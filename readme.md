SpaStack.NET
=================


> SpaStack.NET is a Single Page Application (SPA) web boilerplate framework built from `Durandal.js` `JayData.js` `ASP.NET Web API 2 oData` . It allows you to maintain one slim
> codebase . It be package with PhoneGap for native deployments to Android / iPhone / Blackberry / Windows Phone / Browsers / Windows 8 / etc... It follows MVC patterns on the server side
> and MVVM patterns in the client side.

![Screenshot](/SpaStack.NET/Content/images/SPAStack.PNG)

Build an app in 1 line of code 
-------------------------------
> maybe a few more ;)

1.Create the `server side model` (C#)

```csharp

	public class TodoItem
	{
		[Key]
		public Guid Id { get; set; }
		public String Task { get; set; }
		public Boolean Completed { get; set; }
		public Boolean InSync { get; set; }    
	}

```

2.Create a `Web Api 2 oData Rest Controller` and use `Entity Framework Code first` to create the database

3.Run the Jay Data Service utility to auto create the client side model (JS)
`JaySvcUtil.exe -m http://localhost:65310/odata/$metadata -o App\services\db.js`

```js

	/*//////////////////////////////////////////////////////////////////////////////////////
	////// Autogenerated by JaySvcUtil.exe http://JayData.org for more info        /////////
	//////                             oData  V3                                     /////////
	//////////////////////////////////////////////////////////////////////////////////////*/
	$data.Entity.extend('SpaStack.NET.Models.TodoItem', {
		'Id': { 'key':true,'type':'Edm.Guid','nullable':false,'required':true },
		'Task': { 'type':'Edm.String' },
		'Completed': { 'type':'Edm.Boolean','nullable':false,'required':true },
		'InSync': { 'type':'Edm.Boolean','nullable':false,'required':true }
	});
	$data.EntityContext.extend('MyDb', {
		'TodoItem': { type: $data.EntitySet, elementType: SpaStack.NET.Models.TodoItem}
	});

	$data.generatedContexts = $data.generatedContexts || [];
	$data.generatedContexts.push(MyDb);

```

4.Wire up a `data context` instance on your client (JS)

```js

	var db = new MyDb({
		name: 'oData',
		oDataServiceHost: '/odata'
	});

```

5.Consume the data and display it using a knockout observableArray (JS)

```js

	var remoteTodos = new ko.observableArray();
	var promise = datacontext.db.TodoItem.toArray(remoteTodos);

```

```html

	<table class="table table-striped">
		<thead>
			<tr>
				<th>Task</th>
				<th>Is Synchronized</th>
			</tr>
		</thead>
		<tbody data-bind="foreach: remoteTodos">
			<tr>
				<td contenteditable="true" data-bind="text: Task"></td>
				<td data-bind="text: InSync"></td>
			</tr>
		</tbody>
	</table>

```

It uses the following frameworks:
--------------------------------

Frontend
--------

> * JayData.js – rich data management
> * Durandal.js – navigation, app life cycle and View composition
> * Knockout.js – data bindings
> * Require.js – Modularity with AMD and optimization
> * Toastr.js – pop-up messages
> * Twitter Bootstrap – robust CSS styling
> * Phonegap - Interacting with native mobile/tablet API's in javascript
> * jQuery - DOM
> * jQuery.mmenu - responsive side menu

Backend
-------

> ASP.NET Web API 2 oData Service



To Create a PhoneGap Build App
--------------------------------
1. Review the docs here, https://build.phonegap.com/docs 
2. To get up and running quickly...simply build the app in `test` mode so weyland will build and minify the js together
3. Then reference `main-built.js` in your index.html. 
4. If you use github then simply push the code up and reference your repo on the phonegap build site. If not, you can run the 
`PhoneGapBuild.ps1` and it will output a folder on the desktop. You can manually Zip this folder and 
upload to https://build.phonegap.com . 
5. An app will be built and available for download from the Phonegap Build site.

To Create App Icons
-------------------
You can generate Android icons using this site http://android-ui-utils.googlecode.com/hg/asset-studio/dist/icons-launcher.html#foreground.type=image&foreground.space.trim=0&foreground.space.pad=0&foreColor=fff%2C0&crop=1&backgroundShape=none&backColor=fff%2C100
Then configure the `config.xml` to use them in the build


Custom binding handler - mmenu plugin 
-------------------------------------
To get the jquery.mmenu plugin to work, a durandal custom binding handler was created in  
`services/binding-handlers.js`. This file is loaded at app start in main.js.

<pre>
composition.addBindingHandler('mmenu', {
    init: function (element, valueAccessor, allBindingsAccessor, viewModel) {
        $('a#open-icon-menu').click(function (e) {
            e.stopImmediatePropagation();
            e.preventDefault();
            $(element).trigger('toggle.mm');
        });
        $(element).mmenu();

    }
});
</pre>
