// JayData 1.3.4
// Dual licensed under MIT and GPL v2
// Copyright JayStack Technologies (http://jaydata.org/licensing)
//
// JayData is a standards-based, cross-platform Javascript library and a set of
// practices to access and manipulate data from various online and offline sources.
//
// Credits:
//     Hajnalka Battancs, Dániel József, János Roden, László Horváth, Péter Nochta
//     Péter Zentai, Róbert Bónay, Szabolcs Czinege, Viktor Borza, Viktor Lázár,
//     Zoltán Gyebrovszki, Gábor Dolla
//
// More info: http://jaydata.org
(function(){Object.defineProperty($data.Entity.prototype,"_isNew",{get:function(){return!this.storeToken}});Object.defineProperty($data.Entity.prototype,"_isDirty",{get:function(){return!this._isNew&&this.changedProperties&&0<this.changedProperties.length}});var k=$data.Entity.prototype.save,l=$data.Entity.prototype.remove,i=$data.EntityContext.prototype.saveChanges,m=function(h){var h=h.expression.getJSON(),a=0,g,e;if(0==h.length)return a;for(g=0;g<h.length;g++)e=h.charCodeAt(g),a=(a<<5)-a+e,a&=
a;return a};angular.module("jaydata",["ng",["$provide",function(h){h.factory("$data",["$rootScope","$q",function(a,g){var e={};$data.Entity.prototype.hasOwnProperty=function(a){var b;return this.getType&&this.getType().memberDefinitions?(b=this.getType().memberDefinitions["$"+a])?"property"===b.kind&&b.enumerable:!1:Object.prototype.hasOwnProperty.apply(this,arguments)};$data.Queryable.prototype.toLiveArray=function(d){function b(b,a){if(b){var d="success"===a?c.successHandlers:c.errorHandlers;"completed"===
c.state?b(c):d.push(b);return c}}var j=this;this.toTraceString();var f=m(this);if(e[f])return e[f];var c=[];e[f]=c;c.state="inprogress";c.successHandlers=[];c.errorHandlers=[];d&&"function"===typeof d&&b(d,"success");c.then=c.success=function(c){return b(c,"success")};c.error=function(){return c};c.refresh=function(a){c.length=0;c.state="inprogress";b(a,"success");j.toArray({success:c.resolve,error:c.reject});return c};c.resolve=function(b){c.state="completed";b.forEach(function(b){c.push(b)});c.successHandlers.forEach(function(b){b(c)});
a.$$phase||a.$apply()};c.reject=function(b){c.state="failed";c.errorHandlers.forEach(function(c){c(b)});a.$$phase||a.$apply()};this.toArray({success:c.resolve,error:c.reject});return c};$data.Entity.prototype.save=function(){var d=this,b=g.defer();k.call(d).then(function(){e={};b.resolve(d);a.$$phase||a.$apply()}).fail(function(d){b.reject(d);a.$$phase||a.$apply()});return b.promise};$data.ItemStoreClass.prototype.EntityInstanceSave=function(a,b){var j=$data.ItemStore,f=this;return j._getStoreEntitySet(a,
f).then(function(c){return j._getSaveMode(f,c,b,a).then(function(b){b=b||"add";switch(b){case "add":c.add(f);break;case "attach":c.attach(f,!0);f.entityState=$data.EntityState.Modified;break;default:var a=new $data.PromiseHandler;a.createCallback().error("save mode not supported: "+b);return a.getPromise()}return i.call(c.entityContext).then(function(){j._setStoreAlias(f,c.entityContext.storeToken);return f})})})};$data.ItemStoreClass.prototype.EntityInstanceRemove=function(a){var b=this;return $data.ItemStore._getStoreEntitySet(a,
b).then(function(a){a.remove(b);return i.call(a.entityContext).then(function(){return b})})};$data.ItemStoreClass.prototype.EntityTypeRemoveAll=function(a){return function(b){return $data.ItemStore._getStoreEntitySet(b,a).then(function(b){return b.toArray().then(function(a){a.forEach(function(a){b.remove(a)});return i.call(b.entityContext).then(function(){return a})})})}};$data.ItemStoreClass.prototype.EntityTypeAddMany=function(a){return function(b,e){return $data.ItemStore._getStoreEntitySet(e,
a).then(function(a){var c=a.addMany(b);return i.call(a.entityContext).then(function(){return c})})}};$data.Entity.prototype.remove=function(){var d=g.defer(),b=this;l.call(b).then(function(){e={};d.resolve(b);a.$$phase||a.$apply()}).fail(function(b){d.reject(b);a.$$phase||a.$apply()});return d.promise};$data.EntityContext.prototype.saveChanges=function(){var d=g.defer();i.call(this).then(function(b){e={};d.resolve(b);a.$$phase||a.$apply()}).fail(function(b){d.reject(b);a.$$phase||a.$apply()});return d.promise};
return $data}])}]])})();
