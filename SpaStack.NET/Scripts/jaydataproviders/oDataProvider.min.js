// JayData 1.3.4
// Dual licensed under MIT and GPL v2
// Copyright JayStack Technologies (http://jaydata.org/licensing)
//
// JayData is a standards-based, cross-platform Javascript library and a set of
// practices to access and manipulate data from various online and offline sources.
//
// Credits:
//     Hajnalka Battancs, Dániel József, János Roden, László Horváth, Péter Nochta
//     Péter Zentai, Róbert Bónay, Szabolcs Czinege, Viktor Borza, Viktor Lázár,
//     Zoltán Gyebrovszki, Gábor Dolla
//
// More info: http://jaydata.org
$data.oDataConverter={fromDb:{"$data.Byte":$data.Container.proxyConverter,"$data.SByte":$data.Container.proxyConverter,"$data.Decimal":$data.Container.proxyConverter,"$data.Float":$data.Container.proxyConverter,"$data.Int16":$data.Container.proxyConverter,"$data.Int64":$data.Container.proxyConverter,"$data.ObjectID":$data.Container.proxyConverter,"$data.Integer":$data.Container.proxyConverter,"$data.Int32":$data.Container.proxyConverter,"$data.Number":$data.Container.proxyConverter,"$data.Date":function(a){if(a){if(a instanceof
Date)return a;if("/Date("===a.substring(0,6))return new Date(parseInt(a.substr(6)));-1===a.indexOf("Z")&&!a.match("T.*[+-]")&&(a+="Z");return new Date(a)}return a},"$data.DateTimeOffset":function(a){if(a){if(a instanceof Date)return a;if("/Date("===a.substring(0,6))return new Date(parseInt(a.substr(6)));-1===a.indexOf("Z")&&!a.match("T.*[+-]")&&(a+="Z");return new Date(a)}return a},"$data.Time":$data.Container.proxyConverter,"$data.String":$data.Container.proxyConverter,"$data.Boolean":$data.Container.proxyConverter,
"$data.Blob":function(a){if("string"==typeof a)try{return $data.Container.convertTo(atob(a),"$data.Blob")}catch(b){return a}else return a},"$data.Object":function(a){return void 0===a?new $data.Object:"string"===typeof a?JSON.parse(a):a},"$data.Array":function(a){return void 0===a?new $data.Array:a instanceof $data.Array?a:JSON.parse(a)},"$data.GeographyPoint":function(a){return a?new $data.GeographyPoint(a):a},"$data.GeographyLineString":function(a){return a?new $data.GeographyLineString(a):a},"$data.GeographyPolygon":function(a){return a?
new $data.GeographyPolygon(a):a},"$data.GeographyMultiPoint":function(a){return a?new $data.GeographyMultiPoint(a):a},"$data.GeographyMultiLineString":function(a){return a?new $data.GeographyMultiLineString(a):a},"$data.GeographyMultiPolygon":function(a){return a?new $data.GeographyMultiPolygon(a):a},"$data.GeographyCollection":function(a){return a?new $data.GeographyCollection(a):a},"$data.GeometryPoint":function(a){return a?new $data.GeometryPoint(a):a},"$data.GeometryLineString":function(a){return a?
new $data.GeometryLineString(a):a},"$data.GeometryPolygon":function(a){return a?new $data.GeometryPolygon(a):a},"$data.GeometryMultiPoint":function(a){return a?new $data.GeometryMultiPoint(a):a},"$data.GeometryMultiLineString":function(a){return a?new $data.GeometryMultiLineString(a):a},"$data.GeometryMultiPolygon":function(a){return a?new $data.GeometryMultiPolygon(a):a},"$data.GeometryCollection":function(a){return a?new $data.GeometryCollection(a):a},"$data.Guid":function(a){return a?a.toString():
a}},toDb:{"$data.Entity":$data.Container.proxyConverter,"$data.Byte":$data.Container.proxyConverter,"$data.SByte":$data.Container.proxyConverter,"$data.Decimal":$data.Container.proxyConverter,"$data.Float":$data.Container.proxyConverter,"$data.Int16":$data.Container.proxyConverter,"$data.Int64":$data.Container.proxyConverter,"$data.ObjectID":$data.Container.proxyConverter,"$data.Integer":$data.Container.proxyConverter,"$data.Int32":$data.Container.proxyConverter,"$data.Number":$data.Container.proxyConverter,
"$data.Date":function(a){return a?a.toISOString().replace("Z",""):a},"$data.Time":$data.Container.proxyConverter,"$data.DateTimeOffset":function(a){return a?a.toISOString():a},"$data.String":$data.Container.proxyConverter,"$data.Boolean":$data.Container.proxyConverter,"$data.Blob":function(a){return a?$data.Blob.toBase64(a):a},"$data.Object":$data.Container.proxyConverter,"$data.Array":$data.Container.proxyConverter,"$data.GeographyPoint":$data.Container.proxyConverter,"$data.GeographyLineString":$data.Container.proxyConverter,
"$data.GeographyPolygon":$data.Container.proxyConverter,"$data.GeographyMultiPoint":$data.Container.proxyConverter,"$data.GeographyMultiLineString":$data.Container.proxyConverter,"$data.GeographyMultiPolygon":$data.Container.proxyConverter,"$data.GeographyCollection":$data.Container.proxyConverter,"$data.GeometryPoint":$data.Container.proxyConverter,"$data.GeometryLineString":$data.Container.proxyConverter,"$data.GeometryPolygon":$data.Container.proxyConverter,"$data.GeometryMultiPoint":$data.Container.proxyConverter,
"$data.GeometryMultiLineString":$data.Container.proxyConverter,"$data.GeometryMultiPolygon":$data.Container.proxyConverter,"$data.GeometryCollection":$data.Container.proxyConverter,"$data.Guid":$data.Container.proxyConverter},escape:{"$data.Entity":function(a){return JSON.stringify(a)},"$data.Integer":$data.Container.proxyConverter,"$data.Int32":$data.Container.proxyConverter,"$data.Number":$data.Container.proxyConverter,"$data.Int16":$data.Container.proxyConverter,"$data.Byte":$data.Container.proxyConverter,
"$data.SByte":$data.Container.proxyConverter,"$data.Decimal":function(a){return a?a+"m":a},"$data.Float":function(a){return a?a+"f":a},"$data.Int64":function(a){return a?a+"L":a},"$data.Time":function(a){return a?"time'"+a+"'":a},"$data.DateTimeOffset":function(a){return a?"datetimeoffset'"+a+"'":a},"$data.Date":function(a){return a?"datetime'"+a+"'":a},"$data.String":function(a){return"string"===typeof a?"'"+a.replace(/'/g,"''")+"'":a},"$data.ObjectID":function(a){return"string"===typeof a?"'"+a.replace(/'/g,
"''")+"'":a},"$data.Boolean":function(a){return"boolean"===typeof a?a.toString():a},"$data.Blob":function(a){return a?"X'"+$data.Blob.toHexString($data.Container.convertTo(atob(a),$data.Blob))+"'":a},"$data.Object":function(a){return JSON.stringify(a)},"$data.Array":function(a){return JSON.stringify(a)},"$data.GeographyPoint":function(a){return a?$data.GeographyBase.stringifyToUrl(a):a},"$data.GeographyLineString":function(a){return a?$data.GeographyBase.stringifyToUrl(a):a},"$data.GeographyPolygon":function(a){return a?
$data.GeographyBase.stringifyToUrl(a):a},"$data.GeographyMultiPoint":function(a){return a?$data.GeographyBase.stringifyToUrl(a):a},"$data.GeographyMultiLineString":function(a){return a?$data.GeographyBase.stringifyToUrl(a):a},"$data.GeographyMultiPolygon":function(a){return a?$data.GeographyBase.stringifyToUrl(a):a},"$data.GeographyCollection":function(a){return a?$data.GeographyBase.stringifyToUrl(a):a},"$data.GeometryPoint":function(a){return a?$data.GeometryBase.stringifyToUrl(a):a},"$data.GeometryLineString":function(a){return a?
$data.GeometryBase.stringifyToUrl(a):a},"$data.GeometryPolygon":function(a){return a?$data.GeometryBase.stringifyToUrl(a):a},"$data.GeometryMultiPoint":function(a){return a?$data.GeometryBase.stringifyToUrl(a):a},"$data.GeometryMultiLineString":function(a){return a?$data.GeometryBase.stringifyToUrl(a):a},"$data.GeometryMultiPolygon":function(a){return a?$data.GeometryBase.stringifyToUrl(a):a},"$data.GeometryCollection":function(a){return a?$data.GeometryBase.stringifyToUrl(a):a},"$data.Guid":function(a){return a?
"guid'"+a.toString()+"'":a}},unescape:{"$data.Entity":function(a,b){var c=b||{},e=JSON.parse(a);return e&&c.type?new (Container.resolveType(c.type))(e,{converters:void 0}):e},"$data.Number":function(a){return JSON.parse(a)},"$data.Integer":function(a){return JSON.parse(a)},"$data.Int32":function(a){return JSON.parse(a)},"$data.Byte":function(a){return JSON.parse(a)},"$data.SByte":function(a){return JSON.parse(a)},"$data.Decimal":function(a){return"string"===typeof a&&a.toLowerCase().lastIndexOf("m")===
a.length-1?a.substr(0,a.length-1):a},"$data.Float":function(a){return"string"===typeof a&&a.toLowerCase().lastIndexOf("f")===a.length-1?a.substr(0,a.length-1):a},"$data.Int16":function(a){return JSON.parse(a)},"$data.Int64":function(a){return"string"===typeof a&&a.toLowerCase().lastIndexOf("l")===a.length-1?a.substr(0,a.length-1):a},"$data.Boolean":function(a){return JSON.parse(a)},"$data.Date":function(a){return"string"===typeof a&&/^datetime'/.test(a)?a.slice(9,a.length-1):a},"$data.String":function(a){return"string"===
typeof a&&0===a.indexOf("'")&&a.lastIndexOf("'")===a.length-1?a.slice(1,a.length-1):a},"$data.ObjectID":function(a){return"string"===typeof a&&0===a.indexOf("'")&&a.lastIndexOf("'")===a.length-1?a.slice(1,a.length-1):a},"$data.Guid":function(a){return/^guid'\w{8}-\w{4}-\w{4}-\w{4}-\w{12}'$/.test(a)?(a=a.slice(5,a.length-1),$data.parseGuid(a).toString()):a},"$data.Array":function(a,b){var c=b||{},e=JSON.parse(a)||[];if(e&&c.elementType){var c=Container.resolveType(c.elementType),d=Container.resolveName(c);
c&&c.isAssignableTo&&c.isAssignableTo($data.Entity)&&(d=$data.Entity.fullName);if(Array.isArray(e)){c=$data.oDataConverter.unescape[d];for(d=0;d<e.length;d++)e[d]=c?c(e[d]):e[d]}}return e},"$data.DateTimeOffset":function(a){return"string"===typeof a&&/^datetimeoffset'/.test(a)?$data.Container.convertTo(a.slice(15,a.length-1),$data.DateTimeOffset):a},"$data.Time":function(a){return"string"===typeof a&&/^time'/.test(a)?$data.Container.convertTo(a.slice(5,a.length-1),$data.Time):a},"$data.Blob":function(a){if("string"===
typeof a){if(/^X'/.test(a))return $data.Blob.createFromHexString(a.slice(2,a.length-1));if(/^binary'/.test(a))return $data.Blob.createFromHexString(a.slice(7,a.length-1))}return a},"$data.Object":function(a){return JSON.parse(a)},"$data.GeographyPoint":function(a){return/^geography'POINT\(/i.test(a)?(a=a.slice(10,a.length-1),$data.GeographyBase.parseFromString(a)):a},"$data.GeographyPolygon":function(a){return/^geography'POLYGON\(/i.test(a)?(a=a.slice(10,a.length-1),$data.GeographyBase.parseFromString(a)):
a},"$data.GeometryPoint":function(a){return/^geometry'POINT\(/i.test(a)?(a=a.slice(9,a.length-1),$data.GeometryBase.parseFromString(a)):a},"$data.GeometryPolygon":function(a){return/^geometry'POLYGON\(/i.test(a)?(a=a.slice(9,a.length-1),$data.GeometryBase.parseFromString(a)):a}},xmlEscape:{"$data.Byte":function(a){return a.toString()},"$data.SByte":function(a){return a.toString()},"$data.Decimal":function(a){return a.toString()},"$data.Float":function(a){return a.toString()},"$data.Int16":function(a){return a.toString()},
"$data.Int64":function(a){return a.toString()},"$data.Integer":function(a){return a.toString()},"$data.Int32":function(a){return a.toString()},"$data.Boolean":function(a){return a.toString()},"$data.Blob":function(a){return $data.Blob.toBase64(a)},"$data.Date":function(a){return a.toISOString().replace("Z","")},"$data.DateTimeOffset":function(a){return a.toISOString()},"$data.Time":function(a){return a.toString()},"$data.Number":function(a){return a.toString()},"$data.Integer":function(a){return a.toString()},
"$data.Int32":function(a){return a.toString()},"$data.String":function(a){return a.toString()},"$data.ObjectID":function(a){return a.toString()},"$data.Object":function(a){return JSON.stringify(a)},"$data.Guid":function(a){return a.toString()}},simple:{"$data.Byte":function(a){return a.toString()},"$data.SByte":function(a){return a.toString()},"$data.Decimal":function(a){return a.toString()},"$data.Float":function(a){return a.toString()},"$data.Int16":function(a){return a.toString()},"$data.Int64":function(a){return a.toString()},
"$data.ObjectID":function(a){return a.toString()},"$data.Integer":function(a){return a.toString()},"$data.Int32":function(a){return a.toString()},"$data.Number":function(a){return a.toString()},"$data.Date":function(a){return a instanceof $data.Date?a.toISOString().replace("Z",""):a.toString()},"$data.DateTimeOffset":function(a){return a?a.toISOString():a},"$data.Time":function(a){return a.toString()},"$data.String":function(a){return a.toString()},"$data.Boolean":function(a){return a.toString()},
"$data.Blob":function(a){return a},"$data.Object":function(a){return JSON.stringify(a)},"$data.Array":function(a){return JSON.stringify(a)},"$data.Guid":function(a){return a.toString()},"$data.GeographyPoint":function(a){return JSON.stringify(a)},"$data.GeometryPoint":function(a){return JSON.stringify(a)},"$data.GeographyLineString":function(a){return JSON.stringify(a)},"$data.GeographyPolygon":function(a){return JSON.stringify(a)},"$data.GeographyMultiPoint":function(a){return JSON.stringify(a)},
"$data.GeographyMultiLineString":function(a){return JSON.stringify(a)},"$data.GeographyMultiPolygon":function(a){return JSON.stringify(a)},"$data.GeographyCollection":function(a){return JSON.stringify(a)},"$data.GeometryLineString":function(a){return JSON.stringify(a)},"$data.GeometryPolygon":function(a){return JSON.stringify(a)},"$data.GeometryMultiPoint":function(a){return JSON.stringify(a)},"$data.GeometryMultiLineString":function(a){return JSON.stringify(a)},"$data.GeometryMultiPolygon":function(a){return JSON.stringify(a)},
"$data.GeometryCollection":function(a){return JSON.stringify(a)}}};var datajsPatch;
datajsPatch=function(){if(OData&&OData.jsonHandler&&"useJsonLight"in OData.jsonHandler&&"object"===typeof datajs&&!datajs.version){console.log("!!!!!!! - patch datajs 1.1.0");var a=OData.defaultHandler.read;OData.defaultHandler.read=function(b,e){delete e.contentType;delete e.dataServiceVersion;a.apply(this,arguments)};var b=OData.defaultHandler.write;OData.defaultHandler.write=function(a,e){delete e.contentType;delete e.dataServiceVersion;b.apply(this,arguments)}}datajsPatch=function(){}};
$C("$data.storageProviders.oData.oDataProvider",$data.StorageProviderBase,null,{constructor:function(a,b){"undefined"===typeof OData&&Guard.raise(new Exception("datajs is required","Not Found!"));datajsPatch();this.SqlCommands=[];this.context=b;this.providerConfiguration=$data.typeSystem.extend({dbCreation:$data.storageProviders.DbCreationType.DropTableIfChanged,oDataServiceHost:"/odata.svc",serviceUrl:"",maxDataServiceVersion:"2.0",dataServiceVersion:void 0,setDataServiceVersionToMax:!0,user:null,
password:null,withCredentials:!1,UpdateMethod:"PATCH"},a);this.fixkDataServiceVersions(a);this.context&&this.context._buildDbType_generateConvertToFunction&&this.buildDbType_generateConvertToFunction&&(this.context._buildDbType_generateConvertToFunction=this.buildDbType_generateConvertToFunction);this.context&&this.context._buildDbType_modifyInstanceDefinition&&this.buildDbType_modifyInstanceDefinition&&(this.context._buildDbType_modifyInstanceDefinition=this.buildDbType_modifyInstanceDefinition)},
fixkDataServiceVersions:function(a){this.providerConfiguration.dataServiceVersion>this.providerConfiguration.maxDataServiceVersion&&(this.providerConfiguration.dataServiceVersion=this.providerConfiguration.maxDataServiceVersion);!0===this.providerConfiguration.setDataServiceVersionToMax&&(this.providerConfiguration.dataServiceVersion=this.providerConfiguration.maxDataServiceVersion);if(a&&!a.UpdateMethod&&"3.0">this.providerConfiguration.dataServiceVersion||!this.providerConfiguration.dataServiceVersion)this.providerConfiguration.UpdateMethod=
"MERGE"},initializeStore:function(a){a=$data.typeSystem.createCallbackSetting(a);switch(this.providerConfiguration.dbCreation){case $data.storageProviders.DbCreationType.DropAllExistingTables:var b=this;if(this.providerConfiguration.serviceUrl){var c=[{requestUri:b.providerConfiguration.serviceUrl+"/Delete",method:"POST"},function(){a.success(b.context)},function(){a.success(b.context)}];this.appendBasicAuth(c[0],this.providerConfiguration.user,this.providerConfiguration.password,this.providerConfiguration.withCredentials);
this.context.prepareRequest.call(this,c);OData.request.apply(this,c)}else a.success(b.context);break;default:a.success(this.context)}},buildDbType_generateConvertToFunction:function(a,b){return function(c,e){var d=new a.PhysicalType;d.entityState=c.entityState;a.PhysicalType.memberDefinitions.getPublicMappedProperties().forEach(function(a){d.initData[a.name]=c[a.name]},this);a.Associations&&a.Associations.forEach(function(a){if("*"==a.FromMultiplicity&&"0..1"==a.ToMultiplicity||"0..1"==a.FromMultiplicity&&
"1"==a.ToMultiplicity||"$$unbound"==a.FromMultiplicity){var g=c[a.FromPropertyName];if(void 0!==g)if(g instanceof $data.Array)d.initData[a.FromPropertyName]=d[a.FromPropertyName]||[],g.forEach(function(c){if(c.entityState==$data.EntityState.Modified||0>e.indexOf(c)){var g=b._storageModel.getStorageModel(c.getType()).TableName,c="("+b.storageProvider.getEntityKeysValue({data:c,entitySet:b.getEntitySetFromElementType(c.getType())})+")";d.initData[a.FromPropertyName].push({__metadata:{uri:g+c}})}else g=
e.indexOf(c),0>g&&Guard.raise("Dependency graph error"),d.initData[a.FromPropertyName].push({__metadata:{uri:"$"+(g+1)}})},this);else if(null===g)d.initData[a.FromPropertyName]=null;else if(g.entityState==$data.EntityState.Modified||0>e.indexOf(g)){var h=b._storageModel.getStorageModel(g.getType()).TableName,g="("+b.storageProvider.getEntityKeysValue({data:g,entitySet:b.getEntitySetFromElementType(g.getType())})+")";d.initData[a.FromPropertyName]={__metadata:{uri:h+g}}}else h=e.indexOf(g),0>h&&Guard.raise("Dependency graph error"),
d.initData[a.FromPropertyName]={__metadata:{uri:"$"+(h+1)}}}},this);a.ComplexTypes&&a.ComplexTypes.forEach(function(a){d.initData[a.FromPropertyName]=c[a.FromPropertyName]},this);return d}},buildDbType_modifyInstanceDefinition:function(){},executeQuery:function(a,b){var b=$data.typeSystem.createCallbackSetting(b),c;try{c=this._compile(a)}catch(e){b.error(e);return}var d=this,f=[{requestUri:this.providerConfiguration.oDataServiceHost+c.queryText,method:c.method,data:c.postData,headers:{MaxDataServiceVersion:this.providerConfiguration.maxDataServiceVersion}},
function(d,e){!d&&e.body&&(d=JSON.parse(e.body));if(b.success){a.rawDataList="string"===typeof d?[{cnt:Container.convertTo(d,$data.Integer)}]:d;if(c.withInlineCount&&"object"===typeof d&&("undefined"!==typeof d.__count||"d"in d&&"undefined"!==typeof d.d.__count))a.__count=(new Number("undefined"!==typeof d.__count?d.__count:d.d.__count)).valueOf();b.success(a)}},function(a){b.error(d.parseError(a,arguments))}];this.providerConfiguration.dataServiceVersion&&(f[0].headers.DataServiceVersion=this.providerConfiguration.dataServiceVersion);
"undefined"!==typeof this.providerConfiguration.enableJSONP&&(f[0].enableJsonpCallback=this.providerConfiguration.enableJSONP);"undefined"!==typeof this.providerConfiguration.useJsonLight&&(f[0].useJsonLight=this.providerConfiguration.useJsonLight);this.appendBasicAuth(f[0],this.providerConfiguration.user,this.providerConfiguration.password,this.providerConfiguration.withCredentials);this.context.prepareRequest.call(this,f);OData.request.apply(this,f)},_compile:function(a){return(new $data.storageProviders.oData.oDataCompiler).compile(a)},
saveChanges:function(a,b){0<b.length?this.saveInternal(this.buildIndependentBlocks(b),0,a):a.success(0)},saveInternal:function(a,b,c){(!0===this.providerConfiguration.disableBatch||"object"===typeof $data.defaults&&!0===$data.defaults.disableBatch)&&"function"===typeof this._saveRestMany?this._saveRestMany(a,b,c):1<a.length||1==a.length&&1<a[0].length?this._saveBatch(a,b,c):this._saveRest(a,b,c)},_saveRest:function(a,b,c){for(var e=[],d,b=0;b<a.length;b++)for(var f=0;f<a[b].length;f++)switch(e.push(a[b][f].data),
d={requestUri:this.providerConfiguration.oDataServiceHost+"/",headers:{MaxDataServiceVersion:this.providerConfiguration.maxDataServiceVersion}},this.providerConfiguration.dataServiceVersion&&(d.headers.DataServiceVersion=this.providerConfiguration.dataServiceVersion),"undefined"!==typeof this.providerConfiguration.useJsonLight&&(d.useJsonLight=this.providerConfiguration.useJsonLight),a[b][f].data.entityState){case $data.EntityState.Unchanged:continue;case $data.EntityState.Added:d.method="POST";d.requestUri+=
a[b][f].entitySet.tableName;d.data=this.save_getInitData(a[b][f],e);break;case $data.EntityState.Modified:d.method=this.providerConfiguration.UpdateMethod;d.requestUri+=a[b][f].entitySet.tableName;d.requestUri+="("+this.getEntityKeysValue(a[b][f])+")";this.save_addConcurrencyHeader(a[b][f],d.headers);d.data=this.save_getInitData(a[b][f],e);break;case $data.EntityState.Deleted:d.method="DELETE";d.requestUri+=a[b][f].entitySet.tableName;d.requestUri+="("+this.getEntityKeysValue(a[b][f])+")";this.save_addConcurrencyHeader(a[b][f],
d.headers);break;default:Guard.raise(new Exception("Not supported Entity state"))}var g=this,a=[d,function(a,b){if(200<=b.statusCode&&300>b.statusCode){var d=e[0];if(204==b.statusCode){if(b.headers.ETag||b.headers.Etag||b.headers.etag){var f=d.getType().memberDefinitions.getPublicMappedProperties().filter(function(a){return a.concurrencyMode===$data.ConcurrencyMode.Fixed});f&&f[0]&&(d[f[0].name]=b.headers.ETag||b.headers.Etag||b.headers.etag)}}else g.reload_fromResponse(d,a,b);c.success&&c.success(e.length)}else c.error(g.parseError(b))},
function(a){c.error(g.parseError(a))}];this.appendBasicAuth(a[0],this.providerConfiguration.user,this.providerConfiguration.password,this.providerConfiguration.withCredentials);this.context.prepareRequest.call(this,a);OData.request.apply(this,a)},_saveBatch:function(a,b,c){for(var b=[],e=[],d=0;d<a.length;d++)for(var f=0;f<a[d].length;f++){e.push(a[d][f].data);var g={};g.headers={"Content-Id":e.length,MaxDataServiceVersion:this.providerConfiguration.maxDataServiceVersion};switch(a[d][f].data.entityState){case $data.EntityState.Unchanged:continue;
case $data.EntityState.Added:g.method="POST";g.requestUri=a[d][f].entitySet.tableName;g.data=this.save_getInitData(a[d][f],e);break;case $data.EntityState.Modified:g.method=this.providerConfiguration.UpdateMethod;g.requestUri=a[d][f].entitySet.tableName;g.requestUri+="("+this.getEntityKeysValue(a[d][f])+")";this.save_addConcurrencyHeader(a[d][f],g.headers);g.data=this.save_getInitData(a[d][f],e);break;case $data.EntityState.Deleted:g.method="DELETE";g.requestUri=a[d][f].entitySet.tableName;g.requestUri+=
"("+this.getEntityKeysValue(a[d][f])+")";this.save_addConcurrencyHeader(a[d][f],g.headers);break;default:Guard.raise(new Exception("Not supported Entity state"))}this.providerConfiguration.dataServiceVersion&&(g.headers.DataServiceVersion=this.providerConfiguration.dataServiceVersion);b.push(g)}var h=this,a=[{requestUri:this.providerConfiguration.oDataServiceHost+"/$batch",method:"POST",data:{__batchRequests:[{__changeRequests:b}]},headers:{MaxDataServiceVersion:this.providerConfiguration.maxDataServiceVersion}},
function(a,b){if(202==b.statusCode){for(var d=a.__batchResponses[0].__changeResponses,f=[],g=0;g<d.length;g++)if(200<=d[g].statusCode&&300>d[g].statusCode){var k=e[g];if(204==d[g].statusCode){if(d[g].headers.ETag||d[g].headers.Etag||d[g].headers.etag){var l=k.getType().memberDefinitions.getPublicMappedProperties().filter(function(a){return a.concurrencyMode===$data.ConcurrencyMode.Fixed});l&&l[0]&&(k[l[0].name]=d[g].headers.ETag||d[g].headers.Etag||d[g].headers.etag)}}else h.reload_fromResponse(k,
d[g].data,d[g])}else f.push(h.parseError(d[g]));0<f.length?1===f.length?c.error(f[0]):c.error(new Exception("See inner exceptions","Batch failed",f)):c.success&&c.success(e.length)}else c.error(h.parseError(b))},function(a){c.error(h.parseError(a))},OData.batchHandler];this.providerConfiguration.dataServiceVersion&&(a[0].headers.DataServiceVersion=this.providerConfiguration.dataServiceVersion);"undefined"!==typeof this.providerConfiguration.useJsonLight&&(a[0].useJsonLight=this.providerConfiguration.useJsonLight);
this.appendBasicAuth(a[0],this.providerConfiguration.user,this.providerConfiguration.password,this.providerConfiguration.withCredentials);this.context.prepareRequest.call(this,a);OData.request.apply(this,a)},reload_fromResponse:function(a,b,c){var e=this;a.getType().memberDefinitions.getPublicMappedProperties().forEach(function(d){var f=Container.resolveType(d.type);if(d.computed||d.key||!d.inverseProperty)if(d.concurrencyMode===$data.ConcurrencyMode.Fixed)a[d.name]=c.headers.ETag||c.headers.Etag||
c.headers.etag;else if(d.isAssignableTo)a[d.name]=b[d.name]?new f(b[d.name],{converters:e.fieldConverter.fromDb}):b[d.name];else if(f===$data.Array&&d.elementType)if(f=Container.resolveType(d.elementType),b[d.name]&&Array.isArray(b[d.name])){for(var g=[],h=0;h<b[d.name].length;h++){var i=b[d.name][h];if(f.isAssignableTo&&!Object.isNullOrUndefined(i))g.push(new f(i,{converters:e.fieldConverter.fromDb}));else{var j=Container.resolveName(f),j=e.fieldConverter.fromDb[j];g.push(j?j(i):i)}}a[d.name]=g}else b[d.name]||
(a[d.name]=b[d.name]);else f=Container.resolveName(d.type),f=e.fieldConverter.fromDb[f],a[d.name]=f?f(b[d.name]):b[d.name]},this)},save_getInitData:function(a,b){var c=this;a.physicalData=this.context._storageModel.getStorageModel(a.data.getType()).PhysicalType.convertTo(a.data,b);var e={};a.physicalData.getType().memberDefinitions.asArray().forEach(function(b){if(b.kind==$data.MemberTypes.navProperty||b.kind==$data.MemberTypes.complexProperty||b.kind==$data.MemberTypes.property&&!b.notMapped)if("undefined"===
typeof b.concurrencyMode&&(!0===b.key||a.data.entityState===$data.EntityState.Added||a.data.changedProperties.some(function(a){return a.name===b.name}))){var f=Container.resolveName(b.type),f=c.fieldConverter.toDb[f];e[b.name]=f?f(a.physicalData[b.name]):a.physicalData[b.name]}},this);return e},save_addConcurrencyHeader:function(a,b){var c=a.data.getType().memberDefinitions.getPublicMappedProperties().filter(function(a){return a.concurrencyMode===$data.ConcurrencyMode.Fixed});c&&c[0]&&(b["If-Match"]=
a.data[c[0].name])},getTraceString:function(a){this._compile(a);return a},supportedDataTypes:{value:[$data.Array,$data.Integer,$data.String,$data.Number,$data.Blob,$data.Boolean,$data.Date,$data.Object,$data.GeographyPoint,$data.Guid,$data.GeographyLineString,$data.GeographyPolygon,$data.GeographyMultiPoint,$data.GeographyMultiLineString,$data.GeographyMultiPolygon,$data.GeographyCollection,$data.GeometryPoint,$data.GeometryLineString,$data.GeometryPolygon,$data.GeometryMultiPoint,$data.GeometryMultiLineString,
$data.GeometryMultiPolygon,$data.GeometryCollection,$data.Byte,$data.SByte,$data.Decimal,$data.Float,$data.Int16,$data.Int32,$data.Int64,$data.Time,$data.DateTimeOffset],writable:!1},supportedBinaryOperators:{value:{equal:{mapTo:"eq",dataType:"boolean",allowedIn:[$data.Expressions.FilterExpression,$data.Expressions.OrderExpression]},notEqual:{mapTo:"ne",dataType:"boolean",allowedIn:[$data.Expressions.FilterExpression,$data.Expressions.OrderExpression]},equalTyped:{mapTo:"eq",dataType:"boolean",allowedIn:[$data.Expressions.FilterExpression,
$data.Expressions.OrderExpression]},notEqualTyped:{mapTo:"ne",dataType:"boolean",allowedIn:[$data.Expressions.FilterExpression,$data.Expressions.OrderExpression]},greaterThan:{mapTo:"gt",dataType:"boolean",allowedIn:[$data.Expressions.FilterExpression,$data.Expressions.OrderExpression]},greaterThanOrEqual:{mapTo:"ge",dataType:"boolean",allowedIn:[$data.Expressions.FilterExpression,$data.Expressions.OrderExpression]},lessThan:{mapTo:"lt",dataType:"boolean",allowedIn:[$data.Expressions.FilterExpression,
$data.Expressions.OrderExpression]},lessThenOrEqual:{mapTo:"le",dataType:"boolean",allowedIn:[$data.Expressions.FilterExpression,$data.Expressions.OrderExpression]},or:{mapTo:"or",dataType:"boolean",allowedIn:[$data.Expressions.FilterExpression,$data.Expressions.OrderExpression]},and:{mapTo:"and",dataType:"boolean",allowedIn:[$data.Expressions.FilterExpression,$data.Expressions.OrderExpression]},add:{mapTo:"add",dataType:"number",allowedIn:[$data.Expressions.FilterExpression,$data.Expressions.OrderExpression]},
divide:{mapTo:"div",allowedIn:[$data.Expressions.FilterExpression,$data.Expressions.OrderExpression]},multiply:{mapTo:"mul",allowedIn:[$data.Expressions.FilterExpression,$data.Expressions.OrderExpression]},subtract:{mapTo:"sub",allowedIn:[$data.Expressions.FilterExpression,$data.Expressions.OrderExpression]},modulo:{mapTo:"mod",allowedIn:[$data.Expressions.FilterExpression,$data.Expressions.OrderExpression]},"in":{mapTo:"in",allowedIn:[$data.Expressions.FilterExpression,$data.Expressions.OrderExpression]}}},
supportedUnaryOperators:{value:{not:{mapTo:"not"}}},supportedFieldOperations:{value:{contains:{mapTo:"substringof",dataType:"boolean",allowedIn:[$data.Expressions.FilterExpression,$data.Expressions.OrderExpression],parameters:[{name:"substring",dataType:"string"},{name:"@expression"}]},startsWith:{mapTo:"startswith",dataType:"string",allowedIn:[$data.Expressions.FilterExpression,$data.Expressions.OrderExpression],parameters:[{name:"@expression",dataType:"string"},{name:"strFragment",dataType:"string"}]},
endsWith:{mapTo:"endswith",dataType:"string",allowedIn:[$data.Expressions.FilterExpression,$data.Expressions.OrderExpression],parameters:[{name:"@expression",dataType:"string"},{name:"strFragment",dataType:"string"}]},length:[{allowedType:"string",dataType:"number",allowedIn:[$data.Expressions.FilterExpression,$data.Expressions.ProjectionExpression],parameters:[{name:"@expression",dataType:"string"}]},{allowedType:"GeographyLineString",mapTo:"geo.length",dataType:"number",allowedIn:[$data.Expressions.FilterExpression,
$data.Expressions.OrderExpression],parameters:[{name:"@expression",dataType:["GeographyLineString"]}],fixedDataType:"decimal"},{allowedType:"GeometryLineString",mapTo:"geo.length",dataType:"number",allowedIn:[$data.Expressions.FilterExpression,$data.Expressions.OrderExpression],parameters:[{name:"@expression",dataType:"GeometryLineString"}],fixedDataType:"decimal"}],strLength:{mapTo:"length",dataType:"number",allowedIn:[$data.Expressions.FilterExpression,$data.Expressions.ProjectionExpression],parameters:[{name:"@expression",
dataType:"string"}]},indexOf:{dataType:"number",allowedIn:[$data.Expressions.FilterExpression,$data.Expressions.OrderExpression],mapTo:"indexof",baseIndex:1,parameters:[{name:"@expression",dataType:"string"},{name:"strFragment",dataType:"string"}]},replace:{dataType:"string",allowedIn:[$data.Expressions.FilterExpression,$data.Expressions.OrderExpression],parameters:[{name:"@expression",dataType:"string"},{name:"strFrom",dataType:"string"},{name:"strTo",dataType:"string"}]},substr:{mapTo:"substring",
dataType:"string",allowedIn:[$data.Expressions.FilterExpression,$data.Expressions.OrderExpression],parameters:[{name:"@expression",dataType:"string"},{name:"startFrom",dataType:"number"},{name:"length",dataType:"number",optional:"true"}]},toLowerCase:{mapTo:"tolower",dataType:"string",allowedIn:[$data.Expressions.FilterExpression,$data.Expressions.OrderExpression],parameters:[{name:"@expression",dataType:"string"}]},toUpperCase:{mapTo:"toupper",dataType:"string",allowedIn:[$data.Expressions.FilterExpression,
$data.Expressions.OrderExpression],parameters:[{name:"@expression",dataType:"string"}]},trim:{dataType:"string",allowedIn:[$data.Expressions.FilterExpression,$data.Expressions.OrderExpression],parameters:[{name:"@expression",dataType:"string"}]},concat:{dataType:"string",allowedIn:[$data.Expressions.FilterExpression,$data.Expressions.OrderExpression],parameters:[{name:"@expression",dataType:"string"},{name:"strFragment",dataType:"string"}]},day:{allowedIn:[$data.Expressions.FilterExpression,$data.Expressions.OrderExpression],
parameters:[{name:"@expression",dataType:"date"}]},hour:{allowedIn:[$data.Expressions.FilterExpression,$data.Expressions.OrderExpression],parameters:[{name:"@expression",dataType:"date"}]},minute:{allowedIn:[$data.Expressions.FilterExpression,$data.Expressions.OrderExpression],parameters:[{name:"@expression",dataType:"date"}]},month:{allowedIn:[$data.Expressions.FilterExpression,$data.Expressions.OrderExpression],parameters:[{name:"@expression",dataType:"date"}]},second:{allowedIn:[$data.Expressions.FilterExpression,
$data.Expressions.OrderExpression],parameters:[{name:"@expression",dataType:"date"}]},year:{allowedIn:[$data.Expressions.FilterExpression,$data.Expressions.OrderExpression],parameters:[{name:"@expression",dataType:"date"}]},round:{allowedIn:[$data.Expressions.FilterExpression,$data.Expressions.OrderExpression],parameters:[{name:"@expression",dataType:"date"}]},floor:{allowedIn:[$data.Expressions.FilterExpression,$data.Expressions.OrderExpression],parameters:[{name:"@expression",dataType:"date"}]},
ceiling:{allowedIn:[$data.Expressions.FilterExpression,$data.Expressions.OrderExpression],parameters:[{name:"@expression",dataType:"date"}]},distance:[{allowedType:"GeographyPoint",mapTo:"geo.distance",dataType:"number",allowedIn:[$data.Expressions.FilterExpression,$data.Expressions.OrderExpression],parameters:[{name:"@expression",dataType:"GeographyPoint"},{name:"to",dataType:"GeographyPoint"}],fixedDataType:"decimal"},{allowedType:"GeometryPoint",mapTo:"geo.distance",dataType:"number",allowedIn:[$data.Expressions.FilterExpression,
$data.Expressions.OrderExpression],parameters:[{name:"@expression",dataType:"GeometryPoint"},{name:"to",dataType:"GeometryPoint"}],fixedDataType:"decimal"}],intersects:[{allowedType:"GeographyPoint",mapTo:"geo.intersects",dataType:"boolean",allowedIn:[$data.Expressions.FilterExpression,$data.Expressions.OrderExpression],parameters:[{name:"@expression",dataType:"GeographyPoint"},{name:"in",dataType:"GeographyPolygon"}]},{allowedType:"GeometryPoint",mapTo:"geo.intersects",dataType:"boolean",allowedIn:[$data.Expressions.FilterExpression,
$data.Expressions.OrderExpression],parameters:[{name:"@expression",dataType:"GeometryPoint"},{name:"in",dataType:"GeometryPolygon"}]}]},enumerable:!0,writable:!0},supportedSetOperations:{value:{filter:{},map:{},length:{},forEach:{},toArray:{},single:{},some:{invokable:!1,allowedIn:[$data.Expressions.FilterExpression],parameters:[{name:"filter",dataType:"$data.Queryable"}],mapTo:"any",frameType:$data.Expressions.SomeExpression},every:{invokable:!1,allowedIn:[$data.Expressions.FilterExpression],parameters:[{name:"filter",
dataType:"$data.Queryable"}],mapTo:"all",frameType:$data.Expressions.EveryExpression},take:{},skip:{},orderBy:{},orderByDescending:{},first:{},include:{},batchDelete:{},withInlineCount:{},find:{}},enumerable:!0,writable:!0},fieldConverter:{value:$data.oDataConverter},resolveTypeOperations:function(a,b,c){var e=b.entityType.getMemberDefinition(a);(!e||!e.method||!1!==e.method.IsSideEffecting||!e.method.returnType||!(c===$data.Expressions.FilterExpression||c===$data.Expressions.OrderExpression))&&Guard.raise(new Exception("Entity '"+
b.entityType.name+"' Operation '"+a+"' is not supported by the provider"));return e},resolveSetOperations:function(a,b,c){if(b){var e=b.storageModel.ContextType.getMemberDefinition(b.storageModel.ItemName);if(e&&e.actions&&e.actions[a])return e=$data.MemberDefinition.translateDefinition(e.actions[a],a,this.getType()),(!e||!e.method||!1!==e.method.IsSideEffecting||!e.method.returnType||!(c===$data.Expressions.FilterExpression||c===$data.Expressions.OrderExpression))&&Guard.raise(new Exception("Collection '"+
b.storageModel.ItemName+"' Operation '"+a+"' is not supported by the provider")),e}return $data.StorageProviderBase.prototype.resolveSetOperations.apply(this,arguments)},resolveContextOperations:function(a,b,c){var e=this.context.getType().getMemberDefinition(a);(!e||!e.method||!1!==e.method.IsSideEffecting||!e.method.returnType||!(c===$data.Expressions.FilterExpression||c===$data.Expressions.OrderExpression))&&Guard.raise(new Exception("Context '"+b.instance.getType().name+"' Operation '"+a+"' is not supported by the provider"));
return e},getEntityKeysValue:function(a){for(var b=[],c=void 0,e=a.data.getType().memberDefinitions.getKeyProperties(),d=0,f=e.length;d<f;d++){var g=e[d];if(g.key){var c=a.data[g.name],h=Container.resolveName(g.type),i=this.fieldConverter.toDb[h],c=i?i(c):c,c=(i=this.fieldConverter.escape[h])?i(c):c;b.push(g.name+"="+c)}}return 1<b.length?b.join(","):c},getFieldUrl:function(a,b,c){var a=this.getEntityKeysValue({data:a}),e=this.providerConfiguration.oDataServiceHost;e.lastIndexOf("/")===e.length&&
(e=e.substring(0,e.length-1));return e+"/"+c.tableName+"("+a+")/"+b+"/$value"},parseError:function(a,b){var c=(a.response||a||{}).body||"";try{if(0===c.indexOf("{")){var e=JSON.parse(c),e=e["odata.error"]||e.error||e;e.message&&(c=e.message.value||e.message)}}catch(d){}return new Exception(c,a.message,b||a)},appendBasicAuth:function(a,b,c,e){a.headers=a.headers||{};!a.headers.Authorization&&b&&c&&(a.headers.Authorization="Basic "+this.__encodeBase64(b+":"+c));e&&(a.withCredentials=e)},__encodeBase64:function(a){var b=
"",c,e,d="",f,g,h="",i=0;do c=a.charCodeAt(i++),e=a.charCodeAt(i++),d=a.charCodeAt(i++),f=c>>2,c=(c&3)<<4|e>>4,g=(e&15)<<2|d>>6,h=d&63,isNaN(e)?g=h=64:isNaN(d)&&(h=64),b=b+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(f)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(c)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(g)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(h);while(i<a.length);
return b}},null);$data.StorageProviderBase.registerProvider("oData",$data.storageProviders.oData.oDataProvider);
$C("$data.storageProviders.oData.oDataCompiler",$data.Expressions.EntityExpressionVisitor,null,{constructor:function(){this.context={};this.provider={};this.mainEntitySet=this.includes=null},compile:function(a){this.provider=a.context.storageProvider;this.context=a.context;this.mainEntitySet=a.context.getEntitySetFromElementType(a.defaultType);var b={urlText:""};this.Visit(a.expression,b);a.modelBinderConfig={};Container.createModelBinderConfigCompiler(a,this.includes,!0).Visit(a.expression);var c=
b.urlText,e=!1,d;for(d in b)"urlText"!=d&&"actionPack"!=d&&"data"!=d&&"lambda"!=d&&"method"!=d&&"postData"!=d&&""!=b[d]&&(c=e?c+"&":c+"?",e=!0,c="$urlParams"!=d?c+(d+"="+b[d]):c+b[d]);a.queryText=c;a.postData=b.postData;return{queryText:c,withInlineCount:"$inlinecount"in b,method:b.method||"GET",postData:b.postData,params:[]}},VisitOrderExpression:function(a,b){this.Visit(a.source,b);Container.createoDataOrderCompiler(this.provider).compile(a,b)},VisitPagingExpression:function(a,b){this.Visit(a.source,
b);Container.createoDataPagingCompiler(this.provider).compile(a,b)},VisitIncludeExpression:function(a,b){this.Visit(a.source,b);if(!b.$select){b.$expand=b.$expand?b.$expand+",":"";b.$expand+=a.selector.value.replace(/\./g,"/");this.includes=this.includes||[];for(var c=a.selector.value.split("."),e=null,d=this.mainEntitySet.entityContext._storageModel.getStorageModel(this.mainEntitySet.createNew),f=0;f<c.length;f++)e=e?e+("."+c[f]):c[f],(d=d.Associations[c[f]])?this.includes.some(function(a){return a.name==
e},this)||this.includes.push({name:e,type:d.ToType}):Guard.raise(new Exception("The given include path is invalid: "+a.selector.value+", invalid point: "+e)),d=this.mainEntitySet.entityContext._storageModel.getStorageModel(d.ToType)}},VisitFindExpression:function(a,b){this.Visit(a.source,b);b.urlText+="(";if(1===a.params.length){var c=a.params[0],e=Container.resolveName(c.type),d=this.provider.fieldConverter.toDb[e],d=d?d(c.value):c.value,d=(d=this.provider.fieldConverter.escape[e])?d(c.value):c.value;
b.urlText+=d}else for(var f=0;f<a.params.length;f++)c=a.params[f],e=Container.resolveName(c.type),(d=this.provider.fieldConverter.toDb[e])&&d(c.value),d=(d=this.provider.fieldConverter.escape[e])?d(c.value):c.value,0<f&&(b.urlText+=","),b.urlText+=c.name+"="+d;b.urlText+=")"},VisitProjectionExpression:function(a,b){this.Visit(a.source,b);Container.createoDataProjectionCompiler(this.context).compile(a,b)},VisitFilterExpression:function(a,b){this.Visit(a.source,b);var c=Container.createoDataWhereCompiler(this.provider);
b.data="";c.compile(a.selector,b);b.$filter=b.data;b.data=""},VisitInlineCountExpression:function(a,b){this.Visit(a.source,b);b.$inlinecount=a.selector.value},VisitEntitySetExpression:function(a,b){b.urlText+="/"+a.instance.tableName;if(a.params)for(var c=0;c<a.params.length;c++)this.Visit(a.params[c],b)},VisitServiceOperationExpression:function(a,b){a.boundItem&&(b.urlText+="/"+a.boundItem.entitySet.tableName,a.boundItem.data instanceof $data.Entity&&(b.urlText+="("+this.provider.getEntityKeysValue(a.boundItem)+
")"));b.urlText+="/"+a.cfg.serviceName;b.method=b.method||a.cfg.method;if(a.params)for(var c=0;c<a.params.length;c++)this.Visit(a.params[c],b)},VisitBatchDeleteExpression:function(a,b){this.Visit(a.source,b);b.urlText+="/$batchDelete";b.method="DELETE"},VisitConstantExpression:function(a,b){var c=Container.resolveName(a.type);a.value instanceof $data.Entity&&(c=$data.Entity.fullName);var e=this.provider.fieldConverter.toDb[c],d=e?e(a.value):a.value;"GET"===b.method||!b.method?(d=(e=this.provider.fieldConverter.escape[c])?
e(d):d,void 0!==d&&(b.$urlParams=b.$urlParams?b.$urlParams+"&":"",b.$urlParams+=a.name+"="+d)):(b.postData=b.postData||{},b.postData[a.name]=d)},VisitCountExpression:function(a,b){this.Visit(a.source,b);b.urlText+="/$count"}},{});
$C("$data.storageProviders.oData.oDataWhereCompiler",$data.Expressions.EntityExpressionVisitor,null,{constructor:function(a,b){this.provider=a;this.lambdaPrefix=b},compile:function(a,b){this.Visit(a,b)},VisitParametricQueryExpression:function(a,b){this.Visit(a.expression,b)},VisitUnaryExpression:function(a,b){b.data+=a.resolution.mapTo;b.data+="(";this.Visit(a.operand,b);b.data+=")"},VisitSimpleBinaryExpression:function(a,b){b.data+="(";if("in"==a.nodeType){Guard.requireType("expression.right",a.type,
$data.Expressions.ConstantExpression);var c=a.right.value;!c instanceof Array&&Guard.raise(new Exception("Right to the 'in' operator must be an array value"));var e=null,d={mapTo:"or",dataType:"boolean",name:"or"},f={mapTo:"eq",dataType:"boolean",name:"equal"};c.forEach(function(b){b=Container.createSimpleBinaryExpression(a.left,b,$data.Expressions.ExpressionType.Equal,"==","boolean",f);e=e?Container.createSimpleBinaryExpression(e,b,$data.Expressions.ExpressionType.Or,"||","boolean",d):b});c=b.data;
b.data="";this.Visit(e,b);b.data=c+b.data.replace(/\(/g,"").replace(/\)/g,"")}else this.Visit(a.left,b),b.data+=" ",b.data+=a.resolution.mapTo,b.data+=" ",this.Visit(a.right,b);b.data+=")"},VisitEntityFieldExpression:function(a,b){this.Visit(a.source,b);a.source instanceof $data.Expressions.ComplexTypeExpression&&(b.data+="/");this.Visit(a.selector,b)},VisitAssociationInfoExpression:function(a,b){b.data+=a.associationInfo.FromPropertyName},VisitMemberInfoExpression:function(a,b){b.data+=a.memberName},
VisitQueryParameterExpression:function(a,b){var c=Container.resolveName(a.type),e=this.provider.fieldConverter.toDb[c],d=e?e(a.value):a.value,e=this.provider.fieldConverter.escape[c];b.data+=e?e(d):d},VisitEntityFieldOperationExpression:function(a,b){Guard.requireType("expression.operation",a.operation,$data.Expressions.MemberInfoExpression);var c=a.operation.memberDefinition;b.data+=c.mapTo||c.name;b.data+="(";var e=0;(c.parameters||[{name:"@expression"}]).map(function(b){return"@expression"===b.name?
a.source:a.parameters[e++]}).forEach(function(a,c){0<c&&(b.data+=",");this.Visit(a,b)},this);b.data+=")"},VisitEntityFunctionOperationExpression:function(a,b){Guard.requireType("expression.operation",a.operation,$data.Expressions.MemberInfoExpression);this.Visit(a.source,b);var c=a.operation.memberDefinition;b.data+=c.mapTo||c.name;b.data+="(";var e=0,d=c.method.params||[{name:"@expression"}],f=0;d.map(function(b){return"@expression"===b.name?a.source:a.parameters[e++]}).forEach(function(a,c){void 0===
a||a instanceof $data.Expressions.ConstantExpression&&"undefined"===typeof a.value||(0<f&&(b.data+=","),f++,b.data+=d[c].name+"=",this.Visit(a,b))},this);b.data+=")"},VisitContextFunctionOperationExpression:function(a,b){return this.VisitEntityFunctionOperationExpression(a,b)},VisitConstantExpression:function(a,b){var c=Container.resolveName(a.type),e=this.provider.fieldConverter.toDb[c],d=e?e(a.value):a.value,e=this.provider.fieldConverter.escape[c];b.data+=e?e(d):d},VisitEntityExpression:function(a,
b){this.Visit(a.source,b);this.lambdaPrefix&&a.selector.lambda&&(b.lambda=a.selector.lambda,b.data+=a.selector.lambda+"/")},VisitEntitySetExpression:function(a,b){this.Visit(a.source,b);a.selector instanceof $data.Expressions.AssociationInfoExpression&&(this.Visit(a.selector,b),b.data+="/")},VisitFrameOperationExpression:function(a,b){this.Visit(a.source,b);Guard.requireType("expression.operation",a.operation,$data.Expressions.MemberInfoExpression);var c=a.operation.memberDefinition;b.data+=c.mapTo||
c.name;b.data+="(";for(var e=0,d=(c.parameters||[{name:"@expression"}]).map(function(b){return"@expression"===b.name?a.source:a.parameters[e++]}),f=0;f<d.length;f++){var g=d[f];if(g&&g.value instanceof $data.Queryable){var h=new c.frameType(g.value.expression),g=Container.createQueryExpressionCreator(g.value.entityContext).Visit(h),h={data:""};(new $data.storageProviders.oData.oDataWhereCompiler(this.provider,!0)).compile(g,h);b.data+=h.lambda+": "+h.data}}b.data+=")"}});
$C("$data.storageProviders.oData.oDataOrderCompiler",$data.storageProviders.oData.oDataWhereCompiler,null,{constructor:function(a){this.provider=a},compile:function(a,b){this.Visit(a,b)},VisitOrderExpression:function(a,b){var c={data:""};this.Visit(a.selector,c);b.$orderby=b.$orderby?b.$orderby+",":"";b.$orderby+=c.data+(a.nodeType==$data.Expressions.ExpressionType.OrderByDescending?" desc":"")},VisitParametricQueryExpression:function(a,b){this.Visit(a.expression,b)},VisitEntityFieldExpression:function(a,
b){this.Visit(a.source,b);this.Visit(a.selector,b)},VisitComplexTypeExpression:function(a,b){this.Visit(a.source,b);this.Visit(a.selector,b);b.data+="/"},VisitEntitySetExpression:function(a,b){a.selector instanceof $data.Expressions.AssociationInfoExpression&&(this.Visit(a.source,b),this.Visit(a.selector,b))},VisitAssociationInfoExpression:function(a,b){b.data+=a.associationInfo.FromPropertyName+"/"},VisitEntityExpression:function(a,b){this.Visit(a.source,b);this.Visit(a.selector,b)},VisitMemberInfoExpression:function(a,
b){b.data+=a.memberName},VisitEntityFieldOperationExpression:function(a,b){Guard.requireType("expression.operation",a.operation,$data.Expressions.MemberInfoExpression);var c=a.operation.memberDefinition;b.data+=c.mapTo||c.name;b.data+="(";var e=0;(c.parameters||[{name:"@expression"}]).map(function(b){return"@expression"===b.name?a.source:a.parameters[e++]}).forEach(function(a,c){0<c&&(b.data+=",");this.Visit(a,b)},this);b.data+=")"},VisitEntityFunctionOperationExpression:function(a,b){Guard.requireType("expression.operation",
a.operation,$data.Expressions.MemberInfoExpression);this.Visit(a.source,b);var c=a.operation.memberDefinition;b.data+=c.mapTo||c.name;b.data+="(";var e=0,d=c.method.params||[{name:"@expression"}],f=0;d.map(function(b){return"@expression"===b.name?a.source:a.parameters[e++]}).forEach(function(a,c){void 0===a||a instanceof $data.Expressions.ConstantExpression&&"undefined"===typeof a.value||(0<f&&(b.data+=","),f++,b.data+=d[c].name+"=",this.Visit(a,b))},this);b.data+=")"},VisitContextFunctionOperationExpression:function(a,
b){return this.VisitEntityFunctionOperationExpression(a,b)}});
$C("$data.storageProviders.oData.oDataPagingCompiler",$data.Expressions.EntityExpressionVisitor,null,{constructor:function(a){this.provider=a},compile:function(a,b){this.Visit(a,b)},VisitPagingExpression:function(a,b){var c={data:""};this.Visit(a.amount,c);switch(a.nodeType){case $data.Expressions.ExpressionType.Skip:b.$skip=c.data;break;case $data.Expressions.ExpressionType.Take:b.$top=c.data;break;default:Guard.raise("Not supported nodeType")}},VisitConstantExpression:function(a,b){var c=this.provider.fieldConverter.escape[Container.resolveName(a.type)];
b.data+=c?c(a.value):a.value}});
$C("$data.storageProviders.oData.oDataProjectionCompiler",$data.Expressions.EntityExpressionVisitor,null,{constructor:function(a){this.entityContext=a;this.hasObjectLiteral=!1;this.ObjectLiteralPath="";this.modelBinderMapping=[]},compile:function(a,b){this.Visit(a,b)},VisitProjectionExpression:function(a,b){this.mapping=b.data="";this.Visit(a.selector,b);b.$select=b.$select?b.$select+",":"";b.$select+=b.data;b.data=""},VisitParametricQueryExpression:function(a,b){this.Visit(a.expression,b);if(a.expression instanceof
$data.Expressions.EntityExpression||a.expression instanceof $data.Expressions.EntitySetExpression)b.$expand=b.$expand?b.$expand+",":"",b.$expand+=this.mapping.replace(/\./g,"/");var c=this.mapping.split(".");c.pop();0<c.length&&(b.$expand=b.$expand?b.$expand+",":"",b.$expand+=c.join("/"))},VisitObjectLiteralExpression:function(a,b){var c=this.ObjectLiteralPath;this.hasObjectLiteral=!0;a.members.forEach(function(c,d){this.Visit(c,b);d<a.members.length-1&&(b.data+=",");this.mapping=""},this);this.ObjectLiteralPath=
c},VisitObjectFieldExpression:function(a,b){this.ObjectLiteralPath=this.ObjectLiteralPath?this.ObjectLiteralPath+("."+a.fieldName):a.fieldName;this.Visit(a.expression,b);if(a.expression instanceof $data.Expressions.EntityExpression||a.expression instanceof $data.Expressions.EntitySetExpression)b.$expand=b.$expand?b.$expand+",":"",b.$expand+=this.mapping.replace(/\./g,"/");else{var c=this.mapping.split(".");c.pop();0<c.length&&(b.$expand=b.$expand?b.$expand+",":"",b.$expand+=c.join("/"))}},VisitComplexTypeExpression:function(a,
b){this.Visit(a.source,b);this.Visit(a.selector,b)},VisitEntityFieldExpression:function(a,b){this.Visit(a.source,b);this.Visit(a.selector,b)},VisitEntityExpression:function(a,b){this.Visit(a.source,b)},VisitEntitySetExpression:function(a,b){a.source instanceof $data.Expressions.EntityExpression&&this.Visit(a.source,b);a.selector instanceof $data.Expressions.AssociationInfoExpression&&this.Visit(a.selector,b)},VisitAssociationInfoExpression:function(a,b){b.data&&0<b.data.length&&","!=b.data[b.data.length-
1]&&(b.data+="/");b.data+=a.associationInfo.FromPropertyName;this.mapping&&0<this.mapping.length&&(this.mapping+=".");this.mapping+=a.associationInfo.FromPropertyName},VisitMemberInfoExpression:function(a,b){b.data&&0<b.data.length&&","!=b.data[b.data.length-1]&&(b.data+="/");b.data+=a.memberName;this.mapping&&0<this.mapping.length&&(this.mapping+=".");this.mapping+=a.memberName},VisitConstantExpression:function(a,b){b.data=b.data.slice(0,b.data.length-1)}});
