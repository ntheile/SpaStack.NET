// JayData 1.3.4
// Dual licensed under MIT and GPL v2
// Copyright JayStack Technologies (http://jaydata.org/licensing)
//
// JayData is a standards-based, cross-platform Javascript library and a set of
// practices to access and manipulate data from various online and offline sources.
//
// Credits:
//     Hajnalka Battancs, Dániel József, János Roden, László Horváth, Péter Nochta
//     Péter Zentai, Róbert Bónay, Szabolcs Czinege, Viktor Borza, Viktor Lázár,
//     Zoltán Gyebrovszki, Gábor Dolla
//
// More info: http://jaydata.org
(function(a){if("object"==typeof exports&&"object"==typeof module)return a(exports);if("function"==typeof define&&define.amd)return define(["exports"],a);a(self.acorn||(self.acorn={}))})(function(a){function b(a){u=a||{};for(var b in Ua)u.hasOwnProperty(b)||(u[b]=Ua[b]);xa=u.sourceFile||null}function c(a,b){var c=sb(m,a),b=b+(" ("+c.line+":"+c.column+")"),d=new SyntaxError(b);d.pos=a;d.loc=c;d.raisedAt=k;throw d;}function d(a){function b(a){if(1==a.length)return c+="return str === "+JSON.stringify(a[0])+
";";c+="switch(str){";for(var d=0;d<a.length;++d)c+="case "+JSON.stringify(a[d])+":";c+="return true}return false;"}var a=a.split(" "),c="",d=[],e=0;a:for(;e<a.length;++e){for(var f=0;f<d.length;++f)if(d[f][0].length==a[e].length){d[f].push(a[e]);continue a}d.push([a[e]])}if(3<d.length){d.sort(function(a,b){return b.length-a.length});c+="switch(str.length){";for(e=0;e<d.length;++e)a=d[e],c+="case "+a[0].length+":",b(a);c+="}"}else b(a);return new Function("str",c)}function e(a){return 65>a?36===a:
91>a?!0:97>a?95===a:123>a?!0:170<=a&&Va.test(String.fromCharCode(a))}function f(a){return 48>a?36===a:58>a?!0:65>a?!1:91>a?!0:97>a?95===a:123>a?!0:170<=a&&tb.test(String.fromCharCode(a))}function g(){this.line=Q;this.column=k-K}function h(){Q=1;k=K=0;na=!0;j()}function i(a,b){ba=k;u.locations&&(oa=new g);s=a;j();R=b;na=a.beforeExpr}function j(){for(;k<Y;){var a=m.charCodeAt(k);if(32===a)++k;else if(13===a)++k,a=m.charCodeAt(k),10===a&&++k,u.locations&&(++Q,K=k);else if(10===a)++k,++Q,K=k;else if(14>
a&&8<a)++k;else if(47===a)if(a=m.charCodeAt(k+1),42===a){var a=u.onComment&&u.locations&&new g,b=k,d=m.indexOf("*/",k+=2);-1===d&&c(k-2,"Unterminated comment");k=d+2;if(u.locations){ca.lastIndex=b;for(var e=void 0;(e=ca.exec(m))&&e.index<k;)++Q,K=e.index+e[0].length}if(u.onComment)u.onComment(!0,m.slice(b+2,d),b,k,a,u.locations&&new g)}else if(47===a){a=k;b=u.onComment&&u.locations&&new g;for(d=m.charCodeAt(k+=2);k<Y&&10!==d&&13!==d&&8232!==d&&8329!==d;)++k,d=m.charCodeAt(k);if(u.onComment)u.onComment(!1,
m.slice(a+2,k),a,k,b,u.locations&&new g)}else break;else if(14>a&&8<a||32===a||160===a)++k;else if(5760<=a&&ub.test(String.fromCharCode(a)))++k;else break}}function l(a){switch(a){case 46:return a=m.charCodeAt(k+1),48<=a&&57>=a?a=E(!0):(++k,a=i(ya)),a;case 40:return++k,i(N);case 41:return++k,i(L);case 59:return++k,i(O);case 44:return++k,i(S);case 91:return++k,i(pa);case 93:return++k,i(qa);case 123:return++k,i(da);case 125:return++k,i(Z);case 58:return++k,i(ea);case 63:return++k,i(za);case 48:if(a=
m.charCodeAt(k+1),120===a||88===a)return k+=2,a=C(16),null==a&&c(G+2,"Expected hexadecimal number"),e(m.charCodeAt(k))&&c(k,"Identifier directly after number"),i(fa,a);case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:return E(!1);case 34:case 39:var b;a:{k++;for(var d="";;){k>=Y&&c(G,"Unterminated string constant");var f=m.charCodeAt(k);if(f===a){++k;b=i(ia,d);break a}if(92===f){var f=m.charCodeAt(++k),g=/^[0-7]+/.exec(m.slice(k,k+3));for(g&&(g=g[0]);g&&255<parseInt(g,8);)g=
g.slice(0,g.length-1);"0"===g&&(g=null);++k;if(g)J&&c(k-2,"Octal literal in strict mode"),d+=String.fromCharCode(parseInt(g,8)),k+=g.length-1;else switch(f){case 110:d+="\n";break;case 114:d+="\r";break;case 120:d+=String.fromCharCode(z(2));break;case 117:d+=String.fromCharCode(z(4));break;case 85:d+=String.fromCharCode(z(8));break;case 116:d+="\t";break;case 98:d+="\u0008";break;case 118:d+="\x0B";break;case 102:d+="\u000c";break;case 48:d+="\x00";break;case 13:10===m.charCodeAt(k)&&++k;case 10:u.locations&&
(K=k,++Q);break;default:d+=String.fromCharCode(f)}}else(13===f||10===f||8232===f||8329===f)&&c(G,"Unterminated string constant"),d+=String.fromCharCode(f),++k}}return b;case 47:return a=m.charCodeAt(k+1),na?(++k,a=p()):a=61===a?q(ga,2):q(Aa,1),a;case 37:case 42:return 61===m.charCodeAt(k+1)?q(ga,2):q(vb,1);case 124:case 38:return b=m.charCodeAt(k+1),b===a?q(124===a?wb:xb,2):61===b?q(ga,2):q(124===a?yb:zb,1);case 94:return 61===m.charCodeAt(k+1)?q(ga,2):q(Ab,1);case 43:case 45:return b=m.charCodeAt(k+
1),b===a?q(Bb,2):61===b?q(ga,2):q(Cb,1);case 60:case 62:return b=m.charCodeAt(k+1),d=1,b===a?(d=62===a&&62===m.charCodeAt(k+2)?3:2,a=61===m.charCodeAt(k+d)?q(ga,d+1):q(Db,d)):(61===b&&(d=61===m.charCodeAt(k+2)?3:2),a=q(Eb,d)),a;case 61:case 33:return 61===m.charCodeAt(k+1)?q(Fb,61===m.charCodeAt(k+2)?3:2):q(61===a?Ba:Wa,1);case 126:return q(Wa,1)}return!1}function w(a){a?k=G+1:G=k;u.locations&&(ra=new g);if(a)return p();if(k>=Y)return i(sa);var b=m.charCodeAt(k);if(e(b)||92===b)return v();a=l(b);
if(!1===a){b=String.fromCharCode(b);if("\\"===b||Va.test(b))return v();c(k,"Unexpected character '"+b+"'")}return a}function q(a,b){var c=m.slice(k,k+b);k+=b;i(a,c)}function p(){for(var a="",b,d,e=k;;){k>=Y&&c(e,"Unterminated regular expression");a=m.charAt(k);Ca.test(a)&&c(e,"Unterminated regular expression");if(b)b=!1;else{if("["===a)d=!0;else if("]"===a&&d)d=!1;else if("/"===a&&!d)break;b="\\"===a}++k}a=m.slice(e,k);++k;(b=n())&&!/^[gmsiy]*$/.test(b)&&c(e,"Invalid regexp flag");return i(Da,RegExp(a,
b))}function C(a,b){for(var c=k,d=0,e=0,f=null==b?Infinity:b;e<f;++e){var g=m.charCodeAt(k),g=97<=g?g-97+10:65<=g?g-65+10:48<=g&&57>=g?g-48:Infinity;if(g>=a)break;++k;d=d*a+g}return k===c||null!=b&&k-c!==b?null:d}function E(a){var b=k,d=!1,f=48===m.charCodeAt(k);!a&&null===C(10)&&c(b,"Invalid number");46===m.charCodeAt(k)&&(++k,C(10),d=!0);a=m.charCodeAt(k);if(69===a||101===a)a=m.charCodeAt(++k),(43===a||45===a)&&++k,null===C(10)&&c(b,"Invalid number"),d=!0;e(m.charCodeAt(k))&&c(k,"Identifier directly after number");
var a=m.slice(b,k),g;d?g=parseFloat(a):!f||1===a.length?g=parseInt(a,10):/[89]/.test(a)||J?c(b,"Invalid number"):g=parseInt(a,8);return i(fa,g)}function z(a){a=C(16,a);null===a&&c(G,"Bad character escape sequence");return a}function n(){ha=!1;for(var a,b=!0,d=k;;){var g=m.charCodeAt(k);if(f(g))ha&&(a+=m.charAt(k)),++k;else if(92===g){ha||(a=m.slice(d,k));ha=!0;117!=m.charCodeAt(++k)&&c(k,"Expecting Unicode escape sequence \\uXXXX");++k;var g=z(4),j=String.fromCharCode(g);j||c(k-1,"Invalid Unicode escape");
(b?e(g):f(g))||c(k-4,"Invalid Unicode escape");a+=j}else break;b=!1}return ha?a:m.slice(d,k)}function v(){var a=n(),b=aa;ha||(Gb(a)?b=Ea[a]:(u.forbidReserved&&(3===u.ecmaVersion?Hb:Ib)(a)||J&&Xa(a))&&c(G,"The keyword '"+a+"' is reserved"));return i(b,a)}function r(){Fa=G;X=ba;Ga=oa;w()}function T(a){J=a;for(k=X;k<K;)K=m.lastIndexOf("\n",K-2)+1,--Q;j();w()}function P(){this.type=null;this.start=G;this.end=null}function A(){this.start=ra;this.end=null;null!==xa&&(this.source=xa)}function t(){var a=
new P;u.locations&&(a.loc=new A);u.ranges&&(a.range=[G,0]);return a}function y(a){var b=new P;b.start=a.start;u.locations&&(b.loc=new A,b.loc.start=a.loc.start);u.ranges&&(b.range=[a.range[0],0]);return b}function o(a,b){a.type=b;a.end=X;u.locations&&(a.loc.end=Ga);u.ranges&&(a.range[1]=X);return a}function D(a){return 5<=u.ecmaVersion&&"ExpressionStatement"===a.type&&"Literal"===a.expression.type&&"use strict"===a.expression.value}function x(a){if(s===a)return r(),!0}function U(){return!u.strictSemicolons&&
(s===sa||s===Z||Ca.test(m.slice(X,G)))}function H(){!x(O)&&!U()&&V()}function B(a){s===a?r():V()}function V(){c(G,"Unexpected token")}function ta(a){"Identifier"!==a.type&&"MemberExpression"!==a.type&&c(a.start,"Assigning to rvalue");J&&"Identifier"===a.type&&ua(a.name)&&c(a.start,"Assigning to "+a.name+" in strict mode")}function M(){s===Aa&&w(!0);var a=s,b=t();switch(a){case Ha:case Ya:r();var d=a===Ha;x(O)||U()?b.label=null:s!==aa?V():(b.label=W(),H());for(var e=0;e<F.length;++e){var f=F[e];if(null==
b.label||f.name===b.label.name){if(null!=f.kind&&(d||"loop"===f.kind))break;if(b.label&&d)break}}e===F.length&&c(b.start,"Unsyntactic "+a.keyword);return o(b,d?"BreakStatement":"ContinueStatement");case Za:return r(),H(),o(b,"DebuggerStatement");case $a:return r(),F.push(Ia),b.body=M(),F.pop(),B(Ja),b.test=ja(),H(),o(b,"DoWhileStatement");case ab:r();F.push(Ia);B(N);if(s===O)return Ka(b,null);if(s===La)return a=t(),r(),bb(a,!0),1===a.declarations.length&&x(va)?cb(b,a):Ka(b,a);a=I(!1,!0);return x(va)?
(ta(a),cb(b,a)):Ka(b,a);case Ma:return r(),Na(b,!0);case db:return r(),b.test=ja(),b.consequent=M(),b.alternate=x(eb)?M():null,o(b,"IfStatement");case fb:return ka||c(G,"'return' outside of function"),r(),x(O)||U()?b.argument=null:(b.argument=I(),H()),o(b,"ReturnStatement");case Oa:r();b.discriminant=ja();b.cases=[];B(da);for(F.push(Jb);s!=Z;)s===Pa||s===gb?(a=s===Pa,e&&o(e,"SwitchCase"),b.cases.push(e=t()),e.consequent=[],r(),a?e.test=I():(d&&c(Fa,"Multiple default clauses"),d=!0,e.test=null),B(ea)):
(e||V(),e.consequent.push(M()));e&&o(e,"SwitchCase");r();F.pop();return o(b,"SwitchStatement");case hb:return r(),Ca.test(m.slice(X,G))&&c(X,"Illegal newline after throw"),b.argument=I(),H(),o(b,"ThrowStatement");case ib:return r(),b.block=la(),b.handler=null,s===jb&&(a=t(),r(),B(N),a.param=W(),J&&ua(a.param.name)&&c(a.param.start,"Binding "+a.param.name+" in strict mode"),B(L),a.guard=null,a.body=la(),b.handler=o(a,"CatchClause")),b.finalizer=x(kb)?la():null,!b.handler&&!b.finalizer&&c(b.start,"Missing catch or finally clause"),
o(b,"TryStatement");case La:return r(),b=bb(b),H(),b;case Ja:return r(),b.test=ja(),F.push(Ia),b.body=M(),F.pop(),o(b,"WhileStatement");case lb:return J&&c(G,"'with' in strict mode"),r(),b.object=ja(),b.body=M(),o(b,"WithStatement");case da:return la();case O:return r(),o(b,"EmptyStatement");default:d=R;f=I();if(a===aa&&"Identifier"===f.type&&x(ea)){for(e=0;e<F.length;++e)F[e].name===d&&c(f.start,"Label '"+d+"' is already declared");F.push({name:d,kind:s.isLoop?"loop":s===Oa?"switch":null});b.body=
M();F.pop();b.label=f;return o(b,"LabeledStatement")}b.expression=f;H();return o(b,"ExpressionStatement")}}function ja(){B(N);var a=I();B(L);return a}function la(){var a=t(),b=!0,c=!1,d;a.body=[];for(B(da);!x(Z);){var e=M();a.body.push(e);b&&D(e)&&(d=c,T(c=!0));b=!1}c&&!d&&T(!1);return o(a,"BlockStatement")}function Ka(a,b){a.init=b;B(O);a.test=s===O?null:I();B(O);a.update=s===L?null:I();B(L);a.body=M();F.pop();return o(a,"ForStatement")}function cb(a,b){a.left=b;a.right=I();B(L);a.body=M();F.pop();
return o(a,"ForInStatement")}function bb(a,b){a.declarations=[];for(a.kind="var";;){var d=t();d.id=W();J&&ua(d.id.name)&&c(d.id.start,"Binding "+d.id.name+" in strict mode");d.init=x(Ba)?I(!0,b):null;a.declarations.push(o(d,"VariableDeclarator"));if(!x(S))break}return o(a,"VariableDeclaration")}function I(a,b){var c=Qa(b);if(!a&&s===S){var d=y(c);for(d.expressions=[c];x(S);)d.expressions.push(Qa(b));return o(d,"SequenceExpression")}return c}function Qa(a){var b;b=Ra(Sa(a),-1,a);if(x(za)){var c=y(b);
c.test=b;c.consequent=I(!0);B(ea);c.alternate=I(!0,a);b=o(c,"ConditionalExpression")}return s.isAssign?(c=y(b),c.operator=R,c.left=b,r(),c.right=Qa(a),ta(b),o(c,"AssignmentExpression")):b}function Ra(a,b,c){var d=s.binop;if(null!=d&&(!c||s!==va)&&d>b){var e=y(a);e.left=a;e.operator=R;r();e.right=Ra(Sa(c),d,c);e=o(e,/&&|\|\|/.test(e.operator)?"LogicalExpression":"BinaryExpression");return Ra(e,b,c)}return a}function Sa(a){if(s.prefix){var b=t(),d=s.isUpdate;b.operator=R;b.prefix=!0;r();b.argument=
Sa(a);d?ta(b.argument):J&&"delete"===b.operator&&"Identifier"===b.argument.type&&c(b.start,"Deleting local variable in strict mode");return o(b,d?"UpdateExpression":"UnaryExpression")}for(a=ma(wa());s.postfix&&!U();)b=y(a),b.operator=R,b.prefix=!1,b.argument=a,ta(a),r(),a=o(b,"UpdateExpression");return a}function ma(a,b){if(x(ya)){var c=y(a);c.object=a;c.property=W(!0);c.computed=!1;return ma(o(c,"MemberExpression"),b)}return x(pa)?(c=y(a),c.object=a,c.property=I(),c.computed=!0,B(qa),ma(o(c,"MemberExpression"),
b)):!b&&x(N)?(c=y(a),c.callee=a,c.arguments=Ta(L,!1),ma(o(c,"CallExpression"),b)):a}function wa(){switch(s){case mb:var a=t();r();return o(a,"ThisExpression");case aa:return W();case fa:case ia:case Da:return a=t(),a.value=R,a.raw=m.slice(G,ba),r(),o(a,"Literal");case nb:case ob:case pb:return a=t(),a.value=s.atomValue,a.raw=s.keyword,r(),o(a,"Literal");case N:var a=ra,b=G;r();var d=I();d.start=b;d.end=ba;u.locations&&(d.loc.start=a,d.loc.end=oa);u.ranges&&(d.range=[b,ba]);B(L);return d;case pa:return a=
t(),r(),a.elements=Ta(qa,!0,!0),o(a,"ArrayExpression");case da:a=t();b=!0;d=!1;a.properties=[];for(r();!x(Z);){if(b)b=!1;else if(B(S),u.allowTrailingCommas&&x(Z))break;var e={key:s===fa||s===ia?wa():W(!0)},f=!1,g;x(ea)?(e.value=I(!0),g=e.kind="init"):5<=u.ecmaVersion&&"Identifier"===e.key.type&&("get"===e.key.name||"set"===e.key.name)?(f=d=!0,g=e.kind=e.key.name,e.key=s===fa||s===ia?wa():W(!0),s!==N&&V(),e.value=Na(t(),!1)):V();if("Identifier"===e.key.type&&(J||d))for(var j=0;j<a.properties.length;++j){var h=
a.properties[j];if(h.key.name===e.key.name){var i=g==h.kind||f&&"init"===h.kind||"init"===g&&("get"===h.kind||"set"===h.kind);i&&!J&&"init"===g&&"init"===h.kind&&(i=!1);i&&c(e.key.start,"Redefinition of property")}}a.properties.push(e)}return o(a,"ObjectExpression");case Ma:return a=t(),r(),Na(a,!1);case qb:return a=t(),r(),a.callee=ma(wa(),!0),a.arguments=x(N)?Ta(L,!1):[],o(a,"NewExpression");default:V()}}function Na(a,b){s===aa?a.id=W():b?V():a.id=null;a.params=[];var d=!0;for(B(N);!x(L);)d?d=!1:
B(S),a.params.push(W());var d=ka,e=F;ka=!0;F=[];a.body=la(!0);ka=d;F=e;if(J||a.body.body.length&&D(a.body.body[0]))for(d=a.id?-1:0;d<a.params.length;++d)if(e=0>d?a.id:a.params[d],(Xa(e.name)||ua(e.name))&&c(e.start,"Defining '"+e.name+"' in strict mode"),0<=d)for(var f=0;f<d;++f)e.name===a.params[f].name&&c(e.start,"Argument name clash in strict mode");return o(a,b?"FunctionDeclaration":"FunctionExpression")}function Ta(a,b,c){for(var d=[],e=!0;!x(a);){if(e)e=!1;else if(B(S),b&&u.allowTrailingCommas&&
x(a))break;c&&s===S?d.push(null):d.push(I(!0))}return d}function W(a){var b=t();b.name=s===aa?R:a&&!u.forbidReserved&&s.keyword||V();r();return o(b,"Identifier")}a.version="0.1.01";var u,m,Y,xa;a.parse=function(a,c){m=""+a;Y=m.length;b(c);h();var d=u.program;Fa=X=k;u.locations&&(Ga=new g);ka=J=null;F=[];w();var e=d||t(),f=!0;d||(e.body=[]);for(;s!==sa;)d=M(),e.body.push(d),f&&D(d)&&T(!0),f=!1;return o(e,"Program")};var Ua=a.defaultOptions={ecmaVersion:5,strictSemicolons:!1,allowTrailingCommas:!0,
forbidReserved:!1,locations:!1,onComment:null,ranges:!1,program:null,sourceFile:null},sb=a.getLineInfo=function(a,b){for(var c=1,d=0;;){ca.lastIndex=d;var e=ca.exec(a);if(e&&e.index<b)++c,d=e.index+e[0].length;else break}return{line:c,column:b-d}};a.tokenize=function(a,c){function d(a){w(a);e.start=G;e.end=ba;e.startLoc=ra;e.endLoc=oa;e.type=s;e.value=R;return e}m=""+a;Y=m.length;b(c);h();var e={};d.jumpTo=function(a,b){k=a;if(u.locations){Q=K=ca.lastIndex=0;for(var c;(c=ca.exec(m))&&c.index<a;)++Q,
K=c.index+c[0].length}m.charAt(a-1);na=b;j()};return d};var k,G,ba,ra,oa,s,R,na,Q,K,Fa,X,Ga,ka,F,J,fa={type:"num"},Da={type:"regexp"},ia={type:"string"},aa={type:"name"},sa={type:"eof"},Ha={keyword:"break"},Pa={keyword:"case",beforeExpr:!0},jb={keyword:"catch"},Ya={keyword:"continue"},Za={keyword:"debugger"},gb={keyword:"default"},$a={keyword:"do",isLoop:!0},eb={keyword:"else",beforeExpr:!0},kb={keyword:"finally"},ab={keyword:"for",isLoop:!0},Ma={keyword:"function"},db={keyword:"if"},fb={keyword:"return",
beforeExpr:!0},Oa={keyword:"switch"},hb={keyword:"throw",beforeExpr:!0},ib={keyword:"try"},La={keyword:"var"},Ja={keyword:"while",isLoop:!0},lb={keyword:"with"},qb={keyword:"new",beforeExpr:!0},mb={keyword:"this"},nb={keyword:"null",atomValue:null},ob={keyword:"true",atomValue:!0},pb={keyword:"false",atomValue:!1},va={keyword:"in",binop:7,beforeExpr:!0},Ea={"break":Ha,"case":Pa,"catch":jb,"continue":Ya,"debugger":Za,"default":gb,"do":$a,"else":eb,"finally":kb,"for":ab,"function":Ma,"if":db,"return":fb,
"switch":Oa,"throw":hb,"try":ib,"var":La,"while":Ja,"with":lb,"null":nb,"true":ob,"false":pb,"new":qb,"in":va,"instanceof":{keyword:"instanceof",binop:7,beforeExpr:!0},"this":mb,"typeof":{keyword:"typeof",prefix:!0,beforeExpr:!0},"void":{keyword:"void",prefix:!0,beforeExpr:!0},"delete":{keyword:"delete",prefix:!0,beforeExpr:!0}},pa={type:"[",beforeExpr:!0},qa={type:"]"},da={type:"{",beforeExpr:!0},Z={type:"}"},N={type:"(",beforeExpr:!0},L={type:")"},S={type:",",beforeExpr:!0},O={type:";",beforeExpr:!0},
ea={type:":",beforeExpr:!0},ya={type:"."},za={type:"?",beforeExpr:!0},Aa={binop:10,beforeExpr:!0},Ba={isAssign:!0,beforeExpr:!0},ga={isAssign:!0,beforeExpr:!0},Cb={binop:9,prefix:!0,beforeExpr:!0},Bb={postfix:!0,prefix:!0,isUpdate:!0},Wa={prefix:!0,beforeExpr:!0},wb={binop:1,beforeExpr:!0},xb={binop:2,beforeExpr:!0},yb={binop:3,beforeExpr:!0},Ab={binop:4,beforeExpr:!0},zb={binop:5,beforeExpr:!0},Fb={binop:6,beforeExpr:!0},Eb={binop:7,beforeExpr:!0},Db={binop:8,beforeExpr:!0},vb={binop:10,beforeExpr:!0};
a.tokTypes={bracketL:pa,bracketR:qa,braceL:da,braceR:Z,parenL:N,parenR:L,comma:S,semi:O,colon:ea,dot:ya,question:za,slash:Aa,eq:Ba,name:aa,eof:sa,num:fa,regexp:Da,string:ia};for(var rb in Ea)a.tokTypes[rb]=Ea[rb];var Hb=d("abstract boolean byte char class double enum export extends final float goto implements import int interface long native package private protected public short static super synchronized throws transient volatile"),Ib=d("class enum extends super const export import"),Xa=d("implements interface let package private protected public static yield"),
ua=d("eval arguments"),Gb=d("break case catch continue debugger default do else finally for function if return switch throw try var while with null true false instanceof typeof void delete new in this"),ub=/[\u1680\u180e\u2000-\u200a\u2028\u2029\u202f\u205f\u3000\ufeff]/,Va=RegExp("[\u00aa\u00b5\u00ba\u00c0-\u00d6\u00d8-\u00f6\u00f8-\u02c1\u02c6-\u02d1\u02e0-\u02e4\u02ec\u02ee\u0370-\u0374\u0376\u0377\u037a-\u037d\u0386\u0388-\u038a\u038c\u038e-\u03a1\u03a3-\u03f5\u03f7-\u0481\u048a-\u0527\u0531-\u0556\u0559\u0561-\u0587\u05d0-\u05ea\u05f0-\u05f2\u0620-\u064a\u066e\u066f\u0671-\u06d3\u06d5\u06e5\u06e6\u06ee\u06ef\u06fa-\u06fc\u06ff\u0710\u0712-\u072f\u074d-\u07a5\u07b1\u07ca-\u07ea\u07f4\u07f5\u07fa\u0800-\u0815\u081a\u0824\u0828\u0840-\u0858\u08a0\u08a2-\u08ac\u0904-\u0939\u093d\u0950\u0958-\u0961\u0971-\u0977\u0979-\u097f\u0985-\u098c\u098f\u0990\u0993-\u09a8\u09aa-\u09b0\u09b2\u09b6-\u09b9\u09bd\u09ce\u09dc\u09dd\u09df-\u09e1\u09f0\u09f1\u0a05-\u0a0a\u0a0f\u0a10\u0a13-\u0a28\u0a2a-\u0a30\u0a32\u0a33\u0a35\u0a36\u0a38\u0a39\u0a59-\u0a5c\u0a5e\u0a72-\u0a74\u0a85-\u0a8d\u0a8f-\u0a91\u0a93-\u0aa8\u0aaa-\u0ab0\u0ab2\u0ab3\u0ab5-\u0ab9\u0abd\u0ad0\u0ae0\u0ae1\u0b05-\u0b0c\u0b0f\u0b10\u0b13-\u0b28\u0b2a-\u0b30\u0b32\u0b33\u0b35-\u0b39\u0b3d\u0b5c\u0b5d\u0b5f-\u0b61\u0b71\u0b83\u0b85-\u0b8a\u0b8e-\u0b90\u0b92-\u0b95\u0b99\u0b9a\u0b9c\u0b9e\u0b9f\u0ba3\u0ba4\u0ba8-\u0baa\u0bae-\u0bb9\u0bd0\u0c05-\u0c0c\u0c0e-\u0c10\u0c12-\u0c28\u0c2a-\u0c33\u0c35-\u0c39\u0c3d\u0c58\u0c59\u0c60\u0c61\u0c85-\u0c8c\u0c8e-\u0c90\u0c92-\u0ca8\u0caa-\u0cb3\u0cb5-\u0cb9\u0cbd\u0cde\u0ce0\u0ce1\u0cf1\u0cf2\u0d05-\u0d0c\u0d0e-\u0d10\u0d12-\u0d3a\u0d3d\u0d4e\u0d60\u0d61\u0d7a-\u0d7f\u0d85-\u0d96\u0d9a-\u0db1\u0db3-\u0dbb\u0dbd\u0dc0-\u0dc6\u0e01-\u0e30\u0e32\u0e33\u0e40-\u0e46\u0e81\u0e82\u0e84\u0e87\u0e88\u0e8a\u0e8d\u0e94-\u0e97\u0e99-\u0e9f\u0ea1-\u0ea3\u0ea5\u0ea7\u0eaa\u0eab\u0ead-\u0eb0\u0eb2\u0eb3\u0ebd\u0ec0-\u0ec4\u0ec6\u0edc-\u0edf\u0f00\u0f40-\u0f47\u0f49-\u0f6c\u0f88-\u0f8c\u1000-\u102a\u103f\u1050-\u1055\u105a-\u105d\u1061\u1065\u1066\u106e-\u1070\u1075-\u1081\u108e\u10a0-\u10c5\u10c7\u10cd\u10d0-\u10fa\u10fc-\u1248\u124a-\u124d\u1250-\u1256\u1258\u125a-\u125d\u1260-\u1288\u128a-\u128d\u1290-\u12b0\u12b2-\u12b5\u12b8-\u12be\u12c0\u12c2-\u12c5\u12c8-\u12d6\u12d8-\u1310\u1312-\u1315\u1318-\u135a\u1380-\u138f\u13a0-\u13f4\u1401-\u166c\u166f-\u167f\u1681-\u169a\u16a0-\u16ea\u16ee-\u16f0\u1700-\u170c\u170e-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176c\u176e-\u1770\u1780-\u17b3\u17d7\u17dc\u1820-\u1877\u1880-\u18a8\u18aa\u18b0-\u18f5\u1900-\u191c\u1950-\u196d\u1970-\u1974\u1980-\u19ab\u19c1-\u19c7\u1a00-\u1a16\u1a20-\u1a54\u1aa7\u1b05-\u1b33\u1b45-\u1b4b\u1b83-\u1ba0\u1bae\u1baf\u1bba-\u1be5\u1c00-\u1c23\u1c4d-\u1c4f\u1c5a-\u1c7d\u1ce9-\u1cec\u1cee-\u1cf1\u1cf5\u1cf6\u1d00-\u1dbf\u1e00-\u1f15\u1f18-\u1f1d\u1f20-\u1f45\u1f48-\u1f4d\u1f50-\u1f57\u1f59\u1f5b\u1f5d\u1f5f-\u1f7d\u1f80-\u1fb4\u1fb6-\u1fbc\u1fbe\u1fc2-\u1fc4\u1fc6-\u1fcc\u1fd0-\u1fd3\u1fd6-\u1fdb\u1fe0-\u1fec\u1ff2-\u1ff4\u1ff6-\u1ffc\u2071\u207f\u2090-\u209c\u2102\u2107\u210a-\u2113\u2115\u2119-\u211d\u2124\u2126\u2128\u212a-\u212d\u212f-\u2139\u213c-\u213f\u2145-\u2149\u214e\u2160-\u2188\u2c00-\u2c2e\u2c30-\u2c5e\u2c60-\u2ce4\u2ceb-\u2cee\u2cf2\u2cf3\u2d00-\u2d25\u2d27\u2d2d\u2d30-\u2d67\u2d6f\u2d80-\u2d96\u2da0-\u2da6\u2da8-\u2dae\u2db0-\u2db6\u2db8-\u2dbe\u2dc0-\u2dc6\u2dc8-\u2dce\u2dd0-\u2dd6\u2dd8-\u2dde\u2e2f\u3005-\u3007\u3021-\u3029\u3031-\u3035\u3038-\u303c\u3041-\u3096\u309d-\u309f\u30a1-\u30fa\u30fc-\u30ff\u3105-\u312d\u3131-\u318e\u31a0-\u31ba\u31f0-\u31ff\u3400-\u4db5\u4e00-\u9fcc\ua000-\ua48c\ua4d0-\ua4fd\ua500-\ua60c\ua610-\ua61f\ua62a\ua62b\ua640-\ua66e\ua67f-\ua697\ua6a0-\ua6ef\ua717-\ua71f\ua722-\ua788\ua78b-\ua78e\ua790-\ua793\ua7a0-\ua7aa\ua7f8-\ua801\ua803-\ua805\ua807-\ua80a\ua80c-\ua822\ua840-\ua873\ua882-\ua8b3\ua8f2-\ua8f7\ua8fb\ua90a-\ua925\ua930-\ua946\ua960-\ua97c\ua984-\ua9b2\ua9cf\uaa00-\uaa28\uaa40-\uaa42\uaa44-\uaa4b\uaa60-\uaa76\uaa7a\uaa80-\uaaaf\uaab1\uaab5\uaab6\uaab9-\uaabd\uaac0\uaac2\uaadb-\uaadd\uaae0-\uaaea\uaaf2-\uaaf4\uab01-\uab06\uab09-\uab0e\uab11-\uab16\uab20-\uab26\uab28-\uab2e\uabc0-\uabe2\uac00-\ud7a3\ud7b0-\ud7c6\ud7cb-\ud7fb\uf900-\ufa6d\ufa70-\ufad9\ufb00-\ufb06\ufb13-\ufb17\ufb1d\ufb1f-\ufb28\ufb2a-\ufb36\ufb38-\ufb3c\ufb3e\ufb40\ufb41\ufb43\ufb44\ufb46-\ufbb1\ufbd3-\ufd3d\ufd50-\ufd8f\ufd92-\ufdc7\ufdf0-\ufdfb\ufe70-\ufe74\ufe76-\ufefc\uff21-\uff3a\uff41-\uff5a\uff66-\uffbe\uffc2-\uffc7\uffca-\uffcf\uffd2-\uffd7\uffda-\uffdc]"),
tb=RegExp("[\u00aa\u00b5\u00ba\u00c0-\u00d6\u00d8-\u00f6\u00f8-\u02c1\u02c6-\u02d1\u02e0-\u02e4\u02ec\u02ee\u0370-\u0374\u0376\u0377\u037a-\u037d\u0386\u0388-\u038a\u038c\u038e-\u03a1\u03a3-\u03f5\u03f7-\u0481\u048a-\u0527\u0531-\u0556\u0559\u0561-\u0587\u05d0-\u05ea\u05f0-\u05f2\u0620-\u064a\u066e\u066f\u0671-\u06d3\u06d5\u06e5\u06e6\u06ee\u06ef\u06fa-\u06fc\u06ff\u0710\u0712-\u072f\u074d-\u07a5\u07b1\u07ca-\u07ea\u07f4\u07f5\u07fa\u0800-\u0815\u081a\u0824\u0828\u0840-\u0858\u08a0\u08a2-\u08ac\u0904-\u0939\u093d\u0950\u0958-\u0961\u0971-\u0977\u0979-\u097f\u0985-\u098c\u098f\u0990\u0993-\u09a8\u09aa-\u09b0\u09b2\u09b6-\u09b9\u09bd\u09ce\u09dc\u09dd\u09df-\u09e1\u09f0\u09f1\u0a05-\u0a0a\u0a0f\u0a10\u0a13-\u0a28\u0a2a-\u0a30\u0a32\u0a33\u0a35\u0a36\u0a38\u0a39\u0a59-\u0a5c\u0a5e\u0a72-\u0a74\u0a85-\u0a8d\u0a8f-\u0a91\u0a93-\u0aa8\u0aaa-\u0ab0\u0ab2\u0ab3\u0ab5-\u0ab9\u0abd\u0ad0\u0ae0\u0ae1\u0b05-\u0b0c\u0b0f\u0b10\u0b13-\u0b28\u0b2a-\u0b30\u0b32\u0b33\u0b35-\u0b39\u0b3d\u0b5c\u0b5d\u0b5f-\u0b61\u0b71\u0b83\u0b85-\u0b8a\u0b8e-\u0b90\u0b92-\u0b95\u0b99\u0b9a\u0b9c\u0b9e\u0b9f\u0ba3\u0ba4\u0ba8-\u0baa\u0bae-\u0bb9\u0bd0\u0c05-\u0c0c\u0c0e-\u0c10\u0c12-\u0c28\u0c2a-\u0c33\u0c35-\u0c39\u0c3d\u0c58\u0c59\u0c60\u0c61\u0c85-\u0c8c\u0c8e-\u0c90\u0c92-\u0ca8\u0caa-\u0cb3\u0cb5-\u0cb9\u0cbd\u0cde\u0ce0\u0ce1\u0cf1\u0cf2\u0d05-\u0d0c\u0d0e-\u0d10\u0d12-\u0d3a\u0d3d\u0d4e\u0d60\u0d61\u0d7a-\u0d7f\u0d85-\u0d96\u0d9a-\u0db1\u0db3-\u0dbb\u0dbd\u0dc0-\u0dc6\u0e01-\u0e30\u0e32\u0e33\u0e40-\u0e46\u0e81\u0e82\u0e84\u0e87\u0e88\u0e8a\u0e8d\u0e94-\u0e97\u0e99-\u0e9f\u0ea1-\u0ea3\u0ea5\u0ea7\u0eaa\u0eab\u0ead-\u0eb0\u0eb2\u0eb3\u0ebd\u0ec0-\u0ec4\u0ec6\u0edc-\u0edf\u0f00\u0f40-\u0f47\u0f49-\u0f6c\u0f88-\u0f8c\u1000-\u102a\u103f\u1050-\u1055\u105a-\u105d\u1061\u1065\u1066\u106e-\u1070\u1075-\u1081\u108e\u10a0-\u10c5\u10c7\u10cd\u10d0-\u10fa\u10fc-\u1248\u124a-\u124d\u1250-\u1256\u1258\u125a-\u125d\u1260-\u1288\u128a-\u128d\u1290-\u12b0\u12b2-\u12b5\u12b8-\u12be\u12c0\u12c2-\u12c5\u12c8-\u12d6\u12d8-\u1310\u1312-\u1315\u1318-\u135a\u1380-\u138f\u13a0-\u13f4\u1401-\u166c\u166f-\u167f\u1681-\u169a\u16a0-\u16ea\u16ee-\u16f0\u1700-\u170c\u170e-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176c\u176e-\u1770\u1780-\u17b3\u17d7\u17dc\u1820-\u1877\u1880-\u18a8\u18aa\u18b0-\u18f5\u1900-\u191c\u1950-\u196d\u1970-\u1974\u1980-\u19ab\u19c1-\u19c7\u1a00-\u1a16\u1a20-\u1a54\u1aa7\u1b05-\u1b33\u1b45-\u1b4b\u1b83-\u1ba0\u1bae\u1baf\u1bba-\u1be5\u1c00-\u1c23\u1c4d-\u1c4f\u1c5a-\u1c7d\u1ce9-\u1cec\u1cee-\u1cf1\u1cf5\u1cf6\u1d00-\u1dbf\u1e00-\u1f15\u1f18-\u1f1d\u1f20-\u1f45\u1f48-\u1f4d\u1f50-\u1f57\u1f59\u1f5b\u1f5d\u1f5f-\u1f7d\u1f80-\u1fb4\u1fb6-\u1fbc\u1fbe\u1fc2-\u1fc4\u1fc6-\u1fcc\u1fd0-\u1fd3\u1fd6-\u1fdb\u1fe0-\u1fec\u1ff2-\u1ff4\u1ff6-\u1ffc\u2071\u207f\u2090-\u209c\u2102\u2107\u210a-\u2113\u2115\u2119-\u211d\u2124\u2126\u2128\u212a-\u212d\u212f-\u2139\u213c-\u213f\u2145-\u2149\u214e\u2160-\u2188\u2c00-\u2c2e\u2c30-\u2c5e\u2c60-\u2ce4\u2ceb-\u2cee\u2cf2\u2cf3\u2d00-\u2d25\u2d27\u2d2d\u2d30-\u2d67\u2d6f\u2d80-\u2d96\u2da0-\u2da6\u2da8-\u2dae\u2db0-\u2db6\u2db8-\u2dbe\u2dc0-\u2dc6\u2dc8-\u2dce\u2dd0-\u2dd6\u2dd8-\u2dde\u2e2f\u3005-\u3007\u3021-\u3029\u3031-\u3035\u3038-\u303c\u3041-\u3096\u309d-\u309f\u30a1-\u30fa\u30fc-\u30ff\u3105-\u312d\u3131-\u318e\u31a0-\u31ba\u31f0-\u31ff\u3400-\u4db5\u4e00-\u9fcc\ua000-\ua48c\ua4d0-\ua4fd\ua500-\ua60c\ua610-\ua61f\ua62a\ua62b\ua640-\ua66e\ua67f-\ua697\ua6a0-\ua6ef\ua717-\ua71f\ua722-\ua788\ua78b-\ua78e\ua790-\ua793\ua7a0-\ua7aa\ua7f8-\ua801\ua803-\ua805\ua807-\ua80a\ua80c-\ua822\ua840-\ua873\ua882-\ua8b3\ua8f2-\ua8f7\ua8fb\ua90a-\ua925\ua930-\ua946\ua960-\ua97c\ua984-\ua9b2\ua9cf\uaa00-\uaa28\uaa40-\uaa42\uaa44-\uaa4b\uaa60-\uaa76\uaa7a\uaa80-\uaaaf\uaab1\uaab5\uaab6\uaab9-\uaabd\uaac0\uaac2\uaadb-\uaadd\uaae0-\uaaea\uaaf2-\uaaf4\uab01-\uab06\uab09-\uab0e\uab11-\uab16\uab20-\uab26\uab28-\uab2e\uabc0-\uabe2\uac00-\ud7a3\ud7b0-\ud7c6\ud7cb-\ud7fb\uf900-\ufa6d\ufa70-\ufad9\ufb00-\ufb06\ufb13-\ufb17\ufb1d\ufb1f-\ufb28\ufb2a-\ufb36\ufb38-\ufb3c\ufb3e\ufb40\ufb41\ufb43\ufb44\ufb46-\ufbb1\ufbd3-\ufd3d\ufd50-\ufd8f\ufd92-\ufdc7\ufdf0-\ufdfb\ufe70-\ufe74\ufe76-\ufefc\uff21-\uff3a\uff41-\uff5a\uff66-\uffbe\uffc2-\uffc7\uffca-\uffcf\uffd2-\uffd7\uffda-\uffdc\u0371-\u0374\u0483-\u0487\u0591-\u05bd\u05bf\u05c1\u05c2\u05c4\u05c5\u05c7\u0610-\u061a\u0620-\u0649\u0672-\u06d3\u06e7-\u06e8\u06fb-\u06fc\u0730-\u074a\u0800-\u0814\u081b-\u0823\u0825-\u0827\u0829-\u082d\u0840-\u0857\u08e4-\u08fe\u0900-\u0903\u093a-\u093c\u093e-\u094f\u0951-\u0957\u0962-\u0963\u0966-\u096f\u0981-\u0983\u09bc\u09be-\u09c4\u09c7\u09c8\u09d7\u09df-\u09e0\u0a01-\u0a03\u0a3c\u0a3e-\u0a42\u0a47\u0a48\u0a4b-\u0a4d\u0a51\u0a66-\u0a71\u0a75\u0a81-\u0a83\u0abc\u0abe-\u0ac5\u0ac7-\u0ac9\u0acb-\u0acd\u0ae2-\u0ae3\u0ae6-\u0aef\u0b01-\u0b03\u0b3c\u0b3e-\u0b44\u0b47\u0b48\u0b4b-\u0b4d\u0b56\u0b57\u0b5f-\u0b60\u0b66-\u0b6f\u0b82\u0bbe-\u0bc2\u0bc6-\u0bc8\u0bca-\u0bcd\u0bd7\u0be6-\u0bef\u0c01-\u0c03\u0c46-\u0c48\u0c4a-\u0c4d\u0c55\u0c56\u0c62-\u0c63\u0c66-\u0c6f\u0c82\u0c83\u0cbc\u0cbe-\u0cc4\u0cc6-\u0cc8\u0cca-\u0ccd\u0cd5\u0cd6\u0ce2-\u0ce3\u0ce6-\u0cef\u0d02\u0d03\u0d46-\u0d48\u0d57\u0d62-\u0d63\u0d66-\u0d6f\u0d82\u0d83\u0dca\u0dcf-\u0dd4\u0dd6\u0dd8-\u0ddf\u0df2\u0df3\u0e34-\u0e3a\u0e40-\u0e45\u0e50-\u0e59\u0eb4-\u0eb9\u0ec8-\u0ecd\u0ed0-\u0ed9\u0f18\u0f19\u0f20-\u0f29\u0f35\u0f37\u0f39\u0f41-\u0f47\u0f71-\u0f84\u0f86-\u0f87\u0f8d-\u0f97\u0f99-\u0fbc\u0fc6\u1000-\u1029\u1040-\u1049\u1067-\u106d\u1071-\u1074\u1082-\u108d\u108f-\u109d\u135d-\u135f\u170e-\u1710\u1720-\u1730\u1740-\u1750\u1772\u1773\u1780-\u17b2\u17dd\u17e0-\u17e9\u180b-\u180d\u1810-\u1819\u1920-\u192b\u1930-\u193b\u1951-\u196d\u19b0-\u19c0\u19c8-\u19c9\u19d0-\u19d9\u1a00-\u1a15\u1a20-\u1a53\u1a60-\u1a7c\u1a7f-\u1a89\u1a90-\u1a99\u1b46-\u1b4b\u1b50-\u1b59\u1b6b-\u1b73\u1bb0-\u1bb9\u1be6-\u1bf3\u1c00-\u1c22\u1c40-\u1c49\u1c5b-\u1c7d\u1cd0-\u1cd2\u1d00-\u1dbe\u1e01-\u1f15\u200c\u200d\u203f\u2040\u2054\u20d0-\u20dc\u20e1\u20e5-\u20f0\u2d81-\u2d96\u2de0-\u2dff\u3021-\u3028\u3099\u309a\ua640-\ua66d\ua674-\ua67d\ua69f\ua6f0-\ua6f1\ua7f8-\ua800\ua806\ua80b\ua823-\ua827\ua880-\ua881\ua8b4-\ua8c4\ua8d0-\ua8d9\ua8f3-\ua8f7\ua900-\ua909\ua926-\ua92d\ua930-\ua945\ua980-\ua983\ua9b3-\ua9c0\uaa00-\uaa27\uaa40-\uaa41\uaa4c-\uaa4d\uaa50-\uaa59\uaa7b\uaae0-\uaae9\uaaf2-\uaaf3\uabc0-\uabe1\uabec\uabed\uabf0-\uabf9\ufb20-\ufb28\ufe00-\ufe0f\ufe20-\ufe26\ufe33\ufe34\ufe4d-\ufe4f\uff10-\uff19\uff3f]"),
Ca=/[\n\r\u2028\u2029]/,ca=/\r\n|[\n\r\u2028\u2029]/g,ha,Ia={kind:"loop"},Jb={kind:"switch"}});(function(){"undefined"===typeof window&&(window=this);$data=window.$data||(window.$data=function b(){return this instanceof b?new (b.implementation.apply(this,arguments))(arguments[1]):b.implementation.apply(this,arguments)})})(this);"undefined"===typeof console&&(console={warn:function(){},error:function(){},log:function(){},dir:function(){},time:function(){},timeEnd:function(){}});
console.warn||(console.warn=function(){});console.error||(console.error=function(){});(function(a){a.__namespace=true;a.version="JayData 1.3.4";a.versionNumber="1.3.4";a.root={};a.Acorn=a.Acorn||(typeof acorn=="object"?acorn:void 0);a.Esprima=a.Esprima||(typeof esprima=="object"?esprima:void 0)})($data);Exception=function(a,b,c){Error.call(this);Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor);this.name=b||"Exception";this.message=a;this.data=c};
Exception.prototype.__proto__=Error.prototype;Exception.prototype._getStackTrace=function(){};
Guard={requireValue:function(a,b){(typeof b==="undefined"||b===null)&&Guard.raise(a+" requires a value other than undefined or null")},requireType:function(a,b,c){return(c instanceof Array?c:[c]).some(function(c){switch(typeof c){case "string":return typeof b===c;case "function":return b instanceof c;default:Guard.raise("Unknown type format : "+typeof c+" for: "+a)}})},raise:function(a){if(typeof intellisense==="undefined"){a instanceof Exception?console.error(a.name+":",a.message+"\n",a):console.error(a);
throw a;}}};Object.isNullOrUndefined=function(a){return a===void 0||a===null};
(function(){if(!Object.getOwnPropertyNames)Object.getOwnPropertyNames=function(a){var b=[],c;for(c in a)a.hasOwnProperty(c)&&b.push(c);return b};if(!Object.create)Object.create=function(a){function b(){}arguments.length>1&&Guard.raise(Error("Object.create implementation only accepts the first parameter."));b.prototype=a;return new b};if(!Object.keys){var a=Object.prototype.hasOwnProperty,b=!{toString:null}.propertyIsEnumerable("toString"),c=["toString","toLocaleString","valueOf","hasOwnProperty",
"isPrototypeOf","propertyIsEnumerable","constructor"],d=c.length;Object.keys=function(e){(typeof e!=="object"&&typeof e!=="function"||e===null)&&Guard.raise(new TypeError("Object.keys called on non-object"));var f=[],g;for(g in e)a.call(e,g)&&f.push(g);if(b)for(g=0;g<d;g++)a.call(e,c[g])&&f.push(c[g]);return f}}if(!Object.defineProperty)Object.defineProperty=function(a,b,c){a[b]=c.value||{}};if(!Object.defineProperties)Object.defineProperties=function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=
b[c].value||{})};if(!Array.prototype.forEach)Array.prototype.forEach=function(a,b){for(var c=0,d=this.length;c<d;c++)b?a.call(b,this[c],c,this):a(this[c],c,this)};if(!Array.prototype.filter)Array.prototype.filter=function(a,b){for(var c=[],d=0,i=this.length;d<i;d++)(b?a.call(b,this[d],d,this):a(this[d],d,this))===true&&c.push(this[d]);return c};if(!Array.prototype.map)Array.prototype.map=function(a,b){for(var c=[],d=0,i=this.length;d<i;d++){var j=b?a.call(b,this[d],d,this):a(this[d],d,this);c.push(j)}return c};
if(!Array.prototype.some)Array.prototype.some=function(a,b){for(var c=0,d=this.length;c<d;c++)if(b?a.call(b,this[c],c,this):a(this[c],c,this))return true;return false};if(!Array.prototype.indexOf)Array.prototype.indexOf=function(a){for(var b=0,c=this.length;b<c;b++)if(this[b]===a)return b;return-1};if(!String.prototype.trimLeft)String.prototype.trimLeft=function(){return this.replace(/^\s+/,"")};if(!String.prototype.trimRight)String.prototype.trimRight=function(){return this.replace(/\s+$/,"")};if(!Function.prototype.bind)Function.prototype.bind=
function(a){if(typeof this!=="function")throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");var b=Array.prototype.slice.call(arguments,1),c=this,d=function(){},i=function(){return c.apply(this instanceof d&&a?this:a,b.concat(Array.prototype.slice.call(arguments)))};d.prototype=this.prototype;i.prototype=new d;return i};typeof Uint8Array=="undefined"&&(Uint8Array=function(a){if(a instanceof Uint8Array)return a;var b=this,c=Array.isArray(a)?a:Array(a);this.byteLength=
this.length=c.length;this.byteOffset=0;this.buffer={byteLength:b.length};for(var a=function(a){c[a]=c[a]||0;Object.defineProperty(b,a,{enumerable:true,configurable:false,get:function(){if(isNaN(+a)||(a|0)<0||(a|0)>=b.length)try{typeof document!="undefined"&&document.createTextNode("").splitText(1);return new RangeError("INDEX_SIZE_ERR")}catch(d){return d}return c[a]},set:function(d){if(isNaN(+a)||(a|0)<0||(a|0)>=b.length)try{typeof document!="undefined"&&document.createTextNode("").splitText(1);return new RangeError("INDEX_SIZE_ERR")}catch(e){return e}c[a|
0]=(d|0)&255}})},d=0;d<b.length;d++)a(d)})})();
(function(a,b){function c(b,c){this.kind=f.property;Object.defineProperty(this,"definedBy",{value:c,enumerable:false,configurable:false,writable:false});if(b){if(typeof b==="function"||typeof b.asFunction==="function"){this.method=b;this.kind=f.method}else{this.configurable=this.enumerable=true;if(typeof b==="number"){this.value=b;this.dataType=this.type=a.Number}else if(typeof b==="string"){this.value=b;this.type=this.dataType=a.String}else for(var d in b)b.hasOwnProperty(d)&&(this[d]=b[d])}this.type!==
void 0?this.dataType=this.dataType||this.type:this.type=this.dataType;this.originalType=this.type;if(this.elementType!==void 0)this.originalElementType=this.elementType}}function d(){}function e(){this.classNames={}}function f(){}function g(b){b&&b.addChildContainer(this);var c={},d=[],e=[];this.classNames=c;this.consolidatedClassNames=d;this.classTypes=e;var f=[];this.mappedTo=f;var g=this;this.holder=null;var h=function(a,b){var c=g.resolveType(a),d=Object.create(c.prototype);c.apply(d,b);return d},
i={};this.pendingResolutions=i;this.addChildContainer=function(){};this.createInstance=function(a,b){return h(a,b)};this.mapType=function(a,b){Guard.requireValue("aliasType",a);Guard.requireValue("realType",b);var c=this.getType(a),d=this.getType(b),c=e.indexOf(c),d=e.indexOf(d);f[c]=d};this.isPrimitiveType=function(b){b=this.resolveType(b);switch(true){case b===Number:case b===String:case b===Date:case b===Boolean:case b===Array:case b===Object:case b===a.Number:case b===a.Integer:case b===a.Date:case b===
a.String:case b===a.Boolean:case b===a.Array:case b===a.Object:case b===a.Guid:case b===a.Byte:case b===a.SByte:case b===a.Decimal:case b===a.Float:case b===a.Int16:case b===a.Int32:case b===a.Int64:case b===a.DateTimeOffset:case b===a.Time:case b===a.SimpleBase:case b===a.Geospatial:case b===a.GeographyBase:case b===a.GeographyPoint:case b===a.GeographyLineString:case b===a.GeographyPolygon:case b===a.GeographyMultiPoint:case b===a.GeographyMultiLineString:case b===a.GeographyMultiPolygon:case b===
a.GeographyCollection:case b===a.GeometryBase:case b===a.GeometryPoint:case b===a.GeometryLineString:case b===a.GeometryPolygon:case b===a.GeometryMultiPoint:case b===a.GeometryMultiLineString:case b===a.GeometryMultiPolygon:case b===a.GeometryCollection:return true;default:return false}};this.resolveName=function(a){a=this.resolveType(a);a=e.indexOf(a);return d[a]};this.resolveType=function(a,b){var c;c=this.getType(a,b?true:false,b);var d=e.indexOf(c);return typeof f[d]==="undefined"?c:e[f[d]]};
this.getType=function(a,d,f){Guard.requireValue("typeOrName",a);if(typeof a==="function")return a;if(!(a in c)){if(b){var g=b.getType(a,true);if(g)return g}if(f){i[a]=i[a]||[];i[a].push(f);return}if(d)return;Guard.raise(new Exception("Unable to resolve type:"+a))}a=e[c[a]];f&&f(a);return a};this.getName=function(a){var b=this.getType(a),b=e.indexOf(b);b==-1&&Guard.raise("unknown type to request name for: "+a);return d[b]};this.getTypes=function(){for(var a=Object.keys(c),b=[],d=0;d<a.length;d++){var f=
a[d];b.push({name:f,type:e[c[f]],toString:function(){return this.name}})}return b};this.getTypeName=function(b){switch(typeof b){case "object":if(b==null)return"$data.Object";if(b instanceof Array)return"$data.Array";if(b.getType)return b.getType().fullName;if(b instanceof Date)return"$data.Date";if(b instanceof a.Guid)return"$data.Guid";if(b instanceof a.DateTimeOffset)return"$data.DateTimeOffset";if(b instanceof a.GeographyPoint)return"$data.GeographyPoint";if(b instanceof a.GeographyLineString)return"$data.GeographyLineString";
if(b instanceof a.GeographyPolygon)return"$data.GeographyPolygon";if(b instanceof a.GeographyMultiPoint)return"$data.GeographyMultiPoint";if(b instanceof a.GeographyMultiLineString)return"$data.GeographyMultiLineString";if(b instanceof a.GeographyMultiPolygon)return"$data.GeographyMultiPolygon";if(b instanceof a.GeographyCollection)return"$data.GeographyCollection";if(b instanceof a.GeographyBase)return"$data.GeographyBase";if(b instanceof a.GeometryPoint)return"$data.GeometryPoint";if(b instanceof
a.GeometryLineString)return"$data.GeometryLineString";if(b instanceof a.GeometryPolygon)return"$data.GeometryPolygon";if(b instanceof a.GeometryMultiPoint)return"$data.GeometryMultiPoint";if(b instanceof a.GeometryMultiLineString)return"$data.GeometryMultiLineString";if(b instanceof a.GeometryMultiPolygon)return"$data.GeometryMultiPolygon";if(b instanceof a.GeometryCollection)return"$data.GeometryCollection";if(b instanceof a.GeometryBase)return"$data.GeometryBase";if(b instanceof a.Geospatial)return"$data.Geospatial";
if(b instanceof a.SimpleBase)return"$data.SimpleBase";if(typeof b.toHexString==="function")return"$data.ObjectID";default:return typeof b}};this.isTypeRegistered=function(a){return typeof a==="function"?e.indexOf(a)>-1:a in c};this.unregisterType=function(){Guard.raise("Unimplemented")};this.getDefault=function(b){switch(this.resolveType(b)){case a.Number:return 0;case a.Float:return 0;case a.Decimal:return"0.0";case a.Integer:return 0;case a.Int16:return 0;case a.Int32:return 0;case a.Int64:return"0";
case a.Byte:return 0;case a.SByte:return 0;case a.String:return null;case a.Boolean:return false;default:return null}};this.getIndex=function(a){a=this.resolveType(a);return e.indexOf(a)};this.resolveByIndex=function(a){return e[a]};this.registerType=function(a,f,p){if(a){typeof f==="string"&&(f=g.resolveType(f));var n=[];if(typeof a==="string"){n=[];n.push(a)}else n=a;for(var A=0;A<n.length;A++){var t=n[A].split("."),y={};y.shortName=t[t.length-1];y.fullName=n[A];n[A]=y}t=function(){return h(f,arguments)};
typeof intellisense!=="undefined"&&intellisense.annotate(t,f);for(var A=0,o=n.length;A<o;A++){y=n[A];"create"+y.shortName in g||(g["create"+y.shortName]=typeof p==="function"?p:t);var D=e.indexOf(f);if(D==-1){D=e.push(f)-1;d[D]=y.fullName}c[y.fullName]=D;D=i[y.fullName]||[];if(D.length>0){D.forEach(function(a){a(f)});i[y.fullName]=[]}}b&&b.registerType.apply(b,arguments);if(!f.name)f.name=n[0].shortName}};var n={from:{},to:{}};this.converters=n;this.convertTo=function(b,c,d,e){Guard.requireValue("typeOrName",
c);if(Object.isNullOrUndefined(b))return b;var f=Container.getTypeName(b),g=Container.resolveType(f),f=Container.resolveName(g),j=Container.resolveType(c),h=Container.resolveName(j),i;try{if(typeof j["from"+f]==="function")i=j["from"+f].apply(j,arguments);else if(typeof g["to"+h]==="function")i=g["to"+h].apply(g,arguments);else if(n.to[h]&&n.to[h][f])i=n.to[h][f].apply(n,arguments);else if(n.from[f]&&n.from[f][h])i=n.from[f][h].apply(n,arguments);else if(h===f||b instanceof j)i=b;else if(n.to[h]&&
n.to[h]["default"])i=n.to[h]["default"].apply(n,arguments);else throw"converter not found";}catch(l){Guard.raise(new Exception("Value '"+f+"' not convertable to '"+h+"'","TypeError",b))}if(j===a.Array&&d&&Array.isArray(i))for(f=0;f<i.length;f++)i[f]=this.convertTo.call(this,i[f],d,void 0,e);return i};this.registerConverter=function(b,c,d,e){b=Container.resolveName(b);if(Container.isTypeRegistered(c)){n.to[b]=n.to[b]||{};n.from[b]=n.from[b]||{};c=Container.resolveName(c);d&&(n.to[b][c]=d);e&&(n.from[b][c]=
e)}else{n.to[b]=n.to[b]?a.typeSystem.extend(n.to[b],c):c;n.from[b]=n.from[b]?a.typeSystem.extend(n.from[b],d):d}}}c.prototype.createPropertyDescriptor=function(a,b){var c=this,d={enumerable:this.enumerable==void 0?true:this.enumerable,configurable:this.configurable==void 0?true:this.configurable};if(this.set&&this.get){d.set=this.set;d.get=this.get}else if("value"in this||b){d.value=b||this.value;d.writable=true}else{d.set=function(a){this.storeProperty(c,a)};d.get=function(){return this.retrieveProperty(c)}}return d};
c.prototype.createStorePropertyDescriptor=function(a){return{enumerable:false,writable:true,configurable:this.configurable,value:a}};c.prototype.createGetMethod=function(){var a=this;return{enumerable:false,writable:false,configurable:false,value:function(b,c){return this.getProperty(a,b,c)}}};c.prototype.createSetMethod=function(){var a=this;return{enumerable:false,writable:false,configurable:false,value:function(b,c,d){return this.setProperty(a,b,c,d)}}};c.translateDefinition=function(b,d,e){function f(b){b&&
b.isAssignableTo&&a.Entity&&b.isAssignableTo(a.Entity)&&e.childResolverThunks.push(function(){b.resolveForwardDeclarations&&b.resolveForwardDeclarations()})}var g=e,h;if(b.type&&Container.isTypeRegistered(b.type)){g=Container.resolveType(b.type);if(typeof g.translateDefinition==="function"){h=g.translateDefinition.apply(g,arguments);h.name=h.name||d}else g=e}if(!(h instanceof c)){h=new c(h||b,g);h.name=d}e.resolverThunks=e.resolverThunks||[];e.childResolverThunks=e.childResolverThunks||[];var i=h.type,
z=h.elementType;f(i);f(z);if("string"===typeof i)if("@"===i[0]){h.type=i.substr(1);h.dataType=i.substr(1)}else e.resolverThunks.push(function(){var a=e.container.resolveType(i);f(a);h.type=a;h.dataType=a});if(z&&"string"===typeof z)"@"===z[0]?h.elementType=z.substr(1):e.resolverThunks.push(function(){var a=e.container.resolveType(z);f(a);h.elementType=a});e.resolveForwardDeclarations=function(){e.resolveForwardDeclarations=function(){};a.Trace.log("resolving: "+e.fullName);this.resolverThunks.forEach(function(a){a()});
this.childResolverThunks.forEach(function(a){a()})};return h};c.prototype.toJSON=function(){var a={},b;for(b in this)if(b!=="defineBy"&&b!=="storageModel")if((b==="type"||b==="dataType")&&this[b]&&typeof this[b]==="function")try{a[b]=Container.resolveName(this[b])}catch(c){a[b]=this[b]}else a[b]=this[b];return a};a.MemberDefinition=window.MemberDefinition=c;d.prototype={clearCache:function(){this.pubMapPropNamesCache=this.pubMapMethodsCache=this.propByTypeCache=this.keyPropsCache=this.pubMapPropsCache=
this.arrayCache=void 0},asArray:function(){if(!this.arrayCache){this.arrayCache=[];for(var a in this)a.indexOf("$")===0&&this.arrayCache.push(this[a])}return this.arrayCache},getPublicMappedProperties:function(){if(!this.pubMapPropsCache){this.pubMapPropsCache=[];for(var a in this)a.indexOf("$")===0&&this[a].kind=="property"&&!this[a].notMapped&&this[a].enumerable&&this.pubMapPropsCache.push(this[a])}return this.pubMapPropsCache},getPublicMappedPropertyNames:function(){if(!this.pubMapPropNamesCache){this.pubMapPropNamesCache=
[];for(var a in this)a.indexOf("$")===0&&this[a].kind=="property"&&!this[a].notMapped&&this[a].enumerable&&this.pubMapPropNamesCache.push(this[a].name)}return this.pubMapPropNamesCache},getKeyProperties:function(){if(!this.keyPropsCache){this.keyPropsCache=[];for(var a in this)a.indexOf("$")===0&&this[a].kind=="property"&&this[a].key&&this.keyPropsCache.push(this[a])}return this.keyPropsCache},getPublicMappedMethods:function(){if(!this.pubMapMethodsCache){this.pubMapMethodsCache=[];for(var a in this)a.indexOf("$")===
0&&this[a].kind=="method"&&this[a].method&&this.pubMapMethodsCache.push(this[a])}return this.pubMapMethodsCache},getPropertyByType:function(a){if(!this.propByTypeCache){this.propByTypeCache=[];for(var b in this)b.indexOf("$")===0&&this[b].dataType==a&&this.propByTypeCache.push(this[b])}return this.propByTypeCache},getMember:function(a){return this["$"+a]},setMember:function(a){this["$"+a.name]=a}};d.prototype.constructor=d;a.MemberDefinitionCollection=window.MemberDefinitionCollection=d;f.__enum=
true;f.method="method";f.property="property";f.navProperty="navProperty";f.complexProperty="complexProperty";f.field="field";a.MemberTypes=f;e.prototype={define:function(a,b,c,d,e){return this.defineEx(a,[{type:b}],c,d,e)},defineEx:function(b,c,d,e,f){d=d||a.Container;if(c.length==0)c.push({type:a.Base});else if(c.length>0&&!c[0].type)c[0].type=a.Base;for(var g=0,h=c.length;g<h;g++)typeof c[g]==="function"&&(c[g]={type:c[g]});for(var i=b.split("."),n=i.splice(i.length-1,1)[0],v=d===a.Container?window:
d,g=0;g<i.length;g++){h=i[g];v[h]||(v[h]={__namespace:true});v=v[h]}h=null;h=this.classFunctionBuilder(n,c,f,e);h.fullName=b;h.namespace=i.join(".");h.name=n;h.container=d;h.container.registerType(b,h);this.buildType(h,c,e,f);typeof intellisense!=="undefined"&&e&&e.constructor&&intellisense.annotate(h,e.constructor);v[n]=this.classNames[b]=h;b=h.baseTypes.length;for(g=0;g<b;g++){c=h.baseTypes[g];"inheritedTypeProcessor"in c&&c.inheritedTypeProcessor(h)}return h},classFunctionBuilder:function(a,b,
c,d){var e=this.bodyBuilder(b,c,d);return(new Function("base","classDefinition","instanceDefinition","name","return function "+a+" (){ "+e+" \n}; "))(b,c,d,a)},bodyBuilder:function(b,c,d){for(var e=c="",f="",g=0,h=b.length;g<h;g++){var i=b[g],n=g;if(n==0){if(i&&i.type&&i.type!==a.Base&&i.type.fullName){e=e+("    var baseArguments = $data.typeSystem.createCtorParams(arguments, base["+n+"].params, this); \n");e=e+("    "+i.type.fullName+".apply(this, baseArguments); \n")}}else if(i&&i.type&&i.propagateTo){f=
f+("    "+(!f?"var ":"")+"propagationArguments = $data.typeSystem.createCtorParams(arguments, base["+n+"].params, this); \n");f=f+('    this["'+i.propagateTo+'"] =  Object.create('+i.type.fullName+".prototype); \n    "+i.type.fullName+'.apply(this["'+i.propagateTo+'"], propagationArguments); \n')}else i&&i.type&&i.type.memberDefinitions&&i.type.memberDefinitions.$constructor&&!i.propagateTo&&(c=c+("    "+i.type.fullName+".memberDefinitions.$constructor.method.apply(this); \n"))}d&&d.constructor!=
Object&&(e=e+"    instanceDefinition.constructor.apply(this, arguments); \n");return"\n    //mixins \n"+c+"\n    //construction \n"+e+"\n    //propagations \n"+f},buildType:function(a,b,c,e){var f=b[0].type;if(a.inheritsFrom=f){a.prototype=Object.create(f.prototype);a.memberDefinitions=Object.create(f.memberDefinitions||new d);a.memberDefinitions.clearCache();var g=f.staticDefinitions;if(g)if(g=g.asArray())for(var h=0;h<g.length;h++)this.buildMember(a,g[h],void 0,"staticDefinitions");a.baseTypes=
f.baseTypes?[].concat(f.baseTypes):[];for(h=0;h<b.length;h++)a.baseTypes.push(b[h].type);a.isAssignableTo||Object.defineProperty(a,"isAssignableTo",{value:function(a){return this===a||this.baseTypes.indexOf(a)>=0},writable:false,enumerable:false,configurable:false})}if(e){this.buildStaticMembers(a,e);if(e.constructor)a.classConstructor=e.constructor}c&&this.buildInstanceMembers(a,c);b=[].concat(b);b.shift();Object.keys(b).length>0&&this.buildInstanceMixins(a,b);a.__class=true;a.prototype.constructor=
a;Object.defineProperty(a.prototype,"getType",{value:function(){return a},writable:false,enumerable:false,configurable:false})},addMethod:function(a,b,c,d){a[b]=!d||typeof intellisense!=="undefined"?c:function(){return c.apply(this[d],arguments)}},addProperty:function(a,b,c,d){if(d){c.configurable=true;if(c.get){var e=c.get;c.get=function(){this[d]||Guard.raise(new Exception("not inicialized"));return e.apply(this[d],arguments)}}if(c.set){var f=c.set;c.set=function(){this[d]||Guard.raise(new Exception("not inicialized"));
f.apply(this[d],arguments)}}}Object.defineProperty(a,b,c)},addField:function(){Guard.raise("not implemented")},buildMethod:function(a,b,c){this.addMethod(b.classMember?a:a.prototype,b.name,b.method,c)},buildProperty:function(a,b,c){var d=b.classMember?a:a.prototype,e=b.createPropertyDescriptor(a);this.addProperty(d,b.name,e,c);if(!b.classMember&&a.__setPropertyfunctions==true&&b.withoutGetSetMethod!==true&&!("get_"+b.name in d||"set_"+b.name in d)){a=b.createGetMethod();this.addProperty(d,"get_"+
b.name,a,c);a=b.createSetMethod();this.addProperty(d,"set_"+b.name,a,c)}},buildMember:function(a,b,c,e){e=e||"memberDefinitions";a[e]=a[e]||new d;a[e].setMember(b);switch(b.kind){case f.method:this.buildMethod(a,b,c);break;case f.navProperty:case f.complexProperty:case f.property:this.buildProperty(a,b,c);break;default:Guard.raise("Unknown member type: "+b.kind+","+b.name)}},buildStaticMembers:function(a,b){for(var d in b)if(b.hasOwnProperty(d)){var e=c.translateDefinition(b[d],d,a);e.classMember=
true;this.buildMember(a,e,void 0,"staticDefinitions")}},buildInstanceMembers:function(a,b){for(var d in b)if(b.hasOwnProperty(d)){var e=c.translateDefinition(b[d],d,a);this.buildMember(a,e,void 0,"memberDefinitions")}},copyMembers:function(a,b){Object.keys(a.prototype).forEach(function(c){if(c!=="constructor"&&c!=="toString"){typeof intellisense!=="undefined"&&intellisense.logMessage("copying item:"+c);b.prototype[c]=a[c]}})},buildInstanceMixins:function(a,b){a.mixins=a.mixins||[];a.propagations=
a.propagations||[];for(var c=0;c<b.length;c++){var d=b[c];if(d.propagateTo){this.buildInstancePropagation(a,d);a.propagations.push(d);a.propagations[d.type.name]=true}else{this.buildInstanceMixin(a,d);a.mixins.push(d);a.mixins[d.type.name]=true}}},buildInstanceMixin:function(a,b){for(var c=b.type.memberDefinitions.asArray(),d=0,e=c.length;d<e;d++){var f=c[d].name;f!=="constructor"&&!a.memberDefinitions.getMember(f)&&this.buildMember(a,c[d])}if(b.type.staticDefinitions){c=b.type.staticDefinitions.asArray();
d=0;for(e=c.length;d<e;d++){f=c[d].name;f!=="constructor"&&!a.memberDefinitions.getMember(f)&&this.buildMember(a,c[d],void 0,"staticDefinitions")}}},buildInstancePropagation:function(a,b){for(var c=b.type.memberDefinitions.asArray(),d=0,e=c.length;d<e;d++){var f=c[d].name;f!=="constructor"&&!a.memberDefinitions.getMember(f)&&this.buildMember(a,c[d],b.propagateTo)}}};a.Class=Class=new e;b=window;a.ContainerClass=g;b.Container=a.Container=b.C$=new g;a.createContainer=function(){return new g(a.Container)};
b.$C=function(){Class.define.apply(Class,arguments)};var h=function(a,b){var c="_"+a.name;this[c]?this[c]=b:Object.defineProperty(this,c,a.createStorePropertyDescriptor(b))},i=function(a){return this["_"+a.name]};a.Class.define("$data.Base",function(){},null,{storeProperty:h,retrieveProperty:i,setProperty:function(a,b,c){this[a.name]=b;c()},getProperty:function(a,b){b.apply(this,[this[a.name]])}},{create:function(){return Container.createInstance(this,arguments)},extend:function(b,c,d,e){if(c&&!(c instanceof
g)){e=d;d=c;c=void 0}return a.Class.define(b,this,c,d,e)},getMemberDefinition:function(a){return this.memberDefinitions.getMember(a)},addProperty:function(b,d,e,f){var g=d,h=e,i;if(typeof g==="string"){i=d;g=e;h=f}b=c.translateDefinition({notMapped:true,storeOnObject:true,get:typeof g==="function"?g:function(){},set:typeof h==="function"?h:function(){},type:i},b,this);a.Class.buildMember(this,b);this.memberDefinitions.clearCache();return this},addMember:function(b,d,e){b=c.translateDefinition(d,b,
this);if(e){b.classMember=true;a.Class.buildMember(this,b,void 0,"staticDefinitions");this.staticDefinitions.clearCache()}else{a.Class.buildMember(this,b);this.memberDefinitions.clearCache()}return this},describeField:function(a,b){this.memberDefinitions.getMember(a)?Guard.raise(new Exception("Field '"+a+"' already defined!","Invalid operation")):this.addMember(a,b);return this},storeProperty:h,retrieveProperty:i,"from$data.Object":function(a){return a}});a.Class.ConstructorParameter=ConstructorParameter=
a.Class.define("ConstructorParameter",null,null,{constructor:function(a){this.paramIndex=a},paramIndex:{}})})($data,window);
$data.defaultErrorCallback=function(){if(arguments.length>0&&arguments[arguments.length-1]&&typeof arguments[arguments.length-1].reject==="function"){(console.error||console.log).call(console,arguments[0]);arguments[arguments.length-1].reject.apply(arguments[arguments.length-1],arguments)}else arguments[0]instanceof Error?Guard.raise(arguments[0]):Guard.raise(new Exception("DEFAULT ERROR CALLBACK!","DefaultError",arguments))};$data.defaultSuccessCallback=function(){};$data.defaultNotifyCallback=function(){};
$data.typeSystem={__namespace:!0,extend:function(a){typeof a!=="object"&&typeof a!=="function"&&Guard.raise("Target must be object or function");for(var b=1;b<arguments.length;b++){var c=arguments[b];if(!(c===null||typeof c==="undefined"))for(key in c)a[key]=c[key]}return a},createCallbackSetting:function(a,b){function c(a){var b=this;return function(){a.apply(b,arguments);a=function(){}}}var d={success:$data.defaultSuccessCallback,error:$data.defaultErrorCallback,notify:$data.defaultNotifyCallback};
b!=void 0&&b!=null&&(d=b);d=a==null||a==void 0?d:typeof a=="function"?this.extend(d,{success:a}):this.extend(d,a);if(typeof d.error==="function")d.error=c(d.error);return d},createCtorParams:function(a,b,c){if(b){for(var d=[],e=0,f=b.length;e<f;e++){var g=e;b[g]instanceof ConstructorParameter?d.push(a[b[g].paramIndex]):typeof b[g]==="function"?d.push(b[g].apply(c)):d.push(b[g])}return d}return a},writePropertyValues:function(a){a&&a.getType&&a.getType().memberDefinitions&&this.writeProperties(a,a.getType().memberDefinitions.asArray().filter(function(a){return(a.kind==
"property"||a.kind=="navProperty"||a.kind=="complexProperty")&&!a.prototypeProperty}))},writeProperties:function(a,b){for(var c={},d=0,e=b.length;d<e;d++){var f=b[d];c[f.name]=f.createPropertyDescriptor(null,f.value)}Object.defineProperties(a,c)},writeProperty:function(a,b,c){if(b=typeof b==="string"?a.getType().memberDefinitions.getMember(b):b){c=b.createPropertyDescriptor(null,c);Object.defineProperty(a,b.name,c)}}};$data.debug=function(){(console.debug||console.log).apply(console,arguments)};
$data.debugWith=function(){var a=arguments;return function(b){(console.debug||console.log).apply(console,a);typeof Error!=="undefined"&&b instanceof Error||typeof Exception!=="undefined"&&b instanceof Exception?(console.error||console.log).apply(console,arguments):(console.debug||console.log).apply(console,arguments)}};$data.fdebug={success:$data.debugWith("success"),error:$data.debugWith("error")};$data.Number="undefined"!==typeof Number?Number:function(){};
$data.Date="undefined"!==typeof Date?Date:function(){};$data.String="undefined"!==typeof String?String:function(){};$data.Boolean="undefined"!==typeof Boolean?Boolean:function(){};$data.Array="undefined"!==typeof Array?Array:function(){};$data.Object="undefined"!==typeof Object?Object:function(){};$data.Function=Function;$data.Byte=function(){};$data.SByte=function(){};$data.Decimal=function(){};$data.Float=$data.Single=function(){};$data.Integer=function(){};$data.Int16=function(){};
$data.Int32=function(){};$data.Int64=function(){};$data.ObjectID="undefined"!==typeof $data.mongoDBDriver&&"undefined"!==typeof $data.mongoDBDriver.ObjectID?$data.mongoDBDriver.ObjectID:function(){};$data.Time=function(){};$data.DateTimeOffset=function(a){this.value=a};$data.DateTimeOffset.prototype.toJSON=function(){return this.value instanceof Date?this.value.toISOString():this.value};$data.Container.registerType(["$data.Number","number","JayNumber","double"],$data.Number);
$data.Container.registerType(["$data.Integer","int","integer","JayInteger"],$data.Integer);$data.Container.registerType(["$data.Int32","int32","JayInt32"],$data.Int32);$data.Container.registerType(["$data.Byte","byte","JayByte"],$data.Byte);$data.Container.registerType(["$data.SByte","sbyte","JaySByte"],$data.SByte);$data.Container.registerType(["$data.Decimal","decimal","JayDecimal"],$data.Decimal);$data.Container.registerType(["$data.Float","$data.Single","float","single","JayFloat"],$data.Float);
$data.Container.registerType(["$data.Int16","int16","word","JayInt16"],$data.Int16);$data.Container.registerType(["$data.Int64","int64","long","JayInt64"],$data.Int64);$data.Container.registerType(["$data.String","string","text","character","JayString"],$data.String);$data.Container.registerType(["$data.Array","array","Array","[]","JayArray"],$data.Array,function(){return $data.Array.apply(void 0,arguments)});$data.Container.registerType(["$data.Date","datetime","date","JayDate"],$data.Date);
$data.Container.registerType(["$data.Time","time","JayTime"],$data.Time);$data.Container.registerType(["$data.DateTimeOffset","offset","datetimeoffset","JayDateTimeOffset"],$data.DateTimeOffset);$data.Container.registerType(["$data.Boolean","bool","boolean","JayBoolean"],$data.Boolean);$data.Container.registerType(["$data.Object","Object","object","{}","JayObject"],$data.Object);$data.Container.registerType(["$data.Function","Function","function"],$data.Function);
$data.Container.registerType("$data.ObjectID,ObjectID,objectId,objectid,ID,Id,id,JayObjectID".split(","),$data.ObjectID);$data.Class.define("$data.TraceBase",null,null,{log:function(){},warn:function(){},error:function(){}});$data.Trace=new $data.TraceBase;
$data.Class.define("$data.Logger",$data.TraceBase,null,{log:function(){Array.prototype.unshift.call(arguments,this.getDateFormat());console.log.apply(console,arguments)},warn:function(){Array.prototype.unshift.call(arguments,this.getDateFormat());console.warn.apply(console,arguments)},error:function(){Array.prototype.unshift.call(arguments,this.getDateFormat());console.error.apply(console,arguments)},getDateFormat:function(){var a=new Date;return a.getHours()+":"+a.getMinutes()+":"+a.getSeconds()+
"."+a.getMilliseconds()}});$data.Number="undefined"!==typeof Number?Number:function(){};$data.Date="undefined"!==typeof Date?Date:function(){};$data.String="undefined"!==typeof String?String:function(){};$data.Boolean="undefined"!==typeof Boolean?Boolean:function(){};$data.Array="undefined"!==typeof Array?Array:function(){};$data.Object="undefined"!==typeof Object?Object:function(){};$data.Function=Function;$data.Byte=function(){};$data.SByte=function(){};$data.Decimal=function(){};
$data.Float=$data.Single=function(){};$data.Integer=function(){};$data.Int16=function(){};$data.Int32=function(){};$data.Int64=function(){};$data.ObjectID="undefined"!==typeof $data.mongoDBDriver&&"undefined"!==typeof $data.mongoDBDriver.ObjectID?$data.mongoDBDriver.ObjectID:function(){};$data.Time=function(){};$data.DateTimeOffset=function(a){this.value=a};$data.DateTimeOffset.prototype.toJSON=function(){return this.value instanceof Date?this.value.toISOString():this.value};
$data.Container.registerType(["$data.Number","number","JayNumber","double"],$data.Number);$data.Container.registerType(["$data.Integer","int","integer","JayInteger"],$data.Integer);$data.Container.registerType(["$data.Int32","int32","JayInt32"],$data.Int32);$data.Container.registerType(["$data.Byte","byte","JayByte"],$data.Byte);$data.Container.registerType(["$data.SByte","sbyte","JaySByte"],$data.SByte);$data.Container.registerType(["$data.Decimal","decimal","JayDecimal"],$data.Decimal);
$data.Container.registerType(["$data.Float","$data.Single","float","single","JayFloat"],$data.Float);$data.Container.registerType(["$data.Int16","int16","word","JayInt16"],$data.Int16);$data.Container.registerType(["$data.Int64","int64","long","JayInt64"],$data.Int64);$data.Container.registerType(["$data.String","string","text","character","JayString"],$data.String);
$data.Container.registerType(["$data.Array","array","Array","[]","JayArray"],$data.Array,function(){return $data.Array.apply(void 0,arguments)});$data.Container.registerType(["$data.Date","datetime","date","JayDate"],$data.Date);$data.Container.registerType(["$data.Time","time","JayTime"],$data.Time);$data.Container.registerType(["$data.DateTimeOffset","offset","datetimeoffset","JayDateTimeOffset"],$data.DateTimeOffset);
$data.Container.registerType(["$data.Boolean","bool","boolean","JayBoolean"],$data.Boolean);$data.Container.registerType(["$data.Object","Object","object","{}","JayObject"],$data.Object);$data.Container.registerType(["$data.Function","Function","function"],$data.Function);$data.Container.registerType("$data.ObjectID,ObjectID,objectId,objectid,ID,Id,id,JayObjectID".split(","),$data.ObjectID);
$data.SimpleBase=function(a){if(typeof a==="object"&&a)if(Array.isArray(this.constructor.validMembers))for(var b=0;b<this.constructor.validMembers.length;b++){var c=this.constructor.validMembers[b];a[c]!==void 0&&(this[c]=a[c])}else{delete a.type;$data.typeSystem.extend(this,a)}};$data.SimpleBase.registerType=function(a,b,c){c=c||$data.SimpleBase;b.type=a;b.prototype=Object.create(c.prototype);b.prototype.constructor=b};$data.Container.registerType(["$data.SimpleBase","SimpleBase"],$data.SimpleBase);
$data.Geospatial=function(){this.type=this.constructor.type;if(Array.isArray(this.constructor.validMembers))for(var a=0;a<this.constructor.validMembers.length;a++)this[this.constructor.validMembers[a]]=void 0;$data.SimpleBase.apply(this,arguments);this.type=this.constructor.type||"Unknown"};$data.SimpleBase.registerType("Geospatial",$data.Geospatial);$data.Container.registerType(["$data.Geospatial","Geospatial"],$data.Geospatial);
$data.point=function(a){if(a&&a.crs)return a.crs.properties&&a.crs.properties.name===$data.GeometryBase.defaultCrs.properties.name?new $data.GeometryPoint(a):new $data.GeographyPoint(a);if(a){if("x"in a&&"y"in a)return new $data.GeometryPoint(a.x,a.y);if("longitude"in a&&"latitude"in a)return new $data.GeographyPoint(a.longitude,a.latitude);if("lng"in a&&"lat"in a)return new $data.GeographyPoint(a.lng,a.lat)}};
$data.GeographyBase=function(){$data.Geospatial.apply(this,arguments);this.crs=$data.GeographyBase.defaultCrs;$data.GeographyBase.validateGeoJSON(this)};$data.GeographyBase.defaultCrs={properties:{name:"EPSG:4326"},type:"name"};
$data.GeographyBase.parseFromString=function(a){var b=a.indexOf("(");if(b>=0){b=a.substring(0,b).toLowerCase();if((b=$data.GeographyBase.registered[b])&&b.parseFromString&&b!=$data.GeographyBase)return b.parseFromString(a);Guard.raise(new Exception("parseFromString","Not Implemented",a))}};
$data.GeographyBase.stringifyToUrl=function(a){if(a instanceof $data.GeographyBase&&a.constructor&&a.constructor.stringifyToUrl)return a.constructor.stringifyToUrl(a);if(a instanceof $data.GeographyBase&&a.constructor&&Array.isArray(a.constructor.validMembers)&&a.constructor.validMembers[0]==="coordinates"){var b="geography'"+a.type.toUpperCase()+"(",c=function(a){if(Array.isArray(a[0]))for(var e=0;e<a.length;e++){e>0&&(b=b+",");Array.isArray(a[e][0])&&(b=b+"(");c(a[e]);Array.isArray(a[e][0])&&(b=
b+")")}else b=b+a.join(" ")};c(a.coordinates,b);return b=b+")'"}Guard.raise(new Exception("stringifyToUrl on instance type","Not Implemented",a))};$data.GeographyBase.registerType=function(a,b,c){$data.SimpleBase.registerType(a,b,c||$data.GeographyBase);$data.GeographyBase.registered=$data.GeographyBase.registered||{};$data.GeographyBase.registered[a.toLowerCase()]=b};
$data.GeographyBase.validateGeoJSON=function(a){var b=a.type;if(b){var c=$data.GeographyBase.registered[b.toLowerCase()];if(typeof c.validateGeoJSON==="function"){if(c=c.validateGeoJSON(a))return c;Guard.raise(new Exception("Invalid '"+b+"' format!","Format Exception",a))}}console.log("GeoJSON validation missing",a)};$data.SimpleBase.registerType("GeographyBase",$data.GeographyBase,$data.Geospatial);$data.Container.registerType(["$data.GeographyBase"],$data.GeographyBase);
$data.GeographyPoint=function(a,b){a&&typeof a==="object"&&Array.isArray(a)?$data.GeographyBase.call(this,{coordinates:a}):a&&typeof a==="object"&&("longitude"in a||"latitude"in a)?$data.GeographyBase.call(this,{coordinates:[a.longitude,a.latitude]}):a&&typeof a==="object"&&("lng"in a||"lat"in a)?$data.GeographyBase.call(this,{coordinates:[a.lng,a.lat]}):a&&typeof a==="object"?$data.GeographyBase.call(this,a):$data.GeographyBase.call(this,{coordinates:[a||0,b||0]})};
$data.GeographyPoint.validateGeoJSON=function(a){return a&&Array.isArray(a.coordinates)&&a.coordinates.length==2&&typeof a.coordinates[0]==="number"&&typeof a.coordinates[1]==="number"};$data.GeographyPoint.parseFromString=function(a){a=a.substring(a.indexOf("(")+1,a.lastIndexOf(")")).split(" ");return new $data.GeographyPoint(parseFloat(a[0]),parseFloat(a[1]))};$data.GeographyPoint.validMembers=["coordinates"];$data.GeographyBase.registerType("Point",$data.GeographyPoint);
Object.defineProperty($data.GeographyPoint.prototype,"longitude",{get:function(){return this.coordinates[0]},set:function(a){this.coordinates[0]=a}});Object.defineProperty($data.GeographyPoint.prototype,"latitude",{get:function(){return this.coordinates[1]},set:function(a){this.coordinates[1]=a}});$data.Container.registerType("$data.GeographyPoint,GeographyPoint,$data.Geography,Geography,geography,geo".split(","),$data.GeographyPoint);$data.Geography=$data.GeographyPoint;
$data.GeographyLineString=function(a){Array.isArray(a)?$data.GeographyBase.call(this,{coordinates:a}):$data.GeographyBase.call(this,a)};$data.GeographyLineString.validateGeoJSON=function(a){for(var b=a&&Array.isArray(a.coordinates),c=0;b&&c<a.coordinates.length;c++)var d=a.coordinates[c],b=b&&Array.isArray(d)&&d.length==2&&typeof d[0]==="number"&&typeof d[1]==="number";return b};$data.GeographyLineString.validMembers=["coordinates"];$data.GeographyBase.registerType("LineString",$data.GeographyLineString);
$data.Container.registerType(["$data.GeographyLineString","GeographyLineString"],$data.GeographyLineString);
$data.GeographyPolygon=function(a){if(typeof a==="object"&&("topLeft"in a&&"bottomRight"in a||"topRight"in a&&"bottomLeft"in a)){var b,c,d;if("topLeft"in a&&"bottomRight"in a){b=a.topLeft instanceof $data.GeographyPoint?a.topLeft:new $data.GeographyPoint(a.topLeft);d=a.bottomRight instanceof $data.GeographyPoint?a.bottomRight:new $data.GeographyPoint(a.bottomRight);c=new $data.GeographyPoint([d.coordinates[0],b.coordinates[1]]);a=new $data.GeographyPoint([b.coordinates[0],d.coordinates[1]])}else{c=
a.topRight instanceof $data.GeographyPoint?a.topRight:new $data.GeographyPoint(a.topRight);a=a.bottomLeft instanceof $data.GeographyPoint?a.bottomLeft:new $data.GeographyPoint(a.bottomLeft);b=new $data.GeographyPoint([a.coordinates[0],c.coordinates[1]]);d=new $data.GeographyPoint([c.coordinates[0],a.coordinates[1]])}var e=[];e.push([].concat(b.coordinates));e.push([].concat(c.coordinates));e.push([].concat(d.coordinates));e.push([].concat(a.coordinates));e.push([].concat(b.coordinates));$data.GeographyBase.call(this,
{coordinates:[e]})}else Array.isArray(a)?$data.GeographyBase.call(this,{coordinates:a}):$data.GeographyBase.call(this,a)};$data.GeographyPolygon.validateGeoJSON=function(a){for(var b=a&&Array.isArray(a.coordinates),c=0;b&&c<a.coordinates.length;c++)for(var d=a.coordinates[c],b=b&&Array.isArray(d),e=0;b&&e<d.length;e++)var f=d[e],b=b&&Array.isArray(f)&&f.length==2&&typeof f[0]==="number"&&typeof f[1]==="number";return b};
$data.GeographyPolygon.parseFromString=function(a){for(var a=a.substring(a.indexOf("(")+1,a.lastIndexOf(")")),b=a.substring(a.indexOf("(")+1,a.lastIndexOf(")")).split("),("),a=[],c=0;c<b.length;c++){for(var d=[],e=b[c].split(","),f=0;f<e.length;f++){var g=e[f].split(" ");d.push([parseFloat(g[0]),parseFloat(g[1])])}a.push(d)}return new $data.GeographyPolygon(a)};$data.GeographyPolygon.validMembers=["coordinates"];$data.GeographyBase.registerType("Polygon",$data.GeographyPolygon);
$data.Container.registerType(["$data.GeographyPolygon","GeographyPolygon"],$data.GeographyPolygon);$data.GeographyMultiPoint=function(a){Array.isArray(a)?$data.GeographyBase.call(this,{coordinates:a}):$data.GeographyBase.call(this,a)};$data.GeographyMultiPoint.validateGeoJSON=function(a){for(var b=a&&Array.isArray(a.coordinates),c=0;b&&c<a.coordinates.length;c++)var d=a.coordinates[c],b=b&&Array.isArray(d)&&d.length==2&&typeof d[0]==="number"&&typeof d[1]==="number";return b};
$data.GeographyMultiPoint.validMembers=["coordinates"];$data.GeographyBase.registerType("MultiPoint",$data.GeographyMultiPoint);$data.Container.registerType(["$data.GeographyMultiPoint","GeographyMultiPoint"],$data.GeographyMultiPoint);$data.GeographyMultiLineString=function(a){Array.isArray(a)?$data.GeographyBase.call(this,{coordinates:a}):$data.GeographyBase.call(this,a)};
$data.GeographyMultiLineString.validateGeoJSON=function(a){for(var b=a&&Array.isArray(a.coordinates),c=0;b&&c<a.coordinates.length;c++)for(var d=a.coordinates[c],b=b&&Array.isArray(d),e=0;b&&e<d.length;e++)var f=d[e],b=b&&Array.isArray(f)&&f.length==2&&typeof f[0]==="number"&&typeof f[1]==="number";return b};$data.GeographyMultiLineString.validMembers=["coordinates"];$data.GeographyBase.registerType("MultiLineString",$data.GeographyMultiLineString);
$data.Container.registerType(["$data.GeographyMultiLineString","GeographyMultiLineString"],$data.GeographyMultiLineString);$data.GeographyMultiPolygon=function(a){Array.isArray(a)?$data.GeographyBase.call(this,{coordinates:a}):$data.GeographyBase.call(this,a)};
$data.GeographyMultiPolygon.validateGeoJSON=function(a){for(var b=a&&Array.isArray(a.coordinates),c=0;b&&c<a.coordinates.length;c++)for(var d=a.coordinates[c],b=b&&Array.isArray(d),e=0;b&&e<d.length;e++)for(var f=d[e],b=b&&Array.isArray(f),g=0;b&&g<f.length;g++)var h=f[g],b=b&&Array.isArray(h)&&h.length==2&&typeof h[0]==="number"&&typeof h[1]==="number";return b};$data.GeographyMultiPolygon.validMembers=["coordinates"];$data.GeographyBase.registerType("MultiPolygon",$data.GeographyMultiPolygon);
$data.Container.registerType(["$data.GeographyMultiPolygon","GeographyMultiPolygon"],$data.GeographyMultiPolygon);$data.GeographyCollection=function(a){Array.isArray(a)?$data.GeographyBase.call(this,{geometries:a}):$data.GeographyBase.call(this,a)};$data.GeographyCollection.validateGeoJSON=function(a){for(var b=a&&Array.isArray(a.geometries),c=0;b&&c<a.geometries.length;c++){var d=a.geometries[c];try{b=b&&$data.GeographyBase.validateGeoJSON(d)}catch(e){b=false}}return b};
$data.GeographyCollection.validMembers=["geometries"];$data.GeographyBase.registerType("GeometryCollection",$data.GeographyCollection);$data.Container.registerType(["$data.GeographyCollection","GeographyCollection"],$data.GeographyCollection);$data.Container.registerConverter($data.GeographyPoint,$data.Object,function(a){return a?new $data.GeographyPoint(a):a});$data.Container.registerConverter($data.GeographyLineString,$data.Object,function(a){return a?new $data.GeographyLineString(a):a});
$data.Container.registerConverter($data.GeographyPolygon,$data.Object,function(a){return a?new $data.GeographyPolygon(a):a});$data.Container.registerConverter($data.GeographyMultiPoint,$data.Object,function(a){return a?new $data.GeographyMultiPoint(a):a});$data.Container.registerConverter($data.GeographyMultiLineString,$data.Object,function(a){return a?new $data.GeographyMultiLineString(a):a});
$data.Container.registerConverter($data.GeographyMultiPolygon,$data.Object,function(a){return a?new $data.GeographyMultiPolygon(a):a});$data.Container.registerConverter($data.GeographyCollection,$data.Object,function(a){return a?new $data.GeographyCollection(a):a});$data.GeometryBase=function(){$data.Geospatial.apply(this,arguments);this.crs=$data.GeometryBase.defaultCrs;$data.GeometryBase.validateGeoJSON(this)};$data.GeometryBase.defaultCrs={properties:{name:"EPSG:0"},type:"name"};
$data.GeometryBase.parseFromString=function(a){var b=a.indexOf("(");if(b>=0){b=a.substring(0,b).toLowerCase();if((b=$data.GeometryBase.registered[b])&&b.parseFromString&&b!=$data.GeometryBase)return b.parseFromString(a);Guard.raise(new Exception("parseFromString","Not Implemented",a))}};
$data.GeometryBase.stringifyToUrl=function(a){if(a instanceof $data.GeometryBase&&a.constructor&&a.constructor.stringifyToUrl)return a.constructor.stringifyToUrl(a);if(a instanceof $data.GeometryBase&&a.constructor&&Array.isArray(a.constructor.validMembers)&&a.constructor.validMembers[0]==="coordinates"){var b="geometry'"+a.type.toUpperCase()+"(",c=function(a){if(Array.isArray(a[0]))for(var e=0;e<a.length;e++){e>0&&(b=b+",");Array.isArray(a[e][0])&&(b=b+"(");c(a[e]);Array.isArray(a[e][0])&&(b=b+")")}else b=
b+a.join(" ")};c(a.coordinates,b);return b=b+")'"}Guard.raise(new Exception("stringifyToUrl on instance type","Not Implemented",a))};$data.GeometryBase.registerType=function(a,b,c){$data.SimpleBase.registerType(a,b,c||$data.GeometryBase);$data.GeometryBase.registered=$data.GeometryBase.registered||{};$data.GeometryBase.registered[a.toLowerCase()]=b};
$data.GeometryBase.validateGeoJSON=function(a){var b=a.type;if(b){var c=$data.GeometryBase.registered[b.toLowerCase()];if(typeof c.validateGeoJSON==="function"){if(c=c.validateGeoJSON(a))return c;Guard.raise(new Exception("Invalid '"+b+"' format!","Format Exception",a))}}console.log("GeoJSON validation missing",a)};$data.SimpleBase.registerType("GeometryBase",$data.GeometryBase,$data.Geospatial);$data.Container.registerType(["$data.GeometryBase"],$data.GeometryBase);
$data.GeometryPoint=function(a,b){a&&typeof a==="object"&&Array.isArray(a)?$data.GeometryBase.call(this,{coordinates:a}):a&&typeof a==="object"&&("x"in a||"y"in a)?$data.GeometryBase.call(this,{coordinates:[a.x,a.y]}):a&&typeof a==="object"?$data.GeometryBase.call(this,a):$data.GeometryBase.call(this,{coordinates:[a||0,b||0]})};
$data.GeometryPoint.validateGeoJSON=function(a){return a&&Array.isArray(a.coordinates)&&a.coordinates.length==2&&typeof a.coordinates[0]==="number"&&typeof a.coordinates[1]==="number"};$data.GeometryPoint.parseFromString=function(a){a=a.substring(a.indexOf("(")+1,a.lastIndexOf(")")).split(" ");return new $data.GeometryPoint(parseFloat(a[0]),parseFloat(a[1]))};$data.GeometryPoint.validMembers=["coordinates"];$data.GeometryBase.registerType("Point",$data.GeometryPoint);
Object.defineProperty($data.GeometryPoint.prototype,"x",{get:function(){return this.coordinates[0]},set:function(a){this.coordinates[0]=a}});Object.defineProperty($data.GeometryPoint.prototype,"y",{get:function(){return this.coordinates[1]},set:function(a){this.coordinates[1]=a}});$data.Container.registerType(["$data.GeometryPoint","GeometryPoint"],$data.GeometryPoint);
$data.GeometryLineString=function(a){Array.isArray(a)?$data.GeometryBase.call(this,{coordinates:a}):$data.GeometryBase.call(this,a)};$data.GeometryLineString.validateGeoJSON=function(a){for(var b=a&&Array.isArray(a.coordinates),c=0;b&&c<a.coordinates.length;c++)var d=a.coordinates[c],b=b&&Array.isArray(d)&&d.length==2&&typeof d[0]==="number"&&typeof d[1]==="number";return b};$data.GeometryLineString.validMembers=["coordinates"];$data.GeometryBase.registerType("LineString",$data.GeometryLineString);
$data.Container.registerType(["$data.GeometryLineString","GeometryLineString"],$data.GeometryLineString);
$data.GeometryPolygon=function(a){if(typeof a==="object"&&("topLeft"in a&&"bottomRight"in a||"topRight"in a&&"bottomLeft"in a)){var b,c,d;if("topLeft"in a&&"bottomRight"in a){b=a.topLeft instanceof $data.GeometryPoint?a.topLeft:new $data.GeometryPoint(a.topLeft);d=a.bottomRight instanceof $data.GeometryPoint?a.bottomRight:new $data.GeometryPoint(a.bottomRight);c=new $data.GeometryPoint([d.coordinates[0],b.coordinates[1]]);a=new $data.GeometryPoint([b.coordinates[0],d.coordinates[1]])}else{c=a.topRight instanceof
$data.GeometryPoint?a.topRight:new $data.GeometryPoint(a.topRight);a=a.bottomLeft instanceof $data.GeometryPoint?a.bottomLeft:new $data.GeometryPoint(a.bottomLeft);b=new $data.GeometryPoint([a.coordinates[0],c.coordinates[1]]);d=new $data.GeometryPoint([c.coordinates[0],a.coordinates[1]])}var e=[];e.push([].concat(b.coordinates));e.push([].concat(c.coordinates));e.push([].concat(d.coordinates));e.push([].concat(a.coordinates));e.push([].concat(b.coordinates));$data.GeometryBase.call(this,{coordinates:[e]})}else Array.isArray(a)?
$data.GeometryBase.call(this,{coordinates:a}):$data.GeometryBase.call(this,a)};$data.GeometryPolygon.validateGeoJSON=function(a){for(var b=a&&Array.isArray(a.coordinates),c=0;b&&c<a.coordinates.length;c++)for(var d=a.coordinates[c],b=b&&Array.isArray(d),e=0;b&&e<d.length;e++)var f=d[e],b=b&&Array.isArray(f)&&f.length==2&&typeof f[0]==="number"&&typeof f[1]==="number";return b};
$data.GeometryPolygon.parseFromString=function(a){for(var a=a.substring(a.indexOf("(")+1,a.lastIndexOf(")")),b=a.substring(a.indexOf("(")+1,a.lastIndexOf(")")).split("),("),a=[],c=0;c<b.length;c++){for(var d=[],e=b[c].split(","),f=0;f<e.length;f++){var g=e[f].split(" ");d.push([parseFloat(g[0]),parseFloat(g[1])])}a.push(d)}return new $data.GeometryPolygon(a)};$data.GeometryPolygon.validMembers=["coordinates"];$data.GeometryBase.registerType("Polygon",$data.GeometryPolygon);
$data.Container.registerType(["$data.GeometryPolygon","GeometryPolygon"],$data.GeometryPolygon);$data.GeometryMultiPoint=function(a){Array.isArray(a)?$data.GeometryBase.call(this,{coordinates:a}):$data.GeometryBase.call(this,a)};$data.GeometryMultiPoint.validateGeoJSON=function(a){for(var b=a&&Array.isArray(a.coordinates),c=0;b&&c<a.coordinates.length;c++)var d=a.coordinates[c],b=b&&Array.isArray(d)&&d.length==2&&typeof d[0]==="number"&&typeof d[1]==="number";return b};
$data.GeometryMultiPoint.validMembers=["coordinates"];$data.GeometryBase.registerType("MultiPoint",$data.GeometryMultiPoint);$data.Container.registerType(["$data.GeometryMultiPoint","GeometryMultiPoint"],$data.GeometryMultiPoint);$data.GeometryMultiLineString=function(a){Array.isArray(a)?$data.GeometryBase.call(this,{coordinates:a}):$data.GeometryBase.call(this,a)};
$data.GeometryMultiLineString.validateGeoJSON=function(a){for(var b=a&&Array.isArray(a.coordinates),c=0;b&&c<a.coordinates.length;c++)for(var d=a.coordinates[c],b=b&&Array.isArray(d),e=0;b&&e<d.length;e++)var f=d[e],b=b&&Array.isArray(f)&&f.length==2&&typeof f[0]==="number"&&typeof f[1]==="number";return b};$data.GeometryMultiLineString.validMembers=["coordinates"];$data.GeometryBase.registerType("MultiLineString",$data.GeometryMultiLineString);
$data.Container.registerType(["$data.GeometryMultiLineString","GeometryMultiLineString"],$data.GeometryMultiLineString);$data.GeometryMultiPolygon=function(a){Array.isArray(a)?$data.GeometryBase.call(this,{coordinates:a}):$data.GeometryBase.call(this,a)};
$data.GeometryMultiPolygon.validateGeoJSON=function(a){for(var b=a&&Array.isArray(a.coordinates),c=0;b&&c<a.coordinates.length;c++)for(var d=a.coordinates[c],b=b&&Array.isArray(d),e=0;b&&e<d.length;e++)for(var f=d[e],b=b&&Array.isArray(f),g=0;b&&g<f.length;g++)var h=f[g],b=b&&Array.isArray(h)&&h.length==2&&typeof h[0]==="number"&&typeof h[1]==="number";return b};$data.GeometryMultiPolygon.validMembers=["coordinates"];$data.GeometryBase.registerType("MultiPolygon",$data.GeometryMultiPolygon);
$data.Container.registerType(["$data.GeometryMultiPolygon","GeometryMultiPolygon"],$data.GeometryMultiPolygon);$data.GeometryCollection=function(a){Array.isArray(a)?$data.GeometryBase.call(this,{geometries:a}):$data.GeometryBase.call(this,a)};$data.GeometryCollection.validateGeoJSON=function(a){for(var b=a&&Array.isArray(a.geometries),c=0;b&&c<a.geometries.length;c++){var d=a.geometries[c];try{b=b&&$data.GeometryBase.validateGeoJSON(d)}catch(e){b=false}}return b};
$data.GeometryCollection.validMembers=["geometries"];$data.GeometryBase.registerType("GeometryCollection",$data.GeometryCollection);$data.Container.registerType(["$data.GeometryCollection","GeometryCollection"],$data.GeometryCollection);$data.Container.registerConverter($data.GeometryPoint,$data.Object,function(a){return a?new $data.GeometryPoint(a):a});$data.Container.registerConverter($data.GeometryLineString,$data.Object,function(a){return a?new $data.GeometryLineString(a):a});
$data.Container.registerConverter($data.GeometryPolygon,$data.Object,function(a){return a?new $data.GeometryPolygon(a):a});$data.Container.registerConverter($data.GeometryMultiPoint,$data.Object,function(a){return a?new $data.GeometryMultiPoint(a):a});$data.Container.registerConverter($data.GeometryMultiLineString,$data.Object,function(a){return a?new $data.GeometryMultiLineString(a):a});
$data.Container.registerConverter($data.GeometryMultiPolygon,$data.Object,function(a){return a?new $data.GeometryMultiPolygon(a):a});$data.Container.registerConverter($data.GeometryCollection,$data.Object,function(a){return a?new $data.GeometryCollection(a):a});
$data.Guid=function(a){if(a===void 0||typeof a==="string"&&/^[a-zA-z0-9]{8}-[a-zA-z0-9]{4}-[a-zA-z0-9]{4}-[a-zA-z0-9]{4}-[a-zA-z0-9]{12}$/.test(a))this.value=a||"00000000-0000-0000-0000-000000000000";else throw Guard.raise(new Exception("TypeError: ","value not convertable to $data.Guid",a));};$data.Container.registerType(["$data.Guid","Guid","guid"],$data.Guid);
$data.Container.registerConverter("$data.Guid",{"$data.String":function(a){return a?$data.parseGuid(a).toString():a},"$data.Guid":function(a){return a?a.toString():a}},{"$data.String":function(a){return a?a.toString():a}});$data.Guid.prototype.toJSON=function(){return this.value};$data.Guid.prototype.valueOf=function(){return this.value};$data.Guid.prototype.toString=function(){return this.value};$data.Guid.NewGuid=function(){return $data.createGuid()};$data.parseGuid=function(a){return new $data.Guid(a)};
(function(){var a=["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z"];$data.createGuid=function(b){if(b)return new $data.Guid(b);var b=[],c,d;b[8]=b[13]=b[18]=b[23]="-";b[14]="4";for(c=0;c<36;c++)if(!b[c]){d=0|Math.random()*16;b[c]=a[c==19?d&3|8:d]}return $data.parseGuid(b.join(""))}})();$data.Blob=function(){};
$data.Blob.createFromHexString=function(a){if(a!=a.match(/[0-9a-fA-F]+/)[0])Guard.raise(new Exception("TypeError: ","value not convertable to $data.Blob",a));else{for(var b=new (typeof Buffer!="undefined"?Buffer:Uint8Array)(a.length>>1),c=0,d=1,e=0;c<a.length;c=c+2,d=d+2,e++)b[e]=parseInt("0x"+a[c]+a[d],16);return b}};$data.Blob.toString=function(a){if(!a||!a.length)return null;for(var b="",c=0;c<a.length;c++)b=b+String.fromCharCode(a[c]);return b};
$data.Blob.toBase64=function(a){return!a||!a.length?null:btoa($data.Blob.toString(a))};$data.Blob.toArray=function(a){if(!a||!a.length)return null;for(var b=Array(a.length),c=0;c<a.length;c++)b[c]=a[c];return b};$data.Blob.toHexString=function(a){if(!a||!a.length)return null;for(var b="",c=0;c<a.length;c++)b=b+("00"+a[c].toString(16)).slice(-2);return b.toUpperCase()};$data.Blob.toDataURL=function(a){return!a||!a.length?null:"data:application/octet-stream;base64,"+btoa($data.Blob.toString(a))};
$data.Container.registerType(["$data.Blob","blob","JayBlob"],$data.Blob);
$data.Container.registerConverter("$data.Blob",{"$data.String":function(a){if(a&&a.length){for(var b=new (typeof Buffer!=="undefined"?Buffer:Uint8Array)(a.length),c=0;c<a.length;c++)b[c]=a.charCodeAt(c);return b}return null},"$data.Array":function(a){return new (typeof Buffer!=="undefined"?Buffer:Uint8Array)(a)},"$data.Number":function(a){return new (typeof Buffer!=="undefined"?Buffer:Uint8Array)($data.packIEEE754(a,11,52).reverse())},"$data.Boolean":function(a){return new (typeof Buffer!=="undefined"?
Buffer:Uint8Array)([a|0])},"default":function(a){if(typeof Blob!=="undefined"&&a instanceof Blob){var b=new XMLHttpRequest;b.open("GET",URL.createObjectURL(a),false);b.responseType="arraybuffer";b.send(null);return $data.Container.convertTo(b.response,$data.Blob)}if(typeof ArrayBuffer!=="undefined"&&a instanceof ArrayBuffer)return new (typeof Buffer!=="undefined"?Buffer:Uint8Array)(new Uint8Array(a));if(a instanceof Uint8Array)return typeof Buffer!=="undefined"?new Buffer(a):a;if(typeof Buffer!==
"undefined"&&a instanceof Buffer)return a;if(a.buffer)return new (typeof Buffer!=="undefined"?Buffer:Uint8Array)(a);if(typeof a=="object"&&a instanceof Object){var b=[],c;for(c in a)b[c]=a[c];if(!b.length)throw 0;return new (typeof Buffer!=="undefined"?Buffer:Uint8Array)(b)}throw 0;}},{"$data.String":function(a){return $data.Blob.toString(a)},"$data.Array":function(a){return $data.Blob.toArray(a)}});
(function(a){function b(){}function c(){}function d(){}function e(){}function f(){}function g(){}function h(){}function i(){}function j(){}function l(){}function w(){}function q(){}function p(){}function C(){}function E(){}function z(){}function n(){}function v(){}function r(){}function T(){}function P(){}function A(){}function t(){}function y(){}function o(){}function D(){}function x(){}function U(){}function H(){}function B(){}a.Container.registerType("Edm.Boolean",b);a.Container.mapType(b,a.Boolean);
a.Container.registerType("Edm.Binary",c);a.Container.mapType(c,a.Blob);a.Container.registerType("Edm.DateTime",d);a.Container.mapType(d,a.Date);a.Container.registerType("Edm.DateTimeOffset",e);a.Container.mapType(e,a.DateTimeOffset);a.Container.registerType("Edm.Time",f);a.Container.mapType(f,a.Time);a.Container.registerType("Edm.Decimal",g);a.Container.mapType(g,a.Decimal);a.Container.registerType("Edm.Float",h);a.Container.mapType(h,a.Float);a.Container.registerType("Edm.Single",i);a.Container.mapType(i,
a.Float);a.Container.registerType("Edm.Double",j);a.Container.mapType(j,a.Number);a.Container.registerType("Edm.Guid",l);a.Container.mapType(l,a.Guid);a.Container.registerType("Edm.Int16",w);a.Container.mapType(w,a.Int16);a.Container.registerType("Edm.Int32",q);a.Container.mapType(q,a.Integer);a.Container.registerType("Edm.Int64",p);a.Container.mapType(p,a.Int64);a.Container.registerType("Edm.Byte",C);a.Container.mapType(C,a.Byte);a.Container.registerType("Edm.SByte",E);a.Container.mapType(E,a.SByte);
a.Container.registerType("Edm.String",z);a.Container.mapType(z,a.String);a.Container.registerType("Edm.GeographyPoint",n);a.Container.mapType(n,a.GeographyPoint);a.Container.registerType("Edm.GeographyLineString",v);a.Container.mapType(v,a.GeographyLineString);a.Container.registerType("Edm.GeographyPolygon",r);a.Container.mapType(r,a.GeographyPolygon);a.Container.registerType("Edm.GeographyMultiPoint",T);a.Container.mapType(T,a.GeographyMultiPoint);a.Container.registerType("Edm.GeographyMultiLineString",
P);a.Container.mapType(P,a.GeographyMultiLineString);a.Container.registerType("Edm.GeographyMultiPolygon",A);a.Container.mapType(A,a.GeographyMultiPolygon);a.Container.registerType("Edm.GeographyCollection",t);a.Container.mapType(t,a.GeographyCollection);a.Container.registerType("Edm.GeometryPoint",y);a.Container.mapType(y,a.GeometryPoint);a.Container.registerType("Edm.GeometryLineString",o);a.Container.mapType(o,a.GeometryLineString);a.Container.registerType("Edm.GeometryPolygon",D);a.Container.mapType(D,
a.GeometryPolygon);a.Container.registerType("Edm.GeometryMultiPoint",x);a.Container.mapType(x,a.GeometryMultiPoint);a.Container.registerType("Edm.GeometryMultiLineString",U);a.Container.mapType(U,a.GeometryMultiLineString);a.Container.registerType("Edm.GeometryMultiPolygon",H);a.Container.mapType(H,a.GeometryMultiPolygon);a.Container.registerType("Edm.GeometryCollection",B);a.Container.mapType(B,a.GeometryCollection);a.oDataEdmMapping={"$data.Byte":"Edm.Byte","$data.SByte":"Edm.SByte","$data.Decimal":"Edm.Decimal",
"$data.Float":"Edm.Float","$data.Int16":"Edm.Int16","$data.Int64":"Edm.Int64","$data.DateTimeOffset":"Edm.DateTimeOffset","$data.Time":"Edm.Time","$data.Boolean":"Edm.Boolean","$data.Blob":"Edm.Binary","$data.Date":"Edm.DateTime","$data.Number":"Edm.Double","$data.Integer":"Edm.Int32","$data.Int32":"Edm.Int32","$data.String":"Edm.String","$data.ObjectID":"Edm.String","$data.GeographyPoint":"Edm.GeographyPoint","$data.GeographyLineString":"Edm.GeographyLineString","$data.GeographyPolygon":"Edm.GeographyPolygon",
"$data.GeographyMultiPoint":"Edm.GeographyMultiPoint","$data.GeographyMultiLineString":"Edm.GeographyMultiLineString","$data.GeographyMultiPolygon":"Edm.GeographyMultiPolygon","$data.GeographyCollection":"Edm.GeographyCollection","$data.GeometryPoint":"Edm.GeometryPoint","$data.GeometryLineString":"Edm.GeometryLineString","$data.GeometryPolygon":"Edm.GeometryPolygon","$data.GeometryMultiPoint":"Edm.GeometryMultiPoint","$data.GeometryMultiLineString":"Edm.GeometryMultiLineString","$data.GeometryMultiPolygon":"Edm.GeometryMultiPolygon",
"$data.GeometryCollection":"Edm.GeometryCollection","$data.Guid":"Edm.Guid"}})($data);$data.Container.registerConverter("$data.Boolean",{"$data.String":function(a){return a.toLowerCase()=="true"?true:a.toLowerCase()=="false"?false:!!a},"default":function(a){return!!a}});$data.Container.registerConverter("$data.Integer",{"default":function(a){if(a===Number.POSITIVE_INFINITY||a===Number.NEGATIVE_INFINITY||a===Number.MAX_VALUE||a===Number.MIN_VALUE)return a;a=parseInt(+a,10);if(isNaN(a))throw 0;return a}});
$data.Container.registerConverter("$data.Int32",{"default":function(a){return a|0}});$data.Container.registerConverter("$data.Number",{"default":function(a){a=+a;if(isNaN(a))throw 0;return a}});$data.Container.registerConverter("$data.Byte",{"default":function(a){return(a|0)&255}});$data.Container.registerConverter("$data.Date",{"default":function(a){a=new Date(a);if(isNaN(a))throw 0;return a}});
$data.Container.registerConverter("$data.DateTimeOffset",{"$data.Date":function(a){return a},"default":function(a){a=new Date(a);if(isNaN(a))throw 0;return a}});
(function(){function a(a){a=/^([0-9]|0[0-9]|1[0-9]|2[0-3]):([0-5][0-9]|[0-9])(:([0-5][0-9]|[0-9])(\.(\d+))?)?$/.exec(a);if(!a)throw 0;var c;c=""+("00"+a[1]).slice(-2);c=c+(":"+("00"+a[2]).slice(-2));c=a[4]?c+(":"+("00"+a[4]).slice(-2)):c+":00";a[6]&&(c=c+("."+(a[6]+"000").slice(0,3)));return c}$data.Container.registerConverter("$data.Time",{"$data.String":a,"$data.Number":function(b){for(var c=[1E3,60,60],b=[0,0,0,b|0],d=0;d<c.length;d++){b[c.length-(d+1)]=b[c.length-d]/c[d]|0;b[c.length-d]=b[c.length-
d]-b[c.length-(d+1)]*c[d]}c="";for(d=0;d<b.length;d++)if(d<b.length-1){c=c+("00"+b[d]).slice(-2);d<b.length-2&&(c=c+":")}else c=c+("."+("000"+b[d]).slice(-3));return a(c)},"$data.Date":function(b){var c=b.getHours()+":"+b.getMinutes()+":"+b.getSeconds();(b=b.getMilliseconds())&&(c=c+("."+b));return a(c)}})})();
$data.Container.registerConverter("$data.Decimal",{"$data.Boolean":function(a){return a?"1":"0"},"$data.Number":function(a){return a.toString()},"$data.String":function(a){if(!/^\-?([0-9]+(\.[0-9]+)?|Infinity)$/.test(a))throw 0;return a},"$data.Date":function(a){a=a.valueOf();if(isNaN(a))throw 0;return a.toString()}});
$data.packIEEE754=function(a,b,c){var d=(1<<b-1)-1,e,f,g;if(a!==a){f=(1<<d)-1;d=Math.pow(2,c-1);e=0}else if(a===Infinity||a===-Infinity){f=(1<<d)-1;d=0;e=a<0?1:0}else if(a===0){d=f=0;e=1/a===-Infinity?1:0}else{e=a<0;a=Math.abs(a);if(a>=Math.pow(2,1-d)){g=Math.min(Math.floor(Math.log(a)/Math.LN2),d);f=g+d;d=Math.round(a*Math.pow(2,c-g)-Math.pow(2,c))}else{f=0;d=Math.round(a/Math.pow(2,1-d-c))}}for(a=[];c;c=c-1){a.push(d%2?1:0);d=Math.floor(d/2)}for(c=b;c;c=c-1){a.push(f%2?1:0);f=Math.floor(f/2)}a.push(e?
1:0);a.reverse();b=a.join("");for(e=[];b.length;){e.push(parseInt(b.substring(0,8),2));b=b.substring(8)}return e};
$data.unpackIEEE754=function(a,b,c){var d=[],e,f,g;for(e=a.length;e;e=e-1){g=a[e-1];for(f=8;f;f=f-1){d.push(g%2?1:0);g=g>>1}}d.reverse();f=d.join("");a=(1<<b-1)-1;d=parseInt(f.substring(0,1),2)?-1:1;e=parseInt(f.substring(1,1+b),2);f=parseInt(f.substring(1+b),2);return e===(1<<b)-1?f!==0?NaN:d*Infinity:e>0?d*Math.pow(2,e-a)*(1+f/Math.pow(2,c)):f!==0?d*Math.pow(2,-(a-1))*(f/Math.pow(2,c)):d<0?-0.0:0};$data.IEEE754=function(a,b,c){return $data.unpackIEEE754($data.packIEEE754(a,b,c),b,c)};
$data.Container.registerConverter("$data.Float",{"default":function(a){a=+a;if(isNaN(a))throw 0;return $data.IEEE754(a,8,23)}});$data.Container.registerConverter("$data.Int16",{"default":function(a){a=(a|0)&65535;return a>=32768?a-65536:a}});
$data.Container.registerConverter("$data.Int64",{"$data.Boolean":function(a){return a?"1":"0"},"$data.Number":function(a){a=a.toString();if(a.indexOf(".")>0)return a.split(".")[0];if(a.indexOf(".")==0)throw 0;return a},"$data.String":function(a){if(!/^\-?([0-9]+(\.[0-9]+)?|Infinity)$/.test(a))throw 0;if(a.indexOf(".")>0)return a.split(".")[0];if(a.indexOf(".")==0)throw 0;return a},"$data.Date":function(a){a=a.valueOf();if(isNaN(a))throw 0;return a.toString()}});
$data.Container.registerConverter("$data.SByte",{"default":function(a){a=(a|0)&255;return a>=128?a-256:a}});$data.Container.registerConverter("$data.String",{"$data.Date":function(a){return a.toISOString()},"$data.ObjectID":function(a){return btoa(a.toString())},"default":function(a){return typeof a==="object"?JSON.stringify(a):a.toString()}});$data.Container.registerConverter("$data.Object",{"$data.String":function(a){return JSON.parse(a)},"$data.Function":function(){throw 0;}});
$data.Container.registerConverter("$data.Array",{"$data.String":function(a){a=JSON.parse(a);if(!Array.isArray(a))throw 0;return a}});$data.Container.registerConverter("$data.ObjectID",{"$data.ObjectID":function(a){try{return btoa(a.toString())}catch(b){return a}},"$data.String":function(a){return a}});$data.Container.proxyConverter=function(a){return a};$data.Container.defaultConverter=function(a){return function(b){return $data.Container.convertTo(b,a)}};
$data.StringFunctions={startsWith:function(){var a,b;if(arguments.length==2){a=arguments[0];b=arguments[1]}else if(arguments.length==1&&typeof this==="string"){a=this;b=arguments[0]}else if(this instanceof String){a=this.valueOf();b=arguments[0]}else return false;return typeof a!=="string"?false:a.indexOf(b)===0},endsWith:function(){var a,b;if(arguments.length==2){a=arguments[0];b=arguments[1]}else if(arguments.length==1&&typeof this==="string"){a=this;b=arguments[0]}else if(this instanceof String){a=
this.valueOf();b=arguments[0]}else return false;return typeof a!=="string"?false:a.slice(-b.length)===b},contains:function(){var a,b;if(arguments.length==2){a=arguments[0];b=arguments[1]}else if(arguments.length==1&&typeof this==="string"){a=this;b=arguments[0]}else if(this instanceof String){a=this.valueOf();b=arguments[0]}else return false;return typeof a!=="string"?false:a.indexOf(b)>=0}};
$data.Class.define("$data.Expressions.ExpressionType",null,null,{},{Constant:"constant",Variable:"variable",MemberAccess:"memberAccess",Call:"call",Equal:"equal",NotEqual:"notEqual",EqualTyped:"equalTyped",NotEqualTyped:"notEqualTyped",GreaterThen:"greaterThan",LessThen:"lessThan",GreaterThenOrEqual:"greaterThanOrEqual",LessThenOrEqual:"lessThenOrEqual",Or:"or",OrBitwise:"orBitwise",And:"and",AndBitwise:"andBitwise",In:"in",Add:"add",Divide:"divide",Multiply:"multiply",Subtract:"subtract",Modulo:"modulo",
ArrayIndex:"arrayIndex",New:"new",Positive:"positive",Negative:"negative",Increment:"increment",Decrement:"decrement",Not:"not",This:"this",LambdaParameterReference:"lambdaParameterReference",LambdaParameter:"lambdaParameter",Parameter:"parameter",ArrayLiteral:"arrayLiteral",ObjectLiteral:"objectLiteral",ObjectField:"objectField",Function:"Function",Unknown:"UNKNOWN",EntitySet:"EntitySet",ServiceOperation:"ServiceOperation",EntityField:"EntityField",EntityContext:"EntityContext",Entity:"Entity",Filter:"Filter",
First:"First",Count:"Count",InlineCount:"InlineCount",Single:"Single",Find:"Find",Some:"Some",Every:"Every",ToArray:"ToArray",BatchDelete:"BatchDelete",ForEach:"ForEach",Projection:"Projection",EntityMember:"EntityMember",EntityFieldOperation:"EntityFieldOperation",FrameOperation:"FrameOperation",EntityFunctionOperation:"EntityFunctionOperation",ContextFunctionOperation:"ContextFunctionOperation",EntityBinary:"EntityBinary",Code:"Code",ParametricQuery:"ParametricQuery",MemberInfo:"MemberInfo",QueryParameter:"QueryParameter",
ComplexEntityField:"ComplexEntityField",Take:"Take",Skip:"Skip",OrderBy:"OrderBy",OrderByDescending:"OrderByDescending",Include:"Include",IndexedPhysicalAnd:"IndexedDBPhysicalAndFilterExpression",IndexedLogicalAnd:"IndexedDBLogicalAndFilterExpression",IndexedLogicalOr:"IndexedDBLogicalOrFilterExpression",IndexedLogicalIn:"IndexedDBLogicalInFilterExpression"});$data.BinaryOperator=function(){};
$data.binaryOperators=[{operator:"==",expressionType:$data.Expressions.ExpressionType.Equal,type:"boolean",implementation:function(a,b){return a==b}},{operator:"===",expressionType:$data.Expressions.ExpressionType.EqualTyped,type:"boolean",implementation:function(a,b){return a===b}},{operator:"!=",expressionType:$data.Expressions.ExpressionType.NotEqual,type:"boolean",implementation:function(a,b){return a!=b}},{operator:"!==",expressionType:$data.Expressions.ExpressionType.NotEqualTyped,type:"boolean",
implementation:function(a,b){return a!==b}},{operator:">",expressionType:$data.Expressions.ExpressionType.GreaterThen,type:"boolean",implementation:function(a,b){return a>b}},{operator:">=",expressionType:$data.Expressions.ExpressionType.GreaterThenOrEqual,type:"boolean",implementation:function(a,b){return a>=b}},{operator:"<=",expressionType:$data.Expressions.ExpressionType.LessThenOrEqual,type:"boolean",implementation:function(a,b){return a<=b}},{operator:"<",expressionType:$data.Expressions.ExpressionType.LessThen,
type:"boolean",implementation:function(a,b){return a<b}},{operator:"&&",expressionType:$data.Expressions.ExpressionType.And,type:"boolean",implementation:function(a,b){return a&&b}},{operator:"||",expressionType:$data.Expressions.ExpressionType.Or,type:"boolean",implementation:function(a,b){return a||b}},{operator:"&",expressionType:$data.Expressions.ExpressionType.AndBitwise,type:"number",implementation:function(a,b){return a&b}},{operator:"|",expressionType:$data.Expressions.ExpressionType.OrBitwise,
type:"number",implementation:function(a,b){return a|b}},{operator:"+",expressionType:$data.Expressions.ExpressionType.Add,type:"number",implementation:function(a,b){return a+b}},{operator:"-",expressionType:$data.Expressions.ExpressionType.Subtract,type:"number",implementation:function(a,b){return a-b}},{operator:"/",expressionType:$data.Expressions.ExpressionType.Divide,type:"number",implementation:function(a,b){return a/b}},{operator:"%",expressionType:$data.Expressions.ExpressionType.Modulo,type:"number",
implementation:function(a,b){return a%b}},{operator:"*",expressionType:$data.Expressions.ExpressionType.Multiply,type:"number",implementation:function(a,b){return a*b}},{operator:"[",expressionType:$data.Expressions.ExpressionType.ArrayIndex,type:"number",implementation:function(a,b){return a[b]}},{operator:"in",expressionType:$data.Expressions.ExpressionType.In,type:"boolean",implementation:function(a,b){return a in b}}];
$data.binaryOperators.resolve=function(a){if($data.binaryOperators.filter(function(b){return b.operator==a}).length>0)return a};$data.binaryOperators.contains=function(a){return $data.binaryOperators.some(function(b){return b.operator==a})};$data.binaryOperators.getOperator=function(a){var b=$data.binaryOperators.filter(function(b){return b.operator==a});b.length<1&&Guard.raise("Unknown operator: "+a);return b[0]};
$data.unaryOperators=[{operator:"+",arity:"prefix",expressionType:$data.Expressions.ExpressionType.Positive,type:"number",implementation:function(a){return+a}},{operator:"-",arity:"prefix",expressionType:$data.Expressions.ExpressionType.Negative,type:"number",implementation:function(a){return-a}},{operator:"++",arity:"prefix",expressionType:$data.Expressions.ExpressionType.Increment,type:"number",implementation:function(a){return++a}},{operator:"--",arity:"prefix",expressionType:$data.Expressions.ExpressionType.Decrement,
type:"number",implementation:function(a){return--a}},{operator:"++",arity:"suffix",expressionType:$data.Expressions.ExpressionType.Increment,type:"number",implementation:function(a){return a++}},{operator:"!",arity:"prefix",expressionType:$data.Expressions.ExpressionType.Not,type:"boolean",implementation:function(a){return!a}},{operator:"--",arity:"suffix",expressionType:$data.Expressions.ExpressionType.Decrement,type:"number",implementation:function(a){return a--}}];
$data.unaryOperators.resolve=function(a){if($data.unaryOperators.filter(function(b){return b.operator==a}).length>0)return a};$data.unaryOperators.contains=function(a){return $data.unaryOperators.some(function(b){return b.operator==a})};$data.unaryOperators.getOperator=function(a,b){var c=$data.unaryOperators.filter(function(c){return c.operator==a&&(!b||c.arity==b)});c.length<1&&Guard.raise("Unknown operator: "+a);return c[0]};
$data.timeIt=function(a,b){b=b||1;console.time("!");for(var c=0;c<b;c++)a();console.timeEnd("!")};$data.Expressions.OperatorTypes={UNARY:"UNARY",INCDEC:"INCDEC",DECISION:"DECISION",METHODCALL:"METHODCALL",NEW:"NEW",JSONASSIGN:"JSONASSIGN",ARRAYACCESS:"ARRAYACCESS",UNKNOWN:"UNKNOWN"};$data.executable=!0;function jsonify(a){return JSON.stringify(a,null,"\t")}
$C("$data.Expressions.ExpressionNode",null,null,{constructor:function(){this.expressionType=this.constructor},getJSON:function(){return jsonify(this)},expressionType:{set:function(a){typeof a==="string"&&(a=Container.resolveType(a));this._expressionType=a},get:function(a){return arguments.callee.caller==jsonify||arguments.callee.caller==JSON.stringify?Container.resolveName(this._expressionType):this._expressionType},enumerable:!0},nodeType:{value:$data.Expressions.ExpressionType.Unknown,writable:!1},
type:{},isTerminated:{value:!1},toString:function(){return this.value}},null);$C("$data.Expressions.UnaryExpression",$data.Expressions.ExpressionNode,null,{constructor:function(a,b,c,d){this.operand=a;this.operator=b;this.nodeType=c;this.resolution=d},operator:{value:void 0,writable:!0},operand:{value:void 0,writable:!0},nodeType:{value:void 0,writable:!0}});
$C("$data.Expressions.ArrayLiteralExpression",$data.Expressions.ExpressionNode,null,{constructor:function(a){this.items=a||[]},nodeType:{value:$data.Expressions.ExpressionType.ArrayLiteral,writable:!0},items:{value:void 0,dataType:Array,elementType:$data.Expressions.ExpressionNode},toString:function(){return"["+this.items.map(function(a){return a.toString()}).join(",")+"]"}},null);
$C("$data.Expressions.CallExpression",$data.Expressions.ExpressionNode,null,{constructor:function(a,b,c){this.expression=a;this.member=b;this.args=c},nodeType:{value:$data.Expressions.ExpressionType.Call},expression:{value:void 0,dataType:$data.Expressions.ExpressionNode,writable:!0},member:{value:void 0,dataType:$data.MemberDefinition,writable:!0},type:{value:void 0,writable:!0},implementation:{get:function(){return function(a,b,c){typeof b!=="function"&&(b=a[b]);Guard.requireType("method",b,Function);
return b.apply(a,c)}},set:function(){Guard.raise("Property can not be set")}},toString:function(){return this.object.toString()+"."+this.member.toString()+"()"}});
$C("$data.Expressions.CodeParser",null,null,{constructor:function(a){this.scopeContext=a;this.lambdaParams=[]},log:function(a){this.scopeContext&&this.scopeContext.log(a)},parseExpression:function(a){typeof a==="object"&&(a="");var b={success:true,errorMessage:"",errorDetails:""};if($data.Acorn)return{success:true,expression:this.ParserBuild($data.Acorn.parse("("+a.toString()+")").body[0]),errors:[]};if($data.Esprima)return{success:true,expression:this.ParserBuild($data.Esprima.parse("("+a.toString()+
")").body[0]),errors:[]};a=$data.ASTParser.parseCode(a);this.log({event:"AST",data:a});if(!a.success)return{success:false,error:"ASTParser error",errorMessage:a.errors?JSON.stringify(a.errors):"could not get code"};return b={success:true,expression:this.Build2(a.tree.first[0]),errors:a.errors}},createExpression:function(a,b){var c=this.parseExpression(a,b);c.success||Guard.raise("ExpressionParserError: "+c.errorMessage);return c.expression},ParserBuild:function(a){return this["Parser"+a.type](a)},
ParserExpressionStatement:function(a){return this.ParserBuild(a.expression)},ParserBlockStatement:function(a){return this.ParserBuild(a.body[0])},ParserReturnStatement:function(a){return this.ParserBuild(a.argument)},ParserMemberExpression:function(a){return new $data.Expressions.PropertyExpression(this.ParserBuild(a.object),new $data.Expressions.ConstantExpression(a.property.name||a.property.value,typeof(a.property.name||a.property.value)))},ParserIdentifier:function(a){return this.ParserParameter(a,
this.lambdaParams.indexOf(a.name)>-1?$data.Expressions.ExpressionType.LambdaParameterReference:$data.Expressions.ExpressionType.Parameter)},ParserObjectExpression:function(a){for(var b=Array(a.properties.length),c=0;c<a.properties.length;c++)b[c]=this.ParserProperty(a.properties[c]);return new $data.Expressions.ObjectLiteralExpression(b)},ParserArrayExpression:function(a){for(var b=Array(a.elements.length),c=0;c<a.elements.length;c++)b[c]=this.ParserBuild(a.elements[c]);return new $data.Expressions.ArrayLiteralExpression(b)},
ParserProperty:function(a){return new $data.Expressions.ObjectFieldExpression(a.key.name,this.ParserBuild(a.value))},ParserFunctionExpression:function(a){for(var b=Array(a.params.length),c=0;c<a.params.length;c++){this.lambdaParams.push(a.params[c].name);b[c]=this.ParserParameter(a.params[c],$data.Expressions.ExpressionType.LambdaParameter);b[c].owningFunction=d}var d=new $data.Expressions.FunctionExpression(a.id?a.id.name:a.id,b,this.ParserBuild(a.body));return d},ParserParameter:function(a,b){var c=
new $data.Expressions.ParameterExpression(a.name,null,b);if(b==$data.Expressions.ExpressionType.LambdaParameterReference)c.paramIndex=this.lambdaParams.indexOf(a.name);return c},ParserLogicalExpression:function(a){return this.ParserBinaryExpression(a)},ParserOperators:{value:{"==":{expressionType:$data.Expressions.ExpressionType.Equal,type:"boolean",implementation:function(a,b){return a==b}},"===":{expressionType:$data.Expressions.ExpressionType.EqualTyped,type:"boolean",implementation:function(a,
b){return a===b}},"!=":{expressionType:$data.Expressions.ExpressionType.NotEqual,type:"boolean",implementation:function(a,b){return a!=b}},"!==":{expressionType:$data.Expressions.ExpressionType.NotEqualTyped,type:"boolean",implementation:function(a,b){return a!==b}},">":{expressionType:$data.Expressions.ExpressionType.GreaterThen,type:"boolean",implementation:function(a,b){return a>b}},">=":{expressionType:$data.Expressions.ExpressionType.GreaterThenOrEqual,type:"boolean",implementation:function(a,
b){return a>=b}},"<=":{expressionType:$data.Expressions.ExpressionType.LessThenOrEqual,type:"boolean",implementation:function(a,b){return a<=b}},"<":{expressionType:$data.Expressions.ExpressionType.LessThen,type:"boolean",implementation:function(a,b){return a<b}},"&&":{expressionType:$data.Expressions.ExpressionType.And,type:"boolean",implementation:function(a,b){return a&&b}},"||":{expressionType:$data.Expressions.ExpressionType.Or,type:"boolean",implementation:function(a,b){return a||b}},"&":{expressionType:$data.Expressions.ExpressionType.AndBitwise,
type:"number",implementation:function(a,b){return a&b}},"|":{expressionType:$data.Expressions.ExpressionType.OrBitwise,type:"number",implementation:function(a,b){return a|b}},"+":{expressionType:$data.Expressions.ExpressionType.Add,type:"number",implementation:function(a,b){return a+b}},"-":{expressionType:$data.Expressions.ExpressionType.Subtract,type:"number",implementation:function(a,b){return a-b}},"/":{expressionType:$data.Expressions.ExpressionType.Divide,type:"number",implementation:function(a,
b){return a/b}},"%":{expressionType:$data.Expressions.ExpressionType.Modulo,type:"number",implementation:function(a,b){return a%b}},"*":{expressionType:$data.Expressions.ExpressionType.Multiply,type:"number",implementation:function(a,b){return a*b}},"[":{expressionType:$data.Expressions.ExpressionType.ArrayIndex,type:"number",implementation:function(a,b){return a[b]}},"in":{expressionType:$data.Expressions.ExpressionType.In,type:"boolean",implementation:function(a,b){return a in b}}}},ParserUnaryOperators:{value:{"+":{arity:"prefix",
expressionType:$data.Expressions.ExpressionType.Positive,type:"number",implementation:function(a){return+a}},"-":{arity:"prefix",expressionType:$data.Expressions.ExpressionType.Negative,type:"number",implementation:function(a){return-a}},"++true":{arity:"prefix",expressionType:$data.Expressions.ExpressionType.Increment,type:"number",implementation:function(a){return++a}},"--true":{arity:"prefix",expressionType:$data.Expressions.ExpressionType.Decrement,type:"number",implementation:function(a){return--a}},
"++false":{arity:"suffix",expressionType:$data.Expressions.ExpressionType.Increment,type:"number",implementation:function(a){return a++}},"!":{arity:"prefix",expressionType:$data.Expressions.ExpressionType.Not,type:"boolean",implementation:function(a){return!a}},"--false":{arity:"suffix",expressionType:$data.Expressions.ExpressionType.Decrement,type:"number",implementation:function(a){return a--}}}},ParserUnaryExpression:function(a){return new $data.Expressions.UnaryExpression(this.ParserBuild(a.argument),
this.ParserUnaryOperators[a.operator],this.ParserUnaryOperators[a.operator].expressionType)},ParserUpdateExpression:function(a){return new $data.Expressions.UnaryExpression(this.ParserBuild(a.argument),this.ParserUnaryOperators[a.operator+a.prefix],this.ParserUnaryOperators[a.operator+a.prefix].nodeType)},ParserBinaryExpression:function(a){return new $data.Expressions.SimpleBinaryExpression(this.ParserBuild(a.left),this.ParserBuild(a.right),this.ParserOperators[a.operator].expressionType,a.operator,
this.ParserOperators[a.operator].type)},ParserThisExpression:function(){return new $data.Expressions.ThisExpression},ParserLiteral:function(a){return new $data.Expressions.ConstantExpression(a.value,typeof a.value)},ParserCallExpression:function(a){for(var b=this.ParserBuild(a.callee),c=Array(a.arguments.length),d=0;d<a.arguments.length;d++)c[d]=this.ParserBuild(a.arguments[d]);var e,f;switch(true){case b instanceof $data.Expressions.PropertyExpression:f=b.expression;e=b.member;break;case b instanceof
$data.Expressions.ParameterExpression:f=new $data.Expressions.ConstantExpression(null,"object");e=b}return new $data.Expressions.CallExpression(f,e,c)}});
$C("$data.Expressions.ConstantExpression",$data.Expressions.ExpressionNode,null,{constructor:function(a,b,c){this.value=a;this.type=b;this.name=c;if(!Object.isNullOrUndefined(this.value)){this.type=Container.resolveType(this.type);if(Container.resolveType(Container.getTypeName(this.value))!==this.type)this.value=Container.convertTo(a,this.type)}},nodeType:{value:$data.Expressions.ExpressionType.Constant,enumerable:!0},type:{value:Object,writable:!0},value:{value:void 0,writable:!0},toString:function(){return this.value.toString()}});
$C("$data.Expressions.FunctionExpression",$data.Expressions.ExpressionNode,null,{constructor:function(a,b,c){this.parameters=b||[];this.name=a;this.body=c},toString:function(a){var b=this.parameters.map(function(a){return a.toString()}),b=b.join(","),a=this.body?this.body.toString(a):"";return"function "+this.name+"("+b+") { "+a+"}"},nodeType:{value:$data.Expressions.ExpressionType.Function,writable:!0},parameters:{value:void 0,dataType:Array,elementType:$data.Expressions.ParameterExpression},body:{value:void 0,
dataType:$data.Expressions.ExpressionNode},type:{}},null);$C("$data.Expressions.ObjectFieldExpression",$data.Expressions.ExpressionNode,null,{constructor:function(a,b){this.fieldName=a;this.expression=b},nodeType:{value:$data.Expressions.ExpressionType.ObjectField,writable:!0},toString:function(){return"unimplemented"}},null);
$C("$data.Expressions.ObjectLiteralExpression",$data.Expressions.ExpressionNode,null,{constructor:function(a){this.members=a},nodeType:{value:$data.Expressions.ExpressionType.ObjectLiteral,writable:!0},toString:function(){return"unimplemented"},implementation:{get:function(){return function(a){var b={};a.forEach(function(a){b[a.name]=a.value});return b}},set:function(){}}},null);
$C("$data.Expressions.PagingExpression",$data.Expressions.ExpressionNode,null,{constructor:function(a,b,c){this.source=a;this.amount=b;this.nodeType=c},nodeType:{value:$data.Expressions.ExpressionType.Unknown,writable:!0},toString:function(){return"unimplemented"}},null);
$C("$data.Expressions.ParameterExpression",$data.Expressions.ExpressionNode,null,{constructor:function(a,b,c){this.nodeType=c||$data.Expressions.ExpressionType.Parameter;this.name=a;this.type=b||"unknown"},owningFunction:{value:void 0,enumerable:!1},nodeType:{value:$data.Expressions.ExpressionType.Parameter,writable:!0},name:{value:void 0,dataType:String,writable:!0},type:{value:void 0,dataType:"object",writable:!0},toString:function(a){a=a?this.type+" ":"";return a=a+this.name}},null);
$C("$data.Expressions.PropertyExpression",$data.Expressions.ExpressionNode,null,{constructor:function(a,b){this.expression=a;this.member=b;this.type=b.dataType},nodeType:{value:$data.Expressions.ExpressionType.MemberAccess},expression:{value:void 0,dataType:$data.Expressions.ExpressionNode,writable:!0},implementation:{get:function(){return function(a,b){a[b]===void 0&&Guard.raise(new Exception("Parameter '"+b+"' not found in context","Property not found!"));return a[b]}},set:function(){}},member:{value:void 0,
dataType:$data.MemberDefinition,writable:!0},type:{value:void 0,writable:!0},toString:function(){return this.expression.toString()+"."+this.member.toString()}});
$C("$data.Expressions.SimpleBinaryExpression",$data.Expressions.ExpressionNode,null,{constructor:function(a,b,c,d,e,f){this.left=a;this.right=b;this.nodeType=c;this.operator=d;this.type=e;this.resolution=f},implementation:{get:function(){return $data.binaryOperators.getOperator(this.operator).implementation},set:function(){}},type:{value:"number",writable:!0}});$C("$data.Expressions.ThisExpression",$data.Expressions.ExpressionNode,null,{nodeType:{value:$data.Expressions.ExpressionType.This}});
$C("$data.Expressions.ExpressionVisitor",null,null,{constructor:function(){this._deep=0},Visit:function(a,b){if(!a)return a;var c=null;switch(a.expressionType){case $data.Expressions.ParameterExpression:c=this.VisitParameter(a,b);break;case $data.Expressions.ConstantExpression:c=this.VisitConstant(a,b);break;case $data.Expressions.FunctionExpression:c=this.VisitFunction(a,b);break;case $data.Expressions.CallExpression:c=this.VisitCall(a,b);break;case $data.Expressions.SimpleBinaryExpression:c=this.VisitBinary(a,
b);break;case $data.Expressions.PropertyExpression:c=this.VisitProperty(a,b);break;case $data.Expressions.ThisExpression:c=this.VisitThis(a,b);break;case $data.Expressions.ObjectLiteralExpression:c=this.VisitObjectLiteral(a,b);break;case $data.Expressions.ObjectFieldExpression:c=this.VisitObjectField(a,b);break;case $data.Expressions.ArrayLiteralExpression:c=this.VisitArrayLiteral(a,b);break;case $data.Expressions.UnaryExpression:c=this.VisitUnary(a,b);break;case $data.Expressions.EntityContextExpression:c=
this.VisitEntityContext(a,b);break;default:debugger}this._deep=this._deep-1;return c},VisitArrayLiteral:function(a,b){var c=this,d=a.items.map(function(a){return c.Visit(a,b)});return Container.createArrayLiteralExpression(d)},VisitObjectLiteral:function(a,b){var c=this,d=a.members.map(function(a){return c.Visit(a,b)});return Container.createObjectLiteralExpression(d)},VisitObjectField:function(a,b){var c=this.Visit(a.expression,b);return Container.createObjectFieldExpression(a.fieldName,c)},VisitThis:function(a){return a},
VisitCall:function(a,b){var c=a.args.map(function(a){return this.Visit(a,b)},this),d=this.Visit(a.expression,b),e=this.Visit(a.member,b);return new $data.Expressions.CallExpression(d,e,c)},VisitParameter:function(a){return a},VisitConstant:function(a){return a},VisitFunction:function(a,b){var c=this,d=a.parameters.map(function(a){return c.Visit(a,b)}),e=c.Visit(a.body,b);return new $data.Expressions.FunctionExpression(a.name,d,e)},VisitBinary:function(a,b){var c=this.Visit(a.left,b),d=this.Visit(a.right,
b);return new $data.Expressions.SimpleBinaryExpression(c,d,a.nodeType,a.operator,a.type)},VisitProperty:function(a,b){var c=this.Visit(a.expression,b),d=this.Visit(a.member,b);return new $data.Expressions.PropertyExpression(c,d)},VisitUnary:function(a,b){var c=this.Visit(a.operand,b);return c===a.operand?a:new $data.Expressions.UnaryExpression(c,a.operator,a.nodeType)},VisitEntityContext:function(a){return a},VisitDecision:function(a,b){var c=this.Visit(a.expression,b),d=this.Visit(a.left,b),e=this.Visit(a.right,
b);return c===a.expression&&d===a.left&&e===a.right?a:$data.Expressions.ExpressionNodeTypes.DecisionExpressionNode.create(a.executable,c,d,e)},VisitNew:function(a,b){var c=this.VisitArray(a.values,b);return c===a.values?a:$data.Expressions.ExpressionNodeTypes.NewExpressionNode.create(true,c)},VisitArrayAccess:function(a,b){var c=this.Visit(a.array,b),d=this.Visit(a.index,b);return c===a.array&&d===a.index?a:$data.Expressions.ExpressionNodeTypes.ArrayAccessExpressionNode.create(true,c,d)},VisitArray:function(a,
b){for(var c=[],d=true,e=0;e<a.length;e++){c[e]=this.Visit(a[e],b);d=d&&c[e]===a[e]}return d?a:c},GetMemberChain:function(a,b){if(a.expression.type==MEMBERACCESS){var c=this.GetMemberChain(a.expression,b);c.push(a.member);return c}return[a.expression,a.member]}},{});
$C("$data.Expressions.ParameterProcessor",$data.Expressions.ExpressionVisitor,null,{constructor:function(){},Visit:function(a,b){if((a instanceof $data.Expressions.ParameterExpression||a instanceof $data.Expressions.ThisExpression)&&this.canResolve(a)){var c=this.resolve(a,b);if(c!==a)c.resolvedBy=this.constructor.name;return c}return a},canResolve:function(){Guard.raise("Pure method")},resolve:function(){Guard.raise("Pure method")}});
$C("$data.Expressions.GlobalContextProcessor",$data.Expressions.ParameterProcessor,null,{constructor:function(a){this.global=a},canResolve:function(a){return a.nodeType==$data.Expressions.ExpressionType.Parameter&&this.global&&typeof this.global==="object"&&a.name in this.global},resolve:function(a){var b=this.global[a.name];return Container.createConstantExpression(b,typeof b,a.name)}});
$C("$data.Expressions.ConstantValueResolver",$data.Expressions.ParameterProcessor,null,{constructor:function(a,b,c){this.globalResolver=Container.createGlobalContextProcessor(b);this.paramResolver=Container.createGlobalContextProcessor(a);this.paramsObject=a;this.scopeContext=c},canResolve:function(a){return a.name==="$context"||a.nodeType==$data.Expressions.ExpressionType.This&&this.paramsObject?true:this.paramResolver.canResolve(a)||this.globalResolver.canResolve(a)},resolve:function(a){return a.name===
"$context"?Container.createEntityContextExpression(this.scopeContext):a.nodeType==$data.Expressions.ExpressionType.This?Container.createConstantExpression(this.paramsObject,typeof this.paramsObject,"this"):this.paramResolver.canResolve(a)?this.paramResolver.resolve(a):this.globalResolver.resolve(a)}});
$C("$data.Expressions.LocalContextProcessor",$data.Expressions.GlobalContextProcessor,null,{constructor:function(a){this.canResolve=function(b){return b.nodeType==$data.Expressions.ExpressionType.Parameter&&a("typeof "+b.name)!=="undefined"};this.resolve=function(b){b=a(b.name);return Container.createConstantExpression(b,typeof b)}}});
$C("$data.Expressions.LambdaParameterProcessor",$data.Expressions.ParameterProcessor,null,{constructor:function(a){var b={};this.canResolve=function(c){if(c.nodeType==$data.Expressions.ExpressionType.LambdaParameter){var d=c.owningFunction.parameters;if(d.length==1&&c.name==d[0].name){b[c.name]=a[0];return true}for(var e=0;e<d.length;e++)if(d[e].name==c.name){b[c.name]=a[e];return true}}return false};this.resolve=function(a){var d=Container.createParameterExpression(a.name,b[a.name],$data.Expressions.ExpressionType.LambdaParameter);
d.owningFunction=a.owningFunction;return d}}});
$C("$data.Expressions.ParameterResolverVisitor",$data.Expressions.ExpressionVisitor,null,{constructor:function(){this.lambdaParamCache={}},Visit:function(a,b){return $data.Expressions.ExpressionVisitor.prototype.Visit.call(this,a,b)},VisitArrayLiteral:function(a,b){var c=this,d=a.items.map(function(a){return c.Visit(a,b)});if(d.every(function(a){return a instanceof $data.Expressions.ConstantExpression})){d=d.map(function(a){return a.value});return Container.createConstantExpression(d,"array")}return Container.createArrayLiteralExpression(d)},
VisitObjectLiteral:function(a,b){var c=this,d=a.members.map(function(a){return c.Visit(a,b)});if(d.every(function(a){return a.expression instanceof $data.Expressions.ConstantExpression})){d=d.map(function(a){return{name:a.fieldName,value:a.expression.value}});d=a.implementation(d);return Container.createConstantExpression(d,typeof d)}return Container.createObjectLiteralExpression(d)},VisitThis:function(a,b){return b.Visit(a,b)},VisitParameter:function(a,b){var c;switch(a.nodeType){case $data.Expressions.ExpressionType.Parameter:case $data.Expressions.ExpressionType.LambdaParameter:c=
b.Visit(a,b);c.nodeType==$data.Expressions.ExpressionType.LambdaParameter&&(this.lambdaParamCache[c.name]=c);return c;case $data.Expressions.ExpressionType.LambdaParameterReference:if(c=this.lambdaParamCache[a.name]){c=Container.createParameterExpression(a.name,c.type,$data.Expressions.ExpressionType.LambdaParameterReference);c.paramIndex=a.paramIndex;return c}}return a},VisitConstant:function(a){return a},VisitFunction:function(a,b){var c=this,d=a.parameters.map(function(a){return c.Visit(a,b)}),
e=c.Visit(a.body,b);return new $data.Expressions.FunctionExpression(a.name,d,e)},VisitBinary:function(a,b){var c=this.Visit(a.left,b),d=this.Visit(a.right,b),e=$data.Expressions;if(c instanceof e.ConstantExpression&&d instanceof e.ConstantExpression){c=a.implementation(c.value,d.value);return Container.createConstantExpression(c,typeof c)}return new Container.createSimpleBinaryExpression(c,d,a.nodeType,a.operator,a.type)},VisitUnary:function(a,b){var c=this.Visit(a.operand,b);if(c instanceof $data.Expressions.ConstantExpression){c=
a.operator.implementation(c.value);return Container.createConstantExpression(c,typeof c)}return new Container.createUnaryExpression(c,a.operator,a.nodeType)},VisitProperty:function(a,b){var c=this.Visit(a.expression,b),d=this.Visit(a.member,b),e;if(c instanceof $data.Expressions.ConstantExpression&&d instanceof $data.Expressions.ConstantExpression){e=a.implementation(c.value,d.value);return Container.createConstantExpression(e,typeof e,c.name+"$"+d.value)}if(c===a.expression&&d===a.member)return a;
return e=Container.createPropertyExpression(c,d)},VisitCall:function(a,b){function c(a){return a instanceof $data.Expressions.ConstantExpression?a.value:a}var d=$data.Expressions.ExpressionVisitor.prototype.VisitCall.apply(this,arguments),e=d.expression,f=d.member,g=d.args;if(function(a,b,c){return b instanceof $data.Expressions.ConstantExpression&&(!c||c instanceof $data.Expressions.ConstantExpression)&&a.every(function(a){return a instanceof $data.Expressions.ConstantExpression})}(g,f,e)){d=f.value;
typeof d==="string"&&e.value&&(d=e.value[d]);typeof d!=="function"&&Guard.raise("Constant expression is not a method...");e=a.implementation(e.value,d,g.map(c));return new $data.Expressions.ConstantExpression(e,typeof e)}return d}},{});$C("$data.Expressions.AggregatedVisitor",$data.Expressions.ExpressionVisitor,null,{constructor:function(a){this.Visit=function(b,c){for(var d=0;d<a.length;d++){var e=a[d].Visit(b,c);if(e!==b)return e}return b}}});
$C("$data.Expressions.LogicalSchemaBinderVisitor",$data.Expressions.ExpressionVisitor,null,{constructor:function(){},VisitProperty:function(a,b){var c=this.Visit(a.expression,b),d=this.Visit(a.member,b),e=b.memberResolver.resolve(c.type,d.value);d.type=e;return Container.createPropertyExpression(c,d)}},{});
$data.Class.define("$data.Expressions.ExpTreeVisitor",null,null,{constructor:function(){this._deep=0},Visit:function(a,b){this._deep=this._deep+1;var c=null;switch(a.type){case LITERAL:c=this.VisitLiteral(a,b);break;case VARIABLE:c=this.VisitVariable(a,b);break;case MEMBERACCESS:c=this.VisitMember(a,b);break;case BINARY:c=this.VisitBinary(a,b);break;case UNARY:c=this.VisitUnary(a,b);break;case INCDEC:c=this.VisitIncDec(a,b);break;case EQUALITY:c=this.VisitEquality(a,b);break;case DECISION:c=this.VisitDecision(a,
b);break;case METHODCALL:c=this.VisitMethodCall(a,b);break;case NEW:c=this.VisitNew(a,b);break;case JSONASSIGN:c=this.VisitJsonAssign(a,b);break;case ARRAYACCESS:c=this.VisitArrayAccess(a,b);break;default:Guard.raise("Type isn't implemented: "+a.type)}this._deep=this._deep-1;return c},VisitLiteral:function(a){return a},VisitVariable:function(a){return a},VisitMember:function(a,b){var c=this.Visit(a.expression,b),d=this.Visit(a.member,b);return c===a.expression&&d===a.member?a:$data.Expressions.ExpressionNodeTypes.MemberAccessExpressionNode.create(a.executable,
c,d)},VisitBinary:function(a,b){var c=this.Visit(a.left,b),d=this.Visit(a.right,b);return c===a.left&&d===a.right?a:$data.Expressions.ExpressionNodeTypes.BinaryExpressionNode.create(a.executable,a.operator,c,d)},VisitUnary:function(a,b){var c=this.Visit(a.operand,b);return c===a.operand?a:$data.Expressions.ExpressionNodeTypes.UnaryExpressionNode.create(a.executable,a.operator,c)},VisitIncDec:function(a,b){var c=this.Visit(a.operand,b);return c===a.operand?a:$data.Expressions.ExpressionNodeTypes.IncDecExpressionNode.create(a.executable,
a.operator,c,a.suffix)},VisitEquality:function(a,b){var c=this.Visit(a.left,b),d=this.Visit(a.right,b);return c===a.left&&d===a.right?a:$data.Expressions.ExpressionNodeTypes.EqualityExpressionNode.create(a.executable,a.operator,c,d)},VisitDecision:function(a,b){var c=this.Visit(a.expression,b),d=this.Visit(a.left,b),e=this.Visit(a.right,b);return c===a.expression&&d===a.left&&e===a.right?a:$data.Expressions.ExpressionNodeTypes.DecisionExpressionNode.create(a.executable,c,d,e)},VisitMethodCall:function(a,
b){var c=a.object?this.Visit(a.object,b):null,d=this.VisitArray(a.args,b);return c===a.object&&d===a.args?a:$data.Expressions.ExpressionNodeTypes.MethodcallExpressionNode.create(a.executable,c,a.method,d)},VisitNew:function(a,b){var c=this.VisitArray(a.values,b);return c===a.values?a:$data.Expressions.ExpressionNodeTypes.NewExpressionNode.create(true,c)},VisitJsonAssign:function(a,b){var c=this.Visit(a.left,b),d=this.Visit(a.right,b);if(c===a.left&&d===a.right)return a;c.JSONASSIGN=true;d.JSONASSIGN=
true;return $data.Expressions.ExpressionNodeTypes.JsonAssignExpressionNode.create(true,c,d)},VisitArrayAccess:function(a,b){var c=this.Visit(a.array,b),d=this.Visit(a.index,b);return c===a.array&&d===a.index?a:$data.Expressions.ExpressionNodeTypes.ArrayAccessExpressionNode.create(true,c,d)},VisitArray:function(a,b){for(var c=[],d=true,e=0;e<a.length;e++){c[e]=this.Visit(a[e],b);d=d&&c[e]===a[e]}return d?a:c},GetMemberChain:function(a,b){if(a.expression.type==MEMBERACCESS){var c=this.GetMemberChain(a.expression,
b);c.push(a.member);return c}return[a.expression,a.member]}},{});
$data.Class.define("$data.Expressions.SetExecutableVisitor",$data.Expressions.ExpTreeVisitor,null,{Visit:function(a,b){switch(a.type){case LITERAL:return this.VisitLiteral(a,b);case VARIABLE:return this.VisitVariable(a,b);case MEMBERACCESS:return this.VisitMember(a,b);case BINARY:return this.VisitBinary(a,b);case UNARY:return this.VisitUnary(a,b);case INCDEC:return this.VisitIncDec(a,b);case EQUALITY:return this.VisitEquality(a,b);case DECISION:return this.VisitDecision(a,b);case METHODCALL:return this.VisitMethodCall(a,
b);case NEW:return this.VisitNew(a,b);case JSONASSIGN:return this.VisitJsonAssign(a,b);case ARRAYACCESS:return this.VisitArrayAccess(a,b);default:Guard.raise("Type isn't implemented: "+a.type)}},VisitBinary:function(a,b){var c=this.Visit(a.left,b),d=this.Visit(a.right,b);return c===a.left&&d===a.right&&c.executable&&d.executable==a.executable?a:$data.Expressions.ExpressionNodeTypes.BinaryExpressionNode.create(c.executable&&d.executable,a.operator,c,d)},VisitUnary:function(a,b){var c=this.Visit(a.operand,
b);return c===a.operand?a:$data.Expressions.ExpressionNodeTypes.UnaryExpressionNode.create(c.executable,a.operator,c)},VisitIncDec:function(a,b){var c=this.Visit(a.operand,b);return c===a.operand?a:$data.Expressions.ExpressionNodeTypes.IncDecExpressionNode.create(c.executable,a.operator,c,a.suffix)},VisitEquality:function(a,b){var c=this.Visit(a.left,b),d=this.Visit(a.right,b);return c===a.left&&d===a.right&&c.executable&&d.executable==a.executable?a:$data.Expressions.ExpressionNodeTypes.EqualityExpressionNode.create(c.executable&&
d.executable,a.operator,c,d)},VisitDecision:function(a,b){var c=this.Visit(a.expression,b),d=this.Visit(a.left,b),e=this.Visit(a.right,b);return c===a.expression&&d===a.left&&e===a.right&&d.executable&&e.executable&&c.executable==a.executable?a:$data.Expressions.ExpressionNodeTypes.DecisionExpressionNode.create(d.executable&&e.executable&&c.executable,c,d,e)},VisitMethodCall:function(a,b){var c=a.object?this.Visit(a.object,b):null,d=this.VisitArray(a.args,b);return c===a.object&&d===a.args&&(c==null?
true:c.executable)==a.executable?a:$data.Expressions.ExpressionNodeTypes.MethodcallExpressionNode.create(c==null?true:c.executable,c,a.method,d)},VisitNew:function(a,b){var c=this.VisitArray(a.values,b);return c===a.values?a:$data.Expressions.ExpressionNodeTypes.NewExpressionNode.create(true,c)},VisitJsonAssign:function(a,b){var c=this.Visit(a.left,b),d=this.Visit(a.right,b);if(c===a.left&&d===a.right)return a;c.JSONASSIGN=true;d.JSONASSIGN=true;return $data.Expressions.ExpressionNodeTypes.JsonAssignExpressionNode.create(true,
c,d)},VisitArrayAccess:function(a,b){var c=this.Visit(a.array,b),d=this.Visit(a.index,b);return c===a.array&&d===a.index?a:$data.Expressions.ExpressionNodeTypes.ArrayAccessExpressionNode.create(true,c,d)},VisitArray:function(a,b){for(var c=[],d=true,e=0;e<a.length;e++){c[e]=this.Visit(a[e],b);d=d&&c[e]===a[e]}return d?a:c},VisitLiteral:function(a){return{type:a.type,executable:true,value:a.value,valueType:a.valueType}},VisitVariable:function(a,b){typeof b.paramContext[a.name]==void 0&&Guard.raise("Variable is not defined in the paramContext: "+
a.name);return $data.Expressions.ExpressionNodeTypes.VariableExpressionNode.create(true,"Math","GLOBALOBJECT")},VisitMember:function(a,b){var c=this.GetMemberChain(a)[0].name,d=b.lambdaParams.indexOf(c)>=0,e=c==b.paramsName;!e&&!d&&Guard.raise("Variable is not defined in the paramContext or the lambda parameters: "+c);return $data.Expressions.ExpressionNodeTypes.MemberAccessExpressionNode.create(e,a.expression,a.member)}},null);
$data.Class.define("$data.Expressions.ExecutorVisitor",$data.Expressions.ExpTreeVisitor,null,{VisitVariable:function(a,b){if(!a.executable)return a;var c=a.name==b.paramsName?b.paramContext:window[a.name];typeof c=="undefined"&&Guard.raise(new Exception("Unknown variable in '"+b.operation+"' operation. The variable isn't referenced in the parameter context and it's not a global variable: '"+a.name+"'.","InvalidOperation",{operationName:b.operation,missingParameterName:a.name}));return $data.Expressions.ExpressionNodeTypes.LiteralExpressionNode.create(true,
typeof c,c)},VisitMember:function(a,b){if(!a.executable)return a;for(var c=this.GetMemberChain(a),d,e=0;e<c.length;e++)d=e==0?b.paramContext:d[c[e].name];return $data.Expressions.ExpressionNodeTypes.LiteralExpressionNode.create(true,typeof d,d)},VisitUnary:function(a,b){var c=this.Visit(a.operand,b);c!==a.operand&&(a=$data.Expressions.ExpressionNodeTypes.UnaryExpressionNode.create(a.executable,a.operator,c));if(!a.executable)return a;eval("value = "+a.operator+" "+(c.valueType=="string"?"'"+c.value+
"'":c.value));return $data.Expressions.ExpressionNodeTypes.LiteralExpressionNode.create(true,"undefined",void 0)},VisitIncDec:function(a,b){var c=this.Visit(a.operand,b);c!==a.operand&&(a=$data.Expressions.ExpressionNodeTypes.IncDecExpressionNode.create(a.executable,a.operator,c,a.suffix));if(!a.executable)return a;c=a.suffix?a.operator=="++"?c.value++:c.value--:a.operator=="++"?++c.value:--c.value;return $data.Expressions.ExpressionNodeTypes.LiteralExpressionNode.create(true,typeof c,c)},VisitBinary:function(a,
b){var c=this.Visit(a.left,b),d=this.Visit(a.right,b);if(c!==a.left||d!==a.right)a=$data.Expressions.ExpressionNodeTypes.BinaryExpressionNode.create(a.executable,a.operator,c,d);if(!a.executable)return a;eval("value = "+(c.valueType=="string"?"'"+c.value+"'":c.value)+" "+a.operator+" "+(d.valueType=="string"?"'"+d.value+"'":d.value));return $data.Expressions.ExpressionNodeTypes.LiteralExpressionNode.create(true,"undefined",void 0)},VisitEquality:function(a,b){var c=this.Visit(a.left,b),d=this.Visit(a.right,
b);if(c!==a.left||d!==a.right)a=$data.Expressions.ExpressionNodeTypes.EqualityExpressionNode.create(a.executable,a.operator,c,d);if(!a.executable)return a;eval("value = "+(c.valueType=="string"?"'"+c.value+"'":c.value)+" "+a.operator+" "+(d.valueType=="string"?"'"+d.value+"'":d.value));return $data.Expressions.ExpressionNodeTypes.LiteralExpressionNode.create(true,"undefined",void 0)},VisitDecision:function(a,b){var c=this.Visit(a.expression,b),d=this.Visit(a.left,b),e=this.Visit(a.right,b);if(c!==
a.expression||d!==a.left||e!==a.right)a=$data.Expressions.ExpressionNodeTypes.DecisionExpressionNode.create(a.executable,c,d,e);if(!a.executable)return a;c=c.value?d.value:e.value;return $data.Expressions.ExpressionNodeTypes.LiteralExpressionNode.create(true,typeof c,c)},VisitMethodCall:function(a,b){var c=a.object?this.Visit(a.object,b):null,d=this.VisitArray(a.args,b);if(c!==a.object||d!=a.args)a=$data.Expressions.ExpressionNodeTypes.MethodcallExpressionNode.create(a.executable,c,a.method,d);if(!a.executable)return a;
for(var e=[],f=0;f<d.length;f++){var g=d[f];e.push(typeof g.value=="string"?"'"+g.value+"'":g.value)}c=c?"value = object.value[eNode.method]("+e.join(",")+");":"value = "+a.method+"("+e.join(",")+");";eval(c);return $data.Expressions.ExpressionNodeTypes.LiteralExpressionNode.create(true,"undefined",void 0)},VisitArrayAccess:function(a,b){var c=this.Visit(a.array,b),d=this.Visit(a.index,b),c=c.value[d.value];return $data.Expressions.ExpressionNodeTypes.LiteralExpressionNode.create(true,typeof c,c)}},
null);
$data.Class.define("$data.Expressions.ExpressionBuilder",null,null,{constructor:function(a){this.context=a},_isLambdaParam:function(a){for(var b=this.context.lambdaParams,c=0;c<b.length;c++)if(b[c]==a)return true;return false},_isParam:function(a){return this.context.paramContext[a]!=void 0},_isParamRoot:function(a){return this.context.paramsName==a},Build:function(a,b){var c;switch(a.arity){case "infix":"("==a.value?c=this.BuildMethodCall(a,b):"."==a.value?c=this.BuildMember(a,b):["===","==","!==",
"!=",">","<",">=","<="].indexOf(a.value)>=0?c=this.BuildEquality(a,b):["&&","||"].indexOf(a.value)>=0?c=this.BuildBinary(a,b):["+","-","*","/","%"].indexOf(a.value)>=0?c=this.BuildBinary(a,b):"["==a.value?c=this.BuildArrayAccess(a,b):Guard.raise("Value of infix node isn't implemented: "+a.value);break;case "prefix":["+","-","!"].indexOf(a.value)>=0?c=this.BuildUnary(a,b):["++","--"].indexOf(a.value)>=0?c=this.BuildIncDec(a,b):"{"==a.value?c=this.BuildNewExpression(a,b):Guard.raise("Value of prefix node isn't implemented: "+
a.value);break;case "suffix":["++","--"].indexOf(a.value)>=0?c=this.BuildIncDec(a,b):Guard.raise("Value of suffix node isn't implemented: "+a.value);break;case "string":case "number":c=this.BuildLiteral(a,b);break;case "ternary":a.value=="?"?c=this.BuildDecision(a,b):Guard.raise("Value of ternary node isn't implemented: "+a.value);break;case null:case void 0:c=a.type=="boolean"&&(a.value=="true"||a.value=="false")?this.BuildBoolLiteral(a,b):this.BuildVariable(a,b);break;default:Guard.raise("Arity isn't implemented: "+
a.arity)}return c},BuildNewExpression:function(a){for(var b=$data.Expressions.ExpressionNodeTypes.NewExpressionNode.create(true,[]),a=a.first,c=0;c<a.length;c++)b.values.push(this.Build(a[c],b));return b},BuildLiteral:function(a){return $data.Expressions.ExpressionNodeTypes.LiteralExpressionNode.create(true,a.arity,a.value)},BuildBoolLiteral:function(a){return $data.Expressions.ExpressionNodeTypes.LiteralExpressionNode.create(true,a.type,a.value=="true"?true:false)},BuildVariable:function(a,b){if(!a.first){if(b.type==
MEMBERACCESS){var c;c=this._isLambdaParam(a.value)?"LAMBDAPARAM":this._isParamRoot(a.value)?"PARAMETERROOT":this._isParam(a.value)?"PARAMETER":"PROPERTY"}else this._isLambdaParam(a.value)?c="LAMBDAPARAM":this._isParamRoot(a.value)?c="PARAMETERROOT":this._isParam(a.value)?c="PARAMETER":window[a.value]!=void 0?c="GLOBALOBJECT":Guard.raise(new Exception("Unknown variable in '"+this.context.operation+"' operation. The variable isn't referenced in the parameter context and it's not a global variable: '"+
a.value+"'.","InvalidOperation",{operationName:this.context.operation,missingParameterName:a.value}));return $data.Expressions.ExpressionNodeTypes.VariableExpressionNode.create(true,a.value,c)}c=$data.Expressions.ExpressionNodeTypes.LiteralExpressionNode.create(true,"name",a.value);var d=$data.Expressions.ExpressionNodeTypes.JsonAssignExpressionNode.create(true),e=this.Build(a.first,d);d.left=c;d.right=e;c.JSONASSIGN=true;e.JSONASSIGN=true;return d},BuildMember:function(a){if(a.value!="."||a.arity!=
"infix")return a.type=="string"?$data.Expressions.ExpressionNodeTypes.LiteralExpressionNode.create(true,a.arity,a.value):$data.Expressions.ExpressionNodeTypes.MemberAccessExpressionNode.create(true,null,a.value);var b=$data.Expressions.ExpressionNodeTypes.MemberAccessExpressionNode.create(true),c=this.Build(a.first,b),a=this.Build(a.second,b);b.expression=c;b.member=a;return b},BuildUnary:function(a){var b=$data.Expressions.ExpressionNodeTypes.UnaryExpressionNode.create(true,a.value);b.operand=this.Build(a.first,
b);return b},BuildIncDec:function(a){var b=$data.Expressions.ExpressionNodeTypes.IncDecExpressionNode.create(true,a.value,null,a.arity=="suffix");b.operand=this.Build(a.first,b);return b},BuildBinary:function(a){a.first||Guard.raise("Cannot build binary: node.first is null");a.second||Guard.raise("Cannot build binary: node.second is null");var b=$data.Expressions.ExpressionNodeTypes.BinaryExpressionNode.create(true,a.value);b.left=this.Build(a.first,b);b.right=this.Build(a.second,b);return b},BuildEquality:function(a){var b=
$data.Expressions.ExpressionNodeTypes.EqualityExpressionNode.create(true,a.value);b.left=this.Build(a.first,b);b.right=this.Build(a.second,b);return b},BuildDecision:function(a){var b=$data.Expressions.ExpressionNodeTypes.DecisionExpressionNode.create(true);b.expression=this.Build(a.first,b);b.left=this.Build(a.second,b);b.right=this.Build(a.third,b);return b},BuildMethodCall:function(a){var b=$data.Expressions.ExpressionNodeTypes.MethodcallExpressionNode.create(true);if(a.first.type=="function"){b.object=
this.Build(a.first.first,b);b.method=a.first.second.value}else{a.first.type!=null&&Guard.raise("Cannot build MethodCall because type is "+type);b.object=null;b.method=a.first.value}for(var a=a.second,c=[],d=0;d<a.length;d++)c[d]=this.Build(a[d],b);b.args=c;return b},BuildArrayAccess:function(a){var b=$data.Expressions.ExpressionNodeTypes.ArrayAccessExpressionNode.create(true);b.array=this.Build(a.first,b);b.index=this.Build(a.second,b);return b}},null);
$C("$data.Expressions.AssociationInfoExpression",$data.Expressions.ExpressionNode,null,{constructor:function(a){this.associationInfo=a},nodeType:{value:$data.Expressions.ExpressionType.AssociationInfo,enumerable:!0}});
$C("$data.Expressions.CodeExpression",$data.Expressions.ExpressionNode,null,{constructor:function(a,b){Container.resolveType(Container.getTypeName(a))==$data.String&&a.replace(/^[\s\xA0]+/,"").match("^function")!="function"&&(a="function (it) { return "+a+"; }");this.source=a;this.parameters=b},nodeType:{value:$data.Expressions.ExpressionType.Code,enumerable:!0}});
$C("$data.Expressions.CodeToEntityConverter",$data.Expressions.ExpressionVisitor,null,{constructor:function(a){this.scopeContext=a;this.parameters=[]},VisitBinary:function(a,b){var c=this.Visit(a.left,b),d=this.Visit(a.right,b);if(!(c instanceof $data.Expressions.ConstantExpression)&&d instanceof $data.Expressions.ConstantExpression||!(d instanceof $data.Expressions.ConstantExpression)&&c instanceof $data.Expressions.ConstantExpression){var e,f;if(d instanceof $data.Expressions.ConstantExpression){e=
c;f=d}else{e=d;f=c}var g;if((g=e.selector)instanceof $data.Expressions.MemberInfoExpression||(g=e.operation)instanceof $data.Expressions.MemberInfoExpression)if(g.memberDefinition&&(g.memberDefinition.type||g.memberDefinition.dataType)){e=Container.resolveType(g.memberDefinition.type||g.memberDefinition.dataType);var h=Container.resolveType(f.type);if(e!==h){g=f.value;if(a.operator===$data.Expressions.ExpressionType.In)if(Array.isArray(g)){for(var h=[],i=0;i<g.length;i++)h.push(new $data.Expressions.ConstantExpression(g[i],
e));g=h;e=$data.Array}else e=h;d===f?d=new $data.Expressions.ConstantExpression(g,e,d.name):c=new $data.Expressions.ConstantExpression(g,e,c.name)}}}f=this.scopeContext.resolveBinaryOperator(a.nodeType,a,b.frameType);return Container.createSimpleBinaryExpression(c,d,a.nodeType,a.operator,a.type,f)},VisitUnary:function(a,b){var c=this.Visit(a.operand,b),d=this.scopeContext.resolveUnaryOperator(a.nodeType,a,b.frameType);return Container.createUnaryExpression(c,a.operator,a.nodeType,d)},VisitParameter:function(a,
b){Guard.requireValue("context",b);var c=$data.Expressions.ExpressionType;switch(a.nodeType){case c.LambdaParameterReference:return Container.createEntityExpression(b.lambdaParameters[a.paramIndex],{lambda:a.name});case c.LambdaParameter:break;default:Guard.raise("Global parameter "+a.name+" not found. For query parameters use 'this.field' notation")}},VisitThis:function(a,b){var c=this.parameters.push({name:"",value:void 0})-1;return Container.createQueryParameterExpression("",c,b.queryParameters,
void 0)},VisitFunction:function(a,b){return $data.Expressions.ExpressionVisitor.prototype.VisitFunction.apply(this,arguments).body},VisitCall:function(a,b){var c=this,d=this.Visit(a.expression,b),e=this.Visit(a.member,b),f=a.args.map(function(a){return c.Visit(a,b)});switch(true){case d instanceof $data.Expressions.QueryParameterExpression:f=f.map(function(a){return a.value});f=a.implementation(d.value,e.value,f);return Container.createQueryParameterExpression(d.name+"$"+e.value,d.index,f,typeof f);
case d instanceof $data.Expressions.EntityFieldExpression:case d instanceof $data.Expressions.EntityFieldOperationExpression:var g=this.scopeContext.resolveFieldOperation(e.value,d,b.frameType);g||Guard.raise("Unknown entity field operation: "+e.getJSON());e=Container.createMemberInfoExpression(g);return f=Container.createEntityFieldOperationExpression(d,e,this._resolveFunctionArguments(f,g.parameters));case d instanceof $data.Expressions.EntitySetExpression:(g=this.scopeContext.resolveSetOperations(e.value,
d,b.frameType))||Guard.raise("Unknown entity field operation: "+e.getJSON());e=Container.createMemberInfoExpression(g);return f=Container.createFrameOperationExpression(d,e,this._resolveFunctionArguments(f,g.parameters));case d instanceof $data.Expressions.EntityExpression:(g=this.scopeContext.resolveTypeOperations(e.value,d,b.frameType))||Guard.raise("Unknown entity function operation: "+e.getJSON());e=Container.createMemberInfoExpression(g);return f=Container.createEntityFunctionOperationExpression(d,
e,this._resolveFunctionArguments(f,g.method.params));case d instanceof $data.Expressions.EntityContextExpression:(g=this.scopeContext.resolveContextOperations(e.value,d,b.frameType))||Guard.raise("Unknown entity function operation: "+e.getJSON());e=Container.createMemberInfoExpression(g);return f=Container.createContextFunctionOperationExpression(d,e,this._resolveFunctionArguments(f,g.method.params));default:Guard.raise("VisitCall: Only fields can have operations: "+a.getType().name)}},_resolveFunctionArguments:function(a,
b){b&&(b=b.filter(function(a){return a.name!=="@expression"}));return a.length===1&&a[0]instanceof $data.Expressions.ConstantExpression&&typeof a[0].value==="object"&&a[0].value&&b&&b[0]&&a[0].value.constructor===$data.Object&&b.some(function(b){return b.name in a[0].value})?b.map(function(b){return new $data.Expressions.ConstantExpression(a[0].value[b.name],Container.resolveType(b.type||b.dataType||a[0].type),b.name)}):a.map(function(a,d){return a instanceof $data.Expressions.ConstantExpression&&
b&&b[d]?new $data.Expressions.ConstantExpression(a.value,Container.resolveType(b[d].type||b[d].dataType||a.type),b[d].name):a})},VisitProperty:function(a,b){var c=this.Visit(a.expression,b),d=this.Visit(a.member,b);Guard.requireType("member",d,$data.Expressions.ConstantExpression);switch(c.expressionType){case $data.Expressions.EntityExpression:var e=c.getMemberDefinition(d.value);e||Guard.raise(new Exception("Unknown member: "+d.value,"MemberNotFound"));switch(e.storageModel.PhysicalType.memberDefinitions.getMember(e.name).kind){case "property":d=
Container.createMemberInfoExpression(e);return c=Container.createEntityFieldExpression(c,d);case "navProperty":d=e.storageModel.Associations[e.name];c=Container.createEntitySetExpression(c,Container.createAssociationInfoExpression(d));return d.ToMultiplicity!=="*"?Container.createEntityExpression(c,{}):c;case "complexProperty":d=Container.createMemberInfoExpression(e);return c=Container.createComplexTypeExpression(c,d)}case $data.Expressions.ComplexTypeExpression:(e=c.getMemberDefinition(d.value))||
Guard.raise("Unknown member "+d.value+" on "+c.entityType.name);d=Container.createMemberInfoExpression(e);if(Container.isPrimitiveType(Container.resolveType(e.dataType)))return c=Container.createEntityFieldExpression(c,d);return c=Container.createComplexTypeExpression(c,d);case $data.Expressions.QueryParameterExpression:e=a.implementation(c.value,d.value);this.parameters[c.index].name=this.parameters[c.index].name+("$"+d.value);this.parameters[c.index].value=e;return Container.createQueryParameterExpression(c.name+
"$"+d.value,c.index,e,Container.getTypeName(e));case $data.Expressions.EntityFieldExpression:case $data.Expressions.EntityFieldOperationExpression:(e=this.scopeContext.resolveFieldOperation(d.value,c,b.frameType))||Guard.raise("Unknown entity field operation: "+d.getJSON());d=Container.createMemberInfoExpression(e);return c=Container.createEntityFieldOperationExpression(c,d,[]);default:Guard.raise("Unknown expression type to handle: "+c.expressionType.name)}}});
$C("$data.Expressions.ComplexTypeExpression",$data.Expressions.ExpressionNode,null,{constructor:function(a,b){Guard.requireType("source",a,[$data.Expressions.EntityExpression,$data.Expressions.ComplexTypeExpression]);Guard.requireType("selector",b,[$data.Expressions.EntityExpression,$data.Expressions.MemberInfoExpression]);this.source=a;this.selector=b;var c=a.entityType.getMemberDefinition(b.memberName).dataType;this.entityType=Container.resolveType(c)},getMemberDefinition:function(a){return this.entityType.getMemberDefinition(a)},
nodeType:{value:$data.Expressions.ExpressionType.Com}});$C("$data.Expressions.EntityContextExpression",$data.Expressions.ExpressionNode,null,{constructor:function(a){this.instance=a},instance:{enumerable:!1},nodeType:{value:$data.Expressions.ExpressionType.EntityContext,enumerable:!0}});
$C("$data.Expressions.EntityExpression",$data.Expressions.ExpressionNode,null,{constructor:function(a,b){Guard.requireValue("source",a);Guard.requireValue("selector",b);!(a instanceof $data.Expressions.EntitySetExpression)&&!(a instanceof $data.Expressions.ServiceOperationExpression)&&Guard.raise("Only EntitySetExpressions can be the source for an EntityExpression");this.source=a;this.selector=b;this.entityType=this.source.elementType;this.storageModel=this.source.storageModel;Guard.requireValue("entityType",
this.entityType);Guard.requireValue("storageModel",this.storageModel)},getMemberDefinition:function(a){var b=this.entityType.getMemberDefinition(a);b||Guard.raise(new Exception("Unknown member "+a+" on type "+this.entityType.name,"MemberNotFound"));b.storageModel=this.storageModel;return b},nodeType:{value:$data.Expressions.ExpressionType.Entity}});
$C("$data.Expressions.EntityExpressionVisitor",null,null,{constructor:function(){this.lambdaTypes=[]},canVisit:function(a){return a instanceof $data.Expressions.ExpressionNode},Visit:function(a,b){if(!this.canVisit(a))return a;var c="Visit"+a.getType().name;if(c in this){c=this[c].call(this,a,b);return typeof c==="undefined"?a:c}return a},VisitToArrayExpression:function(a,b){var c=this.Visit(a.source,b);return c!==a.source?Container.createToArrayExpression(c):a},VisitForEachExpression:function(a,
b){var c=this.Visit(a.source,b);return c!==a.source?Container.createForEachExpression(c):a},VisitMemberInfoExpression:function(a){return a},VisitSingleExpression:function(a,b){var c=this.Visit(a.source,b);return c!==a.source?Container.createSingleExpression(c):a},VisitFirstExpression:function(a,b){var c=this.Visit(a.source,b);return c!==a.source?Container.createFirstExpression(c):a},VisitSomeExpression:function(a,b){var c=this.Visit(a.source,b);return c!==a.source?Container.createSomeExpression(c):
a},VisitFindExpression:function(a,b){var c=this.Visit(a.source,b);return c!==a.source?Container.createFindExpression(c):a},VisitEveryExpression:function(a,b){var c=this.Visit(a.source,b);return c!==a.source?Container.createEveryExpression(c):a},VisitCountExpression:function(a,b){var c=this.Visit(a.source,b);return c!==a.source?Container.createCountExpression(c):a},VisitBatchDeleteExpression:function(a,b){var c=this.Visit(a.source,b);return c!==a.source?Container.createBatchDeleteExpression(c):a},
VisitObjectLiteralExpression:function(a,b){for(var c=a.members.map(function(a){return this.Visit(a,b)},this),d=true,e=0;e<a.members.length;e++)d=d&&a.members[e]===c[e];return!d?Container.createObjectLiteralExpression(c):a},VisitObjectFieldExpression:function(a,b){var c=this.Visit(a.expression,b);return a.expression!==c?Container.createObjectFieldExpression(a.fieldName,c):a},VisitIncludeExpression:function(a,b){var c=this.Visit(a.source,b);return c!==a.source?Container.createIncludeExpression(c,a.selector):
a},VisitUnaryExpression:function(a,b){var c=this.Visit(a.operand,b);return a.operand!==c?Container.createUnaryExpression(c,a.operator,a.nodeType,a.resolution):a},VisitSimpleBinaryExpression:function(a,b){var c=this.Visit(a.left,b),d=this.Visit(a.right,b);return c!==a.left||d!==a.right?new $data.Expressions.SimpleBinaryExpression(c,d,a.nodeType,a.operator,a.type,a.resolution):a},VisitEntityContextExpression:function(a){return a},VisitCodeExpression:function(a){return a},VisitComplexTypeExpression:function(a,
b){var c=this.Visit(a.source,b),d=this.Visit(a.selector,b);return c!==a.source||d!==a.selector?Container.createComplexTypeExpression(c,d):a},VisitEntityExpression:function(a,b){var c=this.Visit(a.source,b),d=this.Visit(a.selector,b);return c!==a.source||d!==a.selector?Container.createEntityExpression(c,d):a},VisitEntityFieldExpression:function(a,b){var c=this.Visit(a.source,b),d=this.Visit(a.selector,b);return c!==a.source||d!==a.selector?Container.createEntityFieldExpression(c,d):a},VisitEntityFieldOperationExpression:function(a,
b){var c=this.Visit(a.source,b),d=this.Visit(a.operation,b),e=a.parameters.map(function(a){return this.Visit(a)},this);return Container.createEntityFieldOperationExpression(c,d,e)},VisitParametricQueryExpression:function(a,b){var c=this.Visit(a.expression,b),d=a.parameters.map(function(a){return this.Visit(a)},this);return Container.createParametricQueryExpression(c,d)},VisitEntitySetExpression:function(a,b){var c=this.Visit(a.source,b),d=this.Visit(a.selector,b);return c!==a.source||d!==a.selector?
Container.createEntitySetExpression(c,d,a.params,a.instance):a},VisitInlineCountExpression:function(a,b){var c=this.Visit(a.source,b),d=this.Visit(a.selector,b);return c!==a.source||d!==a.selector?Container.createInlineCountExpression(c,d,a.params,a.instance):a},VisitFilterExpression:function(a,b){var c=this.Visit(a.source,b),d=this.Visit(a.selector,b);return c!==a.source||d!==a.selector?Container.createFilterExpression(c,d,a.params,a.instance):a},VisitProjectionExpression:function(a,b){var c=this.Visit(a.source,
b),d=this.Visit(a.selector,b);if(c!==a.source||d!==a.selector){c=Container.createProjectionExpression(c,d,a.params,a.instance);c.projectionAs=a.projectionAs;return c}return a},VisitOrderExpression:function(a,b){var c=this.Visit(a.source,b),d=this.Visit(a.selector,b);return c!==a.source||d!==a.selector?Container.createOrderExpression(c,d,a.nodeType):a},VisitPagingExpression:function(a,b){var c=this.Visit(a.source,b),d=this.Visit(a.amount,b);return c!==a.source||d!==a.amount?Container.createPagingExpression(c,
d,a.nodeType):a}});
$C("$data.Expressions.ExpressionMonitor",$data.Expressions.EntityExpressionVisitor,null,{constructor:function(a){this.Visit=function(b,c){var d=b,e;if(this.canVisit(b)){a.VisitExpressionNode&&a.VisitExpressionNode.apply(a,arguments);e="Visit"+b.getType().name;e in a&&(d=a[e].apply(a,arguments))}var f=arguments;d!==b&&(f=[d,c]);d=$data.Expressions.EntityExpressionVisitor.prototype.Visit.apply(this,f);f=[d,c];if(this.canVisit(d)){var g=d.getType().name;a.MonitorExpressionNode&&a.MonitorExpressionNode.apply(a,f);
e="Monitor"+g;e in a&&a[e].apply(a,f);a.MutateExpressionNode&&a.MutateExpressionNode.apply(a,f);e="Mutate"+g;e in a&&(d=a[e].apply(a,f))}return d}}});$C("$data.Expressions.EntityFieldExpression",$data.Expressions.ExpressionNode,null,{constructor:function(a,b){this.selector=b;this.source=a;if(this.selector instanceof $data.Expressions.MemberInfoExpression||this.selector.name)this.memberName=this.selector.name},nodeType:{value:$data.Expressions.ExpressionType.EntityField}});
$C("$data.Expressions.EntityFieldOperationExpression",$data.Expressions.ExpressionNode,null,{constructor:function(a,b,c){this.source=a;this.operation=b;this.parameters=c},nodeType:{value:$data.Expressions.ExpressionType.EntityFieldOperation}});
$C("$data.Expressions.EntitySetExpression",$data.Expressions.ExpressionNode,null,{constructor:function(a,b,c,d){Guard.requireType("source",a,[$data.Expressions.EntityContextExpression,$data.Expressions.EntitySetExpression]);Guard.requireType("selector",a,[$data.Expressions.MemberInfoExpression,$data.Expressions.CodeExpression,$data.Expressions.ParametricQueryExpression]);this.source=a;this.selector=b;this.params=c;this.instance=d;this.storage_type={};a:{for(;a;){if(a instanceof $data.Expressions.EntityContextExpression)break a;
a=a.source}a=void 0}switch(true){case this.source instanceof $data.Expressions.EntityContextExpression:Guard.requireType("selector",b,$data.Expressions.MemberInfoExpression);this.elementType=b.memberDefinition.elementType;this.storageModel=a.instance._storageModel.getStorageModel(this.elementType);break;case this.source instanceof $data.Expressions.EntityExpression:Guard.requireType("selector",b,$data.Expressions.AssociationInfoExpression);this.elementType=b.associationInfo.ToType;this.storageModel=
a.instance._storageModel.getStorageModel(this.elementType);break;case this.source instanceof $data.Expressions.EntitySetExpression:this.elementType=this.source.elementType;this.storageModel=this.source.storageModel;break;case this.source instanceof $data.Expressions.ServiceOperationExpression:this.elementType=this.source.elementType;this.storageModel=this.source.storageModel;break;default:Guard.raise("take and skip must be the last expressions in the chain!")}},instance:{enumerable:!1},nodeType:{value:$data.Expressions.ExpressionType.EntitySet,
enumerable:!0}});$C("$data.Expressions.FrameOperationExpression",$data.Expressions.ExpressionNode,null,{constructor:function(a,b,c){this.source=a;this.operation=b;this.parameters=c},nodeType:{value:$data.Expressions.ExpressionType.FrameOperation}});$C("$data.Expressions.EntityFunctionOperationExpression",$data.Expressions.FrameOperationExpression,null,{nodeType:{value:$data.Expressions.ExpressionType.EntityFunctionOperation}});
$C("$data.Expressions.ContextFunctionOperationExpression",$data.Expressions.FrameOperationExpression,null,{nodeType:{value:$data.Expressions.ExpressionType.ContextFunctionOperation}});$C("$data.Expressions.FilterExpression",$data.Expressions.EntitySetExpression,null,{constructor:function(){this.resultType=$data.Array},nodeType:{value:$data.Expressions.ExpressionType.Filter,enumerable:!0}});
$C("$data.Expressions.InlineCountExpression",$data.Expressions.EntitySetExpression,null,{constructor:function(){},nodeType:{value:$data.Expressions.ExpressionType.InlineCount,enumerable:!0}});$C("$data.Expressions.FrameOperator",$data.Expressions.ExpressionNode,null,{constructor:function(){this.isTerminated=true}});
$C("$data.Expressions.CountExpression",$data.Expressions.FrameOperator,null,{constructor:function(a){this.source=a;this.resultType=$data.Integer},nodeType:{value:$data.Expressions.ExpressionType.Count,enumerable:!0}});$C("$data.Expressions.SingleExpression",$data.Expressions.FrameOperator,null,{constructor:function(a){this.source=a;this.resultType=$data.Object},nodeType:{value:$data.Expressions.ExpressionType.Single,enumerable:!0}});
$C("$data.Expressions.FindExpression",$data.Expressions.FrameOperator,null,{constructor:function(a,b){this.source=a;this.params=b;this.resultType=$data.Object},nodeType:{value:$data.Expressions.ExpressionType.Find,enumerable:!0}});$C("$data.Expressions.FirstExpression",$data.Expressions.FrameOperator,null,{constructor:function(a){this.source=a;this.resultType=$data.Object},nodeType:{value:$data.Expressions.ExpressionType.First,enumerable:!0}});
$C("$data.Expressions.ForEachExpression",$data.Expressions.FrameOperator,null,{constructor:function(a){this.source=a;this.resultType=$data.Array},nodeType:{value:$data.Expressions.ExpressionType.ForEach,enumerable:!0}});$C("$data.Expressions.ToArrayExpression",$data.Expressions.FrameOperator,null,{constructor:function(a){this.source=a;this.resultType=$data.Array},nodeType:{value:$data.Expressions.ExpressionType.ToArray,enumerable:!0}});
$C("$data.Expressions.SomeExpression",$data.Expressions.FrameOperator,null,{constructor:function(a){this.source=a;this.resultType=$data.Object},nodeType:{value:$data.Expressions.ExpressionType.Some,enumerable:!0}});$C("$data.Expressions.EveryExpression",$data.Expressions.FrameOperator,null,{constructor:function(a){this.source=a;this.resultType=$data.Object},nodeType:{value:$data.Expressions.ExpressionType.Every,enumerable:!0}});
$C("$data.Expressions.BatchDeleteExpression",$data.Expressions.FrameOperator,null,{constructor:function(a){this.source=a;this.resultType=$data.Integer},nodeType:{value:$data.Expressions.ExpressionType.BatchDelete,enumerable:!0}});$C("$data.Expressions.IncludeExpression",$data.Expressions.EntitySetExpression,null,{constructor:function(){},nodeType:{value:$data.Expressions.ExpressionType.Include,writable:!0},toString:function(){return"unimplemented"}},null);
$C("$data.Expressions.MemberInfoExpression",$data.Expressions.ExpressionNode,null,{constructor:function(a){this.memberDefinition=a;this.memberName=a.name},nodeType:{value:$data.Expressions.ExpressionType.MemberInfo,enumerable:!0}});$C("$data.Expressions.OrderExpression",$data.Expressions.EntitySetExpression,null,{constructor:function(a,b,c){this.nodeType=c},nodeType:{value:$data.Expressions.ExpressionType.OrderBy,writable:!0},toString:function(){return"unimplemented"}},null);
$C("$data.Expressions.ParametricQueryExpression",$data.Expressions.ExpressionNode,null,{constructor:function(a,b){this.expression=a;this.parameters=b||[]},nodeType:{value:$data.Expressions.ExpressionType.ParametricQuery,enumerable:!0}});$C("$data.Expressions.ProjectionExpression",$data.Expressions.EntitySetExpression,null,{constructor:function(){},nodeType:{value:$data.Expressions.ExpressionType.Projection,enumerable:!0}});
$C("$data.Expressions.QueryExpressionCreator",$data.Expressions.EntityExpressionVisitor,null,{constructor:function(a){Guard.requireValue("scopeContext",a);this.scopeContext=a},VisitEntitySetExpression:function(a){a.source instanceof $data.Expressions.EntityContextExpression&&this.lambdaTypes.push(a);return a},VisitServiceOperationExpression:function(a){a.source instanceof $data.Expressions.EntityContextExpression&&this.lambdaTypes.push(a);return a},VisitCodeExpression:function(a,b){var c=a.source.toString(),
c=Container.createCodeParser(this.scopeContext).createExpression(c);this.scopeContext.log({event:"JSCodeExpression",data:c});var d=Container.createConstantValueResolver(a.parameters,window,this.scopeContext),c=Container.createParameterResolverVisitor().Visit(c,d);this.scopeContext.log({event:"JSCodeExpressionResolved",data:c});d=Container.createCodeToEntityConverter(this.scopeContext);c=d.Visit(c,{queryParameters:a.parameters,lambdaParameters:this.lambdaTypes,frameType:b.frameType});d=Container.createParametricQueryExpression(c,
d.parameters);this.scopeContext.log({event:"EntityExpression",data:c});return d},VisitFilterExpression:function(a,b){var c=this.Visit(a.source,b),b=b||{};b.frameType=a.getType();var d=this.Visit(a.selector,b);return c!==a.source||d!==a.selector?Container.createFilterExpression(c,d,a.params,a.instance):a},VisitInlineCountExpression:function(a,b){var c=this.Visit(a.source,b),b=b||{};b.frameType=a.getType();var d=this.Visit(a.selector,b);return c!==a.source||d!==a.selector?Container.createInlineCountExpression(c,
d,a.params,a.instance):a},VisitProjectionExpression:function(a,b){var c=this.Visit(a.source,b),b=b||{};b.frameType=a.getType();var d=this.Visit(a.selector,b);if(c!==a.source||d!==a.selector){c=Container.createProjectionExpression(c,d,a.params,a.instance);c.projectionAs=a.projectionAs;return c}return a},VisitOrderExpression:function(a,b){var c=this.Visit(a.source,b),b=b||{};b.frameType=a.getType();var d=this.Visit(a.selector,b);return c!==a.source||d!==a.selector?Container.createOrderExpression(c,
d,a.nodeType):a}});$C("$data.Expressions.QueryParameterExpression",$data.Expressions.ExpressionNode,null,{constructor:function(a,b,c){this.name=a;this.index=b;this.value=c;this.type=Container.getTypeName(c)},nodeType:{value:$data.Expressions.ExpressionType.QueryParameter,writable:!1}});$C("$data.Expressions.RepresentationExpression",$data.Expressions.ExpressionNode,null,{constructor:function(){},getMemberDefinition:function(a){return this.entityType.getMemberDefinition(a)},nodeType:{value:$data.Expressions.ExpressionType.Entity}});
$C("$data.Expressions.ServiceOperationExpression",$data.Expressions.ExpressionNode,null,{constructor:function(a,b,c,d,e){Guard.requireType("source",a,[$data.Expressions.EntityContextExpression]);Guard.requireType("selector",a,[$data.Expressions.MemberInfoExpression]);this.source=a;this.selector=b;this.params=c;this.cfg=d;this.boundItem=e;a:{for(;a;){if(a instanceof $data.Expressions.EntityContextExpression)break a;a=a.source}a=void 0}switch(true){case this.source instanceof $data.Expressions.EntityContextExpression:this.elementType=
d.elementType?Container.resolveType(d.elementType):this.elementType?Container.resolveType(d.returnType):null;this.storageModel=d.elementType?a.instance._storageModel.getStorageModel(Container.resolveType(d.elementType)):null;break;default:Guard.raise("Unknown source type for EntitySetExpression: "+this.source.getType().name)}},nodeType:{value:$data.Expressions.ExpressionType.ServiceOperation,enumerable:!0}});
$C("$data.Expressions.ContinuationExpressionBuilder",$data.Expressions.EntityExpressionVisitor,null,{constructor:function(a){this.mode=a},compile:function(a){var b={mode:"find",skipExists:false};this.Visit(a.expression,b);var c={skip:b.skipSize,take:b.pageSize,message:""};if("pageSize"in b){var d,e={mode:this.mode,pageSize:b.pageSize};if(!b.skipExists&&b.pageSize){e.append=true;d=this.Visit(a.expression,e)}else b.skipExists&&(d=this.Visit(a.expression,e));if(e.abort){c.skip=(c.skip||0)-c.take;c.message=
"Invalid skip value!"}else c.expression=d}else c.message="take expression not defined in the chain!";return c},VisitPagingExpression:function(a,b){switch(b.mode){case "find":if(a.nodeType===$data.Expressions.ExpressionType.Take)b.pageSize=a.amount.value;else{b.skipSize=a.amount.value;b.skipExists=true}break;case "prev":if(a.nodeType===$data.Expressions.ExpressionType.Skip){var c=a.amount.value-b.pageSize;b.abort=c<0&&a.amount.value>=b.pageSize;c=Container.createConstantExpression(Math.max(c,0),"number");
return Container.createPagingExpression(a.source,c,a.nodeType)}if(b.append)b.abort=true;break;case "next":if(a.nodeType===$data.Expressions.ExpressionType.Skip){c=b.pageSize+a.amount.value;c=Container.createConstantExpression(c,"number");return Container.createPagingExpression(a.source,c,a.nodeType)}if(b.append){c=Container.createConstantExpression(b.pageSize,"number");return Container.createPagingExpression(a,c,$data.Expressions.ExpressionType.Skip)}}this.Visit(a.source,b)}});
$data.Class.define("$data.Validation.ValidationError",null,null,{constructor:function(a,b,c){this.Message=a;this.PropertyDefinition=b;this.Type=c},Type:{dataType:"string"},Message:{dataType:"string"},PropertyDefinition:{dataType:$data.MemberDefinition}},null);
$data.Class.define("$data.Validation.EntityValidationBase",null,null,{ValidateEntity:function(){return[]},ValidateEntityField:function(){return[]},getValidationValue:function(){Guard.raise("Pure class")},getValidationMessage:function(){Guard.raise("Pure class")}},null);$data.Validation=$data.Validation||{};$data.Validation.Entity=new $data.Validation.EntityValidationBase;
$data.Class.define("$data.Validation.Defaults",null,null,null,{validators:{value:{required:function(a){return!Object.isNullOrUndefined(a)},customValidator:function(a,b){return Object.isNullOrUndefined(a)||typeof b=="function"?b(a):true},minValue:function(a,b){return Object.isNullOrUndefined(a)||a>=b},maxValue:function(a,b){return Object.isNullOrUndefined(a)||a<=b},minLength:function(a,b){return Object.isNullOrUndefined(a)||a.length>=b},maxLength:function(a,b){return Object.isNullOrUndefined(a)||a.length<=
b},length:function(a,b){return Object.isNullOrUndefined(a)||a.length==b},regex:function(a,b){return Object.isNullOrUndefined(a)||a.match(typeof b==="string"?RegExp(b.indexOf("/")===0&&b.lastIndexOf("/")===b.length-1?b.slice(1,-1):b):b)}}},_getGroupValidations:function(a){var b={};if(Array.isArray(a))for(var c=0;c<a.length;c++){var d=a[c];typeof this.validators[d]==="function"&&(b[d]=this.validators[d])}return b}});
$data.Class.define("$data.Validation.EntityValidation",$data.Validation.EntityValidationBase,null,{ValidateEntity:function(a){var b=[];a.getType().memberDefinitions.getPublicMappedProperties().forEach(function(c){b=b.concat(this.ValidateEntityField(a,c,void 0,true))},this);return b},ValidateEntityField:function(a,b,c,d){var e=[],f=Container.resolveType(b.dataType),g=Container.resolveName(f),c=!d?c:a[b.name];if(!b.inverseProperty&&f&&typeof f.isAssignableTo==="function"&&f.isAssignableTo($data.Entity))g=
$data.Entity.fullName;this.fieldValidate(a,b,c,e,g);return e},getValidationValue:function(a,b){var c;c=a[b]&&a[b].value?a[b].value:a[b];if(this.convertableValidation[b]){var d;(d=this.convertableValidation[b]===true?a.type:this.convertableValidation[b])&&(c=Container.convertTo(c,d,a.elementType))}return c},getValidationMessage:function(a,b,c){if(typeof a[b]=="object"&&a[b].message)c=a[b].message;else if(a.errorMessage)c=a.errorMessage;return c},createValidationError:function(a,b,c){return new $data.Validation.ValidationError(this.getValidationMessage(a,
b,c),a,b)},convertableValidation:{value:{required:"$data.Boolean",minValue:!0,maxValue:!0,minLength:"$data.Integer",maxLength:"$data.Integer",length:"$data.Integer"}},supportedValidations:{value:{"$data.ObjectID":$data.Validation.Defaults._getGroupValidations(["required","customValidator"]),"$data.Byte":$data.Validation.Defaults._getGroupValidations(["required","customValidator","minValue","maxValue"]),"$data.SByte":$data.Validation.Defaults._getGroupValidations(["required","customValidator","minValue",
"maxValue"]),"$data.Decimal":$data.Validation.Defaults._getGroupValidations(["required","customValidator","minValue","maxValue"]),"$data.Float":$data.Validation.Defaults._getGroupValidations(["required","customValidator","minValue","maxValue"]),"$data.Number":$data.Validation.Defaults._getGroupValidations(["required","customValidator","minValue","maxValue"]),"$data.Int16":$data.Validation.Defaults._getGroupValidations(["required","customValidator","minValue","maxValue"]),"$data.Integer":$data.Validation.Defaults._getGroupValidations(["required",
"customValidator","minValue","maxValue"]),"$data.Int32":$data.Validation.Defaults._getGroupValidations(["required","customValidator","minValue","maxValue"]),"$data.Int64":$data.Validation.Defaults._getGroupValidations(["required","customValidator","minValue","maxValue"]),"$data.String":$data.Validation.Defaults._getGroupValidations("required,customValidator,minLength,maxLength,length,regex".split(",")),"$data.Date":$data.Validation.Defaults._getGroupValidations(["required","customValidator","minValue",
"maxValue"]),"$data.DateTimeOffset":$data.Validation.Defaults._getGroupValidations(["required","customValidator","minValue","maxValue"]),"$data.Time":$data.Validation.Defaults._getGroupValidations(["required","customValidator","minValue","maxValue"]),"$data.Boolean":$data.Validation.Defaults._getGroupValidations(["required","customValidator"]),"$data.Array":$data.Validation.Defaults._getGroupValidations(["required","customValidator","length"]),"$data.Object":$data.Validation.Defaults._getGroupValidations(["required",
"customValidator"]),"$data.Guid":$data.Validation.Defaults._getGroupValidations(["required","customValidator"]),"$data.Blob":$data.Validation.Defaults._getGroupValidations(["required","customValidator","minLength","maxLength","length"]),"$data.GeographyPoint":$data.Validation.Defaults._getGroupValidations(["required","customValidator"]),"$data.GeographyLineString":$data.Validation.Defaults._getGroupValidations(["required","customValidator"]),"$data.GeographyPolygon":$data.Validation.Defaults._getGroupValidations(["required",
"customValidator"]),"$data.GeographyMultiPoint":$data.Validation.Defaults._getGroupValidations(["required","customValidator"]),"$data.GeographyMultiLineString":$data.Validation.Defaults._getGroupValidations(["required","customValidator"]),"$data.GeographyMultiPolygon":$data.Validation.Defaults._getGroupValidations(["required","customValidator"]),"$data.GeographyCollection":$data.Validation.Defaults._getGroupValidations(["required","customValidator"]),"$data.GeometryPoint":$data.Validation.Defaults._getGroupValidations(["required",
"customValidator"]),"$data.GeometryLineString":$data.Validation.Defaults._getGroupValidations(["required","customValidator"]),"$data.GeometryPolygon":$data.Validation.Defaults._getGroupValidations(["required","customValidator"]),"$data.GeometryMultiPoint":$data.Validation.Defaults._getGroupValidations(["required","customValidator"]),"$data.GeometryMultiLineString":$data.Validation.Defaults._getGroupValidations(["required","customValidator"]),"$data.GeometryMultiPolygon":$data.Validation.Defaults._getGroupValidations(["required",
"customValidator"]),"$data.GeometryCollection":$data.Validation.Defaults._getGroupValidations(["required","customValidator"])}},fieldValidate:function(a,b,c,d,e){if(!(a.entityState==$data.EntityState.Modified&&a.changedProperties&&a.changedProperties.indexOf(b)<0)){var f=this.supportedValidations[e];if(f){Object.keys(f).forEach(function(e){b[e]&&f[e]&&!f[e].call(a,c,this.getValidationValue(b,e))&&d.push(this.createValidationError(b,e,"Validation error!"))},this);e===$data.Entity.fullName&&c instanceof
$data.Entity&&!c.isValid()&&d.push(this.createValidationError(b,"ComplexProperty","Validation error!"))}}}},null);$data.Validation.Entity=new $data.Validation.EntityValidation;$data.Class.define("$data.Notifications.ChangeDistributorBase",null,null,{distributeData:function(){Guard.raise("Pure class")}},null);
$data.Class.define("$data.Notifications.ChangeCollectorBase",null,null,{buildData:function(){Guard.raise("Pure class")},processChangedData:function(a){this.Distrbutor&&this.Distrbutor.distributeData&&this.Distrbutor.distributeData(this.buildData(a))},Distrbutor:{enumerable:!1,dataType:$data.Notifications.ChangeDistributorBase,storeOnObject:!0}},null);
$data.Class.define("$data.Notifications.ChangeDistributor",$data.Notifications.ChangeDistributorBase,null,{constructor:function(a){this.broadcastUrl=a},distributeData:function(a){$data.ajax({url:this.broadcastUrl,type:"POST",data:"data="+JSON.stringify(a),succes:this.success,error:this.error})},broadcastUrl:{dataType:"string"},success:function(){},error:function(){}},null);
$data.Class.define("$data.Notifications.ChangeCollector",$data.Notifications.ChangeCollectorBase,null,{buildData:function(a){var b=[];a.forEach(function(a){var d={entityState:a.data.entityState,typeName:a.data.getType().name},e=[];switch(a.data.entityState){case $data.EntityState.Added:e=a.data.getType().memberDefinitions.getPublicMappedProperties();break;case $data.EntityState.Modified:e=a.data.changedProperties;break;case $data.EntityState.Deleted:e=a.data.getType().memberDefinitions.getKeyProperties()}e.forEach(function(b){d[b.name]=
a.data[b.name]});b.push(d)});return b}},null);
$data.Class.define("$data.Transaction",null,null,{constructor:function(){this._objectId=(new Date).getTime();$data.Trace.log("create: ",this._objectId);this.oncomplete=new $data.Event("oncomplete",this);this.onerror=new $data.Event("onerror",this)},abort:function(){Guard.raise(new Exception("Not Implemented","Not Implemented",arguments))},_objectId:{type:$data.Integer},transaction:{type:$data.Object},oncomplete:{type:$data.Event},onerror:{type:$data.Event}},null);
$data.Class.define("$data.Access",null,null,{},{isAuthorized:function(a,b,c,d){a=new $data.PromiseHandler;d=a.createCallback(d);a=a.getPromise();d.success(true);return a},getAccessBitmaskFromPermission:function(a){var b=$data.Access.None;a.Create&&(b=b|$data.Access.Create);a.Read&&(b=b|$data.Access.Read);a.Update&&(b=b|$data.Access.Update);a.Delete&&(b=b|$data.Access.Delete);a.DeleteBatch&&(b=b|$data.Access.DeleteBatch);a.Execute&&(b=b|$data.Access.Execute);return b},None:{value:0},Create:{value:1},
Read:{value:2},Update:{value:4},Delete:{value:8},DeleteBatch:{value:16},Execute:{value:32}});
$data.Class.define("$data.Promise",null,null,{always:function(){Guard.raise(new Exception("$data.Promise.always","Not implemented!"))},done:function(){Guard.raise(new Exception("$data.Promise.done","Not implemented!"))},fail:function(){Guard.raise(new Exception("$data.Promise.fail","Not implemented!"))},isRejected:function(){Guard.raise(new Exception("$data.Promise.isRejected","Not implemented!"))},isResolved:function(){Guard.raise(new Exception("$data.Promise.isResolved","Not implemented!"))},pipe:function(){Guard.raise(new Exception("$data.Promise.pipe",
"Not implemented!"))},progress:function(){Guard.raise(new Exception("$data.Promise.progress","Not implemented!"))},promise:function(){Guard.raise(new Exception("$data.Promise.promise","Not implemented!"))},state:function(){Guard.raise(new Exception("$data.Promise.state","Not implemented!"))},then:function(){Guard.raise(new Exception("$data.Promise.then","Not implemented!"))}},null);
$data.Class.define("$data.PromiseHandlerBase",null,null,{constructor:function(){},createCallback:function(a){a=$data.typeSystem.createCallbackSetting(a);return cbWrapper={success:a.success,error:a.error,notify:a.notify}},getPromise:function(){return new $data.Promise}},null);$data.PromiseHandler=$data.PromiseHandlerBase;var EventSubscriber=$data.Class.define("EventSubscriber",null,null,{constructor:function(a,b,c){this.handler=a;this.state=b;this.thisArg=c},handler:{},state:{},thisArg:{}});
$data.Event=Event=$data.Class.define("$data.Event",null,null,{constructor:function(a,b){function c(a,b){a.forEach(function(c,d){c.handler==b&&a.splice(d,1)})}var d=null;this.attach=function(a,c,g){d||(d=[]);d.push(new EventSubscriber(a,c,g||b))};this.detach=function(a){c(d,a)};this.fire=function(a,c){var g=c||b||this;d&&d.forEach(function(b){try{b.handler.call(b.thisArg,g,a,b.state)}catch(c){console.log("unhandled exception in event handler. exception suppressed");console.dir(c)}})};this.fireCancelAble=
function(a,c){var g=c||b||this,h=true;d&&d.forEach(function(b){try{h=h&&(b.handler.call(b.thisArg,g,a,b.state)===false?false:true)}catch(c){console.log("unhandled exception in event handler. exception suppressed");console.dir(c)}});return h}}});
var eventData=$data.Class.define("EventData",null,null,{eventName:{}}),PropertyChangeEventData=$data.Class.define("PropertyChangeEventData",EventData,null,{constructor:function(a,b,c){this.propertyName=a;this.oldValue=b;this.newValue=c},propertyName:{},oldValue:{},newValue:{}}),PropertyValidationEventData=$data.Class.define("PropertyValidationEventData",EventData,null,{constructor:function(a,b,c,d){this.propertyName=a;this.oldValue=b;this.newValue=c;this.errors=d;this.cancel=false},propertyName:{},
oldValue:{},newValue:{},errors:{},cancel:{}});
$data.Entity=Entity=$data.Class.define("$data.Entity",null,null,{constructor:function(a,b){this.initData={};var c=this.getType();c.__copyPropertiesToInstance&&$data.typeSystem.writePropertyValues(this);this.context=null;if("setDefaultValues"in c&&(!b||b.setDefaultValues!==false))if(!a||Object.keys(a).length<1)a=c.setDefaultValues(a);if(typeof a==="object"){var d=c.memberDefinitions,e=d.getPublicMappedPropertyNames(),f;for(f in a)if(e.indexOf(f)>-1){var g=d.getMember(f),h=Container.resolveType(g.type),
i=a[f];if(g.concurrencyMode===$data.ConcurrencyMode.Fixed)this.initData[f]=i;else{if(b&&b.converters){var j=b.converters[Container.resolveName(h)];j&&(i=j(i))}this.initData[f]=Container.convertTo(i,h,g.elementType,b)}}}b&&b.entityBuilder&&b.entityBuilder(this,c.memberDefinitions.asArray(),c);this.entityState=this.changedProperties=void 0},toString:function(){return this.getType().fullName+"("+(this.Id||this.Name||"")+")"},toJSON:function(){var a={},b=this;this.getType().memberDefinitions.getPublicMappedProperties().forEach(function(c){a[c.name]=
b[c.name]instanceof Date&&c.type&&Container.resolveType(c.type)===$data.DateTimeOffset?new $data.DateTimeOffset(b[c.name]):b[c.name]});return a},equals:function(a){if(a.getType()!==this.getType())return false;for(var b=this.getType().memberDefinitions.getKeyProperties(),c=0;c<b.length;c++)if(this[b[c].name]!=a[b[c].name])return false;return true},propertyChanging:{dataType:$data.Event,storeOnObject:!0,monitorChanges:!1,notMapped:!0,enumerable:!1,prototypeProperty:!0,get:function(){if(!this._propertyChanging)this._propertyChanging=
new Event("propertyChanging",this);return this._propertyChanging},set:function(a){this._propertyChanging=a}},propertyChanged:{dataType:$data.Event,storeOnObject:!0,monitorChanges:!1,notMapped:!0,enumerable:!1,prototypeProperty:!0,get:function(){if(!this._propertyChanged)this._propertyChanged=new Event("propertyChanged",this);return this._propertyChanged},set:function(a){this._propertyChanged=a}},propertyValidationError:{dataType:$data.Event,storeOnObject:!0,monitorChanges:!1,notMapped:!0,enumerable:!1,
prototypeProperty:!0,get:function(){if(!this._propertyValidationError)this._propertyValidationError=new Event("propertyValidationError",this);return this._propertyValidationError},set:function(a){this._propertyValidationError=a}},storeProperty:function(a,b){a.concurrencyMode!==$data.ConcurrencyMode.Fixed&&(b=Container.convertTo(b,a.type,a.elementType));var c=null;if(a.monitorChanges!=false&&(this._propertyChanging||this._propertyChanged||"instancePropertyChanged"in this.constructor)){var d=this[a.name],
c=new PropertyChangeEventData(a.name,d,b);this._propertyChanging&&this.propertyChanging.fire(c)}if(a.monitorChanges!=false&&(this._propertyValidationError||"instancePropertyValidationError"in this.constructor)){var e=$data.Validation.Entity.ValidateEntityField(this,a,b);if(e.length>0){d=this[a.name];d=new PropertyValidationEventData(a.name,d,b,e);this._propertyValidationError&&this.propertyValidationError.fire(d);"instancePropertyValidationError"in this.constructor&&this.constructor.instancePropertyValidationError.fire(d,
this);if(d.cancel==true)return}}a.storeOnObject==true?this["_"+a.name]=b:this.initData[a.name]=b;this.isValidated=false;if(a.monitorChanges!=false&&this.entityState==$data.EntityState.Unchanged)this.entityState=$data.EntityState.Modified;this._setPropertyChanged(a);if(a.monitorChanges!=false){this._propertyChanged&&this.propertyChanged.fire(c);"instancePropertyChanged"in this.constructor&&this.constructor.instancePropertyChanged.fire(c,this)}},_setPropertyChanged:function(a){if(a.monitorChanges!=
false){if(!this.changedProperties)this.changedProperties=[];this.changedProperties.some(function(b){return b.name==a.name})||this.changedProperties.push(a)}},retrieveProperty:function(a){return a.storeOnObject==true?this["_"+a.name]:this.initData[a.name]},getProperty:function(a,b,c){b=$data.typeSystem.createCallbackSetting(b);if(this[a.name]!=void 0)c instanceof $data.Transaction?b.success(this[a.name],c):b.success(this[a.name]);else{var d=this.context;if(this.context)return d.loadItemProperty(this,
a,b,c);try{var e=this,f=this.storeToken||this.getType().storeToken;if(f&&typeof f.factory==="function")return f.factory().onReady().then(function(c){return c.loadItemProperty(e,a,b)})}catch(g){}Guard.raise(new Exception("Entity not in context","Invalid operation"))}},setProperty:function(a,b,c){this[a.name]=b;b=new $data.PromiseHandler;c=b.createCallback(c);c.success(this[a.name]);return b.getPromise()},isValid:function(){if(!this.isValidated){this.ValidationErrors=$data.Validation.Entity.ValidateEntity(this);
this.isValidated=true}return this.ValidationErrors.length==0},isValidated:{dataType:"bool",storeOnObject:!0,monitorChanges:!1,notMapped:!0,enumerable:!1,value:!1},ValidationErrors:{dataType:Array,elementType:$data.Validation.ValidationError,storeOnObject:!0,monitorChanges:!0,notMapped:!0,enumerable:!1},resetChanges:function(){delete this._changedProperties},changedProperties:{dataType:Array,elementType:window.MemberDefinition,storeOnObject:!0,monitorChanges:!1,notMapped:!0,enumerable:!1},entityState:{dataType:"integer",
storeOnObject:!0,monitorChanges:!1,notMapped:!0,enumerable:!1},remove:function(){if($data.ItemStore&&"EntityInstanceRemove"in $data.ItemStore)return $data.ItemStore.EntityInstanceRemove.apply(this,arguments);throw"not implemented";},save:function(){if($data.ItemStore&&"EntityInstanceSave"in $data.ItemStore)return $data.ItemStore.EntityInstanceSave.apply(this,arguments);throw"not implemented";},refresh:function(){if($data.ItemStore&&"EntityInstanceSave"in $data.ItemStore)return $data.ItemStore.EntityInstanceRefresh.apply(this,
arguments);throw"not implemented";},storeToken:{type:Object,monitorChanges:!1,notMapped:!0,storeOnObject:!0},getFieldUrl:function(a){if(this.context)return this.context.getFieldUrl(this,a);if(this.getType().storeToken&&typeof this.getType().storeToken.factory==="function")return this.getType().storeToken.factory().getFieldUrl(this,a);if(this.getType().storeToken)try{var b=$data.ItemStore._getContextPromise("default",this.getType());if(b instanceof $data.EntityContext)return b.getFieldUrl(this,a)}catch(c){}return"#"}},
{__setPropertyfunctions:{value:!0,notMapped:!0,enumerable:!1,storeOnObject:!0},__copyPropertiesToInstance:{value:!1,notMapped:!0,enumerable:!1,storeOnObject:!0},inheritedTypeProcessor:function(a){$data.ItemStore&&"EntityInheritedTypeProcessor"in $data.ItemStore&&$data.ItemStore.EntityInheritedTypeProcessor.apply(this,arguments);a.defaultValues={};a.memberDefinitions.asArray().forEach(function(b){if(b.hasOwnProperty("defaultValue"))a.defaultValues[b.name]=b.defaultValue});if(Object.keys(a.defaultValues).length>
0)a.setDefaultValues=function(b,c){var b=b||{},d=a.defaultValues,e;for(e in d)e in b||(b[e]="function"===typeof d[e]?d[e](e,c):d[e]);return b}},addEventListener:function(a,b){var c="on"+a;c in this||(this[c]=new $data.Event(a,this));this[c].attach(b)},removeEventListener:function(a,b){var c="on"+a;c in this&&this[c].detach(b)},raiseEvent:function(a,b){var c="on"+a;c in this&&this[c].fire(b)},getFieldNames:function(){return this.memberDefinitions.getPublicMappedPropertyNames()},"from$data.Object":function(a,
b,c,d){if(Object.isNullOrUndefined(a))return a;var e;d&&d.converters&&(e={converters:d.converters});return new this(a,e)}});
$data.define=function(a,b,c){if(b&&!(b instanceof $data.ContainerClass)){c=b;b=void 0}if(!c)throw Error("json object type is not supported yet");var d={},e=[];Object.keys(c).forEach(function(a){var b=c[a];if(typeof b==="object"&&("type"in b||"get"in b||"set"in b)){d[a]=b;b.key&&e.push(b);if(("get"in b||"set"in b)&&(!("notMapped"in b)||b.notMapped===true)){b.notMapped=true;b.storeOnObject=true}if("get"in b&&!("set"in b))b.set=function(){};else if("set"in b&&!("get"in b))b.get=function(){}}else d[a]=
{type:b}});if(e.length<1){var f;switch(true){case "id"in d:f="id";break;case "Id"in d:f="Id";break;case "ID"in d:f="ID"}if(f){d[f].key=true;$data.Container.resolveName(d[f].type);d[f].computed=true}else d.Id={type:"int",key:true,computed:true}}return $data.Entity.extend(a,b,d)};$data.implementation=function(a){return Container.resolveType(a)};(function(){$data.defaults=$data.defaults||{};$data.defaults.defaultDatabaseName="JayDataDefault"})();
$data.Class.define("$data.StorageModel",null,null,{constructor:function(){this.ComplexTypes=[];this.Associations=[]},LogicalType:{},LogicalTypeName:{},PhysicalType:{},PhysicalTypeName:{},EventHandlers:{},TableName:{},TableOptions:{value:void 0},ComplexTypes:{},Associations:{},ContextType:{},Roles:{}},null);
$data.Class.define("$data.Association",null,null,{constructor:function(a){if(a){this.From=a.From;this.FromType=a.FromType;this.FromMultiplicity=a.FromMultiplicity;this.FromPropertyName=a.FromPropertyName;this.To=a.To;this.ToType=a.ToType;this.ToMultiplicity=a.ToMultiplicity;this.ToPropertyName=a.ToPropertyName}},From:{},FromType:{},FromMultiplicity:{},FromPropertyName:{},To:{},ToType:{},ToMultiplicity:{},ToPropertyName:{},ReferentialConstraint:{}},null);
$data.Class.define("$data.ComplexType",$data.Association,null,{},null);
$data.Class.define("$data.EntityContext",null,null,{constructor:function(a){$data.ItemStore&&"ContextRegister"in $data.ItemStore&&$data.ItemStore.ContextRegister.apply(this,arguments);if(a.queryCache)this.queryCache=a.queryCache;"string"===typeof a&&(a=0===a.indexOf("http")?{name:"oData",oDataServiceHost:a}:{name:"local",databaseName:a});if("provider"in a)a.name=a.provider;this.trackChanges=this.lazyLoad=false;this._entitySetReferences={};this._storageModel=[];var b=this;b._isOK=false;var c=this._successInitProvider;
this._successInitProvider=function(a){a instanceof $data.EntityContext?c(b):c(b,a)};this._storageModel.getStorageModel=function(a){a=Container.resolveName(a);return b._storageModel[a]};if(typeof a.name==="string")a.name=[a.name];var d=[].concat(a.name),e=$data.typeSystem.createCallbackSetting({success:this._successInitProvider,error:this._successInitProvider});this._initStorageModelSync();b._initializeEntitySets(b.getType());$data.StorageProviderLoader.load(d,{success:function(c){b.storageProvider=
new c(a,b);b.storageProvider.setContext(b);b.stateManager=new $data.EntityStateManager(b);var d=b.getType();if(c.name in d._storageModelCache)b._storageModel=d._storageModelCache[c.name];else{b._initializeStorageModel();d._storageModelCache[c.name]=b._storageModel}a&&a.user&&Object.defineProperty(b,"user",{value:a.user,enumerable:true});a&&a.checkPermission&&Object.defineProperty(b,"checkPermission",{value:a.checkPermission,enumerable:true});b._initializeStore(e)},error:function(){e.error("Provider fallback failed!")}});
this.addEventListener=function(a,b){var c="on"+a;c in this||(this[c]=new $data.Event(a,this));this[c].attach(b)};this.removeEventListener=function(a,b){var c="on"+a;c in this&&this[c].detach(b)};this.raiseEvent=function(a,b){var c="on"+a;c in this&&this[c].fire(b)};this.ready=this.onReady({success:$data.defaultSuccessCallback,error:function(){$data.PromiseHandler!==$data.PromiseHandlerBase?$data.defaultErrorCallback.apply(this,arguments):$data.Trace.error(arguments)}})},beginTransaction:function(a,
b,c){function d(a){Object.isNullOrUndefined(a)||(typeof a==="boolean"?g=a:Array.isArray(a)?e=a:f=a)}var e=null,f=null,g=false;d(a);d(b);d(c);a=new $data.PromiseHandler;f=a.createCallback(f);this.storageProvider._beginTran(e,g,f);return a.getPromise()},_isReturnTransaction:function(a){return a instanceof $data.Base||a==="returnTransaction"},_applyTransaction:function(a,b,c,d,e){if(e===true)if(d instanceof $data.Transaction){Array.prototype.push.call(c,d);b.apply(a,c)}else this.beginTransaction(function(d){Array.prototype.push.call(c,
d);b.apply(a,c)});else b.apply(a,c)},getDataType:function(a){if(typeof a=="string"){var b=this[a];if(b===void 0||b===null)b=eval(a);return b}return a},_initializeEntitySets:function(a){for(var b=0,c=this._storageModel.length;b<c;b++){var d=this._storageModel[b];this[d.ItemName]=new $data.EntitySet(d.LogicalType,this,d.ItemName,d.EventHandlers,d.Roles);var e=this[d.ItemName];e.name=d.ItemName;e.tableName=d.TableName;e.tableOptions=d.TableOptions;e.eventHandlers=d.EventHandlers;this._entitySetReferences[d.LogicalType.name]=
e;this._initializeActions(e,a,a.getMemberDefinition(d.ItemName))}},_initializeStore:function(a){this.storageProvider&&this.storageProvider.initializeStore(a)},_initStorageModelSync:function(){for(var a=this.getType().memberDefinitions.asArray(),b=0;b<a.length;b++){var c=a[b];if("dataType"in c){var d=Container.resolveType(c.dataType);if(d&&d.isAssignableTo&&d.isAssignableTo($data.EntitySet)){var d=Container.resolveType(c.elementType),e=new $data.StorageModel;e.TableName=c.tableName||c.name;e.TableOptions=
c.tableOptions;e.ItemName=c.name;e.LogicalType=d;e.LogicalTypeName=d.name;e.PhysicalTypeName=$data.EntityContext._convertLogicalTypeNameToPhysical(e.LogicalTypeName);e.ContextType=this.getType();e.Roles=c.roles;if(c.indices)e.indices=c.indices;if(c.beforeCreate){if(!e.EventHandlers)e.EventHandlers={};e.EventHandlers.beforeCreate=c.beforeCreate}if(c.beforeRead){if(!e.EventHandlers)e.EventHandlers={};e.EventHandlers.beforeRead=c.beforeRead}if(c.beforeUpdate){if(!e.EventHandlers)e.EventHandlers={};e.EventHandlers.beforeUpdate=
c.beforeUpdate}if(c.beforeDelete){if(!e.EventHandlers)e.EventHandlers={};e.EventHandlers.beforeDelete=c.beforeDelete}if(c.afterCreate){if(!e.EventHandlers)e.EventHandlers={};e.EventHandlers.afterCreate=c.afterCreate}if(c.afterRead){if(!e.EventHandlers)e.EventHandlers={};e.EventHandlers.afterRead=c.afterRead}if(c.afterUpdate){if(!e.EventHandlers)e.EventHandlers={};e.EventHandlers.afterUpdate=c.afterUpdate}if(c.afterDelete){if(!e.EventHandlers)e.EventHandlers={};e.EventHandlers.afterDelete=c.afterDelete}this._storageModel.push(e);
this._storageModel[Container.resolveName(d)]=e}}}},_initializeStorageModel:function(){this.getType().memberDefinitions.asArray();if(typeof intellisense==="undefined")for(var a=0;a<this._storageModel.length;a++){var b=this._storageModel[a],c={};b.Associations=b.Associations||[];b.ComplexTypes=b.ComplexTypes||[];for(var d=0;d<b.LogicalType.memberDefinitions.getPublicMappedProperties().length;d++){var e=b.LogicalType.memberDefinitions.getPublicMappedProperties()[d],f=Container.resolveType(e.dataType);
if(this.storageProvider.supportedDataTypes.indexOf(f)>-1&&Object.isNullOrUndefined(e.inverseProperty)){var g=JSON.parse(JSON.stringify(e));g.dataType=f;c[e.name]=g}else{this._buildDbType_navigationPropertyComplite(e,f,b);if((f===$data.Array||f.isAssignableTo&&f.isAssignableTo($data.EntitySet))&&e.inverseProperty&&e.inverseProperty!=="$$unbound")this._buildDbType_Collection_OneManyDefinition(c,b,f,e);else if(e.inverseProperty)if(e.inverseProperty==="$$unbound")f===$data.Array?this._buildDbType_Collection_OneManyDefinition(c,
b,f,e):this._buildDbType_ElementType_OneManyDefinition(c,b,f,e);else(g=f.memberDefinitions.getMember(e.inverseProperty))?g.elementType?Container.resolveType(g.elementType)===b.LogicalType?this._buildDbType_ElementType_OneManyDefinition(c,b,f,e):typeof intellisense==="undefined"&&Guard.raise(new Exception("Inverse property not valid, refereed item element type not match: "+b.LogicalTypeName,", property: "+e.name)):this._buildDbType_ElementType_OneOneDefinition(c,b,f,e):typeof intellisense==="undefined"&&
Guard.raise(new Exception("Inverse property not valid"));else this._buildDbType_addComplexTypePropertyDefinition(c,b,f,e)}}this._buildDbType_modifyInstanceDefinition(c,b,this);d={};d.convertTo=this._buildDbType_generateConvertToFunction(b,this);this._buildDbType_modifyClassDefinition(d,b,this);b.PhysicalType=$data.Class.define(b.PhysicalTypeName,$data.Entity,b.LogicalType.container,c,d)}},_initializeActions:function(a,b,c){if(c&&c.actions)for(var d=Object.keys(c.actions),e=0;e<d.length;e++){var f=
d[e],g=c.actions[f];if(typeof g==="function")a[f]=g;else{g=$data.MemberDefinition.translateDefinition(g,f,b);if(g instanceof $data.MemberDefinition&&g.kind===$data.MemberTypes.method)a[f]=g.method}}},_buildDbType_navigationPropertyComplite:function(a,b,c){if(a.inverseProperty){b=b===$data.Array||b.isAssignableTo&&b.isAssignableTo($data.EntitySet)?this._storageModel.getStorageModel(Container.resolveType(a.elementType)):this._storageModel.getStorageModel(b);if(c=b.LogicalType.memberDefinitions.getMember(a.inverseProperty))c.inverseProperty?
c.inverseProperty!=a.name&&typeof intellisense==="undefined"&&Guard.raise(new Exception("Inverse property mismatch")):c.inverseProperty=a.name}else{var d=null;if(b===$data.Array||b.isAssignableTo&&b.isAssignableTo($data.EntitySet)){if(b=this._storageModel.getStorageModel(Container.resolveType(a.elementType)))for(var d=[],b=b.LogicalType.memberDefinitions.getPublicMappedProperties(),e=0;e<b.length;e++){var f=b[e];f.inverseProperty==a.name&&Container.resolveType(f.dataType)===Container.resolveType(c.LogicalType)&&
d.push(f)}}else if(b=this._storageModel.getStorageModel(b)){d=[];b=b.LogicalType.memberDefinitions.getPublicMappedProperties();for(e=0;e<b.length;e++){f=b[e];f.elementType&&f.inverseProperty==a.name&&Container.resolveType(f.elementType)===c.LogicalType?d.push(f):f.inverseProperty==a.name&&Container.resolveType(f.dataType)===c.LogicalType&&d.push(f)}}if(d){d.length>1&&typeof intellisense!=="undefined"&&Guard.raise(new Exception("More than one inverse property refer to this member definition: "+a.name+
", type: "+Container.resolveName(c.LogicalType)));if(c=d.pop())a.inverseProperty=c.name}}},_buildDbType_generateConvertToFunction:function(){return function(a){return a}},_buildDbType_modifyInstanceDefinition:function(){},_buildDbType_modifyClassDefinition:function(){},_buildDbType_addComplexTypePropertyDefinition:function(a,b,c,d){this._addNavigationPropertyDefinition(a,d,d.name,$data.MemberTypes.complexProperty);a=this._createComplexElement(b.LogicalType,"",d.name,c,"","");b.ComplexTypes[d.name]=
a;b.ComplexTypes.push(a)},_buildDbType_Collection_OneManyDefinition:function(a,b,c,d){c=Container.resolveType(d.elementType);(c===void 0||c===null)&&typeof intellisense==="undefined"&&Guard.raise(new Exception("Element type definition error","Field definition",d));(c=this._storageModel.getStorageModel(c))||typeof intellisense==="undefined"&&Guard.raise(new Exception("No EntitySet definition for the following element type","Field definition",d));this._addNavigationPropertyDefinition(a,d,d.name);a=
this._addAssociationElement(b.LogicalType,d.inverseProperty==="$$unbound"?"$$unbound":"0..1",d.name,c.LogicalType,"*",d.inverseProperty);b.Associations[d.name]=a;b.Associations.push(a)},_buildDbType_ElementType_OneManyDefinition:function(a,b,c,d){c=Container.resolveType(d.dataType);(c===void 0||c===null)&&typeof intellisense==="undefined"&&Guard.raise(new Exception("Element type definition error","Field definition",d));(c=this._storageModel.getStorageModel(c))||typeof intellisense==="undefined"&&
Guard.raise(new Exception("No EntitySet definition for the following element type","Field definition",d));this._addNavigationPropertyDefinition(a,d,d.name);a=this._addAssociationElement(b.LogicalType,d.inverseProperty==="$$unbound"?"$$unbound":"*",d.name,c.LogicalType,"0..1",d.inverseProperty);b.Associations[d.name]=a;b.Associations.push(a)},_buildDbType_ElementType_OneOneDefinition:function(a,b,c,d){c=Container.resolveType(d.dataType);(c===void 0||c===null)&&typeof intellisense==="undefined"&&Guard.raise(new Exception("Element type definition error",
"Field definition",d));(c=this._storageModel.getStorageModel(c))||typeof intellisense==="undefined"&&Guard.raise(new Exception("No EntitySet definition following element type","Field definition",d));!c.LogicalType.memberDefinitions.getMember(d.inverseProperty).required&&!d.required&&typeof intellisense==="undefined"&&typeof intellisense==="undefined"&&Guard.raise(new Exception("In one to one connection, one side must required!","One to One connection",d));this._addNavigationPropertyDefinition(a,d,
d.name);a=this._addAssociationElement(b.LogicalType,d.required?"0..1":"1",d.name,c.LogicalType,d.required?"1":"0..1",d.inverseProperty);b.Associations[d.name]=a;b.Associations.push(a)},_addNavigationPropertyDefinition:function(a,b,c,d){var e=JSON.parse(JSON.stringify(b));e.dataType=$data.EntitySet;e.notMapped=true;e.kind=d?d:$data.MemberTypes.navProperty;e.association=c;a[b.name]=e},_addAssociationElement:function(a,b,c,d,e,f){return new $data.Association({From:a.name,FromType:a,FromMultiplicity:b,
FromPropertyName:c,To:d.name,ToType:d,ToMultiplicity:e,ReferentialConstraint:[],ToPropertyName:f})},_createComplexElement:function(a,b,c,d,e,f){return new $data.ComplexType({From:a.name,FromType:a,FromMultiplicity:b,FromPropertyName:c,To:d.name,ToType:d,ToMultiplicity:e,ReferentialConstraint:[],ToPropertyName:f})},_successInitProvider:function(a,b){if(a instanceof $data.EntityContext&&a._isOK!==void 0)if(b){a._isOK=b;if(a.onReadyFunction){for(c=0;c<a.onReadyFunction.length;c++)a.onReadyFunction[c].error(b);
a.onReadyFunction=void 0}}else{a._isOK=true;if(a.onReadyFunction){for(var c=0;c<a.onReadyFunction.length;c++)a.onReadyFunction[c].success(a);a.onReadyFunction=void 0}}},onReady:function(a){var b=new $data.PromiseHandler,a=b.createCallback(a);if(this._isOK===true)a.success(this);else if(this._isOK!==false)a.error(this._isOK);else{this.onReadyFunction=this.onReadyFunction||[];this.onReadyFunction.push(a)}return b.getPromise()},ready:{type:$data.Promise},getEntitySetFromElementType:function(a){var b=
this._entitySetReferences[a];if(!b)try{b=this._entitySetReferences[eval(a).name]}catch(c){}return b},executeQuery:function(a,b,c){var d=new $data.Query(a.expression,a.defaultType,this);d.transaction=c instanceof $data.Transaction?c:void 0;var e=this._isReturnTransaction(c),b=$data.typeSystem.createCallbackSetting(b),f=this,g={success:function(a){$data.QueryCache&&$data.QueryCache.isCacheable(f,a)&&$data.QueryCache.addToCache(f,a);a.buildResultSet(f);$data.ItemStore&&"QueryResultModifier"in $data.ItemStore&&
$data.ItemStore.QueryResultModifier.call(f,a);var c;if(a.expression.nodeType===$data.Expressions.ExpressionType.Single||a.expression.nodeType===$data.Expressions.ExpressionType.Find||a.expression.nodeType===$data.Expressions.ExpressionType.Count||a.expression.nodeType===$data.Expressions.ExpressionType.BatchDelete||a.expression.nodeType===$data.Expressions.ExpressionType.Some||a.expression.nodeType===$data.Expressions.ExpressionType.Every){if(a.result.length!==1){b.error(new Exception("result count failed"));
return}c=a.result[0]}else if(a.expression.nodeType===$data.Expressions.ExpressionType.First){if(a.result.length===0){b.error(new Exception("result count failed"));return}c=a.result[0]}else{if(typeof a.__count==="number"&&a.result)a.result.totalCount=a.__count;f.storageProvider._buildContinuationFunction(f,a);c=a.result}var d=function(){f._applyTransaction(b,b.success,[c],a.transaction,e)},g=0,h=a.getEntitySets(),p=function(){var b=h[g];if(b.afterRead){g++;b=b.afterRead.call(this,c,h,a);typeof b===
"function"?b.call(this,g<h.length?p:d,c,h,a):g<h.length?p():d()}else d()};h.length?p():d()},error:function(){e?b.error.apply(this,arguments):b.error.apply(this,Array.prototype.filter.call(arguments,function(a){return!(a instanceof $data.Transaction)}))}},h=d.getEntitySets(),a=function(){var a=true,b=function(b){b===false&&(a=false);if(a)d.transaction?$data.QueryCache&&$data.QueryCache.isInCache(f,d)?$data.QueryCache.executeQuery(f,d,g):f.storageProvider.executeQuery(d,g):f.beginTransaction(function(a){d.transaction=
a;$data.QueryCache&&$data.QueryCache.isInCache(f,d)?$data.QueryCache.executeQuery(f,d,g):f.storageProvider.executeQuery(d,g)});else{d.rawDataList=[];d.result=[];g.success(d)}},c=0,e=function(f){f===false&&(a=false);f=h[c];if(f.beforeRead){c++;f=f.beforeRead.call(this,h,d);if(typeof f==="function")f.call(this,c<h.length&&a?e:b,h,d);else{f===false&&(a=false);c<h.length&&a?e():b()}}else b()};h.length?e():b()};this.user&&this.checkPermission?this.checkPermission(d.expression.nodeType===$data.Expressions.ExpressionType.BatchDelete?
$data.Access.DeleteBatch:$data.Access.Read,this.user,h,{success:a,error:g.error}):a()},saveChanges:function(a,b){$data.QueryCache&&$data.QueryCache.reset(this);for(var c=[],d=this.stateManager.trackedEntities,e=new $data.PromiseHandler,f=e.createCallback(a),e=e.getPromise(),g=this._isReturnTransaction(b),h=[];d.length>0;){for(var i=[],j=0;j<d.length;j++){var l=d[j],w=this._storageModel.getStorageModel(l.data.getType());if(l.data.entityState==$data.EntityState.Unchanged){l.skipSave=true;h.push(l.data)}else if(l.data.entityState==
$data.EntityState.Modified&&l.data.changedProperties&&!l.data.changedProperties.some(function(a){a=w.PhysicalType.memberDefinitions.getMember(a.name);if(a.kind==$data.MemberTypes.navProperty){a=w.Associations[a.association];a=a.FromMultiplicity+a.ToMultiplicity;return a=="*0..1"||a=="0..11"}return true})){l.skipSave=true;h.push(l.data)}this.processEntityTypeBeforeEventHandler(h,l);for(var q=[],p=w.PhysicalType.memberDefinitions.asArray(),C=0;C<p.length;C++){var E=p[C];E.kind==$data.MemberTypes.navProperty&&
q.push(E)}for(p=0;p<q.length;p++)for(var z=q[p],C=w.Associations[z.name],E=C.ToPropertyName,z=[].concat(l.data[z.name]),n=0;n<z.length;n++){var v=z[n];if(v){var r=v[E],T=C.FromMultiplicity+C.ToMultiplicity;if(C.FromMultiplicity==="$$unbound")if(v instanceof $data.Array){l.dependentOn=l.dependentOn||[];for(r=0;r<v.length;r++)l.dependentOn.indexOf(v)<0&&v.skipSave!==true&&l.dependentOn.push(v)}else{l.dependentOn=l.dependentOn||[];l.dependentOn.indexOf(v)<0&&v.skipSave!==true&&l.dependentOn.push(v)}else{switch(T){case "*0..1":if(r)if(r instanceof
Array){if(r.indexOf(l.data)==-1){r.push(l.data);v.initData[E]=r;v._setPropertyChanged(C.ToType.getMemberDefinition(E))}}else typeof intellisense==="undefined"&&Guard.raise("Item must be array or subtype of array");else{v.initData[E]=[l.data];v._setPropertyChanged(C.ToType.getMemberDefinition(E))}break;default:if(r)r!==l.data&&typeof intellisense==="undefined"&&Guard.raise("Integrity check error! Item assigned to another entity!");else{v.initData[E]=l.data;v._setPropertyChanged(C.ToType.getMemberDefinition(E))}}switch(T){case "*0..1":case "0..11":l.dependentOn=
l.dependentOn||[];l.dependentOn.indexOf(v)<0&&v.skipSave!==true&&l.dependentOn.push(v)}}if(!v.entityState)v.entityState=v.storeToken===this.storeToken?$data.EntityState.Modified:$data.EntityState.Added;i.indexOf(v)==-1&&i.push(v)}}}for(j=0;j<d.length;j++){l=d[j];l.skipSave!==true&&c.push(l)}d=[];for(j=0;j<i.length;j++){var P=i[j];h.some(function(a){return a==P})||c.some(function(a){return a.data==P})||d.push({data:P,entitySet:this.getEntitySetFromElementType(P.getType().name)})}}for(p=0;p<c.length;p++){d=
c[p];if(d.dependentOn){i=[];for(j=0;j<d.dependentOn.length;j++)h.indexOf(d.dependentOn[j])<0&&i.push(d.dependentOn[j]);d.dependentOn=i}}var h=null,A=this;if(c.length==0){this.stateManager.trackedEntities.length=0;A._applyTransaction(f,f.success,[0],b,g);return e}h=[];for(j=0;j<c.length;j++){l=c[j];if(l.data.entityState===$data.EntityState.Added)for(p=0;p<l.data.getType().memberDefinitions.getPublicMappedProperties().length;p++){d=l.data.getType().memberDefinitions.getPublicMappedProperties()[p];i=
Container.resolveType(d.type);if(d.required&&!d.computed&&!l.data[d.name])switch(i){case $data.String:case $data.Number:case $data.Float:case $data.Decimal:case $data.Integer:case $data.Int16:case $data.Int32:case $data.Int64:case $data.Byte:case $data.SByte:case $data.Date:case $data.Boolean:l.data[d.name]=Container.getDefault(d.dataType)}}(l.data.entityState===$data.EntityState.Added||l.data.entityState===$data.EntityState.Modified)&&!l.data.isValid()&&h.push({item:l.data,errors:l.data.ValidationErrors})}if(h.length>
0){f.error(h);return e}for(var h=$data.Access.None,t={},p=[],j=0;j<c.length;j++){d=c[j];i=d.entitySet.elementType.name;p.indexOf(d.entitySet)<0&&p.push(d.entitySet);l=this._entitySetReferences[i];if(l.beforeCreate||l.beforeUpdate||l.beforeDelete||this.user&&this.checkPermission){t[i]||(t[i]={});switch(d.data.entityState){case $data.EntityState.Added:h=h|$data.Access.Create;if(l.beforeCreate){if(!t[i].createAll)t[i].createAll=[];t[i].createAll.push(d)}break;case $data.EntityState.Modified:h=h|$data.Access.Update;
if(l.beforeUpdate){if(!t[i].modifyAll)t[i].modifyAll=[];t[i].modifyAll.push(d)}break;case $data.EntityState.Deleted:h=h|$data.Access.Delete;if(l.beforeDelete){if(!t[i].deleteAll)t[i].deleteAll=[];t[i].deleteAll.push(d)}}}}var y=function(a){if(a===false){o="async";c.length=0}if(c.length){var d={success:function(a){A._postProcessSavedItems(f,c,a,g)},error:function(){g?f.error.apply(this,arguments):f.error.apply(this,Array.prototype.filter.call(arguments,function(a){return!(a instanceof $data.Transaction)}))}};
b instanceof $data.Transaction?A.storageProvider.saveChanges(d,c,b):A.beginTransaction(true,function(a){A.storageProvider.saveChanges(d,c,a)})}else o?f.error(new Exception("Cancelled event in "+o,"CancelEvent")):A._applyTransaction(f,f.success,[0],b,g)},o,D=Object.getOwnPropertyNames(t),j=0,x=["beforeUpdate","beforeDelete","beforeCreate"],U={beforeCreate:"createAll",beforeDelete:"deleteAll",beforeUpdate:"modifyAll"},H=function(a){if(a===false){o="async";c.length=0;y(a)}else{var b=A._entitySetReferences[D[j]],
d=x.pop();if(a=t[D[j]][U[d]]){for(var e=[],f=0;f<a.length;f++)e.push(a[f].data);if(!x.length){x=["beforeUpdate","beforeDelete","beforeCreate"];j++}f=b[d].call(A,e);if(typeof f==="function")f.call(A,j<D.length&&!o?H:y,e);else if(f===false){o=b.name+"."+d;for(b=0;b<a.length;b++){d=c.indexOf(a[b]);c.splice(d,1)}y()}else j<D.length&&!o?H():y()}else{if(!x.length){x=["beforeUpdate","beforeDelete","beforeCreate"];j++}j<D.length&&!o?H():y()}}};this.user&&this.checkPermission?this.checkPermission(h,this.user,
p,{success:function(){j<D.length?H():y()},error:f.error}):j<D.length?H():y();return e},processEntityTypeBeforeEventHandler:function(a,b){if(!b.skipSave){var c=b.data,d=c.getType(),e=c.entityState;switch(true){case e===$data.EntityState.Added&&d.onbeforeCreate instanceof $data.Event:if(d.onbeforeCreate.fireCancelAble(c)===false){b.skipSave=true;a.push(c)}break;case e===$data.EntityState.Modified&&d.onbeforeUpdate instanceof $data.Event:if(d.onbeforeUpdate.fireCancelAble(c)===false){b.skipSave=true;
a.push(c)}break;case e===$data.EntityState.Deleted&&d.onbeforeDelete instanceof $data.Event:if(d.onbeforeDelete.fireCancelAble(c)===false){b.skipSave=true;a.push(c)}}}},processEntityTypeAfterEventHandler:function(a){var a=a.data,b=a.getType(),c=a.entityState;switch(true){case c===$data.EntityState.Added&&b.onafterCreate instanceof $data.Event:b.onafterCreate.fire(a);break;case c===$data.EntityState.Modified&&b.onafterUpdate instanceof $data.Event:b.onafterUpdate.fire(a);break;case c===$data.EntityState.Deleted&&
b.onafterDelete instanceof $data.Event:b.onafterDelete.fire(a)}},bulkInsert:function(a,b,c,d){var e=new $data.PromiseHandler,d=e.createCallback(d);if(typeof a==="string"){var f,g;for(g in this._entitySetReferences){var h=this._entitySetReferences[g];if(h.tableName===a){f=h;break}}f||(f=this[a]);a=f}a?this.storageProvider.bulkInsert(a,b,c,d):d.error(new Exception("EntitySet not found"));return e.getPromise()},prepareRequest:function(){},_postProcessSavedItems:function(a,b,c,d){this.ChangeCollector&&
this.ChangeCollector instanceof $data.Notifications.ChangeCollectorBase&&this.ChangeCollector.processChangedData(b);for(var e={},f=this,g=0;g<b.length;g++){var h=b[g];if(!h.data.storeToken)h.data.storeToken=f.storeToken;this.processEntityTypeAfterEventHandler(h);var i=h.data.entityState;h.data.entityState=$data.EntityState.Unchanged;h.data.changedProperties=[];h.physicalData=void 0;var j=h.entitySet.elementType.name,l=f._entitySetReferences[j],w=void 0;switch(i){case $data.EntityState.Added:w="added";
break;case $data.EntityState.Deleted:w="deleted";break;case $data.EntityState.Modified:w="updated"}w&&this.raiseEvent(w,h);if(l.afterCreate||l.afterUpdate||l.afterDelete){e[j]||(e[j]={});switch(i){case $data.EntityState.Added:if(l.afterCreate){if(!e[j].createAll)e[j].createAll=[];e[j].createAll.push(h)}break;case $data.EntityState.Modified:if(l.afterUpdate){if(!e[j].modifyAll)e[j].modifyAll=[];e[j].modifyAll.push(h)}break;case $data.EntityState.Deleted:if(l.afterDelete){if(!e[j].deleteAll)e[j].deleteAll=
[];e[j].deleteAll.push(h)}}}}var q=Object.getOwnPropertyNames(e),g=0,f=this,p=["afterUpdate","afterDelete","afterCreate"],C={afterCreate:"createAll",afterDelete:"deleteAll",afterUpdate:"modifyAll"},E=function(){f.trackChanges||f.stateManager.reset();f._applyTransaction(a,a.success,[b.length],c,d)},z=function(){var a=f._entitySetReferences[q[g]],b=p.pop(),c=e[q[g]][C[b]];if(c){for(var d=[],h=0;h<c.length;h++)d.push(c[h].data);if(!p.length){p=["afterUpdate","afterDelete","afterCreate"];g++}a=a[b].call(f,
d);typeof a==="function"?a.call(f,g<q.length?z:E,d):g<q.length?z():E()}else{if(!p.length){p=["afterUpdate","afterDelete","afterCreate"];g++}g<q.length?z():E()}};g<q.length?z():E()},forEachEntitySet:function(a,b){for(var c in this._entitySetReferences)a.call(b,this._entitySetReferences[c])},loadItemProperty:function(a,b,c,d){Guard.requireType("entity",a,$data.Entity);var b=typeof b==="string"?a.getType().memberDefinitions.getMember(b):b,e=this._isReturnTransaction(d);if(a[b.name]!=void 0){var f=new $data.PromiseHandler;
callBack=f.createCallback(c);this._applyTransaction(c,c.success,[a[b.name]],d,e);return f.getPromise()}var g=true,h=this._storageModel.getStorageModel(a.getType().fullName),e=Container.resolveType(b.dataType);if(e===$data.Array||e.isAssignableTo&&e.isAssignableTo($data.EntitySet)){e=Container.resolveType(b.elementType);g=false}else{for(var i=0;i<h.Associations.length;i++){var j=h.Associations[i];if(j.FromPropertyName==b.name){f=j;break}}f&&f.FromMultiplicity==="0..1"&&f.ToMultiplicity==="1"&&(g=false)}f=
h.LogicalType.memberDefinitions.getKeyProperties();if(g===true){g="function (e) { return";h={};for(i=0;i<f.length;i++){j=f[i];i>0&&(g=g+" &&");g=g+(" e."+j.name+" == this.key"+i);h["key"+i]=a[j.name]}g=g+"; }";a=this.getEntitySetFromElementType(a.getType());return a.map("function (e) { return e."+b.name+" }").single(g,h,c,d)}g="function (e) { return";h={};for(i=0;i<f.length;i++){j=f[i];i>0&&(g=g+" &&");g=g+(" e."+b.inverseProperty+"."+j.name+" == this.key"+i);h["key"+i]=a[j.name]}g=g+"; }";a=this.getEntitySetFromElementType(e);
return a.filter(g,h).toArray(c,d)},getTraceString:function(a){return this.storageProvider.getTraceString(new $data.Query(a.expression,a.defaultType,this))},log:function(){},resolveBinaryOperator:function(a,b,c){return this.storageProvider.resolveBinaryOperator(a,b,c)},resolveUnaryOperator:function(a,b,c){return this.storageProvider.resolveUnaryOperator(a,b,c)},resolveFieldOperation:function(a,b,c){return this.storageProvider.resolveFieldOperation(a,b,c)},resolveSetOperations:function(a,b,c){return this.storageProvider.resolveSetOperations(a,
b,c)},resolveTypeOperations:function(a,b,c){return this.storageProvider.resolveTypeOperations(a,b,c)},resolveContextOperations:function(a,b,c){return this.storageProvider.resolveContextOperations(a,b,c)},_generateServiceOperationQueryable:function(a,b,c,d){typeof console!=="undefined"&&console.log&&console.log("Obsolate: _generateServiceOperationQueryable, $data.EntityContext");for(var e=[],f=0;f<d.length;f++){var g={};g[d[f]]=Container.resolveType(Container.getTypeName(c[f]));e.push(g)}return $data.EntityContext.generateServiceOperation({serviceName:a,
returnType:$data.Queryable,elementType:this[b].elementType,params:e}).apply(this,c)},attach:function(a,b){a instanceof $data.EntityWrapper&&(a=a.getEntity());return this.getEntitySetFromElementType(a.getType()).attach(a,b)},attachOrGet:function(a){a instanceof $data.EntityWrapper&&(a=a.getEntity());return this.getEntitySetFromElementType(a.getType()).attachOrGet(a)},addMany:function(a){var b=this;a.forEach(function(a){b.add(a)});return a},add:function(a){a instanceof $data.EntityWrapper&&(a=a.getEntity());
return this.getEntitySetFromElementType(a.getType()).add(a)},remove:function(a){a instanceof $data.EntityWrapper&&(a=a.getEntity());return this.getEntitySetFromElementType(a.getType()).remove(a)},storeToken:{type:Object},getFieldUrl:function(a,b,c){try{var d=typeof c==="string"?this[c]:c,e=typeof b==="string"?b:b.name;if(a instanceof $data.Entity)d=this.getEntitySetFromElementType(a.getType());else if(!Object.isNullOrUndefined(a)&&a.constructor!==$data.Object){var f=d.elementType.memberDefinitions.getKeyProperties()[0],
b={};b[f.name]=a;a=b}a instanceof $data.Entity||(a=new d.elementType(a));return this.storageProvider.getFieldUrl(a,e,d)}catch(g){}return"#"}},{inheritedTypeProcessor:function(a){a.resolveForwardDeclarations&&a.resolveForwardDeclarations()},generateServiceOperation:function(a){var b;if(a.serviceMethod){b=a.returnType?Container.resolveType(a.returnType):{};b=b.isAssignableTo&&b.isAssignableTo($data.Queryable)?a.serviceMethod:function(){var b=arguments[arguments.length-1],c=new $data.PromiseHandler;
if(typeof b==="function"){b=c.createCallback(b);arguments[arguments.length-1]=b}else{b=c.createCallback();arguments.push(b)}try{var d=a.serviceMethod.apply(this,arguments);d!==void 0&&b.success(d)}catch(e){b.error(e)}return c.getPromise()}}else b=function(){var b=this,c;if(this instanceof $data.Entity){if(!a.method)a.method="POST";if(this.context)b=this.context;else{Guard.raise("entity not attached into context");return}c={data:this,entitySet:b.getEntitySetFromElementType(this.getType())}}var d=a.elementType?
b.getEntitySetFromElementType(Container.resolveType(a.elementType)):null,e=null;if(a.params)for(var e=[],f=0;f<a.params.length;f++)for(var w in a.params[f])e.push(Container.createConstantExpression(arguments[f],Container.resolveType(a.params[f][w]),w));f=Container.createEntityContextExpression(b);w=(c?c.data:b).getType().getMemberDefinition(a.serviceName);c=Container.createServiceOperationExpression(f,Container.createMemberInfoExpression(w),e,a,c);e=arguments[arguments.length-1];typeof e!=="function"&&
(e=void 0);if(d){b=Container.createQueryable(d,c);if(e){c.isTerminated=true;return b._runQuery(e)}return b}d=a.returnType?Container.resolveType(a.returnType):null;b=Container.createQueryable(b,c);b.defaultType=d||$data.Object;if(d===$data.Queryable){b.defaultType=Container.resolveType(a.elementType);if(e){c.isTerminated=true;return b._runQuery(e)}return b}c.isTerminated=true;return b._runQuery(e)};var c=[];if(a.params)for(var d=0;d<a.params.length;d++){var e=a.params[d],f;for(f in e)c.push({name:f,
type:e[f]})}$data.typeSystem.extend(b,a,{params:c});return b},_convertLogicalTypeNameToPhysical:function(a){return a+"_$db$"},_storageModelCache:{get:function(){if(!this.__storageModelCache)this.__storageModelCache={};return this.__storageModelCache},set:function(){}}});$data.Class.define("$data.QueryProvider",null,null,{constructor:function(){this.requiresExpressions=false},executeQuery:function(){},getTraceString:function(){}},null);
$data.Class.define("$data.ModelBinder",null,null,{constructor:function(a){this.context=a;this.providerName=null;if(this.context.storageProvider&&typeof this.context.storageProvider.getType==="function"){this.references=!this.context.storageProvider.providerConfiguration.modelBinderOptimization;for(var b in $data.RegisteredStorageProviders)if($data.RegisteredStorageProviders[b]===this.context.storageProvider.getType())this.providerName=b}},_deepExtend:function(a,b){if(a===null||a===void 0)return b;
for(var c in b)if(a.hasOwnProperty(c)){if(typeof b[c]==="object")if(Array.isArray(b[c]))for(var d=0;d<b[c].length;d++)a[c].indexOf(b[c][d])<0&&a[c].push(b[c][d]);else this._deepExtend(a[c],b[c])}else a[c]=b[c];return this._finalize(a)},_finalize:function(a){if(a instanceof $data.Entity){a.changedProperties=void 0;a.storeToken=this.context.storeToken}return a},_buildSelector:function(a,b){if(a.$selector){if(!Array.isArray(a.$selector))a.$selector=[a.$selector];for(var c=0;c<a.$selector.length;c++){var d=
a.$selector[c].replace("json:","");b.src=b.src+"if(";for(var e=d.split("."),f=0;f<e.length;f++)b.src=b.src+("di."+e.slice(0,f+1).join(".")+(f<e.length-1?" && ":" !== undefined && typeof di."+d+' === "object"'));b.src=b.src+("){di = di."+d+";}"+(c<a.$selector.length-1?"else ":""))}b.src=b.src+"if (di === null){";if(b.iter)b.src=b.src+(b.iter+" = null;");b.src=b.src+"return null;";b.src=b.src+"}"}},_buildKey:function(a,b,c,d,e){if(c){var b=Container.resolveType(b),f=Container.getIndex(b),b=b.fullName||
b.name;d.src=d.src+("var "+a+"Fn = function(di){");if(!Array.isArray(c)||c.length==1){typeof c!=="string"&&(c=c[0]);d.src=d.src+("if (typeof di."+c+' === "undefined") return undefined;');d.src=d.src+("if (di."+c+" === null) return null;");d.src=d.src+('var key = ("'+b+"_"+f+"_"+c+'#" + di.'+c+");")}else{d.src=d.src+'var key = "";';for(var g=0;g<c.length;g++){var h=typeof c[g]!=="object"?c[g]:c[g].$source;d.src=d.src+("if (typeof di."+h+' === "undefined") return undefined;');d.src=d.src+("if (di."+
h+" === null) return null;");d.src=d.src+('key += ("'+b+"_"+f+"_"+h+'#" + di.'+h+");")}}d.src=d.src+"return key;};"}d.src=d.src+("var "+a+" = "+(c?a+"Fn("+(e||"di")+")":"undefined")+";")},build:function(a,b){if(a.$selector){if(!Array.isArray(a.$selector))a.$selector=[a.$selector];for(var c=0;c<a.$selector.length;c++)a.$selector[c]=a.$selector[c].replace("json:","")}if(a.$value)if(typeof a.$value==="function"){b.src=b.src+"var di = di || data;";b.src=b.src+("var fn = function(){ return meta"+(b.meta.length?
"."+b.meta.join("."):"")+".$value.call(self, meta"+(b.meta.length?"."+b.meta.join("."):"")+", di); };");if(a.$type){var d=Container.resolveName(Container.resolveType(a.$type)),e=Container.getIndex(Container.resolveType(a.$type)),f=this.context.storageProvider.fieldConverter.fromDb[d];b.item=f?'self.context.storageProvider.fieldConverter.fromDb["'+d+'"](fn())':"new (Container.resolveByIndex("+e+"))(fn())"}else b.item="fn()"}else if(a.$type){d=Container.resolveName(Container.resolveType(a.$type));e=
Container.getIndex(Container.resolveType(a.$type));f=this.context.storageProvider.fieldConverter.fromDb[d];b.item=f?'self.context.storageProvider.fieldConverter.fromDb["'+d+'"]('+a.$value+")":"new (Container.resolveByIndex("+e+"))("+a.$value+")"}else b.item=a.$value;else if(a.$source){var d=Container.resolveName(Container.resolveType(a.$type)),e=Container.getIndex(Container.resolveType(a.$type)),f=this.context.storageProvider.fieldConverter.fromDb[d],g="_"+d.replace(/\./gi,"_")+"_";if(!b.forEach)b.src=
b.src+"var di = data;";b.item=g;this._buildSelector(a,b);b.src=f?b.src+("var "+g+' = self.context.storageProvider.fieldConverter.fromDb["'+d+'"](di.'+a.$source+");"):b.src+("var "+g+" = new (Container.resolveByIndex("+e+"))(di."+a.$source+");")}else if(a.$item){b.meta.push("$item");c=b.item&&b.current?b.item+"."+b.current:b.item?b.item:"result";b.iter=c;if(c.indexOf(".")<0)b.src=b.src+("var "+c+";");b.src=b.src+"var fn = function(di){";if(a.$selector){b.src=b.src+'if (typeof di !== "undefined" && !(Array.isArray(di))){';
this._buildSelector(a,b);b.src=b.src+"}"}this.references&&a.$keys&&this._buildKey("forKey",a.$type,a.$keys,b);b.src=b.src+(c+" = typeof "+c+' == "undefined" ? [] : '+c+";");if(this.references&&a.$item.$keys){g="keycache_"+c.replace(/\./gi,"_");b.src=b.src+("var "+g+";");b.src=b.src+("var kci = keycacheIter.indexOf("+c+");");b.src=b.src+"if (kci < 0){";b.src=b.src+(g+" = [];");b.src=b.src+("keycache.push("+g+");");b.src=b.src+("keycacheIter.push("+c+");");b.src=b.src+"}else{";b.src=b.src+(g+" = keycache[kci];");
b.src=b.src+"}"}b.iter=void 0;b.forEach=true;d="itemForKey_"+c.replace(/\./gi,"_");b.src=b.src+"var forEachFn = function(di, i){";b.src=b.src+"var diBackup = di;";this.providerName=="sqLite"&&this.references&&a.$item.$keys&&this._buildKey(d,a.$type,a.$item.$keys,b);g=b.item||"iter";b.item=g;a.$item.$source||this._buildSelector(a.$item,b);this.build(a.$item,b);if(this.references&&a.$keys){b.src=b.src+"if (forKey){";b.src=b.src+"if (cache[forKey]){";b.src=b.src+(c+" = cache[forKey];");b.src=b.src+("if ("+
c+".indexOf("+(b.item||g)+") < 0){");b.src=b.src+(c+".push("+(b.item||g)+");");b.src=b.src+"}}else{";b.src=b.src+("cache[forKey] = "+c+";");b.src=b.src+(c+".push("+(b.item||g)+");");b.src=b.src+"}}else{";this.references&&a.$item.$keys&&this._buildKey("cacheKey",a.$type,a.$item.$keys,b,"diBackup");b.src=b.src+'if (typeof cacheKey != "undefined" && cacheKey !== null){';b.src=b.src+("if (keycache_"+c.replace(/\./gi,"_")+" && cacheKey){");b.src=b.src+("if (keycache_"+c.replace(/\./gi,"_")+".indexOf(cacheKey) < 0){");
b.src=b.src+(c+".push("+(b.item||g)+");");b.src=b.src+("keycache_"+c.replace(/\./gi,"_")+".push(cacheKey);");b.src=b.src+"}";b.src=b.src+"}else{";b.src=b.src+(c+".push("+(b.item||g)+");");b.src=b.src+"}";b.src=b.src+"}";b.src=b.src+"}"}else if(this.references&&a.$item.$keys){b.src=b.src+("if (typeof "+d+' !== "undefined" && '+d+" !== null){");b.src=b.src+("if (typeof keycache_"+c.replace(/\./gi,"_")+' !== "undefined" && '+d+"){");b.src=b.src+("if (keycache_"+c.replace(/\./gi,"_")+".indexOf("+d+") < 0){");
b.src=b.src+(c+".push("+(b.item||g)+");");b.src=b.src+("keycache_"+c.replace(/\./gi,"_")+".push("+d+");");b.src=b.src+"}}else{";b.src=b.src+(c+".push("+(b.item||g)+");");b.src=b.src+"}}else{";b.src=b.src+(c+".push("+(b.item||g)+");");b.src=b.src+"}"}else b.src=b.src+(c+".push("+(b.item||g)+");");b.src=b.src+"};";b.src=b.src+"if (Array.isArray(di)) di.forEach(forEachFn);";b.src=b.src+"else forEachFn(di, 0);";b.forEach=false;b.item=null;b.src=b.src+'};fn(typeof di === "undefined" ? data : di);';b.meta.pop()}else if(a.$type){if(!b.forEach){b.src=
b.src+'if (typeof di === "undefined"){';b.src=b.src+"var di = data;";this._buildSelector(a,b);b.src=b.src+"}"}var h=Container.resolveType(a.$type),d=Container.resolveName(h),e=Container.getIndex(h),f=h.isAssignableTo&&h.isAssignableTo($data.Entity),g="_"+d.replace(/\./gi,"_")+"_";b.item==g&&(g=g+"new_");b.item=g;var i=false;!a.$source&&!a.$value&&h!==$data.Array&&h!==$data.Object&&!h.isAssignableTo&&(i=true);if(h===$data.Object||h===$data.Array){h=Object.keys(a);if(h.length==1||h.length==2&&a.$selector)i=
true}if(i){f=this.context.storageProvider.fieldConverter.fromDb[d];b.src=f?b.src+("var "+g+' = di != undefined ? self.context.storageProvider.fieldConverter.fromDb["'+d+'"](di) : di;'):b.src+("var "+g+" = di;")}else if(this.references&&a.$keys){this._buildKey("itemKey",a.$type,a.$keys,b);b.src=b.src+"if (itemKey === null) return null;";b.src=b.src+("var "+g+";");b.src=b.src+"if (itemKey && cache[itemKey]){";b.src=b.src+(g+" = cache[itemKey];");b.src=b.src+"}else{";b.src=f?b.src+(g+" = new (Container.resolveByIndex("+
e+"))(undefined, { setDefaultValues: false });"):b.src+(g+" = new (Container.resolveByIndex("+e+"))();");b.src=b.src+"if (itemKey){";b.src=b.src+("cache[itemKey] = "+g+";");b.src=b.src+"}";b.src=b.src+"}"}else b.src=f?b.src+("var "+g+" = new (Container.resolveByIndex("+e+"))(undefined, { setDefaultValues: false });"):b.src+("var "+g+" = new (Container.resolveByIndex("+e+"))();");for(c in a)if(c.indexOf("$")<0){b.current=c;if(a[c].$item){b.meta.push(c);this.build(a[c],b);b.item=g;b.meta.pop()}else if(a[c].$value){b.meta.push(c);
g=b.item;this.build(a[c],b);b.src=b.src+(g+"."+c+" = "+b.item+";");b.item=g;b.meta.pop()}else if(a[c].$source){b.src=b.src+"var fn = function(di){";this._buildSelector(a[c],b);if(a[c].$type){d=Container.resolveName(Container.resolveType(a[c].$type));e=Container.getIndex(Container.resolveType(a[c].$type));f=this.context.storageProvider.fieldConverter.fromDb[d];b.src=f?b.src+('return self.context.storageProvider.fieldConverter.fromDb["'+d+'"](di.'+a[c].$source+");"):b.src+("return new (Container.resolveByIndex("+
e+"))(di."+a[c].$source+");")}else b.src=b.src+(g+"."+c+" = di."+a[c].$source+";");b.src=b.src+"};";b.src=a[c].$type?b.src+(g+"."+c+" = fn(di);"):b.src+"fn(di);"}else if(a[c].$type){b.meta.push(c);b.src=b.src+"var fn = function(di){";this._buildSelector(a[c],b);this.build(a[c],b);b.src=b.src+("return "+b.item+";};");b.src=a[c].$type===$data.Object?b.src+(g+"."+c+" = self._deepExtend("+g+"."+c+", fn(di));"):b.src+(g+"."+c+" = fn(di);");b.item=g;b.meta.pop()}else if(a.$type){e=Container.resolveType(a.$type).memberDefinitions.getMember(c);
d=Container.resolveName(e.type);Container.resolveType(a.$type);i=Container.getIndex(a.$type);f=this.context.storageProvider.fieldConverter.fromDb[d];if(this.providerName&&e&&e.converter&&e.converter[this.providerName]&&typeof e.converter[this.providerName].fromDb=="function")b.src=b.src+(g+"."+c+' = Container.resolveByIndex("'+i+'").memberDefinitions.getMember("'+c+'").converter.'+this.providerName+".fromDb(di."+a[c]+', Container.resolveByIndex("'+i+'").memberDefinitions.getMember("'+c+'"), self.context, Container.resolveByIndex("'+
i+'"));');else if(f)b.src=b.src+(g+"."+c+' = self.context.storageProvider.fieldConverter.fromDb["'+d+'"](di.'+a[c]+");");else{e=Container.getIndex(Container.resolveType(d.memberDefinitions.getMember(c).type));b.src=b.src+(g+"."+c+" = new (Container.resolveByIndex("+e+"))(di."+a[c]+");")}}}b.src=b.src+(g+" = self._finalize("+g+");")}},call:function(a,b){if(!Object.getOwnPropertyNames(b).length)return a;var c={src:"",meta:[]};c.src=c.src+"var self = this;";c.src=c.src+"var result;";c.src=c.src+"var cache = {};";
c.src=c.src+"var keycache = [];";c.src=c.src+"var keycacheIter = [];";this.build(b,c);if(c.item)c.src=c.src+('if (typeof result === "undefined") result = '+c.item+";");c.src=c.src+"return result;";return(new Function("meta","data",c.src)).bind(this)(b,a)}});
$C("$data.queryBuilder",null,null,{constructor:function(){this._fragments={};this.selectedFragment=null;this.modelBinderConfig=this._binderConfig={};this._binderConfigPropertyStack=[]},selectTextPart:function(a){this._fragments[a]||(this._fragments[a]={text:"",params:[]});this.selectedFragment=this._fragments[a]},getTextPart:function(a){return this._fragments[a]},addText:function(a){this.selectedFragment.text=this.selectedFragment.text+a},addParameter:function(a){this.selectedFragment.params.push(a)},
selectModelBinderProperty:function(a){this._binderConfigPropertyStack.push(this.modelBinderConfig);a in this.modelBinderConfig||(this.modelBinderConfig[a]={});this.modelBinderConfig=this.modelBinderConfig[a]},popModelBinderProperty:function(){this.modelBinderConfig=this._binderConfigPropertyStack.length===0?this._binderConfig():this._binderConfigPropertyStack.pop()},resetModelBinderProperty:function(){this._binderConfigPropertyStack=[];this.modelBinderConfig=this._binderConfig},addKeyField:function(a){this.modelBinderConfig.$keys||
(this.modelBinderConfig.$keys=[]);this.modelBinderConfig.$keys.push(a)}});
$C("$data.Query",null,null,{constructor:function(a,b,c){this.expression=a;this.context=c;this.expressions=a;this.defaultType=b;this.result=[];this.rawDataList=[];this.modelBinderConfig={};this.context=c},rawDataList:{dataType:"Array"},result:{dataType:"Array"},resultType:{},buildResultSet:function(){this.result=(new $data.ModelBinder(this.context)).call(this.rawDataList,this.modelBinderConfig)},getEntitySets:function(){var a=[],b=this.context,c=function(d){d instanceof $data.Expressions.EntitySetExpression&&
a.indexOf(b._entitySetReferences[d.elementType.name])<0&&a.push(b._entitySetReferences[d.elementType.name]);d.source&&c(d.source)};c(this.expression);return a}},null);
$data.Class.define("$data.Queryable",null,null,{constructor:function(a,b){var c=a instanceof $data.EntityContext?a:a.entityContext;this.defaultType=a instanceof $data.EntityContext?null:a.defaultType;this.entityContext=c;this.expression=b},filter:function(a,b){if(arguments.length===3){a="it."+arguments[0]+(arguments[1][0]==="."?arguments[1]+"(param)":" "+arguments[1]+" param");b={param:arguments[2]}}this._checkOperation("filter");var c=Container.createCodeExpression(a,b),d=this.expression;if(this.expression instanceof
$data.Expressions.FilterExpression)var d=this.expression.source,e=this.entityContext.storageProvider.resolveBinaryOperator("and"),c=Container.createSimpleBinaryExpression(this.expression.selector,c,"and","filter","boolean",e);c=Container.createFilterExpression(d,c);return Container.createQueryable(this,c)},where:function(a,b){return this.filter(a,b)},map:function(a,b,c){this._checkOperation("map");a=Container.createCodeExpression(a,b);a=Container.createProjectionExpression(this.expression,a);a.projectionAs=
c==="default"?this.defaultType:c?Container.resolveType(c):$data.Object;return Container.createQueryable(this,a)},select:function(a,b,c){return this.map(a,b,c)},length:function(a,b){this._checkOperation("length");var c=new $data.PromiseHandler,d=c.createCallback(a),e=Container.createCountExpression(this.expression),f=Container.createQueryExpressionCreator(this.entityContext);try{var g=f.Visit(e);this.entityContext.log({event:"EntityExpression",data:g});this.entityContext.executeQuery(Container.createQueryable(this,
g),d,b)}catch(h){d.error(h)}return c.getPromise()},count:function(a,b){return this.length(a,b)},forEach:function(a,b){this._checkOperation("forEach");var c=new $data.PromiseHandler,d=c.createCallback(function(b){b.forEach(a)}),e=Container.createForEachExpression(this.expression),f=Container.createQueryExpressionCreator(this.entityContext);try{var g=f.Visit(e);this.entityContext.log({event:"EntityExpression",data:g});this.entityContext.executeQuery(Container.createQueryable(this,g),d,b)}catch(h){d.error(h)}return c.getPromise()},
toArray:function(a,b){if(a instanceof $data.Array)return this.toArray(function(b){a.length=0;b.forEach(function(b){a.push(b)})});this._checkOperation("toArray");var c=new $data.PromiseHandler,d=c.createCallback(a),e=Container.createToArrayExpression(this.expression),f=Container.createQueryExpressionCreator(this.entityContext);try{var g=f.Visit(e);this.entityContext.log({event:"EntityExpression",data:g});this.entityContext.executeQuery(Container.createQueryable(this,g),d,b)}catch(h){d.error(h)}return c.getPromise()},
single:function(a,b,c,d){this._checkOperation("single");var e=this;a&&(e=this.filter(a,b));var e=e.take(2),a=new $data.PromiseHandler,c=a.createCallback(c),b=Container.createSingleExpression(e.expression),f=Container.createQueryExpressionCreator(e.entityContext);try{var g=f.Visit(b);this.entityContext.log({event:"EntityExpression",data:g});e.entityContext.executeQuery(Container.createQueryable(e,g),c,d)}catch(h){c.error(h)}return a.getPromise()},some:function(a,b,c,d){this._checkOperation("some");
var e=this;a&&(e=this.filter(a,b));var e=e.take(1),a=new $data.PromiseHandler,c=a.createCallback(c),b=Container.createSomeExpression(e.expression),f=Container.createQueryExpressionCreator(e.entityContext);try{var g=f.Visit(b);this.entityContext.log({event:"EntityExpression",data:g});e.entityContext.executeQuery(Container.createQueryable(e,g),c,d)}catch(h){c.error(h)}return a.getPromise()},every:function(a,b,c,d){this._checkOperation("every");var e=this;a&&(e=this.filter(a,b));var e=e.take(1),a=new $data.PromiseHandler,
c=a.createCallback(c),b=Container.createEveryExpression(e.expression),f=Container.createQueryExpressionCreator(e.entityContext);try{var g=f.Visit(b);this.entityContext.log({event:"EntityExpression",data:g});e.entityContext.executeQuery(Container.createQueryable(e,g),c,d)}catch(h){c.error(h)}return a.getPromise()},take:function(a){this._checkOperation("take");a=Container.createConstantExpression(a,"number");a=Container.createPagingExpression(this.expression,a,$data.Expressions.ExpressionType.Take);
return Container.createQueryable(this,a)},skip:function(a){this._checkOperation("skip");a=Container.createConstantExpression(a,"number");a=Container.createPagingExpression(this.expression,a,$data.Expressions.ExpressionType.Skip);return Container.createQueryable(this,a)},order:function(a){return a===""||a===void 0||a===null?this:a[0]==="-"?this.orderByDescending("it."+a.replace("-","")):this.orderBy("it."+a)},orderBy:function(a,b){this._checkOperation("orderBy");var c=Container.createCodeExpression(a,
b),c=Container.createOrderExpression(this.expression,c,$data.Expressions.ExpressionType.OrderBy);return Container.createQueryable(this,c)},orderByDescending:function(a,b){this._checkOperation("orderByDescending");var c=Container.createCodeExpression(a,b),c=Container.createOrderExpression(this.expression,c,$data.Expressions.ExpressionType.OrderByDescending);return Container.createQueryable(this,c)},first:function(a,b,c,d){this._checkOperation("first");var e=this;a&&(e=this.filter(a,b));var e=e.take(1),
a=new $data.PromiseHandler,c=a.createCallback(c),b=Container.createFirstExpression(e.expression),f=Container.createQueryExpressionCreator(e.entityContext);try{var g=f.Visit(b);e.entityContext.log({event:"EntityExpression",data:g});e.entityContext.executeQuery(Container.createQueryable(e,g),c,d)}catch(h){c.error(h)}return a.getPromise()},find:function(a,b,c){var d=new $data.PromiseHandler,b=d.createCallback(b),e=this.defaultType.memberDefinitions.getKeyProperties();try{if(e.length===1&&typeof a!==
"object"){var f={};f[e[0].name]=a;a=f}if(typeof a!=="object")throw new Exception("Key parameter is invalid");for(var f=[],g=0;g<e.length;g++){var h=e[g];if(!(h.name in a))throw new Exception("Key value missing");f.push(Container.createConstantExpression(a[h.name],h.type,h.name))}if(this.entityContext.storageProvider.supportedSetOperations.find){var i=Container.createFindExpression(this.expression,f),j=Container.createQueryExpressionCreator(this.entityContext);try{var l=j.Visit(i);this.entityContext.log({event:"EntityExpression",
data:l});this.entityContext.executeQuery(Container.createQueryable(this,l),b,c)}catch(w){b.error(w)}}else{a="";h={};for(g=0;g<f.length;g++){var q=f[g];h[q.name]=q.value;g>0&&(a=a+" && ");a=a+("it."+q.name+" == this."+q.name)}this.single(a,h,b,c)}}catch(p){b.error(p)}return d.getPromise()},include:function(a){this._checkOperation("include");a=Container.createConstantExpression(a,"string");a=Container.createIncludeExpression(this.expression,a);return Container.createQueryable(this,a)},withInlineCount:function(a){this._checkOperation("withInlineCount");
a=Container.createConstantExpression(a||"allpages","string");a=Container.createInlineCountExpression(this.expression,a);return Container.createQueryable(this,a)},removeAll:function(a,b){this._checkOperation("batchDelete");var c=new $data.PromiseHandler,d=c.createCallback(a),e=Container.createBatchDeleteExpression(this.expression),f=Container.createQueryExpressionCreator(this.entityContext);try{var g=f.Visit(e);this.entityContext.log({event:"EntityExpression",data:g});this.entityContext.executeQuery(Container.createQueryable(this,
g),d,b)}catch(h){d.error(h)}return c.getPromise()},_runQuery:function(a,b){var c=new $data.PromiseHandler,d=c.createCallback(a),e=Container.createQueryExpressionCreator(this.entityContext);try{var f=e.Visit(this.expression);this.entityContext.log({event:"EntityExpression",data:f});this.entityContext.executeQuery(Container.createQueryable(this,f),d,b)}catch(g){d.error(g)}return c.getPromise()},toTraceString:function(a){var b=this.expression,b=a?Container["create"+a+"Expression"](b):Container.createToArrayExpression(b),
b=Container.createQueryExpressionCreator(this.entityContext).Visit(b),a=Container.createQueryable(this,b);return a.entityContext.getTraceString(a)},_checkOperation:function(a){var b=this.entityContext.resolveSetOperations(a);b.invokable!=void 0&&!b.invokable&&Guard.raise(new Exception("Operation '"+a+"' is not invokable with the provider"))},defaultType:{}},null);$data.EntitySchemaConfig=function(){this.Name=""};$data.entitySetState={created:0,defined:1,active:2};
$data.Class.defineEx("$data.EntitySet",[{type:$data.Queryable,params:[new ConstructorParameter(1)]}],null,{constructor:function(a,b,c,d,e){this.createNew=this[a.name]=this.elementType=this.defaultType=a;var f=this;b["createAdd"+a.name]=function(b){b=new a(b);return f.add(b)};this.stateManager=new $data.EntityStateManager(this);this.collectionName=c;this.roles=e;for(var g in d)this[g]=d[g]},addNew:function(a,b){$data.typeSystem.createCallbackSetting(b);var c=new this.createNew(a);this.entityContext.saveChanges(b);
return c},executeQuery:function(a,b){var c=$data.typeSystem.createCallbackSetting(b);this.entityContext.executeQuery(a,c)},getTraceString:function(a){return this.entityContext.getTraceString(a)},setContext:function(a){this.entitySetState=$data.entitySetState.active;this.entityContext=a;this.entityContext[this.schema.name]=this[this.schema.name]},_trackEntity:function(a){for(var b=this.entityContext.stateManager.trackedEntities,c=0;c<b.length;c++)if(b[c].data===a)return;b.push({entitySet:this,data:a})},
add:function(a){var b=a;a instanceof $data.EntityWrapper?b=a.getEntity():a instanceof this.createNew||(b=new this.createNew(a));b.entityState=$data.EntityState.Added;b.changedProperties=void 0;b.context=this.entityContext;this._trackEntity(b);return b},addMany:function(a){var b=[],c=this;a.forEach(function(a){b.push(c.add(a))});return b},remove:function(a){var b=a;a instanceof $data.EntityWrapper?b=a.getEntity():a instanceof this.createNew||(b=new this.createNew(a));b.entityState=$data.EntityState.Deleted;
b.changedProperties=void 0;this._trackEntity(b)},attach:function(a,b){var c=a;a instanceof $data.EntityWrapper?c=a.getEntity():a instanceof this.createNew||(c=new this.createNew(a));for(var d=0;d<this.entityContext.stateManager.trackedEntities.length;d++){var e=this.entityContext.stateManager.trackedEntities[d];if(e.data===c)break;e.data.equals(c)&&Guard.raise(new Exception("Context already contains this entity!!!"))}if(!b){c.entityState=$data.EntityState.Unchanged;c.changedProperties=void 0}c.context=
this.entityContext;this._trackEntity(c)},detach:function(a){var b=a;a instanceof $data.EntityWrapper?b=a.getEntity():a instanceof this.createNew||(b=new this.createNew(a));for(var c,d=this.entityContext.stateManager.trackedEntities,e=0;e<d.length;e++)d[e].data.equals(b)&&(c=d[e]);if(c){b=this.entityContext.stateManager.trackedEntities.indexOf(c);a.entityState=$data.EntityState.Detached;this.entityContext.stateManager.trackedEntities.splice(b,1)}},attachOrGet:function(a){var b=a;a instanceof $data.EntityWrapper?
b=a.getEntity():a instanceof this.createNew||(b=new this.createNew(a));for(var c,a=this.entityContext.stateManager.trackedEntities,d=0;d<a.length;d++)a[d].data.equals(b)&&(c=a[d]);if(c)return c.data;b.entityState=$data.EntityState.Unchanged;b.changedProperties=void 0;b.context=this.entityContext;this._trackEntity(b);return b},loadItemProperty:function(a,b,c){return this.entityContext.loadItemProperty(a,b,c)},saveChanges:function(){return this.entityContext.saveChanges.apply(this.entityContext,arguments)},
addProperty:function(a,b,c){return this.elementType.addProperty.apply(this.elementType,arguments)},expression:{get:function(){if(!this._expression){var a=Container.createEntityContextExpression(this.entityContext),b=this.entityContext.getType().getMemberDefinition(this.collectionName);this._expression=Container.createEntitySetExpression(a,Container.createMemberInfoExpression(b),null,this)}return this._expression},set:function(a){this._expression=a}},getFieldUrl:function(a,b){return this.entityContext.getFieldUrl(a,
b,this)},bulkInsert:function(a,b,c){return this.entityContext.bulkInsert(this,a,b,c)}},null);$data.EntityState={Detached:0,Unchanged:10,Added:20,Modified:30,Deleted:40};$data.Class.define("$data.EntityStateManager",null,null,{constructor:function(a){this.entityContext=null;this.trackedEntities=[];this.init(a)},init:function(a){this.entityContext=a},reset:function(){this.trackedEntities=[]}},null);
$data.Class.define("$data.ItemStoreClass",null,null,{constructor:function(){var a=this;a.itemStoreConfig={aliases:{},contextTypes:{}};a.resetStoreToDefault("local",true);$data.addStore=function(){return a.addItemStoreAlias.apply(a,arguments)};$data.implementation=a.implementation;$data.Entity.addMember("storeToken",{get:function(){if(this.storeConfigs&&this.storeConfigs["default"])return this.storeConfigs.stores[this.storeConfigs["default"]]},set:function(b){a._setTypeStoreConfig(this,"default",b)}},
true)},itemStoreConfig:{},addItemStoreAlias:function(a,b,c){var d=this,e=new $data.PromiseHandler,f=e.createCallback();if("string"===typeof a){if("object"===typeof b&&"factory"in b){var g=Container.resolveType(b.typeName);d.itemStoreConfig.aliases[a]=b.factory;d.itemStoreConfig.contextTypes[a]=g;c&&(d.itemStoreConfig["default"]=a);f.success();return e.getPromise()}if("function"===typeof b){if((g=b())&&g instanceof $data.EntityContext){f.success(g);g=e.getPromise()}return g.then(function(g){if(typeof g===
"function")return d.addItemStoreAlias(a,g,c);if(g instanceof $data.EntityContext)return g.onReady().then(function(e){d.itemStoreConfig.aliases[a]=b;d.itemStoreConfig.contextTypes[a]=e.getType();c&&(d.itemStoreConfig["default"]=a);return e});e=new $data.PromiseHandler;f=e.createCallback();f.error(new Exception("factory dont have context instance","Invalid arguments"));return e.getPromise()})}}f.error(new Exception("Name or factory missing","Invalid arguments"));return e.getPromise()},resetStoreToDefault:function(a,
b){this.itemStoreConfig.aliases[a]=this._getDefaultItemStoreFactory;delete this.itemStoreConfig.contextTypes[a];b&&(this.itemStoreConfig["default"]=a)},_setStoreAlias:function(a,b){if("object"===typeof b&&!a.storeToken)a.storeToken=b;return a},_getStoreAlias:function(a,b){var c;if(a instanceof $data.Entity){if(c=b||a.storeToken)return c;c=a.getType()}else c=a;return b||(c.storeConfigs?c.storeConfigs["default"]:void 0)||c.storeToken},_getStoreContext:function(a,b,c){a=this._getContextPromise(a,b);
if(!a||a instanceof $data.EntityContext){b=new $data.PromiseHandler;b.createCallback().success(a);a=b.getPromise()}return a.then(function(a){if(a instanceof $data.EntityContext)return a.onReady();if(c)return null;a=new $data.PromiseHandler;a.createCallback().error(new Exception("factory return type error","Error"));return a.getPromise()})},_getContextPromise:function(a,b){if(a&&"object"===typeof a&&"function"===typeof a.factory)return a.factory(b);if(a&&"object"===typeof a&&"object"===typeof a.args&&
"string"===typeof a.typeName){b=Container.resolveType(a.typeName);return new b(JSON.parse(JSON.stringify(a.args)))}return a&&"string"===typeof a&&b.storeConfigs&&b.storeConfigs.stores[a]&&typeof b.storeConfigs.stores[a].factory==="function"?b.storeConfigs.stores[a].factory():a&&"string"===typeof a&&b.storeConfigs&&b.storeConfigs.stores[a]?this._getDefaultItemStoreFactory(b,b.storeConfigs.stores[a]):a&&"string"===typeof a&&this.itemStoreConfig.aliases[a]?this.itemStoreConfig.aliases[a](b):a&&"function"===
typeof a?a():this.itemStoreConfig.aliases[this.itemStoreConfig["default"]](b)},_getStoreEntitySet:function(a,b){var c=this._getStoreAlias(b,a),d="function"===typeof b?b:b.getType();return this._getStoreContext(c,d).then(function(a){a=a.getEntitySetFromElementType(d);if(!a){a=new $data.PromiseHandler;a.createCallback().error("EntitySet not exist for "+d.fullName);return a.getPromise()}return a})},_getDefaultItemStoreFactory:function(a,b){if(a){var c="function"===typeof a?a:a.getType(),d=$data.Container.resolveName(c)+
"_items",d=d.replace(/\./g,"_"),e=$data.typeSystem.extend({collectionName:b&&b.collectionName?b.collectionName:"Items",tableName:d,initParam:{provider:"local",databaseName:d}},b),f={};f[e.collectionName]={type:$data.EntitySet,elementType:c};if(e.tableName)f[e.collectionName].tableName=e.tableName;c=new ($data.EntityContext.extend(d,f))(e.initParam);if(b&&typeof b==="object")b.factory=c._storeToken.factory;return c}},implementation:function(a,b){var c=$data.ItemStore,d;typeof b==="string"?b=c.itemStoreConfig.contextTypes[b]:
b instanceof $data.EntityContext?b=b.getType():typeof b==="function"&&b.isAssignableTo||(b=c.itemStoreConfig.contextTypes[c.itemStoreConfig["default"]]);b&&(d=c._resolveFromContext(b,a));d||(d=Container.resolveType(a));return d},_resolveFromContext:function(a,b){for(var c=a.memberDefinitions.getPublicMappedProperties(),d=0;d<c.length;d++){var e=c[d];if(e.type){var f=Container.resolveType(e.type);if(f.isAssignableTo&&f.isAssignableTo($data.EntitySet)){e=Container.resolveType(e.elementType);if(e.name===
b)return e}}}return null},EntityInstanceSave:function(a,b){var c=$data.ItemStore,d=this;return c._getStoreEntitySet(a,d).then(function(e){return c._getSaveMode(d,e,b,a).then(function(a){a=a||"add";switch(a){case "add":e.add(d);break;case "attach":e.attach(d,true);d.entityState=$data.EntityState.Modified;break;default:var b=new $data.PromiseHandler;b.createCallback().error("save mode not supported: "+a);return b.getPromise()}return e.entityContext.saveChanges().then(function(){c._setStoreAlias(d,e.entityContext.storeToken);
return d})})})},EntityInstanceRemove:function(a){var b=this;return $data.ItemStore._getStoreEntitySet(a,b).then(function(a){a.remove(b);return a.entityContext.saveChanges().then(function(){return b})})},EntityInstanceRefresh:function(a,b){var c=$data.ItemStore,d=this,e=d.getType(),c=c._getKeyObjectFromEntity(d,e);return e.read(c,a).then(function(a){e.memberDefinitions.getPublicMappedProperties().forEach(function(b){d[b.name]=a[b.name]});d.storeToken=(b?d.storeToken:void 0)||a.storeToken;d.changedProperties=
void 0;return d})},EntityInheritedTypeProcessor:function(a){var b=$data.ItemStore;a.readAll=b.EntityTypeReadAll(a);a.read=b.EntityTypeRead(a);a.removeAll=b.EntityTypeRemoveAll(a);a.remove=b.EntityTypeRemove(a);a.get=b.EntityTypeGet(a);a.save=b.EntityTypeSave(a);a.addMany=b.EntityTypeAddMany(a);a.itemCount=b.EntityTypeItemCount(a);a.query=b.EntityTypeQuery(a);a.takeFirst=b.EntityTypeTakeFirst(a);a.setStore=b.EntityTypeSetStore(a)},EntityTypeReadAll:function(a){return function(b){var c=$data.ItemStore;
return c._getStoreEntitySet(b,a).then(function(a){return a.forEach(function(b){c._setStoreAlias(b,a.entityContext.storeToken)})})}},EntityTypeRemoveAll:function(a){return function(b){return $data.ItemStore._getStoreEntitySet(b,a).then(function(a){return a.toArray().then(function(b){b.forEach(function(b){a.remove(b)});return a.entityContext.saveChanges().then(function(){return b})})})}},EntityTypeRead:function(a){return function(b,c){var d=$data.ItemStore;return d._getStoreEntitySet(c,a).then(function(a){try{var c=
d._findByIdQueryable(a,b);return a.single(c.predicate,c.thisArgs).then(function(b){return d._setStoreAlias(b,a.entityContext.storeToken)})}catch(g){c=new $data.PromiseHandler;c.createCallback().error(g);return c.getPromise()}})}},EntityTypeGet:function(a){return function(b,c){var d=new a($data.ItemStore._getKeyObjectFromEntity(b));d.refresh(c);return d}},EntityTypeSave:function(a){return function(b,c,d){return(new a(b)).save(c,d)}},EntityTypeAddMany:function(a){return function(b,c){return $data.ItemStore._getStoreEntitySet(c,
a).then(function(a){var c=a.addMany(b);return a.entityContext.saveChanges().then(function(){return c})})}},EntityTypeRemove:function(a){return function(b,c){var d=a.memberDefinitions.getKeyProperties();if(d.length===1){var e={};e[d[0].name]=b;d=new a(e)}else d=new a(b);return d.remove(c)}},EntityTypeItemCount:function(a){return function(b){return $data.ItemStore._getStoreEntitySet(b,a).then(function(a){return a.length()})}},EntityTypeQuery:function(a){return function(b,c,d){var e=$data.ItemStore;
return e._getStoreEntitySet(d,a).then(function(a){return a.filter(b,c).forEach(function(b){e._setStoreAlias(b,a.entityContext.storeToken)})})}},EntityTypeTakeFirst:function(a){return function(b,c,d){var e=$data.ItemStore;return e._getStoreEntitySet(d,a).then(function(a){return a.first(b,c).then(function(b){return e._setStoreAlias(b,a.entityContext.storeToken)})})}},EntityTypeSetStore:function(a){return function(b,c){if(typeof b==="object"&&typeof c==="undefined"){c=b;b="default"}var d=$data.ItemStore,
e={};if(c){if(c.tableName){e.tableName=c.tableName;delete c.tableName}if(c.collectionName){e.collectionName=c.collectionName;delete c.collectionName}if(typeof c.dataSource==="string"){var f=c.dataSource;f.lastIndexOf("/")===f.length-1&&(f=f.substring(0,f.lastIndexOf("/")));var g=f.substring(0,f.lastIndexOf("/"));if(!e.tableName)e.tableName=f.substring(f.lastIndexOf("/")+1);switch(c.provider||c.name){case "oData":c.oDataServiceHost=c.oDataServiceHost||g;break;case "webApi":c.apiUrl=c.apiUrl||g}}}else c=
{name:"local"};e.initParam=c;d._setTypeStoreConfig(a,b,e);return a}},_setTypeStoreConfig:function(a,b,c){if(!a.storeConfigs)a.storeConfigs={stores:{}};a.storeConfigs.stores[b]=c;b==="default"&&(a.storeConfigs["default"]=b)},_findByIdQueryable:function(a,b){var c=a.defaultType.memberDefinitions.getKeyProperties();if(c.length>1&&b&&"object"===typeof b){for(var d="",e={},f=0;f<c.length;f++){f>0&&(d=d+" && ");var g=c[f],d=d+("it."+g.name+" == this."+g.name);e[g.name]=b[g.name]}return{predicate:d,thisArgs:e}}if(c.length===
1)return{predicate:"it."+c[0].name+" == this.value",thisArgs:{value:b}};throw"invalid keys";},_getKeyObjectFromEntity:function(a,b){var c,d=b.memberDefinitions.getKeyProperties();if(d.length===1)c=a&&typeof a==="object"?a[d[0].name]:a;else{c={};for(var e=0;e<d.length;e++)c[d[0].name]=a?a[d[0].name]:a}return c},_getSaveMode:function(a,b,c,d){var b=new $data.PromiseHandler,e=b.createCallback(),f=a.getType();switch(true){case c==="update":e.success("attach");break;case c==="new":e.success("add");break;
case false===f.memberDefinitions.getKeyProperties().every(function(b){return a[b.name]}):e.success("add");break;case !!a.storeToken:e.success("attach");break;default:d=this._getStoreAlias(a,d);f.read(this._getKeyObjectFromEntity(a,f),d).then(function(){e.success("attach")}).fail(function(){e.success("add")})}return b.getPromise()},ContextRegister:function(a){var b=this,c=JSON.parse(JSON.stringify(a));this.storeToken={typeName:this.getType().fullName,args:c,factory:function(){return new (b.getType())(c)}};
for(var a=this.getType().memberDefinitions.getPublicMappedProperties(),d=0;d<a.length;d++){var e=a[d];if(e.type){var f=Container.resolveType(e.type);if(f&&f.isAssignableTo&&f.isAssignableTo($data.EntitySet)){e=Container.resolveType(e.elementType);if(!e.storeToken)e.storeToken=this.storeToken}}}},QueryResultModifier:function(a){var b=$data.ItemStore,c=a.context,d=a.modelBinderConfig.$type;"string"===typeof d&&(d=Container.resolveType(d));if(d===$data.Array&&a.modelBinderConfig.$item&&a.modelBinderConfig.$item.$type)d=
a.modelBinderConfig.$item.$type;if(typeof d==="undefined"&&a.result&&a.result[0]instanceof $data.Entity)for(var d=!d?[]:d.memberDefinitions.getPublicMappedProperties().filter(function(a){return!!a.inverseProperty}),e=0;e<a.result.length;e++){b._setStoreAlias(a.result[e],c.storeToken);for(var f=0;f<d.length;f++){var g=d[f];if(a.result[e][g.name]instanceof $data.Entity)b._setStoreAlias(a.result[e][g.name],c.storeToken);else if(Array.isArray(a.result[e][g.name]))for(var h=0;h<a.result[e][g.name].length;h++)a.result[e][g.name][h]instanceof
$data.Entity&&b._setStoreAlias(a.result[e][g.name][h],c.storeToken)}}}});$data.ItemStore=new $data.ItemStoreClass;$data.Entity.addMember("field",function(a){var b=this.memberDefinitions.getMember(a);if(b){if(b.definedBy===this)return new $data.MemberWrapper(b);Guard.raise(new Exception("Member '"+a+"' defined on '"+b.definedBy.fullName+"'!","Invalid Operation"))}else Guard.raise(new Exception("Member '"+a+"' not exists!","Invalid Operation"));return this},!0);
$data.Class.define("$data.MemberWrapper",null,null,{constructor:function(a){this.memberDefinition=a},setKey:function(a){this.memberDefinition.key=a||a===void 0?true:false;return this},setComputed:function(a){this.memberDefinition.computed=a||a===void 0?true:false;return this},setRequired:function(a){this.memberDefinition.required=a||a===void 0?true:false;return this},setNullable:function(a){this.memberDefinition.nullable=a||a===void 0?true:false;return this},changeDefinition:function(a,b){this.memberDefinition[a]=
b;return this}});
$data.Class.define("$data.StorageProviderLoaderBase",null,null,{isSupported:function(a){$data.Trace.log("Detecting "+a+" provider support");var b=true;switch(a){case "indexedDb":b=window.indexedDB||window.webkitIndexedDB||window.mozIndexedDB||window.msIndexedDB&&!/^file:/.test(window.location.href);break;case "storm":b="XMLHttpRequest"in window;break;case "webSql":case "sqLite":b="openDatabase"in window;break;case "LocalStore":b="localStorage"in window&&window.localStorage?true:false;break;case "sqLite":b=
"openDatabase"in window;break;case "mongoDB":b=$data.mongoDBDriver}$data.Trace.log(a+" provider is "+(b?"":"not")+" supported");return b},scriptLoadTimeout:{type:"int",value:1E3},scriptLoadInterval:{type:"int",value:50},npmModules:{value:{indexedDb:"jaydata-indexeddb",InMemory:"jaydata-inmemory",LocalStore:"jaydata-inmemory",mongoDB:"jaydata-mongodb",oData:"jaydata-odata",webApi:"jaydata-webapi",sqLite:"jaydata-sqlite",webSql:"jaydata-sqlite",storm:"jaydata-storm"}},ProviderNames:{value:{indexedDb:"IndexedDb",
InMemory:"InMemory",LocalStore:"InMemory",oData:"oData",webApi:"WebApi",sqLite:"SqLite",webSql:"SqLite",storm:"Storm"}},load:function(a,b){$data.RegisteredStorageProviders=$data.RegisteredStorageProviders||{};$data.Trace.log("Loading provider(s): "+a);var b=$data.typeSystem.createCallbackSetting(b),c=this,d=a.join(",");c._fallbackCache=c._fallbackCache||{};c._fallbackCache[d]?b.success(c._fallbackCache[d]):this.find(a,{success:function(a){c._fallbackCache[d]=a;b.success.call(this,a)},error:b.error})},
find:function(a,b){var c=a.shift(),c=this.getVirtual(c);if(Array.isArray(c)){a=c;c=a.shift()}for(;c&&!this.isSupported(c);)c=a.shift();$data.Trace.log("First supported provider is "+c);if(!c){$data.Trace.log("Provider fallback failed");b.error()}if($data.RegisteredStorageProviders){$data.Trace.log("Is the "+c+" provider already registered?");var d=$data.RegisteredStorageProviders[c];if(d){$data.Trace.log(c+" provider registered");b.success(d);return}$data.Trace.log(c+" provider not registered")}if(typeof module!==
"undefined"&&typeof module.exports!=="undefined"){$data.Trace.log("node.js detected trying to load NPM module");this.loadNpmModule(c,a,b)}else{$data.Trace.log("Browser detected trying to load provider");this.loadProvider(c,a,b)}},loadProvider:function(a,b,c){var d=this,e=$data.StorageProviderLoader.ProviderNames[a]||a;$data.Trace.log(a+" provider is mapped to name "+e+"Provider");if(e){e=this.getUrl(e);$data.Trace.log(a+" provider from URL: "+e);var f=this.loadScript;if(document&&document.createElement){$data.Trace.log("document and document.createElement detected, using script element loader method");
f=this.loadScriptElement}f.call(this,e,a,function(e){var f=$data.RegisteredStorageProviders[a];if(e&&f){$data.Trace.log(a+" provider successfully registered");c.success(f)}else if(b.length>0){$data.Trace.log(a+" provider failed to load, trying to fallback to "+b+" provider(s)");d.find(b,c)}else{$data.Trace.log(a+" provider failed to load");c.error()}})}},getUrl:function(a){var b=document.querySelector('script[src$="jaydata.min.js"]'),c=document.querySelector('script[src$="jaydata.js"]');return b?
b.src.substring(0,b.src.lastIndexOf("/")+1)+"jaydataproviders/"+a+"Provider.min.js":c?c.src.substring(0,c.src.lastIndexOf("/")+1)+"jaydataproviders/"+a+"Provider.js":"jaydataproviders/"+a+"Provider.js"},loadScript:function(a,b,c){if(a){var d;if(window.XMLHttpRequest)d=new XMLHttpRequest;else if(window.ActiveXObject)d=new ActiveXObject("MsXml2.XmlHttp");else{$data.Trace.log("XMLHttpRequest or MsXml2.XmlHttp ActiveXObject not found");c(false);d=void 0}d.onreadystatechange=function(){$data.Trace.log("HTTP request is in state: "+
d.readyState);if(d.readyState==4)if(d.status==200||d.status==304){$data.Trace.log("HTTP request succeeded");$data.Trace.log("HTTP request response text: "+d.responseText);eval.call(window,d.responseText);typeof c==="function"?c(true):$data.Trace.log("Callback function is undefined")}else{$data.Trace.log("HTTP request status: ",d.status);typeof c==="function"?c(false):$data.Trace.log("Callback function is undefined")}};d.open("GET",a,true);d.send(null)}else c(false)},loadScriptElement:function(a,b,
c){function d(){$data.Trace.log("Script element watcher iteration "+h);if($data.RegisteredStorageProviders[b]){$data.Trace.log(b+" provider registered");c(true)}else{h--;if(h>0){$data.Trace.log("Script element watcher next iteration");setTimeout(d,g)}else{$data.Trace.log("Script element loader failed");c(false)}}}var e=document.getElementsByTagName("head")[0]||document.documentElement,f=document.createElement("script");f.type="text/javascript";f.src=a;$data.Trace.log("Appending child "+f+" to "+e);
e.appendChild(f);var g=this.scriptLoadInterval||50,h=Math.ceil(this.scriptLoadTimeout/g);$data.Trace.log("Script element watcher iterating "+h+" times");setTimeout(d,g)},loadNpmModule:function(a,b,c){var d=null;try{require(this.npmModules[a]);d=$data.RegisteredStorageProviders[a];$data.Trace.log("NPM module loader successfully registered "+a+" provider")}catch(e){$data.Trace.log("NPM module loader failed for "+a+" provider")}d?c.success(d):b.length>0?this.find(b,c):c.error()},virtualProviders:{type:$data.Array,
value:{local:{fallbacks:["webSql","indexedDb","LocalStore"]}}},getVirtual:function(a){return this.virtualProviders[a]?[].concat(this.virtualProviders[a].fallbacks):a}});$data.StorageProviderLoader=new $data.StorageProviderLoaderBase;$data.storageProviders={DbCreationType:{Merge:10,DropTableIfChanged:20,DropTableIfChange:20,DropAllExistingTables:30,ErrorIfChange:40,DropDbIfChange:50}};$data.ConcurrencyMode={Fixed:"fixed",None:"none"};
$data.Class.define("$data.StorageProviderBase",null,null,{constructor:function(a){this.providerConfiguration=a||{};this.name=this.getType().name;if($data.RegisteredStorageProviders)for(var a=Object.keys($data.RegisteredStorageProviders),b=0;b<a.length;b++)if(this instanceof $data.RegisteredStorageProviders[a[b]]){this.name=a[b];break}},providers:{},supportedDataTypes:{value:[],writable:!1},initializeStore:function(){Guard.raise("Pure class")},executeQuery:function(){Guard.raise("Pure class")},loadRawData:function(a,
b){b=$data.typeSystem.createCallbackSetting(b);b.error(new Exception("loadRawData is not supported","Invalid Operation"))},buildIndependentBlocks:function(a){for(var b=[],c=[],d=0;d<a.length;d++){var e=a[d];if(e.dependentOn&&e.dependentOn.length!=0){for(var f=null,g=0;g<e.dependentOn.length;g++){var h=e.dependentOn[g];if(h.entityState!=$data.EntityState.Unchanged){for(var f=f||{},i=-1,j=0;j<a.length;j++)if(a[j].data==h){i=j;break}i==-1&&Guard.raise(new Exception("Dependent object not found","ObjectNotFound",
e.dependentOn[g]));f[i]=true;from=c[i]||{};from[d]=true;c[i]=from}}f!==null&&(b[d]=f)}}d=[];e=[];for(f=0;f<a.length;f++)b.hasOwnProperty(f)||e.push(f);for(;e.length>0;){f=[].concat(e);e=[];for(g=0;g<f.length;g++){h=c[f[g]];if(typeof h!=="undefined")for(var l in h){delete b[l][f[g]];a:{i=b[l];j=void 0;for(j in i)if(i.hasOwnProperty(j)){i=true;break a}i=false}if(!i){delete b[l];e.push(l)}}delete c[f[g]]}g=[];for(h=0;h<f.length;h++){i=a[f[h]];i.data.entityState!=$data.EntityState.Unchanged&&g.push(i)}g.length>
0&&d.push(g)}return d},getTraceString:function(){Guard.raise("Pure class")},setContext:function(a){this.context=a},_buildContinuationFunction:function(a,b){if(Array.isArray(b.result)){b.result.next=this._buildPagingMethod(a,b,"next");b.result.prev=this._buildPagingMethod(a,b,"prev")}},_buildPagingMethod:function(a,b,c){return function(d){var e=new $data.PromiseHandler,d=e.createCallback(d),f=(new $data.Expressions.ContinuationExpressionBuilder(c)).compile(b);if(f.expression){f=Container.createQueryable(a,
f.expression);f.defaultType=b.defaultType;a.executeQuery(f,d)}else d.error(new Exception(f.message,"Invalid Operation",f));return e.getPromise()}},buildDbType_modifyInstanceDefinition:function(a,b){var c=function(b,c){var d;if(c){d=JSON.parse(JSON.stringify(a[c]));d.kind=b.kind;d.name=b.name;d.notMapped=false}else d=JSON.parse(JSON.stringify(b));d.dataType=Container.resolveType(b.dataType);d.type=d.dataType;d.key=false;d.computed=false;return d},d=function(a,b,c,d){var i={};i[a.name]=c;i[b.name]=
d+"__"+c;return i};b.Associations&&b.Associations.forEach(function(b){var f=false,g=b.FromType,h=b.ToType,i=b.ToPropertyName;b.ReferentialConstraint=b.ReferentialConstraint||[];if(b.FromMultiplicity=="*"&&b.ToMultiplicity=="0..1"||b.FromMultiplicity=="0..1"&&b.ToMultiplicity=="1"){g=b.ToType;h=b.FromType;i=b.FromPropertyName;f=true}g.memberDefinitions.getPublicMappedProperties().filter(function(a){return a.key}).forEach(function(j){f&&(a[i+"__"+j.name]=c(j,i));b.ReferentialConstraint.push(d(g,h,j.name,
i))},this)},this);b.ComplexTypes&&b.ComplexTypes.forEach(function(b){b.ReferentialConstraint=b.ReferentialConstraint||[];b.ToType.memberDefinitions.getPublicMappedProperties().forEach(function(f){a[b.FromPropertyName+"__"+f.name]=c(f);b.ReferentialConstraint.push(d(b.ToType,b.FromType,f.name,b.FromPropertyName))},this)},this)},buildDbType_generateConvertToFunction:function(a){return function(b){var c=new a.PhysicalType;c.entityState=b.entityState;a.PhysicalType.memberDefinitions.getPublicMappedProperties().forEach(function(a){b[a.name]!==
void 0&&(c[a.name]=b[a.name])},this);a.Associations&&a.Associations.forEach(function(a){if(a.FromMultiplicity=="*"&&a.ToMultiplicity=="0..1"||a.FromMultiplicity=="0..1"&&a.ToMultiplicity=="1"){var e=b[a.FromPropertyName];e!==void 0&&a.ReferentialConstraint.forEach(function(b){c[b[a.From]]=e!==null?e[b[a.To]]:null},this)}},this);a.ComplexTypes&&a.ComplexTypes.forEach(function(a){var e=b[a.FromPropertyName];e!==void 0&&a.ReferentialConstraint.forEach(function(b){c[b[a.From]]=e!==null?e[b[a.To]]:null},
this)},this);return c}},bulkInsert:function(a,b,c,d){d.error(new Exception("Not Implemented"))},supportedFieldOperations:{value:{length:{dataType:"number",allowedIn:"filter, map"},substr:{dataType:"string",allowedIn:"filter",parameters:[{name:"startFrom",dataType:"number"},{name:"length",dataType:"number"}]},toLowerCase:{dataType:"string"}},enumerable:!0,writable:!0},resolveFieldOperation:function(a,b,c){var d=this.supportedFieldOperations[a];if(Array.isArray(d)){for(var e=0;e<d.length;e++)if(d[e].allowedType===
"default"||Container.resolveType(d[e].allowedType)===Container.resolveType(b.selector.memberDefinition.type)&&c&&d[e].allowedIn&&(Array.isArray(d[e].allowedIn)&&d[e].allowedIn.some(function(a){return c===Container.resolveType(a)})||!Array.isArray(d[e].allowedIn)&&c===Container.resolveType(d[e].allowedIn))){d=d[e];break}e===d.length&&(d=void 0)}d||Guard.raise(new Exception("Field operation '"+a+"' is not supported by the provider"));c&&d.allowedIn&&(d.allowedIn instanceof Array&&!d.allowedIn.some(function(a){return c===
Container.resolveType(a)})||!(d.allowedIn instanceof Array)&&c!==Container.resolveType(d.allowedIn))&&Guard.raise(new Exception(a+" not supported in: "+c.name));d.name=a;return d},supportedBinaryOperators:{value:{equal:{mapTo:"eq",dataType:"boolean"}},enumerable:!0,writable:!0},resolveBinaryOperator:function(a,b,c){(b=this.supportedBinaryOperators[a])||Guard.raise(new Exception("Binary operator '"+a+"' is not supported by the provider"));c&&b.allowedIn&&(b.allowedIn instanceof Array&&!b.allowedIn.some(function(a){return c===
Container.resolveType(a)})||!(b.allowedIn instanceof Array)&&c!==Container.resolveType(b.allowedIn))&&Guard.raise(new Exception(a+" not supported in: "+c.name));b.name=a;return b},supportedUnaryOperators:{value:{not:{mapTo:"not"}},enumerable:!0,writable:!0},resolveUnaryOperator:function(a,b,c){(b=this.supportedUnaryOperators[a])||Guard.raise(new Exception("Unary operator '"+a+"' is not supported by the provider"));c&&b.allowedIn&&(b.allowedIn instanceof Array&&!b.allowedIn.some(function(a){return c===
Container.resolveType(a)})||!(b.allowedIn instanceof Array)&&c!==Container.resolveType(b.allowedIn))&&Guard.raise(new Exception(a+" not supported in: "+c.name));b.name=a;return b},supportedSetOperations:{value:{toArray:{invokable:!0,allowedIn:[]}},enumerable:!0,writable:!0},resolveSetOperations:function(a,b,c){(b=this.supportedSetOperations[a])||Guard.raise(new Exception("Operation '"+a+"' is not supported by the provider"));var d=b.allowedIn||[];c&&d&&(d instanceof Array&&!d.some(function(a){return c===
Container.resolveType(a)})||!(d instanceof Array)&&c!==Container.resolveType(d))&&Guard.raise(new Exception(a+" not supported in: "+c.name));return b},resolveTypeOperations:function(a,b){Guard.raise(new Exception("Entity '"+b.entityType.name+"' Operation '"+a+"' is not supported by the provider"))},resolveContextOperations:function(a,b){Guard.raise(new Exception("Context '"+b.instance.getType().name+"' Operation '"+a+"' is not supported by the provider"))},makePhysicalTypeDefinition:function(){},
_beginTran:function(a,b,c){c.success(new $data.Transaction)},getFieldUrl:function(){return"#"},supportedAutoincrementKeys:{value:{}}},{onRegisterProvider:{value:new $data.Event},registerProvider:function(a,b){this.onRegisterProvider.fire({name:a,provider:b},this);$data.RegisteredStorageProviders=$data.RegisteredStorageProviders||[];$data.RegisteredStorageProviders[a]=b},getProvider:function(a){var b=$data.RegisteredStorageProviders[a];b||console.warn("Provider not found: '"+a+"'");return b},isSupported:{get:function(){return true},
set:function(){}}});
$data.Class.define("$data.ServiceOperation",null,null,{},{translateDefinition:function(a,b){a.serviceName=b;var c=new $data.MemberDefinition(this.generateServiceOperation(a),this);c.name=b;return c},generateServiceOperation:function(a){var b;if(a.serviceMethod){b=a.returnType?Container.resolveType(a.returnType):{};b=b.isAssignableTo&&b.isAssignableTo($data.Queryable)?a.serviceMethod:function(){var b=arguments[arguments.length-1],d=new $data.PromiseHandler;if(typeof b==="function"){b=d.createCallback(b);
arguments[arguments.length-1]=b}else{b=d.createCallback();arguments.push(b)}try{var e=a.serviceMethod.apply(this,arguments);e!==void 0&&b.success(e)}catch(f){b.error(f)}return d.getPromise()}}else b=function(){var b=this,d,e;if(this instanceof $data.Entity||this instanceof $data.EntitySet){var f;if(this instanceof $data.Entity)if(this.context){b=this.context;f=b.getEntitySetFromElementType(this.getType())}else if(this.storeToken&&typeof this.storeToken.factory==="function"){b=this.storeToken.factory();
f=b.getEntitySetFromElementType(this.getType())}else{Guard.raise(new Exception("entity can't resolve context","Not Found!",this));return}else if(this instanceof $data.EntitySet){b=this.entityContext;f=this;d=b.getType().getMemberDefinition(f.name);d=$data.MemberDefinition.translateDefinition(d.actions[a.serviceName],a.serviceName,f.getType())}e={data:this,entitySet:f}}f=a.elementType?b.getEntitySetFromElementType(Container.resolveType(a.elementType)):null;var g=null;if(a.params){g=[];if(arguments[0]&&
typeof arguments[0]==="object"&&arguments[0].constructor===$data.Object&&a.params&&a.params[0]&&a.params[0].name in arguments[0])for(var h=arguments[0],i=0;i<a.params.length;i++){var j=a.params[i];j.name&&j.type&&j.name in h&&g.push(Container.createConstantExpression(h[j.name],Container.resolveType(j.type),j.name))}else for(i=0;i<a.params.length;i++){if(typeof arguments[i]=="function")break;j=a.params[i];j.name&&j.type&&arguments[i]!==void 0&&g.push(Container.createConstantExpression(arguments[i],
Container.resolveType(j.type),j.name))}}h=Container.createEntityContextExpression(b);d||(d=e&&e.data?e.data.getType().getMemberDefinition(a.serviceName):b.getType().getMemberDefinition(a.serviceName));d=Container.createServiceOperationExpression(h,Container.createMemberInfoExpression(d),g,a,e);e=arguments[arguments.length-1];typeof e==="function"||typeof e==="object"&&(typeof e.success==="function"||typeof e.error==="function")||(e=void 0);if(f){b=Container.createQueryable(f,d);if(e){d.isTerminated=
true;return b._runQuery(e)}return b}f=a.returnType?Container.resolveType(a.returnType):null;b=Container.createQueryable(b,d);b.defaultType=f||$data.Object;if(f===$data.Queryable){b.defaultType=Container.resolveType(a.elementType);if(e){d.isTerminated=true;return b._runQuery(e)}return b}d.isTerminated=true;return b._runQuery(e)};$data.typeSystem.extend(b,a,{params:a.params||[]});return b}});
$data.Class.define("$data.ServiceAction",$data.ServiceOperation,null,{},{generateServiceOperation:function(a){if(!a.method)a.method="POST";return $data.ServiceOperation.generateServiceOperation.apply(this,arguments)}});$data.Base.extend("$data.EntityWrapper",{getEntity:function(){Guard.raise("pure object")}});"undefined"!==typeof jQuery&&jQuery.ajax&&($data.ajax=$data.ajax||jQuery.ajax);
"undefined"!==typeof WinJS&&WinJS.xhr&&($data.ajax=$data.ajax||function(a){$data.typeSystem.extend(a,{dataType:"json",headers:{}});var b={json:{accept:"application/json, text/javascript",convert:JSON.parse},text:{accept:"text/plain",convert:function(a){return a}},html:{accept:"text/html",convert:function(a){return a}},xml:{accept:"application/xml, text/xml",convert:function(a){return a}}}[a.dataType.toLowerCase()];a.headers.Accept=b.accept;var c=a.success||$data.defaultSuccessCallback,d=a.error||
$data.defaultErrorCallback,e=a.progress;WinJS.xhr(a).done(function(a){a=b.convert(a.responseText);c(a)},function(a){a=b.convert(a.responseText);d(a)},e)});"undefined"!==typeof Ext&&typeof Ext.Ajax&&($data.ajax=$data.ajax||function(a){Ext.Ajax.request(a)});$data.ajax=$data.ajax||function(){$data.typeSystem.createCallbackSetting(arguments[arguments.length-1]).error("Not implemented")};
$C("$data.modelBinder.FindProjectionVisitor",$data.Expressions.EntityExpressionVisitor,null,{VisitProjectionExpression:function(a){this.projectionExpression=a}});
$C("$data.modelBinder.ModelBinderConfigCompiler",$data.Expressions.EntityExpressionVisitor,null,{constructor:function(a,b,c){this._query=a;this._includes=b;this._isoDataProvider=c||false},VisitSingleExpression:function(a){this._defaultModelBinder(a)},VisitSomeExpression:function(a){this._defaultModelBinder(a)},VisitFindExpression:function(a){this._defaultModelBinder(a)},VisitEveryExpression:function(a){this._defaultModelBinder(a)},VisitToArrayExpression:function(a){this._defaultModelBinder(a)},VisitFirstExpression:function(a){this._defaultModelBinder(a)},
VisitForEachExpression:function(a){this._defaultModelBinder(a)},VisitServiceOperationExpression:function(a){if(a.cfg.returnType){var b=Container.resolveType(a.cfg.returnType);if(typeof b.isAssignableTo==="function"&&b.isAssignableTo($data.Queryable)||b===$data.Array)this._defaultModelBinder(a);else{var c=Container.createqueryBuilder();c.modelBinderConfig.$type=b;if(typeof b.isAssignableTo==="function"&&b.isAssignableTo($data.Entity))c.modelBinderConfig.$selector=["json:"+a.cfg.serviceName];else{c.modelBinderConfig.$type=
b;c.modelBinderConfig.$value=function(b,c){return a.cfg.serviceName in c?c[a.cfg.serviceName]:c.value}}this.VisitExpression(a,c);c.resetModelBinderProperty();this._query.modelBinderConfig=c.modelBinderConfig}}},VisitCountExpression:function(){var a=Container.createqueryBuilder();a.modelBinderConfig.$type=$data.Array;a.selectModelBinderProperty("$item");a.modelBinderConfig.$type=$data.Integer;a.modelBinderConfig.$source="cnt";a.resetModelBinderProperty();this._query.modelBinderConfig=a.modelBinderConfig},
VisitBatchDeleteExpression:function(){var a=Container.createqueryBuilder();a.modelBinderConfig.$type=$data.Array;a.selectModelBinderProperty("$item");a.modelBinderConfig.$type=$data.Integer;a.modelBinderConfig.$source="cnt";a.resetModelBinderProperty();this._query.modelBinderConfig=a.modelBinderConfig},VisitConstantExpression:function(a,b){b.modelBinderConfig.$type=a.type;b.modelBinderConfig.$value=a.value},VisitExpression:function(a,b){var c=Container.createFindProjectionVisitor();c.Visit(a);c.projectionExpression?
this.Visit(c.projectionExpression,b):this.DefaultSelection(b,this._query.defaultType,this._includes)},_defaultModelBinder:function(a){var b=Container.createqueryBuilder();b.modelBinderConfig.$type=$data.Array;this._isoDataProvider&&(b.modelBinderConfig.$selector=["json:d.results","json:d","json:results"]);b.modelBinderConfig.$item={};b.selectModelBinderProperty("$item");this.VisitExpression(a,b);b.resetModelBinderProperty();this._query.modelBinderConfig=b.modelBinderConfig},_addPropertyToModelBinderConfig:function(a,
b){var c=this._query.context._storageModel.getStorageModel(a);if(a.memberDefinitions)a.memberDefinitions.getPublicMappedProperties().forEach(function(a){if(!c||c&&!c.Associations[a.name]&&!c.ComplexTypes[a.name]){var e=Container.resolveType(a.dataType);if(!c&&this._query.context.storageProvider.supportedDataTypes.indexOf(e)<0){b.selectModelBinderProperty(a.name);b.modelBinderConfig.$type=e;b.modelBinderConfig.$selector=this._isoDataProvider?["json:"+a.name+".results","json:"+a.name]:"json:"+a.name;
this._addPropertyToModelBinderConfig(e,b);b.popModelBinderProperty()}else{a.key&&b.addKeyField(a.name);if(a.concurrencyMode===$data.ConcurrencyMode.Fixed)b.modelBinderConfig[a.name]={$selector:"json:__metadata",$source:"etag"};else if(e===$data.Array&&a.elementType){b.selectModelBinderProperty(a.name);b.modelBinderConfig.$type=e;b.modelBinderConfig.$selector=this._isoDataProvider?["json:"+a.name+".results","json:"+a.name]:"json:"+a.name;b.selectModelBinderProperty("$item");a=Container.resolveType(a.elementType);
b.modelBinderConfig.$type=a;this._addPropertyToModelBinderConfig(a,b);b.popModelBinderProperty();b.popModelBinderProperty()}else b.modelBinderConfig[a.name]=a.name}}},this);else{b._binderConfig.$item=b._binderConfig.$item||{};b.modelBinderConfig=b._binderConfig.$item}c&&this._addComplexTypeProperties(c.ComplexTypes,b)},_addComplexTypeProperties:function(a,b){a.forEach(function(a){if(a.ToType!==$data.Array){b.selectModelBinderProperty(a.FromPropertyName);b.modelBinderConfig.$type=a.ToType;b.modelBinderConfig.$selector=
this._isoDataProvider?["json:"+a.FromPropertyName+".results","json:"+a.FromPropertyName]:"json:"+a.FromPropertyName;this._addPropertyToModelBinderConfig(a.ToType,b);b.popModelBinderProperty()}else{var d=a.ToType,e=Container.resolveType(a.FromType.memberDefinitions.getMember(a.FromPropertyName).elementType);if(d===$data.Array&&e&&e.isAssignableTo&&e.isAssignableTo($data.Entity)){config={$type:$data.Array,$selector:"json:"+a.FromPropertyName,$item:{$type:e}};d=e.memberDefinitions.getPublicMappedProperties();
for(e=0;e<d.length;e++)config.$item[d[e].name]={$type:d[e].type,$source:d[e].name};b.modelBinderConfig[a.FromPropertyName]=config}else b.modelBinderConfig[a.FromPropertyName]={$type:a.ToType,$source:a.FromPropertyName}}},this)},DefaultSelection:function(a,b,c){a.modelBinderConfig.$type=b;var d=this._query.context._storageModel.getStorageModel(b);this._addPropertyToModelBinderConfig(b,a);c&&c.forEach(function(b){for(var c=b.name.split("."),g=null,h=d,i=0,j=0;j<c.length;j++){if(a.modelBinderConfig.$item){a.selectModelBinderProperty("$item");
i++}a.selectModelBinderProperty(c[j]);g=h.Associations[c[j]];h=this._query.context._storageModel.getStorageModel(g.ToType)}a.modelBinderConfig.$selector=this._isoDataProvider?["json:"+c[c.length-1]+".results","json:"+c[c.length-1]]:"json:"+c[c.length-1];if(g.ToMultiplicity==="*"){a.modelBinderConfig.$type=$data.Array;a.selectModelBinderProperty("$item");a.modelBinderConfig.$type=b.type;this._addPropertyToModelBinderConfig(b.type,a);a.popModelBinderProperty()}else{a.modelBinderConfig.$type=b.type;
this._addPropertyToModelBinderConfig(b.type,a)}for(j=0;j<c.length+i;j++)a.popModelBinderProperty()},this)},VisitProjectionExpression:function(a,b){this.hasProjection=true;this.Visit(a.selector,b);a.selector&&a.selector.expression instanceof $data.Expressions.ObjectLiteralExpression&&(b.modelBinderConfig.$type=a.projectionAs||b.modelBinderConfig.$type||$data.Object)},VisitParametricQueryExpression:function(a,b){a.expression instanceof $data.Expressions.EntityExpression||a.expression instanceof $data.Expressions.EntitySetExpression?
this.VisitEntityAsProjection(a,b):this.Visit(a.expression,b)},VisitEntityAsProjection:function(a,b){this.mapping="";this.Visit(a.expression,b);var c;if(this.mapping&&this._includes instanceof Array){c=this._includes.filter(function(a){return a.name.indexOf(this.mapping+".")===0},this);c=c.map(function(a){return{name:a.name.replace(this.mapping+".",""),type:a.type}},this);c.length>0&&this.DefaultSelection(b,a.expression.entityType,c)}if(a.expression instanceof $data.Expressions.EntityExpression)this.DefaultSelection(b,
a.expression.entityType);else if(a.expression instanceof $data.Expressions.EntitySetExpression){b.modelBinderConfig.$type=$data.Array;b.modelBinderConfig.$item={};b.selectModelBinderProperty("$item");this.DefaultSelection(b,a.expression.elementType);b.popModelBinderProperty()}},VisitEntityFieldExpression:function(a,b){this.Visit(a.source,b);this.Visit(a.selector,b)},VisitMemberInfoExpression:function(a,b){b.modelBinderConfig.$type=a.memberDefinition.type;if(a.memberDefinition.storageModel&&a.memberName in
a.memberDefinition.storageModel.ComplexTypes)this._addPropertyToModelBinderConfig(Container.resolveType(a.memberDefinition.type),b);else if(!b.modelBinderConfig.$type||!Container.resolveType(b.modelBinderConfig.$type).isAssignableTo||!Container.resolveType(b.modelBinderConfig.$type).isAssignableTo($data.Entity))b.modelBinderConfig.$source=a.memberName},VisitEntitySetExpression:function(a,b){if(a.source instanceof $data.Expressions.EntityExpression){this.Visit(a.source,b);this.Visit(a.selector,b)}},
VisitComplexTypeExpression:function(a,b){this.Visit(a.source,b);this.Visit(a.selector,b);if("$selector"in b.modelBinderConfig&&b.modelBinderConfig.$selector.length>0)if(b.modelBinderConfig.$selector instanceof $data.Array){var c=b.modelBinderConfig.$selector[1];b.modelBinderConfig.$selector[0]=c+"."+a.selector.memberName+".results";b.modelBinderConfig.$selector[1]=c+"."+a.selector.memberName}else b.modelBinderConfig.$selector=b.modelBinderConfig.$selector+("."+a.selector.memberName);else b.modelBinderConfig.$selector=
this._isoDataProvider?["json:"+a.selector.memberName+".results","json:"+a.selector.memberName]:"json:"+a.selector.memberName},VisitEntityExpression:function(a,b){this.Visit(a.source,b)},VisitAssociationInfoExpression:function(a,b){if("$selector"in b.modelBinderConfig&&b.modelBinderConfig.$selector.length>0)if(b.modelBinderConfig.$selector instanceof $data.Array){var c=b.modelBinderConfig.$selector[1];b.modelBinderConfig.$selector[0]=c+"."+a.associationInfo.FromPropertyName+".results";b.modelBinderConfig.$selector[1]=
c+"."+a.associationInfo.FromPropertyName}else b.modelBinderConfig.$selector=b.modelBinderConfig.$selector+("."+a.associationInfo.FromPropertyName);else b.modelBinderConfig.$selector=this._isoDataProvider?["json:"+a.associationInfo.FromPropertyName+".results","json:"+a.associationInfo.FromPropertyName]:"json:"+a.associationInfo.FromPropertyName;if(this.mapping&&this.mapping.length>0)this.mapping=this.mapping+".";this.mapping=this.mapping+a.associationInfo.FromPropertyName},VisitObjectLiteralExpression:function(a,
b){b.modelBinderConfig.$type=$data.Object;a.members.forEach(function(a){this.Visit(a,b)},this)},VisitObjectFieldExpression:function(a,b){b.selectModelBinderProperty(a.fieldName);a.expression instanceof $data.Expressions.EntityExpression||a.expression instanceof $data.Expressions.EntitySetExpression?this.VisitEntityAsProjection(a,b):this.Visit(a.expression,b);b.popModelBinderProperty()}});
$data.Class.define("$data.Authentication.AuthenticationBase",null,null,{constructor:function(a){this.configuration=a||{};this.Authenticated=false},Login:function(){Guard.raise("Pure class")},Logout:function(){Guard.raise("Pure class")},CreateRequest:function(){Guard.raise("Pure class")}},null);
$data.Class.define("$data.Authentication.Anonymous",$data.Authentication.AuthenticationBase,null,{constructor:function(a){this.configuration=a||{};this.Authenticated=false},Login:function(){},Logout:function(){},CreateRequest:function(a){$data.ajax(a)}},null);
$data.Class.define("$data.Authentication.FacebookAuth",$data.Authentication.AuthenticationBase,null,{constructor:function(a){this.configuration=$data.typeSystem.extend({Url_code:"",type_code:"",scope:"",Url_token:"",type_token:"",access_token:"",app_id:""},a)},Login:function(a){if(!this.Authenticated){var b=this;b.configuration.stateCallbacks=a||{};$data.ajax({url:this.configuration.Url_code,data:"type="+b.configuration.type_code+"&client_id="+b.configuration.app_id+"&scope="+b.configuration.scope,
type:"POST",dataType:"json",success:function(a){typeof b.configuration.stateCallbacks.pending=="function"&&b.configuration.stateCallbacks.pending(a);b._processRequestToken(a);b.Authenticated=true},error:function(){typeof b.configuration.stateCallbacks.error=="function"&&b.configuration.stateCallbacks.error(arguments)}})}},Logout:function(){this.Authenticated=false},CreateRequest:function(a){if(a){if(a.url.indexOf("access_token=")===-1&&a.url&&this.Authenticated){var b="?";a.url.indexOf(b)>0&&(b="&");
if(this.configuration.access_token)a.url=a.url+b+"access_token="+this.configuration.access_token}$data.ajax(a)}},_processRequestToken:function(a){var b=this;$data.ajax({url:b.configuration.Url_token,data:"type="+b.configuration.type_token+"&client_id="+b.configuration.app_id+"&code="+a.code,type:"POST",dataType:"json",success:function(a){b.configuration.access_token=a.access_token;typeof b.configuration.stateCallbacks.success=="function"&&b.configuration.stateCallbacks.success(a)},error:function(c){var d=
eval("("+c.responseText+")");d.error&&(d.error.message=="authorization_pending"?setTimeout(function(){b._processRequestToken(a)},2E3):typeof b.configuration.stateCallbacks.abort=="function"&&b.configuration.stateCallbacks.abort(arguments))}})}},null);
$data.Class.define("$data.Authentication.BasicAuth.BasicAuth",$data.Authentication.AuthenticationBase,null,{constructor:function(a){this.configuration=$data.typeSystem.extend({Username:"",Password:""},a)},Login:function(a){a&&typeof a.pending=="function"&&a.pending()},Logout:function(){},CreateRequest:function(a){if(a){var b=this,c=a.beforeSend;a.beforeSend=function(a){a.setRequestHeader("Authorization","Basic  "+b.__encodeBase64(b.configuration.Username+":"+b.configuration.Password));typeof c=="function"&&
c(a)};$data.ajax(a)}},__encodeBase64:function(a){input=a;var a="",b,c,d="",e,f,g="",h=0;do{b=input.charCodeAt(h++);c=input.charCodeAt(h++);d=input.charCodeAt(h++);e=b>>2;b=(b&3)<<4|c>>4;f=(c&15)<<2|d>>6;g=d&63;isNaN(c)?f=g=64:isNaN(d)&&(g=64);a=a+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(e)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(b)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(f)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(g)}while(h<
input.length);return a}},null);
$data.Class.define("$data.MetadataLoaderClass",null,null,{load:function(a,b,c){var d={EntityBaseClass:"$data.Entity",ContextBaseClass:"$data.EntityContext",AutoCreateContext:false,DefaultNamespace:("ns"+Math.random()).replace(".","")+a.replace(/[^\w]/g,"_"),ContextInstanceName:"context",EntitySetBaseClass:"$data.EntitySet",CollectionBaseClass:"Array",url:a,user:void 0,password:void 0,withCredentials:void 0,httpHeaders:void 0,typeFilter:"",navigation:true,generateKeys:true,dependentRelationsOnly:false};
$data.typeSystem.extend(d,c||{});if(d.DefaultNamespace&&d.DefaultNamespace.lastIndexOf(".")!==d.DefaultNamespace.length-1)d.DefaultNamespace=d.DefaultNamespace+".";this.factoryCache=this.factoryCache||{};b=$data.typeSystem.createCallbackSetting(b);if(a in this.factoryCache)b.success.apply({},this.factoryCache[a]);else{if(d.url){d.SerivceUri=d.url.replace("/$metadata","");d.metadataUri=d.url.indexOf("/$metadata")===-1?d.url.replace(/\/+$/,"")+"/$metadata":d.url}else b.error("metadata url is missing");
var e=this;e._loadXMLDoc(d,function(a,c){if(c.statusCode<200||c.statusCode>299)b.error(c);else{var h=e._findVersion(a);if(e.xsltRepoUrl){console.log("XSLT: "+e.xsltRepoUrl+e._supportedODataVersionXSLT);e._loadXMLDoc({metadataUri:e.xsltRepoUrl+e._supportedODataVersionXSLT,user:d.user,password:d.password,httpHeaders:d.httpHeaders},function(c,g){if(g.statusCode<200||g.statusCode>299)b.error(g);else{var l=g.responseText,l=l.replace('xmlns:edm="@@VERSIONNS@@"','xmlns:edm="'+h.ns+'"'),l=l.replace("@@VERSION@@",
h.version);if(typeof ActiveXObject==="undefined")c=(new DOMParser).parseFromString(l,"text/xml");else{c=new ActiveXObject("Microsoft.XMLDOM");c.async=false;c.loadXML(l)}e._transform(b,h,a,c,d)}})}else e._transform(b,h,a,void 0,d)}})}},debugMode:{type:"bool",value:!1},xsltRepoUrl:{type:"string",value:""},createFactoryFunc:function(a,b,c){return function(d){if(a){d=$data.typeSystem.extend({name:"oData",oDataServiceHost:b.SerivceUri,user:b.user,password:b.password,withCredentials:b.withCredentials,maxDataServiceVersion:c.maxVersion||
"3.0"},d);return new a(d)}return null}},_transform:function(a,b,c,d,e){c=this._processResults(e.url,b,c,d,e);try{eval(c)}catch(f){a.error(new Exception("SyntaxError","Unexpected model",[f,c]));return}var g;if(!$data.generatedContexts||!(g=$data.generatedContexts.pop()))a.error(new Exception("No context found in service","Not found",[e,c]));else{b=this.createFactoryFunc(g,e,b);this.factoryCache[e.url]=[b,g];b.type=g;if(this.debugMode){b.codeText=c;a.success(b,g,c)}else a.success(b,g)}},_loadXMLDoc:function(a,
b){var c=this;if($data.postMessageODataHandler){if(a.user&&a.password&&(!a.httpHeaders||a.httpHeaders&&!a.httpHeaders.Authorization)){httpHeader=httpHeader||{};httpHeader.Authorization="Basic "+this.__encodeBase64(a.user+":"+a.password)}$data.postMessageODataHandler.requestProxy({url:a.metadataUri,httpHeaders:a.httpHeaders,success:function(a){var c;if(typeof module!=="undefined"&&typeof require!=="undefined")c=a.responseText;else if(window.ActiveXObject){c=new ActiveXObject("Microsoft.XMLDOM");c.async=
"false";c.loadXML(a.responseText)}else c=(new DOMParser).parseFromString(a.responseText,"text/xml");b(c,a)},error:function(){c._loadXHTTP_XMLDoc(a,b)}})}else this._loadXHTTP_XMLDoc(a,b)},_loadXHTTP_XMLDoc:function(a,b){var c=new XMLHttpRequest;c.open("GET",a.metadataUri,true);a.httpHeaders&&Object.keys(a.httpHeaders).forEach(function(b){c.setRequestHeader(b,a.httpHeaders[b])});c.onreadystatechange=function(){c.readyState===4&&b(c.responseXML||c.responseText,{requestUri:a.metadataUri,statusCode:c.status,
statusText:c.statusText,responseText:c.responseText})};a.user&&a.password&&(!a.httpHeaders||a.httpHeaders&&!a.httpHeaders.Authorization)&&c.setRequestHeader("Authorization","Basic "+this.__encodeBase64(a.user+":"+a.password));c.send("")},_processResults:function(a,b,c,d,e){var f=this.getCurrentXSLTVersion(b,c);e.typeFilter=this._prepareTypeFilter(c,b,e);if(window.ActiveXObject){var a=new ActiveXObject("Msxml2.XSLTemplate.6.0"),g=new ActiveXObject("Msxml2.FreeThreadedDOMDocument.6.0");g.async=false;
d?g.load(d):g.loadXML(f);if(g.parseError.errorCode==0){a.stylesheet=g;d=new ActiveXObject("Msxml2.DOMDocument.6.0");d.async=false;d.load(c);if(d.parseError.errorCode==0){c=a.createProcessor();c.input=d;c.addParameter("SerivceUri",e.SerivceUri);c.addParameter("EntityBaseClass",e.EntityBaseClass);c.addParameter("ContextBaseClass",e.ContextBaseClass);c.addParameter("AutoCreateContext",e.AutoCreateContext);c.addParameter("ContextInstanceName",e.ContextInstanceName);c.addParameter("EntitySetBaseClass",
e.EntitySetBaseClass);c.addParameter("CollectionBaseClass",e.CollectionBaseClass);c.addParameter("DefaultNamespace",e.DefaultNamespace);c.addParameter("MaxDataserviceVersion",b.maxVersion||"3.0");c.addParameter("AllowedTypesList",e.typeFilter);c.addParameter("GenerateNavigationProperties",e.navigation);c.transform();return c.output}}return""}if(typeof document!=="undefined"&&document.implementation&&document.implementation.createDocument){d=d?d:(new DOMParser).parseFromString(f,"text/xml");a=new XSLTProcessor;
a.importStylesheet(d);a.setParameter(null,"SerivceUri",e.SerivceUri);a.setParameter(null,"EntityBaseClass",e.EntityBaseClass);a.setParameter(null,"ContextBaseClass",e.ContextBaseClass);a.setParameter(null,"AutoCreateContext",e.AutoCreateContext);a.setParameter(null,"ContextInstanceName",e.ContextInstanceName);a.setParameter(null,"EntitySetBaseClass",e.EntitySetBaseClass);a.setParameter(null,"CollectionBaseClass",e.CollectionBaseClass);a.setParameter(null,"DefaultNamespace",e.DefaultNamespace);a.setParameter(null,
"MaxDataserviceVersion",b.maxVersion||"3.0");a.setParameter(null,"AllowedTypesList",e.typeFilter);a.setParameter(null,"GenerateNavigationProperties",e.navigation);resultDocument=a.transformToFragment(c,document);return resultDocument.textContent}if(typeof module!=="undefined"&&typeof require!=="undefined"){a=require("node_xslt");return a.transform(a.readXsltString(f),a.readXmlString(c),["SerivceUri","'"+e.SerivceUri+"'","EntityBaseClass","'"+e.EntityBaseClass+"'","ContextBaseClass","'"+e.ContextBaseClass+
"'","AutoCreateContext","'"+e.AutoCreateContext+"'","ContextInstanceName","'"+e.ContextInstanceName+"'","EntitySetBaseClass","'"+e.EntitySetBaseClass+"'","CollectionBaseClass","'"+e.CollectionBaseClass+"'","DefaultNamespace","'"+e.DefaultNamespace+"'","MaxDataserviceVersion","'"+(b.maxVersion||"3.0")+"'","AllowedTypesList","'"+e.typeFilter+"'","GenerateNavigationProperties","'"+e.navigation+"'"])}},_prepareTypeFilter:function(a,b,c){b="";if(!(typeof a==="object"&&"querySelector"in a&&"querySelectorAll"in
a))return b;var d=[];if(typeof c.typeFilter==="object"&&c.typeFilter){for(var e=Object.keys(c.typeFilter),f=0;f<e.length;f++){var g=c.typeFilter[e[f]],h={};if(typeof g==="object"&&g)if(Array.isArray(g)){h.Name=e[f];h.Fields=g}else{h.Name=g.name||e[f];h.Fields=g.members||[]}else if(g){h.Name=e[f];h.Fields=[]}else continue;var g=h.Name,i="";if(h.Name.lastIndexOf(".")>0){i=h.Name.substring(0,h.Name.lastIndexOf("."));g=h.Name.substring(h.Name.lastIndexOf(".")+1)}for(var i=a.querySelectorAll("EntityContainer[Name = '"+
i+"']"),j=0;j<i.length;j++){var l=i[j].querySelector("EntitySet[Name = '"+g+"']");if(l!=null){h.Name=l.attributes.EntityType.value;break}}d.push(h)}c=c.dependentRelationsOnly?this._discoverProperyDependencies(d,a,c.navigation,c.generateKeys):this._discoverTypeDependencies(d,a,c.navigation,c.generateKeys);a=a.querySelectorAll("ComplexType");for(f=0;f<a.length;f++){d=a[f].parentNode.attributes.Namespace.value;c.push({Name:!d?a[f].attributes.Name.value:d+"."+a[f].attributes.Name.value,Fields:[]})}for(f=
0;f<c.length;f++){a=c[f];b=a.Fields.length>0?b+(a.Name+":"+a.Fields.join(",")+";"):b+(a.Name+";")}}return b},_discoverTypeDependencies:function(a,b,c,d){for(var e=[],f=[],g=[],h=0;h<a.length;h++){var i=g.indexOf(a[h].Name);i>=0&&g.splice(i,1);this._discoverType(a[h],b,e,f,c,d,true,g)}for(h=0;h<g.length;h++)this._discoverType({Name:g[h],Fields:[]},b,e,f,c,d,false,[]);return e},_discoverType:function(a,b,c,d,e,f,g,h){var i=a.Name;if(!(d.indexOf(i)>=0)){console.log("Discover: "+i);var j=i,l="";if(i.lastIndexOf(".")>
0){l=i.substring(0,i.lastIndexOf("."));j=i.substring(i.lastIndexOf(".")+1)}l=b.querySelector("Schema[Namespace = '"+l+"']");if(l!=null){var w=l.querySelector("EntityType[Name = '"+j+"'], ComplexType[Name = '"+j+"']");if(w!=null){c.push(a);d.push(i);if(f&&a.Fields.length>0){var q=w.querySelectorAll("Key PropertyRef");if(q!=null)for(j=0;j<q.length;j++){var p=q[j].attributes.Name.value;a.Fields.indexOf(p)<0&&a.Fields.splice(j,0,p)}}if(e){w=w.querySelectorAll("NavigationProperty");for(j=0;j<w.length;j++){p=
w[j];if(a.Fields.length==0||a.Fields.indexOf(p.attributes.Name.value)>=0){q=p.attributes.ToRole.value;p=l.querySelector("Association End[Role = '"+p.attributes.FromRole.value+"']:not([Type = '"+i+"'])");p==null&&(p=l.querySelector("Association End[Role = '"+q+"']:not([Type = '"+i+"'])"));if(p!=null){q=p.attributes.Type.value;g?h.indexOf(q)<0&&d.indexOf(q)<0&&h.push(q):this._discoverType({Name:q,Fields:[]},b,c,d,e,f,false,h)}}}}}}}},_discoverProperyDependencies:function(a,b,c,d){for(var e=[],f=a.map(function(a){return a.Name}),
g=0;g<a.length;g++)this._discoverProperties(a[g],b,e,f,c,d);return e},_discoverProperties:function(a,b,c,d,e,f){var g=a.Name;console.log("Discover: "+g);var h=a.Fields.length!=0,i=g,j="";if(g.lastIndexOf(".")>0){j=g.substring(0,g.lastIndexOf("."));i=g.substring(g.lastIndexOf(".")+1)}b=b.querySelector("Schema[Namespace = '"+j+"']");if(b!=null){i=b.querySelector("EntityType[Name = '"+i+"'], ComplexType[Name = '"+i+"']");if(i!=null){c.push(a);if(h){if(f){d=i.querySelectorAll("Key PropertyRef");if(d!=
null)for(c=0;c<d.length;c++){g=d[c].attributes.Name.value;a.Fields.indexOf(g)<0&&a.Fields.splice(c,0,g)}}}else{f=i.querySelectorAll("Property");if(f!=null)for(c=0;c<f.length;c++)a.Fields.push(f[c].attributes.Name.value);if(e){e=i.querySelectorAll("NavigationProperty");for(c=0;c<e.length;c++){h=e[c];f=h.attributes.Name.value;h=[h.attributes.FromRole.value,h.attributes.ToRole.value];i="";for(j=0;j<h.length;j++){var l=b.querySelector("Association End[Role = '"+h[j]+"']");if(l!=null){i=l.attributes.Type.value;
if(i!=g||j==1)break}}d.indexOf(i)>=0&&a.Fields.push(f)}}}}}},_findVersion:function(a){var b="";if(typeof a==="object"&&"getElementsByTagName"in a){var c="http://schemas.microsoft.com/ado/2008/09/edm",d=a.getElementsByTagName("Schema");d&&(d=d[0]);if(d)d=d.attributes;d&&(d=d.getNamedItem("xmlns"));if(d)c=d.value;(b=a.getElementsByTagName("edmx:DataServices")[0]||a.getElementsByTagName("DataServices")[0])&&(b=b.attributes.getNamedItem("m:MaxDataServiceVersion"));if(b&&c)b=b.value;return{ns:c,version:this._supportedODataVersions[c]||
"unknown",maxVersion:b||this._maxDataServiceVersions[c||"unknown"]}}if(typeof module!=="undefined"&&typeof require!=="undefined"){b="http://schemas.microsoft.com/ado/2008/09/edm";c="nodejs";for(d in this._supportedODataVersions)if(a.search(RegExp('<Schema.+xmlns="'+d+'"',"gi"))>=0){b=d;c=this._supportedODataVersions[d];break}return{ns:b,version:c,maxVersion:this._maxDataServiceVersions[c||"unknown"]}}},_supportedODataVersions:{value:{"http://schemas.microsoft.com/ado/2006/04/edm":"V1","http://schemas.microsoft.com/ado/2008/09/edm":"V2",
"http://schemas.microsoft.com/ado/2009/11/edm":"V3","http://schemas.microsoft.com/ado/2007/05/edm":"V11","http://schemas.microsoft.com/ado/2009/08/edm":"V22"}},_maxDataServiceVersions:{value:{"http://schemas.microsoft.com/ado/2006/04/edm":"2.0","http://schemas.microsoft.com/ado/2008/09/edm":"2.0","http://schemas.microsoft.com/ado/2009/11/edm":"3.0","http://schemas.microsoft.com/ado/2007/05/edm":"2.0","http://schemas.microsoft.com/ado/2009/08/edm":"2.0"}},_supportedODataVersionXSLT:{value:"JayDataContextGenerator.xslt"},
getCurrentXSLTVersion:function(a){return this._metadataConverterXSLT.replace("@@VERSIONNS@@",a.ns).replace("@@VERSION@@",a.version)},__encodeBase64:function(a){var b="",c,d,e="",f,g,h="",i=0;do{c=a.charCodeAt(i++);d=a.charCodeAt(i++);e=a.charCodeAt(i++);f=c>>2;c=(c&3)<<4|d>>4;g=(d&15)<<2|e>>6;h=e&63;isNaN(d)?g=h=64:isNaN(e)&&(h=64);b=b+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(f)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(c)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(g)+
"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(h)}while(i<a.length);return b},_metadataConverterXSLT:{type:"string",value:'<xsl:stylesheet version="1.0" xmlns:xsl="http://www.w3.org/1999/XSL/Transform" \r\n                xmlns:edm="@@VERSIONNS@@" \r\n                xmlns:m="http://schemas.microsoft.com/ado/2007/08/dataservices/metadata" \r\n                xmlns:metadata="http://schemas.microsoft.com/ado/2007/08/dataservices/metadata" \r\n                xmlns:annot="http://schemas.microsoft.com/ado/2009/02/edm/annotation" \r\n                xmlns:exsl="http://exslt.org/common" \r\n                xmlns:msxsl="urn:schemas-microsoft-com:xslt" exclude-result-prefixes="msxsl">\r\n\r\n  <xsl:key name="entityType" match="edm:EntityType" use="concat(string(../@Namespace),\'.\', string(@Name))"/>\r\n  <xsl:key name="associations" match="edm:Association" use="concat(string(../@Namespace),\'.\', string(@Name))"/>\r\n\r\n  <xsl:strip-space elements="property item unprocessed"/>\r\n  <xsl:output method="text" indent="no"  />\r\n  <xsl:param name="contextNamespace" />\r\n\r\n  <xsl:param name="SerivceUri" />\r\n  <xsl:param name="EntityBaseClass"/>\r\n  <xsl:param name="ContextBaseClass"/>\r\n  <xsl:param name="AutoCreateContext"/>\r\n  <xsl:param name="ContextInstanceName"/>\r\n  <xsl:param name="EntitySetBaseClass"/>\r\n  <xsl:param name="CollectionBaseClass"/>\r\n  <xsl:param name="DefaultNamespace"/>\r\n  <xsl:param name="MaxDataserviceVersion"/>\r\n  <xsl:param name="AllowedTypesList" />\r\n  <xsl:param name="GenerateNavigationProperties" />\r\n\r\n  <xsl:param name="AllowedTypesListX">Microsoft.Crm.Sdk.Data.Services.Product;Microsoft.Crm.Sdk.Data.Services.LeadAddress:Telephone1,City,UTCOffset;</xsl:param>\r\n\r\n  <xsl:variable name="fullmetadata" select="/" />\r\n  \r\n  <xsl:template name="createFieldsList">\r\n    <xsl:param name="fields" />\r\n    <\!--<xsl:message terminate="no">\r\n      create field: @<xsl:value-of select="$fields"/>@\r\n    </xsl:message>--\>\r\n      <xsl:variable name="thisField">\r\n        <xsl:choose>\r\n          <xsl:when test="contains($fields,\',\')">\r\n            <xsl:value-of select="substring-before($fields, \',\')"/>\r\n          </xsl:when>\r\n          <xsl:otherwise>\r\n            <xsl:value-of select="$fields"/>\r\n          </xsl:otherwise>\r\n        </xsl:choose>\r\n      </xsl:variable>\r\n      <xsl:element name="field">\r\n        <xsl:attribute name="name">\r\n          <xsl:value-of select="$thisField"/>\r\n        </xsl:attribute> \r\n      </xsl:element>\r\n      <xsl:variable name="remaining" select="substring($fields, string-length($thisField) + 2)" />\r\n      <xsl:if test="string-length($remaining) > 0">\r\n        <xsl:call-template name="createFieldsList">\r\n          <xsl:with-param name="fields" select="$remaining" />\r\n        </xsl:call-template>\r\n      </xsl:if>\r\n  </xsl:template>\r\n\r\n  <xsl:template name="createType">\r\n    <xsl:param name="typeFull" />\r\n    <\!--<xsl:message terminate="no">\r\n      create type: <xsl:value-of select="$typeFull"/>\r\n    </xsl:message>--\>\r\n    <xsl:variable name="typeName">\r\n      <xsl:choose>\r\n        <xsl:when test="contains($typeFull,\':\')">\r\n          <xsl:value-of select="substring-before($typeFull, \':\') "/>\r\n        </xsl:when>\r\n        <xsl:otherwise>\r\n          <xsl:value-of select="$typeFull"/>\r\n        </xsl:otherwise>\r\n      </xsl:choose>\r\n    </xsl:variable>\r\n    <xsl:variable name="fields" select="substring($typeFull, string-length($typeName) + 2)" />\r\n    <xsl:element name="type">\r\n      <xsl:attribute name="name">\r\n        <xsl:value-of select="$typeName"/>\r\n      </xsl:attribute>\r\n      <xsl:if test="string-length($fields) > 0">\r\n        <xsl:call-template name="createFieldsList">\r\n          <xsl:with-param name="fields" select="$fields" />\r\n        </xsl:call-template>\r\n      </xsl:if>\r\n    </xsl:element>\r\n  </xsl:template>\r\n  \r\n  <xsl:template name="createTypeList">\r\n    <xsl:param name="types" />\r\n    <\!--<xsl:message terminate="no">\r\n      createTypeList: <xsl:value-of select="$types"/>\r\n    </xsl:message>--\>\r\n        \r\n    <xsl:variable name="thisTypeFull">\r\n      <xsl:choose>\r\n        <xsl:when test="contains($types, \';\')">\r\n          <xsl:value-of select="substring-before($types, \';\')"/>\r\n        </xsl:when>\r\n        <xsl:otherwise>\r\n          <xsl:value-of select="$types"/>\r\n        </xsl:otherwise>\r\n      </xsl:choose>\r\n    </xsl:variable>\r\n\r\n    <xsl:if test="string-length($thisTypeFull) > 0">\r\n      <xsl:call-template name="createType">\r\n        <xsl:with-param name="typeFull" select="$thisTypeFull" />\r\n      </xsl:call-template>\r\n    </xsl:if>\r\n    \r\n    <xsl:variable name="remaining" select="substring($types, string-length($thisTypeFull) + 2)" />\r\n    <\!--<xsl:message terminate="no">\r\n      rem: @<xsl:value-of select="$remaining"/>@  \r\n    </xsl:message>--\>\r\n    \r\n    <xsl:if test="string-length($remaining) > 0">\r\n      <xsl:call-template name="createTypeList">\r\n        <xsl:with-param name="types" select="$remaining" />\r\n      </xsl:call-template>\r\n    </xsl:if>\r\n  </xsl:template>\r\n\r\n  <xsl:variable name="allowedTypes">\r\n    <xsl:call-template name="createTypeList">\r\n      <xsl:with-param name="types" select="$AllowedTypesList" />\r\n    </xsl:call-template>\r\n  </xsl:variable>\r\n  \r\n\r\n<\!-- TODO EXSLT node-set --\>\r\n  <\!--<xsl:variable name="hasTypeFilter" select="boolean(count(msxsl:node-set($allowedTypes)/type) > 0)"/>--\>\r\n  <xsl:variable name="hasTypeFilter">\r\n    <xsl:choose>\r\n      <xsl:when test="function-available(\'msxsl:node-set\')"><xsl:value-of select="boolean(count(msxsl:node-set($allowedTypes)/type) > 0)"/></xsl:when>\r\n      <xsl:otherwise><xsl:value-of select="boolean(count(exsl:node-set($allowedTypes)/type) > 0)"/></xsl:otherwise>\r\n    </xsl:choose>\r\n  </xsl:variable>\r\n  <xsl:template match="/">\r\n\r\n/*//////////////////////////////////////////////////////////////////////////////////////\r\n////// Autogenerated by JaySvcUtil.exe http://JayData.org for more info        /////////\r\n//////                             oData @@VERSION@@                                    /////////\r\n//////////////////////////////////////////////////////////////////////////////////////*/\r\n(function(global, $data, undefined) {\r\n\r\n    \r\n<xsl:for-each select="//edm:EntityType | //edm:ComplexType" xml:space="default">\r\n  <xsl:variable name="thisName" select="concat(../@Namespace, \'.\', @Name)" />\r\n  <\!-- TODO EXSLT node-set--\>\r\n  <\!--<xsl:variable name="thisTypeNode" select="msxsl:node-set($allowedTypes)/type[@name = $thisName]" />--\>\r\n  <xsl:variable name="thisTypeNode">\r\n    <xsl:choose>\r\n      <xsl:when test="function-available(\'msxsl:node-set\')">\r\n        <xsl:copy-of select="msxsl:node-set($allowedTypes)/type[@name = $thisName]"/>\r\n      </xsl:when>\r\n      <xsl:otherwise>\r\n        <xsl:copy-of select="exsl:node-set($allowedTypes)/type[@name = $thisName]"/>\r\n      </xsl:otherwise>\r\n    </xsl:choose>\r\n  </xsl:variable>\r\n  <xsl:variable name="thisTypeNodeExists">\r\n    <xsl:choose>\r\n      <xsl:when test="function-available(\'msxsl:node-set\')">\r\n        <xsl:copy-of select="(count(msxsl:node-set($allowedTypes)/type[@name = $thisName]) > 0)"/>\r\n      </xsl:when>\r\n      <xsl:otherwise>\r\n        <xsl:copy-of select="(count(exsl:node-set($allowedTypes)/type[@name = $thisName]) > 0)"/>\r\n      </xsl:otherwise>\r\n    </xsl:choose>\r\n  </xsl:variable>\r\n  <\!--<xsl:variable name="filterFields" select="(count($thisTypeNode/field) > 0)" />--\>\r\n  <xsl:variable name="filterFields">\r\n    <xsl:choose>\r\n      <xsl:when test="function-available(\'msxsl:node-set\')">\r\n        <xsl:copy-of select="(count(msxsl:node-set($thisTypeNode)/type/field) > 0)"/>\r\n      </xsl:when>\r\n      <xsl:otherwise>\r\n        <xsl:copy-of select="(count(exsl:node-set($thisTypeNode)/type/field) > 0)"/>\r\n      </xsl:otherwise>\r\n    </xsl:choose>\r\n  </xsl:variable>\r\n  <xsl:if test="($hasTypeFilter = \'false\') or ($thisTypeNodeExists = \'true\')">\r\n\r\n      <xsl:message terminate="no">Info: generating type <xsl:value-of select="concat(../@Namespace, \'.\', @Name)"/></xsl:message>\r\n    \r\n      <xsl:variable name="BaseType">\r\n        <xsl:choose>\r\n          <xsl:when test="@BaseType">\r\n            <xsl:value-of select="concat($DefaultNamespace,@BaseType)"/>\r\n          </xsl:when>\r\n          <xsl:otherwise>\r\n            <xsl:value-of select="$EntityBaseClass"  />\r\n          </xsl:otherwise>\r\n        </xsl:choose>\r\n      </xsl:variable>\r\n\r\n\r\n     <xsl:variable name="props">\r\n       <xsl:for-each select="*[local-name() != \'NavigationProperty\' or ($GenerateNavigationProperties = \'true\' and local-name() = \'NavigationProperty\')]">\r\n         <xsl:variable name="fname" select="@Name" />\r\n         <xsl:variable name="isAllowedField">\r\n           <xsl:choose>\r\n             <xsl:when test="function-available(\'msxsl:node-set\')">\r\n               <xsl:copy-of select="(count(msxsl:node-set($thisTypeNode)/type/field[@name = $fname]) > 0)"/>\r\n             </xsl:when>\r\n             <xsl:otherwise>\r\n               <xsl:copy-of select="(count(exsl:node-set($thisTypeNode)/type/field[@name = $fname]) > 0)"/>\r\n             </xsl:otherwise>\r\n           </xsl:choose>\r\n         </xsl:variable>\r\n         <xsl:if test="($filterFields = \'false\') or ($isAllowedField = \'true\')">\r\n           <xsl:apply-templates select="." />\r\n         </xsl:if> \r\n       </xsl:for-each>\r\n      </xsl:variable>\r\n    \r\n      <xsl:text xml:space="preserve">  </xsl:text><xsl:value-of select="$BaseType"  />.extend(\'<xsl:value-of select="concat($DefaultNamespace,../@Namespace)"/>.<xsl:value-of select="@Name"/>\', {\r\n     <xsl:choose>\r\n        <xsl:when test="function-available(\'msxsl:node-set\')">\r\n          <xsl:for-each select="msxsl:node-set($props)/*">\r\n            <xsl:value-of select="."/>\r\n            <xsl:if test="position() != last()">\r\n            <xsl:text>,&#10;     </xsl:text>  \r\n            </xsl:if>\r\n          </xsl:for-each>\r\n        </xsl:when>\r\n        <xsl:otherwise>\r\n          <xsl:for-each select="exsl:node-set($props)/*">\r\n            <xsl:value-of select="."/>\r\n            <xsl:if test="position() != last()">,&#10;     </xsl:if>\r\n          </xsl:for-each>\r\n        </xsl:otherwise>\r\n      </xsl:choose>\r\n      <xsl:variable name="currentName"><xsl:value-of select="concat(../@Namespace,\'.\',@Name)"/></xsl:variable>\r\n      <xsl:for-each select="//edm:FunctionImport[@IsBindable and edm:Parameter[1]/@Type = $currentName]"><xsl:if test="position() = 1">,\r\n      </xsl:if>\r\n        <xsl:apply-templates select="."></xsl:apply-templates><xsl:if test="position() != last()">,\r\n      </xsl:if>\r\n      </xsl:for-each>\r\n  });\r\n\r\n</xsl:if>\r\n</xsl:for-each>\r\n\r\n<xsl:for-each select="//edm:EntityContainer">\r\n  <xsl:text xml:space="preserve">  </xsl:text><xsl:value-of select="$ContextBaseClass"  />.extend(\'<xsl:value-of select="concat(concat($DefaultNamespace,../@Namespace), \'.\', @Name)"/>\', {\r\n     <\!--or (@IsBindable = \'true\' and (@IsAlwaysBindable = \'false\' or @m:IsAlwaysBindable = \'false\' or @metadata:IsAlwaysBindable = \'false\'))--\>\r\n\r\n   <xsl:variable name="subset">\r\n    <xsl:for-each select="edm:EntitySet | edm:FunctionImport">\r\n      <xsl:choose>\r\n        <xsl:when test="function-available(\'msxsl:node-set\')">\r\n          <xsl:if test="($hasTypeFilter = \'false\') or msxsl:node-set($allowedTypes)/type[@name = current()/@EntityType]">\r\n            <xsl:copy-of select="."/>\r\n          </xsl:if>\r\n        </xsl:when>\r\n        <xsl:otherwise>\r\n          <xsl:if test="($hasTypeFilter = \'false\') or exsl:node-set($allowedTypes)/type[@name = current()/@EntityType]">\r\n            <xsl:copy-of select="."/>\r\n          </xsl:if>\r\n        </xsl:otherwise>\r\n      </xsl:choose>\r\n    </xsl:for-each>\r\n  </xsl:variable>\r\n\r\n  \r\n  <xsl:choose>\r\n    <xsl:when test="function-available(\'msxsl:node-set\')">\r\n      <xsl:for-each select="msxsl:node-set($subset)/*[local-name() != \'FunctionImport\' or not(@IsBindable) or @IsBindable = \'false\']">\r\n        <xsl:apply-templates select="."></xsl:apply-templates>\r\n        <xsl:if test="position() != last()">,\r\n     </xsl:if>\r\n      </xsl:for-each>\r\n    </xsl:when>\r\n    <xsl:otherwise>\r\n      <xsl:for-each select="exsl:node-set($subset)/*[local-name() != \'FunctionImport\' or not(@IsBindable) or @IsBindable = \'false\']">\r\n        <xsl:apply-templates select="."></xsl:apply-templates>\r\n        <xsl:if test="position() != last()">,\r\n     </xsl:if>\r\n      </xsl:for-each>\r\n    </xsl:otherwise>\r\n  </xsl:choose>\r\n  });\r\n\r\n  $data.generatedContexts = $data.generatedContexts || [];\r\n  $data.generatedContexts.push(<xsl:value-of select="concat(concat($DefaultNamespace,../@Namespace), \'.\', @Name)" />);\r\n  <xsl:if test="$AutoCreateContext = \'true\'">\r\n  /*Context Instance*/\r\n  <xsl:value-of select="$DefaultNamespace"/><xsl:value-of select="$ContextInstanceName" /> = new <xsl:value-of select="concat(concat($DefaultNamespace,../@Namespace), \'.\', @Name)" />({ name:\'oData\', oDataServiceHost: \'<xsl:value-of select="$SerivceUri" />\', maxDataServiceVersion: \'<xsl:value-of select="$MaxDataserviceVersion" />\' });\r\n</xsl:if>\r\n\r\n</xsl:for-each>\r\n      \r\n})(window, $data);\r\n      \r\n    </xsl:template>\r\n\r\n  <xsl:template match="edm:Key"></xsl:template>\r\n\r\n  <xsl:template match="edm:FunctionImport">\r\n    <xsl:text>\'</xsl:text>\r\n    <xsl:value-of select="@Name"/>\r\n    <xsl:text>\': { type: </xsl:text>\r\n    <xsl:choose>\r\n      <xsl:when test="@IsBindable = \'true\'">\r\n        <xsl:text>$data.ServiceAction</xsl:text>\r\n      </xsl:when>\r\n      <xsl:otherwise>\r\n        <xsl:text>$data.ServiceOperation</xsl:text>\r\n      </xsl:otherwise>\r\n    </xsl:choose>\r\n\r\n    <xsl:apply-templates select="@*" mode="FunctionImport-mode"/>\r\n\r\n    <xsl:variable name="IsBindable">\r\n      <xsl:value-of select="@IsBindable"/>\r\n    </xsl:variable>\r\n    <xsl:text>, params: [</xsl:text>\r\n    <xsl:for-each select="edm:Parameter[($IsBindable = \'true\' and position() > 1) or (($IsBindable = \'false\' or $IsBindable = \'\') and position() > 0)]">\r\n      <xsl:text>{ name: \'</xsl:text>\r\n      <xsl:value-of select="@Name"/>\r\n      <xsl:text>\', type: \'</xsl:text>\r\n      <xsl:variable name="curr" select="@Type"/>\r\n      <xsl:choose>\r\n        <xsl:when test="$fullmetadata//edm:Schema[starts-with($curr, @Namespace)]">\r\n          <xsl:value-of select="concat($DefaultNamespace,$curr)" />\r\n        </xsl:when>\r\n        <xsl:otherwise>\r\n          <xsl:value-of select="$curr" />\r\n        </xsl:otherwise>\r\n      </xsl:choose>\r\n      <xsl:text>\' }</xsl:text>\r\n      <xsl:if test="position() != last()">, </xsl:if>\r\n    </xsl:for-each>    \r\n    <xsl:text>]</xsl:text>\r\n\r\n    <xsl:text> }</xsl:text>\r\n  </xsl:template>\r\n  \r\n  <xsl:template match="@ReturnType" mode="FunctionImport-mode">\r\n    <xsl:text>, returnType: </xsl:text>\r\n    <xsl:choose>\r\n      <xsl:when test="not(.)">null</xsl:when>\r\n      <xsl:when test="starts-with(., \'Collection\')">$data.Queryable</xsl:when>\r\n      <xsl:otherwise>\r\n        <xsl:text>\'</xsl:text>\r\n        <xsl:variable name="curr" select="."/>\r\n        <xsl:choose>\r\n          <xsl:when test="$fullmetadata//edm:Schema[starts-with($curr, @Namespace)]">\r\n            <xsl:value-of select="concat($DefaultNamespace,$curr)" />\r\n          </xsl:when>\r\n          <xsl:otherwise>\r\n            <xsl:value-of select="$curr" />\r\n          </xsl:otherwise>\r\n        </xsl:choose>\r\n        <xsl:text>\'</xsl:text>\r\n      </xsl:otherwise>\r\n    </xsl:choose>\r\n\r\n    <xsl:if test="starts-with(., \'Collection\')">\r\n      <xsl:variable name="len" select="string-length(.)-12"/>\r\n      <xsl:variable name="curr" select="substring(.,12,$len)"/>\r\n      <xsl:variable name="ElementType" >\r\n        <xsl:choose>\r\n          <xsl:when test="$fullmetadata//edm:Schema[starts-with($curr, @Namespace)]">\r\n            <xsl:value-of select="concat($DefaultNamespace,$curr)" />\r\n          </xsl:when>\r\n          <xsl:otherwise>\r\n            <xsl:value-of select="$curr" />\r\n          </xsl:otherwise>\r\n        </xsl:choose>\r\n      </xsl:variable>\r\n      <xsl:text>, elementType: \'</xsl:text>\r\n      <xsl:value-of select="$ElementType"/>\r\n      <xsl:text>\'</xsl:text>\r\n    </xsl:if>\r\n  </xsl:template>\r\n  <xsl:template match="@Name" mode="FunctionImport-mode"></xsl:template>\r\n  <xsl:template match="@m:HttpMethod" mode="FunctionImport-mode">\r\n    <xsl:text>, method: \'</xsl:text>\r\n    <xsl:value-of select="."/>\r\n    <xsl:text>\'</xsl:text>\r\n  </xsl:template>\r\n  <xsl:template match="@IsBindable | @IsSideEffecting | @IsAlwaysBindable | @m:IsAlwaysBindable | @metadata:IsAlwaysBindable | @IsComposable" mode="FunctionImport-mode">\r\n    <xsl:text>, </xsl:text>\r\n    <xsl:call-template name="GetAttributeName">\r\n      <xsl:with-param name="Name" select="name()" />\r\n    </xsl:call-template>\r\n    <xsl:text>: </xsl:text>\r\n    <xsl:value-of select="."/>\r\n  </xsl:template>\r\n  <xsl:template match="@*" mode="FunctionImport-mode">\r\n    <xsl:text>, \'</xsl:text>\r\n    <xsl:call-template name="GetAttributeName">\r\n      <xsl:with-param name="Name" select="name()" />\r\n    </xsl:call-template>\r\n    <xsl:text>\': \'</xsl:text>\r\n    <xsl:value-of select="."/>        \r\n    <xsl:text>\'</xsl:text>\r\n  </xsl:template>\r\n  <xsl:template name="GetAttributeName">\r\n    <xsl:param name="Name" />\r\n    <xsl:choose>\r\n      <xsl:when test="contains($Name, \':\')">\r\n        <xsl:value-of select="substring-after($Name, \':\')"/>\r\n      </xsl:when>\r\n      <xsl:otherwise>\r\n        <xsl:value-of select="$Name"/>\r\n      </xsl:otherwise>\r\n    </xsl:choose>\r\n  </xsl:template>\r\n\r\n  <xsl:template match="edm:EntitySet">\'<xsl:value-of select="@Name"/>\': { type: <xsl:value-of select="$EntitySetBaseClass"  />, elementType: <xsl:value-of select="concat($DefaultNamespace,@EntityType)"/><xsl:text> </xsl:text><xsl:apply-templates select="." mode="Collection-Actions" />}</xsl:template>\r\n\r\n  <xsl:template match="edm:EntitySet" mode="Collection-Actions">\r\n    <xsl:variable name="CollectionType" select="concat(\'Collection(\', @EntityType, \')\')" />\r\n    <xsl:for-each select="//edm:FunctionImport[edm:Parameter[1]/@Type = $CollectionType]">\r\n      <xsl:if test="position() = 1">\r\n        <xsl:text>, actions: { \r\n        </xsl:text>\r\n      </xsl:if>\r\n        <xsl:apply-templates select="."></xsl:apply-templates><xsl:if test="position() != last()">,\r\n        </xsl:if>\r\n      <xsl:if test="position() = last()">\r\n        <xsl:text>\r\n      }</xsl:text>\r\n      </xsl:if>\r\n    </xsl:for-each>\r\n  </xsl:template>\r\n  \r\n  <xsl:template match="edm:Property | edm:NavigationProperty">\r\n    <property>\r\n    <xsl:variable name="memberDefinition">\r\n      <xsl:if test="parent::edm:EntityType/edm:Key/edm:PropertyRef[@Name = current()/@Name]"><attribute name="key">true</attribute></xsl:if>\r\n      <xsl:apply-templates select="@*[local-name() != \'Name\']" mode="render-field" />\r\n    </xsl:variable>\'<xsl:value-of select="@Name"/>\': { <xsl:choose><xsl:when test="function-available(\'msxsl:node-set\')"><xsl:for-each select="msxsl:node-set($memberDefinition)/*">\'<xsl:if test="@extended = \'true\'">$</xsl:if><xsl:value-of select="@name"/>\':<xsl:value-of select="."/>\r\n      <xsl:if test="position() != last()">,<xsl:text> </xsl:text>\r\n    </xsl:if> </xsl:for-each></xsl:when>\r\n  <xsl:otherwise><xsl:for-each select="exsl:node-set($memberDefinition)/*">\'<xsl:if test="@extended = \'true\'">$</xsl:if><xsl:value-of select="@name"/>\':<xsl:value-of select="."/>\r\n      <xsl:if test="position() != last()">,<xsl:text> </xsl:text>\r\n    </xsl:if> </xsl:for-each></xsl:otherwise>\r\n    </xsl:choose> }</property>\r\n</xsl:template>\r\n  \r\n  <xsl:template match="@Name" mode="render-field">\r\n  </xsl:template>\r\n\r\n  <xsl:template match="@Type" mode="render-field">\r\n    <xsl:choose>\r\n      <xsl:when test="starts-with(., \'Collection\')">\r\n        <attribute name="type">\'Array\'</attribute>\r\n        <xsl:variable name="len" select="string-length(.)-12"/>\r\n        <xsl:variable name="currType" select="substring(.,12,$len)"/>\r\n        <xsl:choose>\r\n          <xsl:when test="starts-with($currType, ../../../@Namespace)">\r\n            <attribute name="elementType">\'<xsl:value-of select="$DefaultNamespace"/><xsl:value-of select="$currType" />\'</attribute>\r\n          </xsl:when>\r\n          <xsl:otherwise>\r\n            <attribute name="elementType">\'<xsl:value-of select="$currType" />\'</attribute>\r\n          </xsl:otherwise>\r\n        </xsl:choose>\r\n      </xsl:when>\r\n      <xsl:when test="starts-with(., ../../../@Namespace)">\r\n        <attribute name="type">\'<xsl:value-of select="$DefaultNamespace"/><xsl:value-of select="."/>\'</attribute>\r\n      </xsl:when>\r\n      <xsl:otherwise>\r\n        <attribute name="type">\'<xsl:value-of select="."/>\'</attribute>\r\n      </xsl:otherwise>\r\n    </xsl:choose>\r\n  </xsl:template>\r\n\r\n  <xsl:template match="@ConcurrencyMode" mode="render-field">\r\n    <attribute name="concurrencyMode">$data.ConcurrencyMode.<xsl:value-of select="."/></attribute>\r\n  </xsl:template>\r\n\r\n  <xsl:template match="@Nullable" mode="render-field">\r\n    <attribute name="nullable"><xsl:value-of select="."/></attribute>\r\n    \r\n    <xsl:if test=". = \'false\'">\r\n      <xsl:choose>\r\n        <xsl:when test="parent::edm:Property/@annot:StoreGeneratedPattern = \'Identity\' or parent::edm:Property/@annot:StoreGeneratedPattern = \'Computed\'"></xsl:when>\r\n        <xsl:otherwise><attribute name="required">true</attribute></xsl:otherwise>\r\n      </xsl:choose>\r\n    </xsl:if>\r\n  </xsl:template>\r\n\r\n  <xsl:template match="@annot:StoreGeneratedPattern" mode="render-field">\r\n    <xsl:if test=". != \'None\'"><attribute name="computed">true</attribute></xsl:if>    \r\n  </xsl:template>\r\n\r\n  <xsl:template match="@MaxLength" mode="render-field">\r\n    <attribute name="maxLength">\r\n      <xsl:choose>\r\n        <xsl:when test="string(.) = \'Max\'">Number.POSITIVE_INFINITY</xsl:when>\r\n        <xsl:otherwise>\r\n          <xsl:value-of select="."/>\r\n        </xsl:otherwise>\r\n      </xsl:choose>\r\n    </attribute>\r\n  </xsl:template>\r\n\r\n  <xsl:template match="@FixedLength | @Unicode | @Precision | @Scale" mode="render-field">\r\n  </xsl:template>\r\n  <xsl:template match="@*" mode="render-field">\r\n    <xsl:variable name="nameProp">\r\n      <xsl:choose>\r\n        <xsl:when test="substring-after(name(), \':\') != \'\'">\r\n          <xsl:value-of select="substring-after(name(), \':\')"/>\r\n        </xsl:when>\r\n        <xsl:otherwise>\r\n          <xsl:value-of select="name()"/>\r\n        </xsl:otherwise>\r\n      </xsl:choose>\r\n    </xsl:variable>\r\n    <xsl:element name="attribute"><xsl:attribute name="extended">true</xsl:attribute><xsl:attribute name="name"><xsl:value-of select="$nameProp"/></xsl:attribute>\'<xsl:value-of select="."/>\'</xsl:element>\r\n  </xsl:template>\r\n\r\n  <xsl:template match="@Relationship" mode="render-field">\r\n    <xsl:variable name="relationName" select="string(../@ToRole)"/>\r\n    <xsl:variable name="relationshipName" select="string(.)" />\r\n    <xsl:variable name="relation" select="key(\'associations\',string(.))/edm:End[@Role = $relationName]" />\r\n    <xsl:variable name="otherName" select="../@FromRole" />\r\n    <xsl:variable name="otherProp" select="//edm:NavigationProperty[@ToRole = $otherName and @Relationship = $relationshipName]" />\r\n    <xsl:variable name="m" select="$relation/@Multiplicity" />\r\n    <xsl:choose>\r\n      <xsl:when test="$m = \'*\'">\r\n        <attribute name="type">\'<xsl:value-of select="$CollectionBaseClass"/>\'</attribute>\r\n        <attribute name="elementType">\'<xsl:value-of select="$DefaultNamespace"/><xsl:value-of select="$relation/@Type"/>\'</attribute>\r\n        <xsl:if test="not($otherProp/@Name)">\r\n          <attribute name="inverseProperty">\'$$unbound\'</attribute></xsl:if>\r\n        <xsl:if test="$otherProp/@Name">\r\n          <attribute name="inverseProperty">\'<xsl:value-of select="$otherProp/@Name"/>\'</attribute></xsl:if>\r\n      </xsl:when>\r\n      <xsl:when test="$m = \'0..1\'">\r\n        <attribute name="type">\'<xsl:value-of select="$DefaultNamespace"/><xsl:value-of select="$relation/@Type"/>\'</attribute>\r\n        <xsl:choose>\r\n          <xsl:when test="$otherProp">\r\n            <attribute name="inverseProperty">\'<xsl:value-of select="$otherProp/@Name"/>\'</attribute>\r\n          </xsl:when >\r\n          <xsl:otherwise>\r\n            <attribute name="inverseProperty">\'$$unbound\'</attribute>\r\n            <xsl:message terminate="no">  Warning: inverseProperty other side missing: <xsl:value-of select="."/>\r\n          </xsl:message>\r\n          </xsl:otherwise>\r\n        </xsl:choose>\r\n      </xsl:when>\r\n      <xsl:when test="$m = \'1\'">\r\n        <attribute name="type">\'<xsl:value-of select="$DefaultNamespace"/><xsl:value-of select="$relation/@Type"/>\'</attribute>\r\n        <attribute name="required">true</attribute>\r\n        <xsl:choose>\r\n          <xsl:when test="$otherProp">\r\n            <attribute name="inverseProperty">\'<xsl:value-of select="$otherProp/@Name"/>\'</attribute>\r\n          </xsl:when >\r\n          <xsl:otherwise>\r\n            <attribute name="inverseProperty">\'$$unbound\'</attribute>\r\n            <xsl:message terminate="no">\r\n              Warning: inverseProperty other side missing: <xsl:value-of select="."/>\r\n            </xsl:message>\r\n          </xsl:otherwise>\r\n        </xsl:choose>\r\n      </xsl:when>\r\n    </xsl:choose>\r\n  </xsl:template>\r\n\r\n\r\n  <xsl:template match="@FromRole | @ToRole" mode="render-field"></xsl:template>\r\n\r\n  <xsl:template match="*" mode="render-field">\r\n    <\!--<unprocessed>!!<xsl:value-of select="name()"/>!!</unprocessed>--\>\r\n    <xsl:message terminate="no">  Warning: <xsl:value-of select="../../@Name"/>.<xsl:value-of select="../@Name"/>:<xsl:value-of select="name()"/> is an unknown/unprocessed attribued</xsl:message>\r\n  </xsl:template>\r\n  <\!--<xsl:template match="*">\r\n    !<xsl:value-of select="name()"/>!\r\n  </xsl:template>--\>\r\n</xsl:stylesheet>\r\n'}});
$data.MetadataLoader=new $data.MetadataLoaderClass;
$data.service=function(a,b,c){function d(a){switch(typeof a){case "object":typeof a.success==="function"||typeof a.error==="function"?f=a:e=a;break;case "function":f=a}}var e,f;d(b);d(c);if(typeof a==="object"){e=$data.typeSystem.extend(a,e);a=a.url;delete e.url}b=new $data.PromiseHandler;f=b.createCallback(f);$data.MetadataLoader.load(a,{success:function(a){var b=a.type;if(e){var c=e.serviceName||e.storeAlias;c&&"addStore"in $data&&$data.addStore(c,a,e.isDefault===void 0||e.isDefault)}f.success(a,
b)},error:f.error},e);return b.getPromise()};
(function(a){if(typeof jQuery!=="undefined"){a.Class.define("$data.Deferred",a.PromiseHandlerBase,null,{constructor:function(){this.deferred=new $.Deferred},deferred:{},createCallback:function(b){var b=a.typeSystem.createCallbackSetting(b),c=this;return cbWrapper={success:function(){b.success.apply(c.deferred,arguments);c.deferred.resolve.apply(c.deferred,arguments)},error:function(){Array.prototype.push.call(arguments,c.deferred);b.error.apply(c.deferred,arguments)},notify:function(){b.notify.apply(c.deferred,
arguments);c.deferred.notify.apply(c.deferred,arguments)}}},getPromise:function(){return this.deferred.promise()}},null);a.PromiseHandler=a.Deferred}})($data);
(function(a){a.initService=function(b,c){var d=new a.PromiseHandler,e;if(typeof b==="object"){e=b;var f=e.isSSL||e.isSSL===void 0?"https":"http",g=e.port?":"+e.port:"",b=typeof e.license==="string"&&e.license.toLowerCase()==="business"?e.appId&&e.serviceName?f+"://"+e.appId+".jaystack.net"+g+"/"+e.serviceName:e.url:e.ownerId&&e.appId&&e.serviceName?f+"://open.jaystack.net/"+e.ownerId+"/"+e.appId+"/api/"+e.serviceName:e.url;delete e.url;e=a.typeSystem.extend(e,c)}else e=c;a.service(b,e).then(function(a){return a().onReady().then(function(b){b.serviceFactory=
a;d.deferred.resolve(b,a,a.type)}).fail(function(){d.deferred.reject.apply(d.deferred,arguments)})}).fail(function(){d.deferred.reject.apply(d.deferred,arguments)});return d.getPromise()}})($data);
